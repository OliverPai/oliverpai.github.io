<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>JavaScript</title>
    <url>/2020/02/24/JavaScript/</url>
    <content><![CDATA[<h1 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h1><h2 id="1-åœ¨HTMLä¸­ä½¿ç”¨JS"><a href="#1-åœ¨HTMLä¸­ä½¿ç”¨JS" class="headerlink" title="1 åœ¨HTMLä¸­ä½¿ç”¨JS"></a>1 åœ¨HTMLä¸­ä½¿ç”¨JS</h2><ul>
<li>æ–¹å¼1</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Hello World!&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>æ–¹å¼2</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">src = <span class="string">&quot;main.js&quot;</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//main.js</span><br><span class="line">console.log(&#x27;Hello World!&#x27;)</span><br></pre></td></tr></table></figure>

<h2 id="2-å˜é‡"><a href="#2-å˜é‡" class="headerlink" title="2 å˜é‡"></a>2 å˜é‡</h2><p>ä¸‰ç§æ–¹å¼å£°æ˜</p>
<ol>
<li><p>varï¼šå…¨å±€ä½œç”¨åŸŸï¼Œæœ€ä¸å¸¸ç”¨</p>
</li>
<li><p>letï¼šå¯é‡æ–°èµ‹å€¼çš„å±€éƒ¨å˜é‡</p>
</li>
<li><p>constï¼šä¸å¯é‡æ–°èµ‹å€¼çš„å±€éƒ¨å˜é‡ï¼›å¿…é¡»åˆå§‹åŒ–ï¼Œå¦åˆ™æŠ¥é”™ï¼›æœ€å¸¸ç”¨</p>
</li>
</ol>
<h2 id="3-æ•°æ®ç±»å‹"><a href="#3-æ•°æ®ç±»å‹" class="headerlink" title="3 æ•°æ®ç±»å‹"></a>3 æ•°æ®ç±»å‹</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//string number boolean null undefined</span><br><span class="line">const name = &#x27;John&#x27;; //string</span><br><span class="line">const age = 30;      //number</span><br><span class="line">const rating = 4.5;  //number</span><br><span class="line">const isCool = true; //boolean</span><br><span class="line">const x = null;      //null</span><br><span class="line">const y = undefined; //undefined</span><br><span class="line">let z;               //undefined</span><br><span class="line">//æŸ¥çœ‹å˜é‡çš„æ•°æ®ç±»å‹ï¼štypeof</span><br><span class="line">console.log(typeof x);//æ­¤æ—¶ä¼šè¾“å‡ºobjectè€Œä¸æ˜¯nullï¼Œè¿™æ˜¯JSçš„ä¸€ä¸ªbug</span><br></pre></td></tr></table></figure>

<ul>
<li>JSçš„æ•°å­—ä¸åŒºåˆ†æ•´å½¢å’Œæµ®ç‚¹æ•°</li>
</ul>
<h2 id="4-å­—ç¬¦ä¸²"><a href="#4-å­—ç¬¦ä¸²" class="headerlink" title="4 å­—ç¬¦ä¸²"></a>4 å­—ç¬¦ä¸²</h2><ul>
<li>å­—ç¬¦ä¸²ä¸­åŠ å…¥å˜é‡</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">const name = &#x27;John&#x27;;</span><br><span class="line">const age = 30;</span><br><span class="line">//æ–¹å¼1ï¼šæ‹¼æ¥</span><br><span class="line">console.log(&#x27;My name is &#x27;+name+&#x27; and I am &#x27;+age);</span><br><span class="line">//æ–¹å¼2ï¼šæ¨¡æ¿å­—ç¬¦ä¸²ï¼Œéœ€åå¼•å·</span><br><span class="line">console.log(`My name is $&#123;name&#125; and I am $&#123;age&#125;`);</span><br></pre></td></tr></table></figure>

<ul>
<li>éƒ¨åˆ†å­—ç¬¦ä¸²å±æ€§ä¸æ–¹æ³•</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">const s = &#x27;Hello World!&#x27;;</span><br><span class="line">console.log(s.length);//é•¿åº¦å±æ€§</span><br><span class="line">console.log(s.toUpperCase());//è½¬å¤§å†™æ–¹æ³•</span><br><span class="line">console.log(s.toLowerCase());//è½¬å°å†™æ–¹æ³•</span><br><span class="line">console.log(s.substring(0,5));//æˆªå–å­ä¸²ï¼Œä»0å¼€å§‹ï¼Œåœ¨5ä¹‹å‰ç»“æŸï¼Œè¾“å‡º&#x27;Hello&#x27;</span><br><span class="line">console.log(s.substring(0,5).toUpperCase());//HELLO</span><br><span class="line">//åˆ†å‰²å­—ç¬¦ä¸²åˆ°æ•°ç»„ä¸­</span><br><span class="line">const v = &#x27;technology, computer, it, code&#x27;</span><br><span class="line">console.log(v.split(&#x27;, &#x27;))//è¾“å‡º[technology,computer,it,code];</span><br></pre></td></tr></table></figure>

<h2 id="5-æ•°ç»„"><a href="#5-æ•°ç»„" class="headerlink" title="5 æ•°ç»„"></a>5 æ•°ç»„</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//JSæ•°ç»„ä¸éœ€è¦æŒ‡å®šé•¿åº¦å’Œç±»å‹</span><br><span class="line">/*-------åˆ›å»ºæ•°ç»„-------*/</span><br><span class="line">//åˆ›å»ºæ–¹å¼1</span><br><span class="line">const numbers = new Array(1,2,3,4,5);</span><br><span class="line">//åˆ›å»ºæ–¹å¼2</span><br><span class="line">const fruits = [&#x27;Apple&#x27;, &#x27;Orange&#x27;, 10, true];//JSä¸­æ•°ç»„å¯ä»¥å­˜æ”¾ä¸åŒç±»å‹å€¼</span><br><span class="line">//åœ¨æ•°ç»„æœ«å°¾æ·»åŠ å€¼</span><br><span class="line">fruits[4]=&#x27;Mangos&#x27;;</span><br><span class="line">fruits.push(&#x27;Grapes&#x27;);</span><br><span class="line">//åœ¨æ•°ç»„å¼€å¤´æ·»åŠ å€¼</span><br><span class="line">fruits.unshift(&#x27;Strawberries&#x27;);</span><br><span class="line">//æ•°ç»„æœ«å°¾åˆ é™¤å€¼</span><br><span class="line">fruits.pop();</span><br><span class="line">//åˆ¤æ–­æ˜¯å¦æ˜¯æ•°ç»„</span><br><span class="line">console.log(Array.isArray(fruits));</span><br><span class="line">//å¯»æ‰¾ç´¢å¼•</span><br><span class="line">console.log(fruits.indexOf(&#x27;Orange&#x27;));</span><br></pre></td></tr></table></figure>

<h2 id="6-å¯¹è±¡"><a href="#6-å¯¹è±¡" class="headerlink" title="6 å¯¹è±¡"></a>6 å¯¹è±¡</h2><p>JSä¸­çš„å¯¹è±¡å°±æ˜¯é”®å€¼å¯¹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">const person = &#123;</span><br><span class="line">  firstName:&#x27;John&#x27;,</span><br><span class="line">  lastName:&#x27;Doe&#x27;,</span><br><span class="line">  age:30,</span><br><span class="line">  hobbies:[&#x27;music&#x27;,&#x27;movie&#x27;,&#x27;sport&#x27;],</span><br><span class="line">  address:&#123;//å¯¹è±¡é‡Œå¯ä»¥åµŒå¥—å¯¹è±¡</span><br><span class="line">    street:&#x27;50 main st&#x27;,</span><br><span class="line">    city:&#x27;Boston&#x27;,</span><br><span class="line">    state:&#x27;MA&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//æ‰¾åˆ°&#x27;movie&#x27;</span><br><span class="line">person.hobbies[1]</span><br><span class="line">//æ‰¾åˆ°Boston</span><br><span class="line">person.address.city</span><br></pre></td></tr></table></figure>

<ul>
<li>å®šä¹‰åä»å¯æ·»åŠ å±æ€§</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">person.email = &#x27;john@gmail.com&#x27;</span><br></pre></td></tr></table></figure>

<ul>
<li>è§£æ„</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">const &#123;firstName, lastName&#125; = person;</span><br><span class="line">//firstNameå˜é‡è¢«åˆ›å»ºï¼Œå¹¶èµ‹å€¼ä¸ºperson.firstNameï¼Œå³Bob</span><br><span class="line">//lastNameå˜é‡è¢«åˆ›å»ºï¼Œå¹¶èµ‹å€¼ä¸ºperson.lastNameï¼Œå³Doe</span><br><span class="line"></span><br><span class="line">//å¯¹è±¡é‡Œçš„åµŒå¥—å¯¹è±¡çš„å±æ€§ä¹Ÿå¯ä»¥è¢«ç»“æ„</span><br><span class="line">const &#123;firstName, lastName, address:&#123;city&#125;&#125; = person;</span><br><span class="line">//cityå˜é‡è¢«åˆ›å»ºï¼Œå¹¶èµ‹å€¼ä¸ºperson.address.cityï¼Œå³Boston</span><br></pre></td></tr></table></figure>

<ul>
<li>å¯¹è±¡æ•°ç»„</li>
</ul>
<!---->

<ul>
<li>JSON</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">const todos = [</span><br><span class="line">  &#123;</span><br><span class="line">    id: 1,</span><br><span class="line">    text: &#x27;Take out trash&#x27;,</span><br><span class="line">    isCompleted:true</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: 2,</span><br><span class="line">    text: &#x27;Meeting with boss&#x27;,</span><br><span class="line">    isCompleted:true</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: 3,</span><br><span class="line">    text: &#x27;Dentist appt&#x27;,</span><br><span class="line">    isCompleted:false</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;//æ‰€æœ‰å±æ€§è¦åŠ ä¸ŠåŒå¼•å·</span><br><span class="line">    &quot;id&quot;: 1,</span><br><span class="line">             //å­—ç¬¦ä¸²ä¸èƒ½å†ç”¨å•å¼•å·</span><br><span class="line">    &quot;text&quot;: &quot;Take out trash&quot;,</span><br><span class="line">    isCompleted:true</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;id&quot;: 2,</span><br><span class="line">    &quot;text&quot;: &quot;Meeting with boss&quot;,</span><br><span class="line">    &quot;isCompleted&quot;:true</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;id&quot;: 3,</span><br><span class="line">    &quot;text&quot;: &quot;Dentist appt&quot;,</span><br><span class="line">    &quot;isCompleted&quot;:false</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¯¹è±¡æ•°ç»„è½¬JSON</span></span><br><span class="line"><span class="keyword">const</span> todoJSON = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(todos);</span><br></pre></td></tr></table></figure>

<h2 id="7-å¾ªç¯"><a href="#7-å¾ªç¯" class="headerlink" title="7 å¾ªç¯"></a>7 å¾ªç¯</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//for</span><br><span class="line">for(let i = 0; i &lt; 10; i++)&#123;</span><br><span class="line">  console.log(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//while</span><br><span class="line">let i = 0;</span><br><span class="line">while(i &lt; 10)&#123;</span><br><span class="line">  console.log(i);</span><br><span class="line">  i++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//for...of</span><br><span class="line">for(let todo of todos)&#123;</span><br><span class="line">  console.log(todo.text);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//forEachï¼šforeachæ˜¯æ–¹æ³•ï¼Œè¾“å…¥å‚æ•°ä¸ºå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¸ºæ¯ä¸€ä¸ªæ•°ç»„å…ƒç´ æ‰§è¡Œä»»åŠ¡ï¼Œæ— è¿”å›å€¼</span><br><span class="line">todos.forEach(function(todo)&#123;//todoå¯è¢«çœ‹ä½œæ¯ä¸ªæ•°ç»„å…ƒç´ çš„ä»£ç§°</span><br><span class="line">  console.log(todo.text);</span><br><span class="line">&#125;); </span><br><span class="line"></span><br><span class="line">//mapï¼šä¸forEachä¸€è‡´ï¼Œä½†æ˜¯æœ‰è¿”å›å€¼ï¼Œæœ€åä¼šåˆ›å»ºæ–°æ•°ç»„ï¼Œä¸å½±å“æ—§æ•°ç»„</span><br><span class="line">const todoText = todos.map(function(todo)&#123;</span><br><span class="line">  return todo.text;</span><br><span class="line">&#125;); </span><br><span class="line"></span><br><span class="line">//filterï¼šä¹Ÿä¼šè¿”å›æ–°æ•°ç»„ï¼Œä½†æ˜¯åªæ‘˜å–åŸæ•°ç»„ä¸­æ»¡è¶³æ¡ä»¶çš„å…ƒç´ </span><br><span class="line">const todoCompleted = todos.filter(function(todo)&#123;</span><br><span class="line">  return todo.isCompleted === true;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="8-æ¡ä»¶"><a href="#8-æ¡ä»¶" class="headerlink" title="8 æ¡ä»¶"></a>8 æ¡ä»¶</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if(a &gt; 5)&#123;</span><br><span class="line">  console.log(&#x27;a is bigger than 5&#x27;);</span><br><span class="line">&#125;else if(a &lt; 5)&#123;</span><br><span class="line">  console.log(&#x27;a is less than 5&#x27;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">  console.log(&#x27;a is equal to 5&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">switch(color)&#123;</span><br><span class="line">case &#x27;blue&#x27;:</span><br><span class="line">  console.log(&#x27;color is blue&#x27;);</span><br><span class="line">  break;</span><br><span class="line">case &#x27;red&#x27;:</span><br><span class="line">  console.log(&#x27;color is red&#x27;);</span><br><span class="line">  break;</span><br><span class="line">default:</span><br><span class="line">  console.log(&#x27;color is others&#x27;);</span><br><span class="line">  break;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>JSä¸­&#x3D;&#x3D;&#x3D;è¦æ±‚æ•°æ®ç±»å‹ä¸€è‡´ä¸”æ•°å€¼ç›¸ç­‰ï¼›è€Œ&#x3D;&#x3D;ä¸è¦æ±‚æ•°æ®ä¸€è‡´ï¼Œâ€™10â€™&#x3D;&#x3D;10ï¼Œè‡ªåŠ¨ç±»å‹è½¬æ¢</li>
</ul>
<h2 id="9-å‡½æ•°"><a href="#9-å‡½æ•°" class="headerlink" title="9 å‡½æ•°"></a>9 å‡½æ•°</h2><ul>
<li>å…¸å‹å‡½æ•°</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//æ ¼å¼ï¼šfunction å‡½æ•°å(å‚æ•°å,...)&#123;&#125;</span><br><span class="line">function addNums(num1 = 1, num2 = 1)&#123;//è¿™é‡Œåªæ˜¯è®¾ç½®é»˜è®¤å€¼ï¼Œå¯ä¸å†™=</span><br><span class="line">  return num1+num2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ç®­å¤´å‡½æ•°ï¼Œå¥½å¤„ä½“ç°åœ¨åªæœ‰ä¸€è¡Œçš„å‡½æ•°å¯ä»¥å†™å¾—ç®€çŸ­äº›</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">const addNums(num1 = 1, num2 = 1) =&gt; &#123;</span><br><span class="line">  return num1+num2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10-é¢å‘å¯¹è±¡"><a href="#10-é¢å‘å¯¹è±¡" class="headerlink" title="10 é¢å‘å¯¹è±¡"></a>10 é¢å‘å¯¹è±¡</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/*-------å‡è®¾å·²ç»å®šä¹‰personå¯¹è±¡ä¸ºä¾‹-------*/</span><br><span class="line">//æ„é€ å‡½æ•°</span><br><span class="line">function Person(firstName,lastName,dob)&#123;</span><br><span class="line">  this.firstName = firstName;</span><br><span class="line">  this.lastName = lastName;</span><br><span class="line">  this.dob = new Date(dob);</span><br><span class="line">  //åˆ›å»ºæ–¹æ³•</span><br><span class="line">  this.getBirthday = function()&#123;</span><br><span class="line">    return this.dob.getFullYear();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">//åˆå§‹åŒ–</span><br><span class="line">const person1 = new Person(&#x27;John&#x27;,&#x27;Doe&#x27;,&#x27;4-3-1980&#x27;);</span><br></pre></td></tr></table></figure>

<ul>
<li>åŸå‹</li>
</ul>
<p>åŸå‹æ˜¯æ‰€æœ‰å¯¹è±¡éƒ½ä¼šç»§æ‰¿çš„å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡åœ¨åŸå‹æ·»åŠ å±æ€§ã€æ–¹æ³•ï¼Œå®ç°åœ¨å¯¹è±¡ä¸­æ·»åŠ å±æ€§ä¸æ–¹æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function Person(firstName,lastName,dob)&#123;</span><br><span class="line">  this.firstName = firstName;</span><br><span class="line">  this.lastName = lastName;</span><br><span class="line">  this.dob = new Date(dob);</span><br><span class="line">&#125;</span><br><span class="line">//åˆ›å»ºæ–¹æ³•</span><br><span class="line">Person.prototype.getBirthday = function()&#123;</span><br><span class="line">  return this.dob.getFullYear();</span><br><span class="line">&#125;</span><br><span class="line">//åˆå§‹åŒ–</span><br><span class="line">const person1 = new Person(&#x27;John&#x27;,&#x27;Doe&#x27;,&#x27;4-3-1980&#x27;);</span><br><span class="line">//è°ƒç”¨æ–¹æ³•ä¸éœ€è¦å†™åŸå‹</span><br><span class="line">person1.getBirthday();</span><br></pre></td></tr></table></figure>

<ul>
<li>ç±»ï¼šES6å¼•å…¥å…ˆç‰¹æ€§ï¼Œä¸ä¸Šè¿°å¯¹è±¡è¡Œä¸ºä¸€è‡´ï¼Œåªæ˜¯å†™æ³•æ›´æ¸…æ™°</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">class Person &#123;</span><br><span class="line">  //æ„é€ å‡½æ•°</span><br><span class="line">  constructor(firstName, lastName, dob)&#123;</span><br><span class="line">    this.firstName = firstName;</span><br><span class="line">    this.lastName = lastName;</span><br><span class="line">    this.dob = new Date(dob);</span><br><span class="line">  &#125;</span><br><span class="line">  //æ–¹æ³•</span><br><span class="line">  getBirthday()&#123;</span><br><span class="line">    return this.dob.getFullYear();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="11-DOM"><a href="#11-DOM" class="headerlink" title="11 DOM"></a>11 DOM</h2><p>DOM(Document Object Model)ï¼Œæ˜¯å€ŸåŠ©windowå¯¹è±¡çš„documentå±æ€§ï¼Œè·å–HTMLçš„IDã€ç±»ã€æ ‡ç­¾ã€æ–‡æœ¬ç­‰ç­‰å…ƒç´ ï¼Œå¹¶ä¸”å¯ä»¥å¯¹HTML\CSSè¿›è¡Œä¿®æ”¹ï¼Œä»è€Œè·å–æœ‰ç”¨æ•°æ®æˆ–è€…æ”¹å˜ç½‘é¡µçŠ¶æ€ã€‚</p>
<ul>
<li>windowå¯¹è±¡å°±æ˜¯æµè§ˆå™¨çš„çª—å£ï¼Œç½‘é¡µåº”ç”¨çš†ç»§æ‰¿windowå¯¹è±¡</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="12-åŒæ­¥ä¸å¼‚æ­¥"><a href="#12-åŒæ­¥ä¸å¼‚æ­¥" class="headerlink" title="12 åŒæ­¥ä¸å¼‚æ­¥"></a>12 åŒæ­¥ä¸å¼‚æ­¥</h2>]]></content>
      <categories>
        <category>ç¼–ç¨‹è¯­è¨€</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>åœ¨çº¿ä¼˜åŒ–åˆ©å™¨â€”â€”æé›…æ™®è¯ºå¤«ä¼˜åŒ–</title>
    <url>/2022/01/30/Lyapunov%20Optimization/</url>
    <content><![CDATA[<h1 id="Lyapunov-Optimization"><a href="#Lyapunov-Optimization" class="headerlink" title="Lyapunov Optimization"></a>Lyapunov Optimization</h1><p><a href="https://en.wikipedia.org/wiki/Lyapunov_optimization" title="ç»´åŸºç™¾ç§‘æé›…æ™®è¯ºå¤«ä¼˜åŒ–ä»‹ç»">ç»´åŸºç™¾ç§‘æé›…æ™®è¯ºå¤«ä¼˜åŒ–ä»‹ç»</a></p>
<p><a href="https://en.wikipedia.org/wiki/Drift_plus_penalty" title="ç»´åŸºç™¾ç§‘æ¼‚ç§»åŠ ç½šä»‹ç»">ç»´åŸºç™¾ç§‘æ¼‚ç§»åŠ ç½šä»‹ç»</a></p>
<p><a href="http://hliangzhao.me/math/Lyapunov_optimization.pdf" title="æµ™å¤§èµµæµ·äº®æ–‡æ¡£">æµ™å¤§èµµæµ·äº®æ–‡æ¡£</a></p>
<blockquote>
<p>æé›…æ™®è¯ºå¤«ä¼˜åŒ–æ—¨åœ¨ï¼Œåˆ©ç”¨æé›…æ™®è¯ºå¤«å‡½æ•°(Lyapunov function)ä»¥éè´Ÿæ ‡é‡çš„å½¢å¼æè¿°ä¸€ä¸ªç”¨å¤šç»´å‘é‡è¡¨ç¤ºçš„çŠ¶æ€ï¼Œé€šè¿‡ä¼˜åŒ–è¯¥å‡½æ•°å®ç°é€¼è¿‘ç”¨å‘é‡è¡¨ç¤ºçš„åŸé—®é¢˜çš„æœ€ä¼˜è§£</p>
</blockquote>
<p><strong>æé›…æ™®è¯ºå¤«ä¼˜åŒ–çš„ä¸€èˆ¬æ­¥éª¤</strong></p>
<p>ä¸ºéšæœºä¼˜åŒ–é—®é¢˜å»ºæ¨¡ â†’ æ„é€ é˜Ÿåˆ— â†’ å¾—åˆ°ä½¿ç”¨æé›…æ™®è¯ºå¤«ä¼˜åŒ–æ±‚çš„è§£ â†’ åˆ†æè§£ä¸åŸå§‹æœ€ä¼˜è§£çš„å·®è·</p>
<h2 id="1-éšæœºä¼˜åŒ–å»ºæ¨¡"><a href="#1-éšæœºä¼˜åŒ–å»ºæ¨¡" class="headerlink" title="1. éšæœºä¼˜åŒ–å»ºæ¨¡"></a>1. éšæœºä¼˜åŒ–å»ºæ¨¡</h2><p>&amp;#x20;      éšæœºä¼˜åŒ–é—®é¢˜ä¸­çš„â€œéšæœºâ€æŒ‡çš„æ˜¯æ¯ä¸ªæ—¶é—´ç‰‡å†…éƒ½æœ‰éšæœºäº‹ä»¶å‘ç”Ÿï¼Œé’ˆå¯¹éšæœºäº‹ä»¶æœ‰ç›¸åº”çš„ç­–ç•¥ã€‚å®šä¹‰ç¬¬tä¸ªæ—¶éš™å†…äº§ç”Ÿçš„æ‰€æœ‰éšæœºäº‹ä»¶ä¸º$\textbf{w}(t)\triangleq[w_1(t),w_2(t),â€¦,w_n(t)]\in\Omega^n$ï¼Œç³»ç»Ÿåœ¨æ¯ä¸ªæ—¶é—´ç‰‡å†…é‡‡å–çš„ç­–ç•¥ï¼Œå³â€œåŠ¨ä½œâ€ï¼ˆcontrol actionï¼‰å®šä¹‰ä¸º$\alpha(t)\triangleq[\alpha_1(t),\alpha_2(t),â€¦,\alpha_m(t)]\in\mathcal{A}^m$ï¼Œå…¶ä¸­$\Omega^nå’Œ\mathcal{A}^m$åˆ†åˆ«æ˜¯éšæœºäº‹ä»¶å’Œæ§åˆ¶å†³ç­–çš„é›†åˆã€‚</p>
<p>&amp;#x20;      å¦‚æœæˆ‘ä»¬çš„ç›®æ ‡å‡½æ•°æ˜¯$p(t)$ï¼Œé‚£ä¹ˆåœ¨æ¯ä¸ªæ—¶éš™tï¼Œå®ƒä¼šæ ¹æ®å‘ç”Ÿçš„éšæœºäº‹ä»¶å’Œé‡‡å–çš„æªæ–½ï¼Œè®¡ç®—å‡ºå½“å‰æ—¶éš™çš„ç›®æ ‡å‡½æ•°å€¼ï¼Œå³$p(t)&#x3D;P(\textbf{w}(t),\alpha(t))$ï¼Œå…¶ä¸­$P(\cdot)$æ˜¯ä¸€ä¸ªç¡®å®šçš„å‡½æ•°ã€‚è¿™é‡Œçš„$p(t)$çš„ç‰©ç†å«ä¹‰å¯ä»¥å¾ˆä¸°å¯Œï¼Œæ¯”å¦‚ä»¤å…¶è¡¨ç¤ºåŠŸç‡ï¼Œé‚£ä¹ˆé—®é¢˜å°±æ˜¯æœ€å°åŒ–åŠŸç‡æ¶ˆè€—ï¼›ä»¤å…¶ä¸ºååé‡çš„è´Ÿ$p(t)&#x3D;-r(t)$ï¼Œé‚£ä¹ˆæœ€å°åŒ–$p(t)$å°±æ˜¯åœ¨æœ€å¤§åŒ–ååé‡ã€‚æ­¤å¤–ï¼Œç³»ç»Ÿä¸­çš„ä¸€ç³»åˆ—å˜é‡ä¹Ÿä¼šå—åˆ°éšæœºäº‹ä»¶å’Œæ§åˆ¶å†³ç­–çš„å½±å“ï¼Œå¯ä»¥æè¿°ä¸º$y_k(t)&#x3D;Y_k(\textbf{w}(t),\alpha(t)),k\in{1,â€¦,K}$ï¼Œå…¶ä¸­$\forall k\in{1,â€¦,K}ï¼ŒY_k(\cdot)$å‡ä¸ºç¡®å®šå‡½æ•°ã€‚ç”±äºæœ€ç»ˆéœ€è¦æŠŠæ‰€æœ‰æ—¶é—´ç‰‡çš„è¡¨ç°éƒ½è€ƒè™‘è¿›å»ï¼Œä»è€Œå¾—åˆ°æœ€ç»ˆç³»ç»Ÿè¡¨ç°ï¼Œæ‰€ä»¥åœ¨ä¼˜åŒ–ç›®æ ‡æ—¶ï¼Œéœ€è¦ä¼˜åŒ–çš„æ˜¯å„æ—¶é—´ç‰‡çš„ç›®æ ‡å‡½æ•°å€¼çš„å¹³å‡ã€‚</p>
<p>é‚£ä¹ˆéšæœºä¼˜åŒ–é—®é¢˜çš„æ ‡å‡†å½¢å¼ä¸ºï¼š</p>
<p>$$<br>\begin{aligned}\mathcal{P}1:&amp;\min_{\forall t,\alpha(t)\in\mathcal{A}^m}\lim_{T\rightarrow\infty}\frac 1 T\sum_{t&#x3D;0}^{T-1}\mathbb{E}[p(t)]\s.t.&amp;\ \lim_{T\rightarrow\infty}\frac 1 T\sum_{t&#x3D;0}^{T-1}\mathbb{E}[y_k(t)]\le 0,k\in{1,â€¦,K}\end{aligned}<br>$$</p>
<h2 id="2-é˜Ÿåˆ—æ„é€ "><a href="#2-é˜Ÿåˆ—æ„é€ " class="headerlink" title="2 é˜Ÿåˆ—æ„é€ "></a>2 é˜Ÿåˆ—æ„é€ </h2><p>&amp;#x20;     æé›…æ™®è¯ºå¤«ä¼˜åŒ–å¸Œæœ›å°†é•¿æœŸçº¦æŸåˆ†å‰²åˆ°å„ä¸ªæ—¶é—´ç‰‡ä¸­ï¼Œåœ¨æ¯ä¸ªæ—¶é—´ç‰‡çº¦æŸå˜é‡éµå®ˆç›¸åº”çš„æ¡ä»¶ï¼Œä»è€Œä½¿å¾—é•¿æœŸçº¦æŸä¸è¢«ç ´åï¼Œå³ä¿æŒç¨³å®šã€‚ç”±æ­¤ï¼Œæ¯ä¸€ä¸ªçº¦æŸ$y_k(t)$å¯ä»¥å¯¹åº”ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—ä¸­çš„å…ƒç´ éšæ—¶é—´ç‰‡çš„è¿­ä»£è€Œè¿›è¿›å‡ºå‡ºï¼Œæœ€ç»ˆè¾¾æˆä¿æŒé˜Ÿåˆ—ç¨³å®šçš„ç›®æ ‡ã€‚å®šä¹‰åˆå€¼ä¸º0çš„é˜Ÿåˆ—ä¸ºï¼š</p>
<p>$$<br>Q_k(t+1)&#x3D;\max{Q_k(t)+y_k(t),0},k\in{1,2,â€¦,K}<br>$$</p>
<p>è¿™é‡Œçš„$y_k(t)$å¯ä»¥ç”¨$y_k(t)&#x3D;a_k(t)-b_k(t)$ï¼Œå…¶ä¸­$a_k(t)$æ˜¯è¿›ï¼Œ$b_k(t)$æ˜¯å‡ºï¼Œä»è€Œå®ç°é˜Ÿåˆ—çš„è¿›å‡ºã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„$Q_k(t)$å¹¶ä¸æ˜¯é˜Ÿåˆ—æœ¬èº«ï¼Œè€Œæ˜¯é˜Ÿåˆ—çš„ç§¯å‹é‡(backlog)ã€‚è€Œç”±äºå‰é¢éšæœºä¼˜åŒ–é—®é¢˜ä¸­çš„çº¦æŸæ¡ä»¶ï¼Œæˆ‘ä»¬å¸Œæœ›æ¯ä¸€ä¸ªæ—¶é—´ç‰‡çš„$b_k(t)$å°½å¯èƒ½å¤§äºç­‰äº$a_k(t)$ï¼Œä»è€Œä½¿$y_k(t)$å°½å¯èƒ½å°äºç­‰äº0ã€‚</p>
<p>æ˜“å¾—$y_k(t)\le Q_k(t+1)-Q_k(t)$ï¼Œå¯¹æ‰€æœ‰æ—¶é—´ç‰‡ç´¯åŠ å¯å¾—$\sum_{t&#x3D;0}^{T-1}y_k(t)\le Q_k(T)-Q_k(0)&#x3D;Q_k(T),k&#x3D;{1,2,â€¦,K}$ï¼Œå–æœŸæœ›å¯å¾—ï¼š</p>
<p>$$<br>\frac 1 T\sum_{t&#x3D;0}^{T-1}\mathbb{E}[y_k(t)]\le \frac{\mathbb{E}[Q_k(T)]}T,k\in{1,2,â€¦,K}<br>$$</p>
<p>ç”±äºå‰é¢éšæœºä¼˜åŒ–çš„çº¦æŸ$\lim_{T\rightarrow\infty}\frac 1 T\sum_{t&#x3D;0}^{T-1}\mathbb{E}[y_k(t)]\le 0,k\in{1,â€¦,K}$ï¼Œå†ç”±äºä¸Šå¼ï¼Œå¯ä»¥å¾—åˆ°æé›…æ™®è¯ºå¤«å½¢å¼çš„éšæœºä¼˜åŒ–çº¦æŸæ¡ä»¶$\lim_{T\rightarrow\infty}\frac{\mathbb{E}[Q_k(T)]}{T}&#x3D;0,k\in{1,2,â€¦,K}$ã€‚</p>
<p>å› æ­¤ï¼Œæ„é€ å¥½è™šæ‹Ÿé˜Ÿåˆ—çš„éšæœºä¼˜åŒ–é—®é¢˜æ–°å½¢å¼å¯è¡¨ç¤ºä¸ºï¼š</p>
<p>$$<br>\begin{aligned}\mathcal{P}2:&amp;\min_{\forall t,\alpha(t)\in\mathcal{A}^m}\lim_{T\rightarrow\infty}\frac 1 T\sum_{t&#x3D;0}^{T-1}\mathbb{E}[p(t)]&amp;(1)\&amp;s.t.\lim_{T\rightarrow\infty}\frac{\mathbb{E}[Q_k(T)]}{T}&#x3D;0,k\in{1,2,â€¦,K}\qquad&amp;(2)\end{aligned}<br>$$</p>
<blockquote>
<p>ğŸ“Œæ³¨ï¼šå…¶å®æé›…æ™®è¯ºå¤«å½¢å¼çš„çº¦æŸæ¡ä»¶è¿˜æœ‰å¦ä¸€ç§æ›´åŠ ä¸¥æ ¼çš„è¡¨è¿°ï¼Œå³ä¸‹å¼ï¼Œä½†ä¸€èˆ¬é‡‡ç”¨ä¸Šå¼</p>
</blockquote>
<p>$$<br>\exist\delta\le 0,\lim_{T\rightarrow 0}\frac{\mathbb{E}[Q_k(T)]}T\le\delta,k\in{1,2,â€¦,K}<br>$$</p>
<h2 id="3-æ¼‚ç§»åŠ ç½šç®—æ³•-drift-plus-penalty-algorithm"><a href="#3-æ¼‚ç§»åŠ ç½šç®—æ³•-drift-plus-penalty-algorithm" class="headerlink" title="3 æ¼‚ç§»åŠ ç½šç®—æ³•(drift plus penalty algorithm)"></a>3 æ¼‚ç§»åŠ ç½šç®—æ³•(drift plus penalty algorithm)</h2><p>å°†é˜Ÿåˆ—å…¨ä½“ç”¨ä¸€ä¸ªå‘é‡è¡¨ç¤ºä¸º$(t)\triangleq[Q_1(t),Q_2(t),â€¦,Q_K(t)]$ï¼Œåˆ™æé›…æ™®è¯ºå¤«å‡½æ•°å®šä¹‰ä¸º</p>
<p>$$<br>L(\Theta(t))\triangleq\frac 1 2\sum_{k&#x3D;1}^KQ_k(t)^2<br>$$</p>
<p>ä»è€Œï¼Œå¯åˆ©ç”¨æé›…æ™®è¯ºå¤«å‡½æ•°æè¿°é˜Ÿåˆ—åœ¨æ—¶éš™tçš„ç§¯å‹é‡$\Delta(\Theta(t))\triangleq L(\Theta(t+1))-L(\Theta(t))$ï¼Œè¯¥å¼è¢«ç§°ä¸ºæé›…æ™®è¯ºå¤«æ¼‚ç§»(Lyapunov drift)ã€‚æ˜“å¾—$Q_k(t+1)^2\le(Q_k(t)+y_k(t))^2,k\in{1,2,â€¦,K}$ï¼Œå¯¹Kä¸ªé˜Ÿåˆ—è¿›è¡Œç´¯åŠ å¯å¾—</p>
<p>$$<br>\frac 1 2\sum_{k&#x3D;1}^KQ_k(t+1)^2\le\frac 1 2\sum_{k&#x3D;1}^KQ_k(t)^2+\frac 1 2\sum_{k&#x3D;1}^Ky_k(t)^2+\sum_{k&#x3D;1}^KQ_k(t)y_k(t)<br>$$</p>
<p>ç”±äºé˜Ÿåˆ—çš„è¿›å‡ºéƒ½æ˜¯æœ‰é™çš„ï¼Œå› æ­¤$\frac 1 2\sum_{k&#x3D;1}^Ky_k(t)^2$æ˜¯å­˜åœ¨ä¸Šç•Œ$B&gt;0$çš„ï¼Œæ‰€ä»¥å¯å¾—</p>
<p>$$<br>\begin{aligned}\Delta(\Theta(t))&amp;\triangleq\frac 1 2\sum_{k&#x3D;1}^KQ_k(t+1)^2-\frac 1 2\sum_{k&#x3D;1}^KQ_k(t)^2\&amp;\le\frac 1 2\sum_{k&#x3D;1}^Ky_k(t)^2+\sum_{k&#x3D;1}^KQ_k(t)y_k(t)\le B+\sum_{k&#x3D;1}^KQ_k(t)y_k(t)\end{aligned}\qquad(3)<br>$$</p>
<p>$$<br>\begin{aligned}\mathcal{P}3:\min_{\forall t,\alpha(t)\in\mathcal{A}^m}\mathbb{E}[\Delta(\Theta(t))+V\cdot p(t)|\mathcal{\Theta}(t)]\s.t.\lim_{T\rightarrow\infty}\frac{\mathbb{E}[Q_k(T)]}{T}&#x3D;0,k\in{1,2,â€¦,K}\end{aligned}<br>$$</p>
<p>å…¶ä¸­ï¼ŒVæ˜¯ä¸€ä¸ªæƒé‡ï¼Œç”¨æ¥è°ƒèŠ‚å¯¹äºŒè€…çš„é‡è§†ç¨‹åº¦ã€‚ç„¶è€Œæ­¤æ—¶è®¡ç®—æé›…æ™®è¯ºå¤«æ¼‚ç§»éœ€è¦ä¸‹ä¸€æ—¶éš™çš„æ’é˜Ÿä¿¡æ¯ï¼Œè¿™æ ·çš„è¯æ— æ³•åœ¨å½“å‰æ—¶éš™ä¸­æ±‚å¾—è¯¥é—®é¢˜çš„è§£ï¼Œä½†æ˜¯å¯ä»¥åˆ©ç”¨å¼(3)å¯¹é—®é¢˜$\mathcal{P}3$è¿›è¡Œæ”¾ç¼©ï¼Œä»è€Œå¾—åˆ°é—®é¢˜$\mathcal{P}4$ ï¼š</p>
<p>$$<br>\mathcal{P}4:\min_{\forall t,\alpha(t)\in\mathcal{A}^m}\mathbb{E}[B+V\cdot p(t)+\sum_{k&#x3D;1}^KQ_k(t)y_k(t)|\Theta(t)]\s.t.\lim_{T\rightarrow\infty}\frac{\mathbb{E}[Q_k(T)]}{T}&#x3D;0,k\in{1,2,â€¦,K}<br>$$</p>
<p>æ¼‚ç§»åŠ ç½šç®—æ³•ï¼ˆDPPï¼‰ï¼Œå°±æ˜¯æ±‚è§£$\mathcal{P}4$çš„è¿‘ä¼¼æœ€ä¼˜è§£ä»è€Œæ±‚è§£$\mathcal{P}3$</p>
<p>ç®—æ³•æ­¥éª¤ï¼š</p>
<p>ï¼ˆ1ï¼‰åœ¨æ—¶éš™tå¼€å¤´ï¼Œè§‚å¯Ÿå‘ç”Ÿçš„æ‰€æœ‰éšæœºäº‹ä»¶ä»¥åŠæ‰€æœ‰é˜Ÿåˆ—çš„ç§¯å‹é‡ï¼š$\textbf{w}(t),\Theta(t)$</p>
<p>ï¼ˆ2ï¼‰é€šè¿‡æ±‚è§£å¦‚ä¸‹é—®é¢˜ç¡®å®šæœ€ä¼˜çš„æ§åˆ¶å†³ç­–$\alpha^*(t)$ï¼š</p>
<p>$$<br>\alpha^*(t)&#x3D;\argmin_{\alpha(t)\in\mathcal{A}^m}\mathbb{E}[B+V\cdot p(t)+\sum_{k&#x3D;1}^KQ_k(t)y_k(t)|\Theta(t)]\qquad(4)<br>$$</p>
<p>ï¼ˆ3ï¼‰$\forall k\in{1,2,â€¦,K},Q_k(t+1)&#x3D;\max{Q_k(t)+y_k(t),0}$æ›´æ–°$Q_k(t)$</p>
<p>ï¼ˆ4ï¼‰$t\leftarrow t+1$</p>
<blockquote>
<p>ğŸ“Œå¯ä»¥çœ‹åˆ°æ¼‚ç§»åŠ ç½šç®—æ³•å¹¶æ²¡æœ‰ç®¡çº¦æŸæ¡ä»¶(2)ï¼Œä¸‹æ–¹è¯æ˜ç®—æ³•éšå¼åœ°æ»¡è¶³çº¦æŸ</p>
</blockquote>
<h2 id="4-æ€§èƒ½åˆ†æ"><a href="#4-æ€§èƒ½åˆ†æ" class="headerlink" title="4 æ€§èƒ½åˆ†æ"></a>4 æ€§èƒ½åˆ†æ</h2><h3 id="4-1-è®¡ç®—ç»“æœç²¾åº¦"><a href="#4-1-è®¡ç®—ç»“æœç²¾åº¦" class="headerlink" title="4.1 è®¡ç®—ç»“æœç²¾åº¦"></a>4.1 è®¡ç®—ç»“æœç²¾åº¦</h3><ul>
<li><p>æœ€ä¼˜$\textbf{w}-only$ç­–ç•¥ï¼š</p>
<p>$\textbf{w}-only\ policy$æ˜¯æŒ‡æ¯ä¸ªæ—¶éš™å†…ä»…ä¾èµ–äºè§‚æµ‹åˆ°çš„$\textbf{w}(t)$é€‰æ‹©æœ€ä¼˜æ§åˆ¶åŠ¨ä½œï¼Œè€Œä¸ä¾èµ–äºé˜Ÿåˆ—çŠ¶æ€(backlog)çš„ç­–ç•¥ã€‚æœ€ä¼˜$\textbf{w}-only$åˆ™æ˜¯æ»¡è¶³å¦‚ä¸‹æ¡ä»¶çš„$\textbf{w}-only$ç­–ç•¥ï¼š</p>
</li>
</ul>
<p>åœ¨æ¯ä¸ªæ—¶éš™å†…ï¼Œé‡‡å–åŠ¨ä½œ$\alpha^*(t)$æ»¡è¶³ï¼š</p>
<p>$$<br>P(\textbf{w}(t),\alpha^*(t))&#x3D;p^<em>\Y_k(\textbf{w}(t),\alpha^</em>(t))\le0,\ k\in{1,2,â€¦,K}\qquad(5)<br>$$</p>
<p>å…¶ä¸­$p^*$æ˜¯ä¸è€ƒè™‘çº¦æŸæ¡ä»¶çš„åŸé—®é¢˜$\mathcal{P}1$çš„æœ€ä¼˜ç›®æ ‡å‡½æ•°å€¼ï¼Œå³</p>
<p>$$<br>p^*&#x3D;\min(\lim_{T\rightarrow\infty}\frac 1 T\sum_{t&#x3D;0}^{T-1}\mathbb{E}[p(t)])<br>$$</p>
<blockquote>
<p>ğŸ“Œå®šç†ï¼šå¦‚æœåŸå§‹é—®é¢˜P1æœ‰æœ€ä¼˜è§£ï¼Œé‚£ä¹ˆP1ä¸€å®šå­˜åœ¨æœ€ä¼˜w-onlyç­–ç•¥</p>
</blockquote>
<ul>
<li>DPPè§£ä¸æœ€ä¼˜è§£ä¹‹é—´çš„å·®è·ï¼š</li>
</ul>
<p>ç”±å¼(3)&amp;(4)å¯å¾—ï¼Œ</p>
<p>$$<br>\begin{aligned}\Delta(\Theta(t))+V\cdot p(t)&amp;\le B+V\cdot p(t)+\sum_{k&#x3D;1}^K Q_k(t)y_k(t)\&amp;&#x3D;B+V\cdot P(\textbf{w}(t),\alpha(t))+\sum_{k&#x3D;1}^KQ_k(t)Y_k(\textbf{w}(t),\alpha(t))\&amp;\le B+V\cdot P(\textbf{w}(t),\alpha^*(t))+\sum_{k&#x3D;1}^KQ_k(t)Y_k(\textbf{w}(t),\alpha^*(t))\end{aligned}<br>$$</p>
<p>å–æœŸæœ›å¾—</p>
<p>$$<br>\begin{aligned}&amp;\mathbb{E}[\Delta(\Theta(t))+V\cdot p(t)|\Theta(t)]\&amp;\le B+V\cdot\mathbb{E}[P(\textbf{w}(t),\alpha^*(t))]+\sum_{k&#x3D;1}^K\mathbb{E}[Q_k(t)Y_k(\textbf{w}(t),\alpha^*(t))|\Theta(t)]\&amp;&#x3D;B+V\cdot\mathbb{E}[P(\textbf{w}(t),\alpha^*(t))]+\sum_{k&#x3D;1}^K\mathbb{E}[Q_k(t)|\Theta(t)]\mathbb{E}[Y_k(\textbf{w}(t),\alpha^*(t))|\Theta(t)]\ (ç›¸äº’ç‹¬ç«‹)\&amp;\le B+V\cdot p^*\qquad(è¿™æ˜¯å› ä¸ºå¼(5))\end{aligned}<br>$$</p>
<p>æ—¶éš™ç´¯åŠ ï¼Œå¯å¾—</p>
<p>$$<br>\begin{aligned}(B+V\cdot p^*)T&amp;\ge\sum_{t&#x3D;0}^{T-1}\mathbb{E}[\Delta(\Theta(t))+V\cdot p(t)|\Theta(t)]\&amp;&#x3D;\mathbb{E}[L(\Theta(t))-L(\Theta(0))]+V\cdot\sum_{t&#x3D;0}^{T-1}\mathbb{E}[p(t)|\Theta(t)]\&amp;\ge V\cdot\sum_{t&#x3D;0}^{T-1}\mathbb{E}[p(t)|\Theta(t)]\end{aligned}<br>$$</p>
<p>ä¹Ÿå°±æ˜¯è¯´$\mathcal{P}4$å¾—åˆ°çš„è¿‘ä¼¼æœ€ä¼˜è§£ä¸ä¸åŠ çº¦æŸçš„$\mathcal{P}1$çš„æœ€ä¼˜è§£ä¹‹é—´çš„å…³ç³»æ˜¯ä¸€ä¸ªä¸ç­‰å¼ï¼š</p>
<p>$$<br>\frac1T\sum_{t&#x3D;0}^{T-1}\mathbb{E}[p(t)|\Theta(t)]\le p^*+\frac B V\qquad(6)<br>$$</p>
<p>æ‰€ä»¥å¯çŸ¥ï¼Œ$\mathcal{P}4$å¾—åˆ°çš„è¿‘ä¼¼æœ€ä¼˜è§£ä¸ä¸åŠ çº¦æŸçš„$\mathcal{P}1$çš„æœ€ä¼˜è§£ä¹‹é—´çš„å·®è·æ˜¯$O(\frac 1 V)$çš„</p>
<h3 id="4-2-é˜Ÿåˆ—é•¿åº¦"><a href="#4-2-é˜Ÿåˆ—é•¿åº¦" class="headerlink" title="4.2 é˜Ÿåˆ—é•¿åº¦"></a>4.2 é˜Ÿåˆ—é•¿åº¦</h3><p>å‡è®¾å­˜åœ¨ä¸€ä¸ª$\textbf{w}-only$ç­–ç•¥ï¼Œæ»¡è¶³$\exist\epsilon &gt;0,\ \mathbb{E}[Y_k(\textbf{w}(t),\alpha^*(t))]\le-\epsilon$ï¼ˆä¸è¦æ±‚æ˜¯æœ€ä¼˜$\textbf{w}-only$ç­–ç•¥ï¼‰ï¼Œé‚£ä¹ˆå­˜åœ¨ä¸‹åˆ—ä¸ç­‰å¼ï¼š</p>
<p>$$<br>\Delta(\Theta(t))+V\cdot p(t)\le B+V\cdot P(\textbf{w}(t),\alpha(t))+\sum_{k&#x3D;1}^KQ_k(t)Y_k(\textbf{w}(t),\alpha^*(t))\\Delta(\Theta(t))+V\cdot p_{min}\le B+V\cdot p_{max}+\sum_{k&#x3D;1}^KQ_k(t)Y_k(\textbf{w}(t),\alpha^*(t))\\begin{aligned}\mathbb{E}[\Delta(\Theta(t))]+V\cdot p_{min}&amp;\le B+V\cdot p_{max}+\sum_{k&#x3D;1}^K\mathbb<br>{E}[Q_k(t)]\mathbb{E}[Y_k(\textbf{w}(t),\alpha^*(t))]\&amp;\le B+V\cdot p_{max}+\sum_{k&#x3D;1}^K\mathbb{E}<a href="-%5Cepsilon">Q_k(t)</a>\end{aligned}<br>$$</p>
<p>ç§»é¡¹ï¼Œç´¯åŠ å¯æœ‰</p>
<p>$$<br>\frac 1 T\sum_{t&#x3D;0}^{T-1}\sum_{k&#x3D;1}^K\mathbb{E}[Q_k(t)]\le\frac{B+V\cdot(p_{max}-p_{min})}{\epsilon}\qquad(7)<br>$$</p>
<p>ç”±æ­¤å¯çŸ¥ï¼Œå¹³å‡æ¯æ—¶éš™å†…æ‰€æœ‰é˜Ÿåˆ—é•¿åº¦æ˜¯$O(V)$çš„</p>
<h3 id="4-3-ç²¾åº¦ä¸æ—¶é—´çš„æƒè¡¡"><a href="#4-3-ç²¾åº¦ä¸æ—¶é—´çš„æƒè¡¡" class="headerlink" title="4.3 ç²¾åº¦ä¸æ—¶é—´çš„æƒè¡¡"></a>4.3 ç²¾åº¦ä¸æ—¶é—´çš„æƒè¡¡</h3><p>å¼(6)å’Œå¼(7)å…±åŒæ„æˆäº†æé›…æ™®è¯ºå¤«ä¼˜åŒ–å®šç†ã€‚</p>
<p>æ—¶å‡é˜Ÿåˆ—å¤§å°æ˜¯$O(V)$çš„ï¼Œå…¶åæ˜ ç®—æ³•çš„æ‰§è¡Œæ—¶é—´ï¼Œè€Œè®¡ç®—ç²¾åº¦æ˜¯$O(\frac 1 V)$çš„ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´å¢å¤§Vå¯ä»¥è·å¾—æ›´åŠ é€¼è¿‘ä¸åŸå§‹é—®é¢˜$\mathcal{P}1$æœ€ä¼˜è§£çš„è§£ï¼Œè€Œå‡å°‘Våˆ™å¯ä»¥æ›´å¿«çš„æ»¡è¶³çº¦æŸæ¡ä»¶ï¼Œé™ä½æ‰§è¡Œæ—¶é—´ã€‚æ‰€ä»¥è¯´ï¼Œéœ€è¦è°ƒæ•´Vï¼Œæ‰¾åˆ°ç®—æ³•æ‰§è¡Œæ—¶é—´ä¸è®¡ç®—ç»“æœç²¾åº¦ä¹‹é—´çš„trade-off</p>
<h3 id="4-4-è¯æ˜æ¼‚ç§»åŠ ç½šç®—æ³•æ»¡è¶³çº¦æŸæ¡ä»¶"><a href="#4-4-è¯æ˜æ¼‚ç§»åŠ ç½šç®—æ³•æ»¡è¶³çº¦æŸæ¡ä»¶" class="headerlink" title="4.4 è¯æ˜æ¼‚ç§»åŠ ç½šç®—æ³•æ»¡è¶³çº¦æŸæ¡ä»¶"></a>4.4 è¯æ˜æ¼‚ç§»åŠ ç½šç®—æ³•æ»¡è¶³çº¦æŸæ¡ä»¶</h3><p>ç”±å‰é¢å¯å¾—ï¼Œ$\mathbb{E}[\Delta(\Theta(t))]+V\cdot p_{min}\le B+V\cdot p_{max}+\sum_{k&#x3D;1}^K\mathbb{E}<a href="-%5Cepsilon">Q_k(t)</a>$ï¼Œå¯¹æ—¶éš™è¿›è¡Œç´¯åŠ æœ‰</p>
<p>$$<br>\begin{aligned}\mathbb{E}[L(\Theta(t))]-\mathbb{E}[L(\Theta(0))]&amp;\le(B+V(p_{max}-p_{min}))\cdot T-\epsilon\sum_{t&#x3D;0}^{T-1}\sum_{k&#x3D;1}^K\mathbb{E}[Q_k(t)|\Theta(t)]\&amp;\le Bâ€™\cdot T\end{aligned}<br>$$</p>
<p>$$<br>\frac 1 2\sum_{k&#x3D;1}^K\mathbb{E}[Q_k(T)^2]\le Bâ€™\cdot T\(\sum_{k&#x3D;1}^K\mathbb{E}[Q_k(T)])^2\le K\sum_{k&#x3D;1}^K\mathbb{E}[Q_k(T)^2]\le 2KBâ€™\cdot T<br>$$</p>
<p>å–æé™æœ‰</p>
<p>$$<br>\lim_{T\rightarrow\infty}\frac{\sum_{k&#x3D;1}^K\mathbb{E}[Q_k(T)]}T\le\lim_{T\rightarrow\infty}\sqrt{\frac{2KBâ€™}T}&#x3D;0<br>$$</p>
<p>åˆç”±äº$Q_k(t)\ge 0$ï¼Œæ‰€ä»¥æœ‰</p>
<p>$$<br>\forall k\in{1,2,â€¦,K},\lim_{T\rightarrow\infty}\frac{\mathbb{E}[Q_k(T)]}T&#x3D;0<br>$$</p>
<p>å³ï¼Œåœ¨æ¼‚ç§»åŠ ç½šç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œçº¦æŸæ¡ä»¶(2)æ˜¯ä¸€ç›´æˆç«‹çš„</p>
<h2 id="5-Case-Study"><a href="#5-Case-Study" class="headerlink" title="5 Case Study"></a>5 Case Study</h2><h3 id="5-1-LODCO"><a href="#5-1-LODCO" class="headerlink" title="5.1 LODCO"></a>5.1 LODCO</h3><p>å…¶ä¸­$Bâ€™&#x3D;B+V\cdot(p_{max}-p_{min})$ï¼Œä»£å…¥æé›…æ™®è¯ºå¤«å‡½æ•°å’ŒæŸ¯è¥¿ä¸ç­‰å¼$(\sum_{i&#x3D;1}^nx_iy_i)^2\le(\sum_{i&#x3D;1}^nx_i^2)(\sum_{i&#x3D;1}^ny_i^2)$å¯å¾—</p>
<p>å°†å‰æ–‡æ‰€è¿°çš„$p(t)$ä½œä¸ºæƒ©ç½šé¡¹(penalty)ï¼ŒåŒæ—¶æ±‚è§£æé›…æ™®è¯ºå¤«æ¼‚ç§»å’Œæƒ©ç½šé¡¹çš„æœ€å°å€¼ï¼Œä¾¿å¯ä»¥å¾—åˆ°æ–°é—®é¢˜</p>
]]></content>
      <categories>
        <category>æ•°å­¦</category>
      </categories>
      <tags>
        <tag>æ•°å­¦æ–¹æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexoä½¿ç”¨æ–¹æ³•</title>
    <url>/2022/05/10/hexo%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
  </entry>
  <entry>
    <title>ã€ç½®é¡¶ã€‘çŸ¥è¯†ç®¡ç†</title>
    <url>/2022/05/18/%E7%AC%94%E8%AE%B0%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h1 id=""><a href="#" class="headerlink" title=""></a></h1><h1 id="ç¼–ç¨‹è¯­è¨€"><a href="#ç¼–ç¨‹è¯­è¨€" class="headerlink" title="ç¼–ç¨‹è¯­è¨€"></a>ç¼–ç¨‹è¯­è¨€</h1><ul>
<li><p>C++</p>
<ul>
<li><p>C++åŸºç¡€çŸ¥è¯†ï¼š<p align="right">ï¼ˆæ›´æ–°ä¸­ï¼‰-&gt;<a href="https://www.wolai.com/i4fuq7u3G5X9fh79fG4yqS">é“¾æ¥</a></p></p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p>ã€ŠC++è¯­è¨€å¯¼å­¦ã€‹ç¬¬ä¸€ç‰ˆ</p>
<p>ã€ŠC++ Primerã€‹ç¬¬äº”ç‰ˆ</p>
<p>ã€ŠC++æ–°ç»å…¸ï¼šå¯¹è±¡æ¨¡å‹ã€‹ç¬¬ä¸€ç‰ˆ</p>
</blockquote>
</li>
<li><p>C++ä¸‰éƒ¨æ›²é˜…è¯»ç¬”è®°ï¼š<p align="right">ï¼ˆå¼€å‘æœªå¡«ï¼‰-&gt;é“¾æ¥</p></p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p>ã€ŠEffective C++ã€‹</p>
<p>ã€ŠMore Effective C++ã€‹</p>
<p>ã€ŠEffective Modern C++ã€‹</p>
</blockquote>
</li>
<li><p>C++æ³›å‹ç¼–ç¨‹ç¬”è®°ï¼š<p align="right">ï¼ˆå¼€å‘æœªå¡«ï¼‰-&gt;é“¾æ¥</p></p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p>ã€ŠC++æ¨¡æ¿å…ƒç¼–ç¨‹å®æˆ˜ï¼šä¸€ä¸ªæ·±åº¦å­¦ä¹ æ¡†æ¶çš„åˆæ­¥å®ç°ã€‹</p>
<p>ã€ŠC++æ–°ç»å…¸ï¼šæ¨¡æ¿ä¸æ³›å‹ç¼–ç¨‹ã€‹</p>
</blockquote>
</li>
</ul>
</li>
<li><p>Golang</p>
<ul>
<li><p>Goè¯­è¨€åŸºç¡€çŸ¥è¯†ï¼š<p align="right">ï¼ˆæ›´æ–°ä¸­ï¼‰-&gt;<a href="https://www.wolai.com/cAyKwE7zy55YMwUgK7dtM6">é“¾æ¥</a></p></p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p>Bç«™upä¸»â€œä¸ƒç±³è€å¸ˆâ€çš„<a href="https://space.bilibili.com/4638193/channel/collectiondetail?sid=337211&ctype=0">Goè¯­è¨€ç³»åˆ—æ•™ç¨‹</a></p>
<p>åˆ˜ä¸¹å†°â€”â€”<a href="https://www.kancloud.cn/aceld/golang">Golangä¿®å…»ä¹‹è·¯</a></p>
<p>ã€ŠGoè¯­è¨€åº•å±‚åŸç†å‰–æã€‹</p>
</blockquote>
</li>
<li><p>Goè¯­è¨€è¿›é˜¶ï¼š<p align="right">ï¼ˆå¼€å‘æœªå¡«ï¼‰-&gt;é“¾æ¥</p></p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p>ã€ŠGoè¯­è¨€è¿›é˜¶ä¹‹è·¯ã€‹</p>
</blockquote>
</li>
</ul>
</li>
<li><p>JavaScript</p>
<ul>
<li><p>JSåŸºç¡€ï¼š<p align="right">ï¼ˆæ›´æ–°ä¸­ï¼‰-&gt;<a href="https://www.wolai.com/wVoyKEaHQ9a8xJfYj9Rr9g">é“¾æ¥</a></p></p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p><a href="https://www.bilibili.com/video/BV11E411R7Mp">JavaScriptâ€”â€”45åˆ†é’Ÿå¿«é€Ÿä¸Šè½¦</a></p>
<p><a href="https://www.bilibili.com/video/BV18a4y1L7kD">å¾®è½¯å®˜æ–¹JavaScriptå…¥é—¨æ•™ç¨‹</a></p>
</blockquote>
</li>
<li><p>Node.jsè¿›é˜¶ï¼š<p align="right">ï¼ˆå¼€å‘æœªå¡«ï¼‰-&gt;é“¾æ¥</p></p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p><a href="https://www.bilibili.com/video/BV1kN41197vw">å¾®è½¯å®˜æ–¹Node.jså…¥é—¨æ•™ç¨‹</a></p>
</blockquote>
</li>
</ul>
</li>
<li><p>Python</p>
<ul>
<li><p>PythonåŸºç¡€çŸ¥è¯†ï¼š<p align="right">ï¼ˆæ›´æ–°ä¸­ï¼‰-&gt;<a href="https://www.wolai.com/cnfQrSS4QVToejo5oHMUiC">é“¾æ¥</a></p></p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p><a href="https://www.liaoxuefeng.com/wiki/1016959663602400">å»–é›ªå³°çš„Pythonæ•™ç¨‹</a></p>
</blockquote>
</li>
<li><p>Python Cookbookå¥‡æŠ€æ·«å·§ï¼š<p align="right">ï¼ˆå¼€å‘æœªå¡«ï¼‰-&gt;é“¾æ¥</p></p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p><a href="https://python3-cookbook.readthedocs.io/zh_CN/latest/preface.html">Python Cookbook ä¸­æ–‡ç‰ˆ</a></p>
</blockquote>
</li>
</ul>
</li>
<li><p>MatlabåŸºç¡€ï¼š<p align="right">ï¼ˆæš‚æ—¶å®Œç»“ï¼‰-&gt;<a href="https://www.wolai.com/6A8LJGxGgXPdjKLJoQPfQC">é“¾æ¥</a></p></p>
</li>
</ul>
<h1 id="å¼€å‘å·¥å…·"><a href="#å¼€å‘å·¥å…·" class="headerlink" title="å¼€å‘å·¥å…·"></a>å¼€å‘å·¥å…·</h1><ul>
<li><p>Dockerï¼š<p align="right">ï¼ˆæš‚æ—¶å®Œç»“ï¼‰-&gt;<a href="https://www.wolai.com/oNuD4Pvm1Zyd1AK5CT5HZ5">é“¾æ¥</a></p></p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p><a href="https://docs.docker.com/get-started/overview/">Dockerå®˜æ–¹æ–‡æ¡£</a></p>
<p>æœ¬äººè¯‘åˆ¶çš„<a href="https://www.bilibili.com/video/BV1Ft4y1S7ax">Dockeré€Ÿæˆè§†é¢‘</a></p>
</blockquote>
</li>
<li><p>WebRTCï¼š<p align="right">ï¼ˆæ›´æ–°ä¸­ï¼‰-&gt;<a href="https://www.wolai.com/rjmCB8E1VC7N8fhv4pBsSP">é“¾æ¥</a></p></p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p>ã€ŠWebRTCéŸ³è§†é¢‘å®æ—¶äº’åŠ¨æŠ€æœ¯ï¼šåŸç†ã€å®æˆ˜ä¸æºç åˆ†æã€‹</p>
</blockquote>
</li>
<li><p>Kubernetesï¼š<p align="right">ï¼ˆæ›´æ–°ä¸­ï¼‰-&gt;<a href="https://www.wolai.com/tpvNeU46wsLMCngKnbViyx">é“¾æ¥</a></p></p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p>æœ¬äººè¯‘åˆ¶çš„<a href="https://www.bilibili.com/video/BV1i5411E7MU">Kubernetesé€Ÿæˆè§†é¢‘</a></p>
<p>æå®¢æ—¶é—´ã€Šæ·±å…¥å‰–æKubernetesã€‹</p>
</blockquote>
</li>
<li><p>Pytorchï¼š<p align="right">ï¼ˆæ›´æ–°ä¸­ï¼‰-&gt;<a href="https://www.wolai.com/v42SEByYqECDFrB1M12gy6">é“¾æ¥</a></p></p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p><a href="https://www.bilibili.com/video/BV1Vx411j7kT">è«çƒ¦æ•™ç¨‹</a></p>
<p><a href="https://pytorch.org/docs/1.11/">Pytorchå®˜æ–¹æ–‡æ¡£</a></p>
</blockquote>
</li>
</ul>
<h1 id="ç¼–ç¨‹ç®—æ³•"><a href="#ç¼–ç¨‹ç®—æ³•" class="headerlink" title="ç¼–ç¨‹ç®—æ³•"></a>ç¼–ç¨‹ç®—æ³•</h1><blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p><a href="https://www.acwing.com/">ACwing</a>ç½‘ç«™ â€œç®—æ³•åŸºç¡€è¯¾â€ &amp; â€œç®—æ³•æé«˜è¯¾â€ &amp; â€œç®—æ³•é¢è¯•ç¬”è¯•è¾…å¯¼è¯¾â€</p>
<p>ç¨‹åºå‘˜Karlâ€”â€”<a href="https://www.programmercarl.com/">ä»£ç éšæƒ³å½•</a></p>
</blockquote>
<h1 id="æ•°å­¦çŸ¥è¯†"><a href="#æ•°å­¦çŸ¥è¯†" class="headerlink" title="æ•°å­¦çŸ¥è¯†"></a>æ•°å­¦çŸ¥è¯†</h1><ul>
<li><p>Lyapunov Optimization</p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
</blockquote>
</li>
<li><p>æ¬¡æ¨¡ä¼˜åŒ–</p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
</blockquote>
</li>
<li><p>çŸ©é˜µè®º</p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
</blockquote>
</li>
<li><p>æ¦‚ç‡è®º</p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
</blockquote>
</li>
<li><p>ç»å…¸å‡¸ä¼˜åŒ–ç†è®º</p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p>Stephen Boydã€ŠConvex Optimizationã€‹</p>
</blockquote>
</li>
<li><p>Majorization Minimization</p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
</blockquote>
</li>
</ul>
<h1 id="è®¡ç®—æœºåŸºç¡€"><a href="#è®¡ç®—æœºåŸºç¡€" class="headerlink" title="è®¡ç®—æœºåŸºç¡€"></a>è®¡ç®—æœºåŸºç¡€</h1><ul>
<li><p>æ“ä½œç³»ç»Ÿï¼š<p align="right">ï¼ˆæ›´æ–°ä¸­ï¼‰-&gt;<a href="https://www.wolai.com/c1N512Jq3vxNKYzzCvqyZM">é“¾æ¥</a></p></p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p>å—äº¬å¤§å­¦è’‹ç‚å²© â€œ<a href="https://space.bilibili.com/202224425/channel/collectiondetail?sid=192498&ctype=0">æ“ä½œç³»ç»Ÿï¼šè®¾è®¡ä¸å®ç°</a>â€</p>
</blockquote>
</li>
<li><p>æ•°æ®åº“</p>
<ul>
<li><p>MySQLï¼š<p align="right">ï¼ˆæ›´æ–°ä¸­ï¼‰-&gt;<a href="https://www.wolai.com/5fP6Py1Z4rerX62PJiiyA2">é“¾æ¥</a></p></p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p><a href="https://www.runoob.com/mysql/mysql-tutorial.html">èœé¸Ÿæ•™ç¨‹â€”â€”MySQLåŸºç¡€</a></p>
<p>ã€ŠMySQLæ˜¯æ€æ ·è¿è¡Œçš„ï¼šä»æ ¹å„¿ä¸Šç†è§£MySQLã€‹</p>
</blockquote>
</li>
</ul>
</li>
<li><p>åˆ†å¸ƒå¼ç³»ç»Ÿ</p>
<ul>
<li><p>MIT 6.824ï¼ˆ2020ï¼‰ç¬”è®°ï¼š<p align="right">ï¼ˆå¼€å‘æœªå¡«ï¼‰-&gt;é“¾æ¥</p></p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š<a href="https://www.simtoco.com/#/home">Simvisoç½‘ç«™</a>è¯‘åˆ¶è¯¾ç¨‹</p>
</blockquote>
</li>
</ul>
</li>
<li><p>è®¾è®¡æ¨¡å¼ï¼š<p align="right">ï¼ˆæ›´æ–°ä¸­ï¼‰-&gt;<a href="https://www.wolai.com/vKvsLtKSQ2EDi2QDfPCfyp">é“¾æ¥</a></p></p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p>ã€Šè®¾è®¡æ¨¡å¼çš„è‰ºæœ¯ï¼šä¸€æœ¬å®ä¾‹é©±åŠ¨çš„è®¾è®¡æ¨¡å¼å®è·µæŒ‡å—ã€‹</p>
</blockquote>
</li>
<li><p>ç¼–è¯‘åŸç†ï¼š<p align="right">ï¼ˆå¼€å‘æœªå¡«ï¼‰-&gt;é“¾æ¥</p></p>
<blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p>è™ä¹¦ã€Šç°ä»£ç¼–è¯‘åŸç†ï¼šCè¯­è¨€æè¿°ã€‹</p>
</blockquote>
</li>
<li><p>åµŒå…¥å¼å¼€å‘ï¼ˆå±äºä¼šçš„æŠ€èƒ½ï¼Œä½†æ˜¯å¦å¡«å‘å†è®®ï¼‰</p>
<ul>
<li><p>STM32</p>
</li>
<li><p>åµŒå…¥å¼Linux</p>
</li>
<li><p>freeRTOS</p>
</li>
<li><p>FPGA</p>
</li>
</ul>
</li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>çŸ©é˜µè®º</title>
    <url>/2021/05/25/%E7%9F%A9%E9%98%B5%E8%AE%BA/</url>
    <content><![CDATA[<h1 id="çŸ©é˜µè®º"><a href="#çŸ©é˜µè®º" class="headerlink" title="çŸ©é˜µè®º"></a>çŸ©é˜µè®º</h1><p><a href="https://github.com/Zessay/HUST_Matrix" title="åŸæ–‡å‡ºå¤„">åŸæ–‡å‡ºå¤„</a></p>
<h1 id="1-çº¿æ€§ç©ºé—´ä¸çº¿æ€§å˜æ¢"><a href="#1-çº¿æ€§ç©ºé—´ä¸çº¿æ€§å˜æ¢" class="headerlink" title="1 çº¿æ€§ç©ºé—´ä¸çº¿æ€§å˜æ¢"></a>1 çº¿æ€§ç©ºé—´ä¸çº¿æ€§å˜æ¢</h1><hr>
<p>ï¼ˆ1ï¼‰çº¿æ€§ç©ºé—´çš„å®šä¹‰ï¼š</p>
<blockquote>
<p>ä»¥$\alpha, \beta, \gamma,â€¦$ä¸ºå…ƒç´ çš„éç©ºé›†åˆ$V$ï¼Œæ•°åŸŸ$F$ï¼Œå®šä¹‰<strong>ä¸¤ç§è¿ç®—</strong>ï¼š <em>åŠ æ³•</em>ï¼š$\forall \alpha , \beta \in V, ; \alpha + \beta \in V$ï¼› <em>æ•°ä¹˜</em>ï¼š$\forall k \in F, \alpha \in V, k \alpha \in V$ã€‚ **æ»¡è¶³8æ¡ï¼š<strong><strong>åŠ æ³•äº¤æ¢å¾‹ã€åŠ æ³•ç»“åˆå¾‹ã€æ•°ä¹˜ç»“åˆå¾‹ã€ä¸¤ä¸ªåˆ†é…å¾‹ï¼Œ0å…ƒå­˜åœ¨ï¼Œ1å…ƒå­˜åœ¨ï¼Œè´Ÿå…ƒå­˜åœ¨</strong></strong>ã€‚ç§° **$V$<strong>ä¸ºæ•°åŸŸ</strong>$F$<strong>ä¸Šçš„çº¿æ€§ç©ºé—´</strong>ã€‚</p>
</blockquote>
<hr>
<p>ï¼ˆ2ï¼‰è¯æ˜ä¸€ç»„å‘é‡æ˜¯çº¿æ€§ç©ºé—´çš„åŸºï¼Œä¸¤æ­¥èµ°ï¼š</p>
<ul>
<li><p>è¯æ˜è¿™ç»„å‘é‡çº¿æ€§æ— å…³ï¼›</p>
</li>
<li><p>è¯æ˜çº¿æ€§ç©ºé—´ä»»æ„å‘é‡å¯ç”±è¿™ç»„å‘é‡è¡¨ç¤ºã€‚</p>
</li>
</ul>
<hr>
<p>ï¼ˆ3ï¼‰å¦‚æœ${E_{ij}, i&#x3D;1,2,â€¦,m;j&#x3D;1,2,â€¦,n}$æ˜¯çŸ©é˜µç©ºé—´$R^{m \times n}$çš„ä¸€ç»„åŸºï¼Œåˆ™$\dim R^{m \times n} &#x3D; m \times n$ã€‚</p>
<blockquote>
<p>ğŸ“Œ<strong>æ³¨ï¼šè¿™é‡Œæœ‰å‰ææ¡ä»¶ï¼Œå®é™…ä¸Š</strong>$\dim R^{m \times n}$<strong>å¹¶ä¸æ˜¯æ€»ç­‰äº</strong>$m \times n$</p>
</blockquote>
<hr>
<p>ï¼ˆ4ï¼‰$\alpha_1, \alpha_2, â€¦, \alpha_n$æ˜¯çº¿æ€§ç©ºé—´$V_n(F)$çš„ä¸€ç»„åŸºï¼Œå¯¹äº$\forall \beta \in V$,</p>
<p>$$<br>\beta &#x3D; (\alpha_1 ; \alpha_2 ; â€¦ ; \alpha_n)\begin{bmatrix}x_1\Â x_2\Â â€¦\Â x_n\end{bmatrix}&#x3D; (\alpha_1 ; \alpha_2 ; â€¦ ; \alpha_n)X<br>$$</p>
<p>å…¶ä¸­$X$ç§°ä¸ºå‘é‡$\beta$åœ¨åŸº$(\alpha_1 ; \alpha_2 ; â€¦ ; \alpha_n)$ä¸‹å¯¹åº”çš„åæ ‡ã€‚</p>
<p>$V_n(F)$ä¸­å‘é‡ç»„${\beta_1 ; \beta_2 ; â€¦ ; \beta_m}$çº¿æ€§ç›¸å…³çš„å……è¦æ¡ä»¶æ˜¯åæ ‡å‘é‡ç»„${X_1,X_2,â€¦,X_m}$æ˜¯çº¿æ€§ç›¸å…³ç»„ã€‚</p>
<hr>
<p>ï¼ˆ5ï¼‰è®¾$(\alpha_1 ; \alpha_2 ; â€¦ ; \alpha_n)$å’Œ$(\beta_1 ; \beta_2 ; â€¦ ; \beta_n)$æ˜¯$n$ç»´çº¿æ€§ç©ºé—´$V_n(F)$ä¸­çš„ä¸¤ç»„åŸºï¼Œåˆ™æœ‰$C\in F^{m \times n}$</p>
<p>$$<br>(\beta_1 ; \beta_2 ; â€¦ ; \beta_n) &#x3D; (\alpha_1 ; \alpha_2 ; â€¦ ; \alpha_n)C<br>$$</p>
<p>å…¶ä¸­$C$ç§°ä¸ºä»åŸº$(\alpha_1 ; \alpha_2 ; â€¦ ; \alpha_n)$åˆ°$(\beta_1 ; \beta_2 ; â€¦ ; \beta_n)$çš„<strong>è¿‡æ¸¡çŸ©é˜µ</strong>ã€‚</p>
<blockquote>
<p>ğŸ“Œé‡è¦æ¨è®ºï¼šå¦‚æœå‘é‡$\alpha \in V_n(F)$ï¼Œ$\alpha$åœ¨ä¸¤ç»„åŸºä¸‹å¯¹åº”åæ ‡åˆ†åˆ«æ˜¯$X$å’Œ$Y$ï¼Œåˆ™æœ‰ï¼š $\alpha &#x3D; (\alpha_1 ; \alpha_2 ; â€¦ ; \alpha_n)X\\alpha &#x3D; (\beta_1 ; \beta_2 ; â€¦ ; \beta_n)Y$ <em>æ˜¾ç„¶æœ‰</em>ï¼š$\color{red}{X &#x3D; CY}$ã€‚</p>
</blockquote>
<hr>
<p>ï¼ˆ6ï¼‰è®¾$W$æ˜¯çº¿æ€§ç©ºé—´$V_n(F)$çš„éç©ºå­é›†åˆï¼Œåˆ™$W$æ˜¯$V_n(F)$çš„å­ç©ºé—´çš„å……è¦æ¡ä»¶æ˜¯ï¼š</p>
<ul>
<li><p><strong>è‹¥</strong>$\alpha, \beta \in W$<strong>ï¼Œåˆ™</strong>$\alpha + \beta \in W$</p>
</li>
<li><p><strong>è‹¥</strong>$\alpha \in W, ; k \in F$<strong>ï¼Œåˆ™</strong>$k \alpha \in W$</p>
</li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¯´åªéœ€è¦éªŒè¯<strong>å¯¹åŠ æ³•å’Œæ•°ä¹˜å°é—­</strong>å³å¯ã€‚</p>
<hr>
<p>ï¼ˆ7ï¼‰è®¾$W_1, ; W_2$æ˜¯çº¿æ€§ç©ºé—´$V$çš„å­ç©ºé—´ï¼Œåˆ™ï¼š</p>
<ul>
<li><p>$W_1$ä¸$W_2$çš„<strong>äº¤ç©ºé—´</strong>ä¸ºï¼š$W_1 \cap W_2 &#x3D; { \alpha | \alpha \in W_1 ; and ; \alpha \in W_2 }$</p>
</li>
<li><p>$W_1$ä¸$W_2$çš„<strong>å’Œç©ºé—´</strong>ä¸ºï¼š$W_1 + W_2 &#x3D; { \alpha | \alpha &#x3D; \alpha_1 + \alpha_2, ; \alpha_1 \in W_1, ; \alpha_2 \in W_2 }$</p>
</li>
</ul>
<blockquote>
<p>ğŸ“Œ***ä¸¤ä¸ªé‡è¦çš„ç»´æ•°å…¬å¼ <em><strong>$\dim (W_1 \cap W_2) \leqslant \dim W_i \leqslant \dim(W_1 + W_2) \leqslant \dim V$</strong></em> ***$\dim W_1 + \dim W_2Â  &#x3D; \dim (W_1 + W_2) + \dim(W_1 \cap W_2)$</p>
</blockquote>
<blockquote>
<p>ğŸ“Œ<em>ç›´å’Œå­ç©ºé—´</em>ï¼šå¦‚æœ$W &#x3D; W_1 + W_2$ï¼Œå¹¶ä¸”$W_1 \cap W_2 &#x3D; {0}$ï¼Œé‚£ä¹ˆç§°$W$æ˜¯$W_1$ä¸$W_2$çš„ç›´å’Œå­ç©ºé—´ï¼Œè¡¨ç¤ºä¸º$W &#x3D; W_1 \oplus W_2$ã€‚</p>
</blockquote>
<blockquote>
<p>ğŸ“Œ<em>ç›´å’Œè¡¥å­ç©ºé—´</em>ï¼šå¯¹$n$ç»´ç©ºé—´$V$çš„ä»»ä½•å­ç©ºé—´$W$ï¼Œè®¾$\alpha_1, â€¦,\alpha_r$ä¸º$W$çš„åŸºï¼Œ$r &lt; n$ï¼ŒæŠŠå®ƒä»¬æ‰©å……ä¸º$V$çš„åŸº${\alpha_1, â€¦,\alpha_r; \beta_{r+1}, â€¦, \beta_n}, \quad U &#x3D; L{\beta_{r+1}, â€¦, \beta_n }$æœ‰$V &#x3D; W \oplus U$æˆç«‹ï¼Œåˆ™ç§°$U$æ˜¯$W$çš„ç›´å’Œè¡¥å­ç©ºé—´ã€‚</p>
</blockquote>
<hr>
<p>ï¼ˆ8ï¼‰è‹¥$(\alpha_1 ; \alpha_2 ; â€¦ ; \alpha_n)$æ˜¯çº¿æ€§ç©ºé—´$V_n(F)$çš„ä¸€ç»„åŸºï¼Œåˆ™$V_n(F) &#x3D; L {\alpha_1, \alpha_2, .., \alpha_n}$</p>
<p>å¯¹ä¸€ä¸ªçŸ©é˜µ$A \in F^{m \times n}$ï¼Œå¯ä»¥å¾—åˆ°ä¸¤ä¸ªä¸$A$ç›¸å…³çš„å­ç©ºé—´ï¼š</p>
<p>$N(A) &#x3D; {X |AX&#x3D;0 } \subseteq F^n\R(A) &#x3D; L{A_1, A_2, â€¦,A_n } \subseteq F^m$</p>
<p>å…¶ä¸­$N(A)$ç§°ä¸ºçŸ©é˜µ$A$çš„<strong>é›¶ç©ºé—´</strong>ï¼Œ$R(A)$ç§°ä¸ºçŸ©é˜µ$A$çš„<strong>åˆ—ç©ºé—´</strong></p>
<hr>
<p>ï¼ˆ9ï¼‰å†…ç§¯ï¼š</p>
<ul>
<li><p><strong>æ¬§æ°ç©ºé—´çš„å†…ç§¯</strong>ï¼š$(\alpha, \beta) &#x3D; \alpha^T \beta ; \quad (A, B) &#x3D; tr(AB^T)$</p>
</li>
<li><p><strong>é…‰ç©ºé—´çš„å†…ç§¯</strong>ï¼š$(\alpha, \beta) &#x3D; \beta^H \alpha ; \quad (A, B) &#x3D; tr(B^HA)$</p>
</li>
</ul>
<blockquote>
<p>ğŸ“ŒæŸ¯è¥¿ä¸ç­‰å¼ï¼š$|(\alpha, \beta)|^2 \leqslant (\alpha, \alpha)(\beta, \beta)$</p>
</blockquote>
<blockquote>
<p><strong>æ­£äº¤è¡¥å­ç©ºé—´****ï¼šè®¾</strong>â€‹$U$<strong>ä¸ºå†…ç§¯ç©ºé—´</strong>$V_n(F)$<strong>çš„ä¸€ä¸ªå­ç©ºé—´ï¼Œå®šä¹‰</strong>$V_n(F)$<strong>ä¸Šçš„ä¸€ä¸ªå­é›†</strong>$U^{\perp} &#x3D; {\alpha ;| ;\alpha \in V_n(F), ; \forall \beta \in U, ; (\alpha, \beta)&#x3D;0 }$<strong>ç§°ä¸º</strong>$U$<strong>çš„æ­£äº¤è¡¥å­ç©ºé—´</strong>ï¼Œæœ‰$V_n(F) &#x3D; U \oplus U^{\perp}$ã€‚</p>
</blockquote>
<hr>
<p>ï¼ˆ10ï¼‰è®¾$T$æ˜¯çº¿æ€§ç©ºé—´$V_n(F)$ä¸Šçš„çº¿æ€§å˜æ¢ï¼Œåˆ™æ»¡è¶³$T(k_1 \alpha_1 + k_2 \alpha_2) &#x3D; k_1 T(\alpha_1) + k_2 T(\alpha_2)$ï¼Œåˆ™æœ‰ï¼š</p>
<blockquote>
<p><strong>åƒç©ºé—´****ï¼š</strong> â€‹$R(T) &#x3D; {\beta | ; \exists \alpha \in V_n(F), s.t. ; \beta &#x3D; T(\alpha)}$<strong>æ˜¯</strong>$V_n(F)$<strong>ä¸Šçš„å­ç©ºé—´ï¼Œç§°ä¸º</strong>$T$<strong>çš„åƒç©ºé—´ï¼›</strong>$\dim R(T)$<strong>ç§°ä¸º</strong>$T$<strong>çš„<strong><strong>ç§©</strong></strong>ã€‚</strong></p>
</blockquote>
<blockquote>
<p><strong>é›¶ç©ºé—´****ï¼š</strong> â€‹$N(T) &#x3D; {\alpha |; T(\alpha) &#x3D; 0}$<strong>æ˜¯</strong>$V_n(F)$<strong>ä¸Šçš„å­ç©ºé—´ï¼Œç§°ä¸º</strong>$T$<strong>çš„é›¶ç©ºé—´ï¼›</strong>$\dim N(T)$<strong>ç§°ä¸º</strong>$T$<strong>çš„<strong><strong>é›¶åº¦</strong></strong>ã€‚</strong></p>
</blockquote>
<hr>
<p>ï¼ˆ11ï¼‰è®¾$T$ä¸º$V_n(F)$ä¸Šçš„çº¿æ€§å˜æ¢ï¼Œ${\alpha_1, \alpha_2, â€¦, \alpha_n}$æ˜¯$V_n(F)$çš„åŸºï¼Œè‹¥å­˜åœ¨$n$é˜¶æ–¹é˜µ$A$ï¼Œæœ‰ï¼š</p>
<p>$$<br>T(\alpha_1 ; \alpha_2 ; â€¦ ; \alpha_n) &#x3D; (\alpha_1 ; \alpha_2 ; â€¦ ; \alpha_n)A<br>$$</p>
<p>ç§°$A$ä¸º$T$åœ¨åŸº${\alpha_1, \alpha_2, â€¦, \alpha_n}$ä¸‹çš„çŸ©é˜µã€‚</p>
<ul>
<li><p>è®¾$\alpha$ä¸$T(\alpha)$åœ¨åŸº${\alpha_1, \alpha_2, â€¦ , \alpha_n}$ä¸‹çš„åæ ‡åˆ†åˆ«æ˜¯$X$ä¸$Y$ï¼Œåˆ™æœ‰ï¼š${\color {red}{ Y &#x3D; AX}}$ã€‚</p>
</li>
<li><p>è®¾${\alpha_1, \alpha_2, â€¦ , \alpha_n}$å’Œ${\beta_1, \beta_2, â€¦ , \beta_n}$æ˜¯$V_n(F)$çš„ä¸¤ç»„åŸºï¼Œä¸”æœ‰$(\beta_1 ; \beta_2 ; â€¦ ; \beta_n) &#x3D; (\alpha_1 ; \alpha_2 ; â€¦ ; \alpha_n)C$ï¼›$T$åœ¨ä¸¤ç»„åŸºä¸‹çš„å˜æ¢çŸ©é˜µåˆ†åˆ«æ˜¯$A$ä¸$B$ï¼Œåˆ™${\color{red} {B&#x3D;C^{-1}AC}}$ã€‚</p>
</li>
</ul>
<blockquote>
<p>ğŸ“Œå¦‚ä½•å¯¹çŸ©é˜µåšçº¿æ€§å˜æ¢ï¼Ÿ $E_{11}&#x3D;\begin{bmatrix} 1 &amp; 0 \ 0 &amp; 0 \end{bmatrix}\ E_{12}&#x3D;\begin{bmatrix} 0 &amp; 1 \ 0 &amp; 0 \end{bmatrix}\ E_{21}&#x3D;\begin{bmatrix} 0 &amp; 0 \ 1 &amp; 0 \end{bmatrix}\ E_{22}&#x3D;\begin{bmatrix} 0 &amp; 0 \ 0 &amp; 1 \end{bmatrix}$æ˜¯$R^{2\times2}$çš„åŸºï¼Œé‚£ä¹ˆçº¿æ€§å˜æ¢å¯¹åº”çš„çŸ©é˜µä¸º$4\times4$ï¼Œæ¯ä¸€åˆ—å¯¹åº”ç€å¯¹${E_{11},E_{12},E_{21},E_{22}}$ç›¸åº”åŸºè¿›è¡Œçš„å˜æ¢ã€‚</p>
</blockquote>
<blockquote>
<p>ğŸ“Œå¦‚$T(E_{11})&#x3D;-bE_{12}+cE_{21}\ T(E_{12})&#x3D;-cE_{11}+(a-d)E_{12}+cE_{22}\ T(E_{21})&#x3D;bE_{11}+(d-a)E_{21}-bE_{22}\ T(E_{22})&#x3D;bE_{12}-cE_{21}$</p>
</blockquote>
<blockquote>
<p>ğŸ“Œåˆ™Tåœ¨åŸº$E_{11},E_{12},E_{21},E_{22}$ä¸‹çš„çŸ©é˜µä¸º $\begin{bmatrix} 0 &amp; -c &amp; b &amp; 0 \ -b &amp; a-d &amp; 0 &amp; b\c &amp; 0 &amp; d-a &amp; -c\0 &amp; c &amp; -b &amp; 0 \end{bmatrix}$</p>
</blockquote>
<hr>
<p>ï¼ˆ12ï¼‰è®¾$T$æ˜¯çº¿æ€§ç©ºé—´$V_n(F)$ä¸Šçš„çº¿æ€§å˜æ¢ï¼Œ$W$æ˜¯$V_n(F)$çš„å­ç©ºé—´ï¼Œå¦‚æœ$\forall \alpha \in W, ; T(\alpha) \in W$ï¼Œå³å€¼åŸŸ$T(W) \subseteq W$ï¼Œåˆ™ç§°$W$æ˜¯$T$çš„<strong>ä¸å˜å­ç©ºé—´</strong>ã€‚</p>
<blockquote>
<p>ğŸ“Œ<em><strong>é‡è¦ä¾‹é¢˜</strong></em> è®¾$T$æ˜¯æ¬§å¼ç©ºé—´$R^3$ä¸Šçš„çº¿æ€§å˜æ¢ï¼Œå¯¹$R^3$ä¸­å•ä½çŸ¢é‡$u$ï¼Œ$\forall x \in R^3$ï¼Œ$T(x) &#x3D; x - (1-k)(x,u)u$ï¼Œé—®ï¼šTçš„ä¸å˜å­ç©ºé—´çš„ç›´å’Œåˆ†è§£ä»¥åŠç›¸åº”çš„çŸ©é˜µåˆ†è§£ã€‚</p>
</blockquote>
<blockquote>
<p>ğŸ“Œç­”ï¼šå¯¹å‘é‡$u$æœ‰$T(u) &#x3D; u - (1-k)(u,u)u&#x3D; u - (1-k)u &#x3D; ku$ æ‰€ä»¥ä»¥$u$ä¸ºåŸºå‘é‡çš„ç©ºé—´æ˜¯ä¸å˜å­ç©ºé—´ï¼Œè¡¨ç¤ºä¸º$L{u}$ï¼› åŒç†ï¼Œå¯¹äº$u$çš„æ­£äº¤è¡¥å­ç©ºé—´$u^{\perp}$ï¼Œå¯¹äºä»»æ„å‘é‡$X \in u^{\perp}$ï¼Œæœ‰ $T(X) &#x3D; X - (1-k)(X,u)u &#x3D; X-0&#x3D;X$ äºæ˜¯å¦ä¸€ä¸ªä¸å˜å­ç©ºé—´ä¸º$u^{\perp}$ï¼›å³$R^3 &#x3D; L{u} \oplus u^{\perp}$ã€‚ æ˜¾ç„¶æœ‰$L{u}$æ˜¯ä¸€ç»´ç©ºé—´ï¼Œç‰¹å¾å€¼$k$å¯¹åº”çš„ç‰¹å¾å‘é‡æ˜¯$u_1 &#x3D; u$ï¼›é‚£ä¹ˆ$u^{\perp}$å°±æ˜¯äºŒç»´ç©ºé—´ï¼Œç‰¹å¾å€¼$1$å¯¹åº”ä¸¤ä¸ªçº¿æ€§æ— å…³çš„ç‰¹å¾å‘é‡ï¼Œå¯ä»¥æ‰¾åˆ°ä¸¤ä¸ªå•ä½æ­£äº¤ç‰¹å¾å‘é‡$u_2, u_3$ï¼Œæ‰€ä»¥ç›¸åº”çš„çŸ©é˜µåˆ†è§£ä¸º$\begin{bmatrix}k &amp; &amp; \ &amp; 1 &amp; \ &amp; &amp; 1\end{bmatrix}$ï¼Œå¯¹åº”çš„ç‰¹å¾å‘é‡ç»„ ${u_1,u_2,u_3}$ä¸ºæ ‡å‡†æ­£äº¤åŸºã€‚</p>
</blockquote>
<hr>
<p>ï¼ˆ13ï¼‰<strong>æ­£äº¤å˜æ¢ï¼ˆé…‰å˜æ¢ï¼‰ï¼šçº¿æ€§å˜æ¢</strong>$T$<strong>ä¸æ”¹å˜å‘é‡å†…ç§¯ï¼Œå³</strong>$(T(\alpha), T(\beta)) &#x3D; (\alpha, \beta)$ã€‚</p>
<ul>
<li><p>æ­£äº¤å˜æ¢$T$å…³äºä»»ä¸€æ ‡å‡†æ­£äº¤åŸºçš„çŸ©é˜µ$C$æ»¡è¶³$C^TC &#x3D; CC^T&#x3D;I$ï¼›é…‰å˜æ¢å…³äºä»»ä¸€æ ‡å‡†æ­£äº¤åŸºçš„çŸ©é˜µ$U$æ»¡è¶³$U^HU&#x3D;UU^H&#x3D;I$ã€‚</p>
</li>
<li><p>æ­£äº¤çŸ©é˜µçš„è¡Œåˆ—å¼ä¸º$\pm 1$ï¼›é…‰çŸ©é˜µçš„è¡Œåˆ—å¼çš„æ¨¡é•¿ä¸º$1$ã€‚</p>
</li>
</ul>
<hr>
<p>ï¼ˆ14ï¼‰<strong>å¸¸è§çš„æ­£äº¤å˜æ¢</strong></p>
<ul>
<li><p>$R^2$ä¸Š<strong>ç»•åŸç‚¹é€†æ—¶é’ˆæ—‹è½¬</strong>$\theta$<strong>è§’çš„çº¿æ€§å˜æ¢</strong>$T_{\theta}$<strong>ç§°ä¸º_æ­£äº¤å˜æ¢_<strong>ï¼Œåœ¨æ ‡å‡†æ­£äº¤åŸºä¸‹å¯¹åº”çš„å˜æ¢çŸ©é˜µ$\begin{bmatrix} \cos \theta &amp; - \sin \theta \ \sin \theta &amp; \cos \theta \end{bmatrix}$æ˜¯</strong>æ­£äº¤çŸ©é˜µ</strong>ã€‚</p>
</li>
<li><p>ç©ºé—´$R^3$ä¸Š<strong>ç»•è¿‡åŸç‚¹çš„ç›´çº¿</strong>$l$<strong>æ—‹è½¬</strong>$\theta$<strong>è§’çš„å˜åŒ–</strong>$T_{L_{\theta}}$<strong>ä¸º_æ­£äº¤å˜æ¢_<strong>ï¼Œåœ¨æ ‡å‡†æ­£äº¤åŸºä¸‹å¯¹åº”çš„å˜æ¢çŸ©é˜µ$\begin{bmatrix}1 &amp; &amp; \ &amp; \cos \theta &amp; -\sin \theta \ &amp; \sin \theta &amp; \cos \theta \end{bmatrix}$æ˜¯</strong>æ­£äº¤çŸ©é˜µ</strong>ã€‚</p>
</li>
</ul>
<hr>
<h1 id="2-Jordanæ ‡å‡†å‹"><a href="#2-Jordanæ ‡å‡†å‹" class="headerlink" title="2 Jordanæ ‡å‡†å‹"></a>2 Jordanæ ‡å‡†å‹</h1><hr>
<p>ï¼ˆ1ï¼‰è‹¥æœ‰$T(\xi) &#x3D; \lambda \xi$ï¼Œç§°$\lambda$ä¸º$T$çš„ç‰¹å¾å€¼ï¼Œ$\xi$ä¸º$T$çš„ç‰¹å¾å‘é‡ã€‚å¦‚æœ$A$æ˜¯çº¿æ€§å˜æ¢$T$å¯¹åº”çš„çŸ©é˜µï¼Œé‚£ä¹ˆï¼Œ$\lambda$å’Œ$\xi$ä¹Ÿæ˜¯$A$çš„ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡ã€‚</p>
<hr>
<p>ï¼ˆ2ï¼‰è®¾$\lambda_1, \lambda_2, â€¦, \lambda_s$æ˜¯$V_n(F)$ä¸Šçº¿æ€§å˜æ¢$T$çš„$s$ä¸ªäº’å¼‚ç‰¹å¾å€¼ï¼Œ$V_{\lambda_i}$æ˜¯$\lambda_i$çš„<strong>ç‰¹å¾å­ç©ºé—´</strong>ï¼Œå…¶ä¸­$i&#x3D;1,2,â€¦,s$ï¼Œåˆ™ï¼š</p>
<ul>
<li><p>$V_{\lambda_i}$æ˜¯$T$çš„<strong>ä¸å˜å­ç©ºé—´</strong>ï¼›</p>
</li>
<li><p>$\lambda_i \neq \lambda_j$æ—¶ï¼Œ$V_{\lambda_i} \cap V_{\lambda_j} &#x3D; {0}$ï¼›</p>
</li>
<li><p>è‹¥$\lambda_i$æ˜¯$k_i$é‡ï¼ˆ<em>ä»£æ•°é‡æ•°</em>ï¼‰çš„ï¼Œ$\dim V_{\lambda_i}$æ˜¯_å‡ ä½•é‡æ•°_ï¼Œåˆ™æœ‰$\dim V_{\lambda_i} \leqslant k_i$ã€‚</p>
</li>
</ul>
<hr>
<p>ï¼ˆ3ï¼‰çº¿æ€§å˜æ¢$T$æœ‰å¯¹è§’çŸ©é˜µè¡¨ç¤ºçš„å……åˆ†å¿…è¦æ¡ä»¶æ˜¯ $T$<strong>æœ‰</strong>$n$<strong>ä¸ªçº¿æ€§æ— å…³çš„ç‰¹å¾å‘é‡</strong>ã€‚</p>
<blockquote>
<p><strong>å¹‚ç­‰çŸ©é˜µ</strong>**ï¼š**$A^2 &#x3D; A$<strong>ï¼Œ</strong>$A$<strong>ç›¸ä¼¼äºå¯¹è§’çŸ©é˜µ</strong>$\begin{bmatrix} I_r&amp; \ &amp; 0\end{bmatrix}$**ï¼Œå…¶ä¸­**$r$<strong>ä¸ºçŸ©é˜µ</strong>$A$<strong>çš„ç§©ã€‚</strong></p>
</blockquote>
<blockquote>
<p><strong>ä¹˜æ–¹çŸ©é˜µ</strong>**ï¼š**$A^2 &#x3D; I$<strong>ï¼Œ</strong>$A$<strong>ç›¸ä¼¼äºå¯¹è§’é˜µ</strong>$\begin{bmatrix}I_s &amp; \ &amp; I_t\end{bmatrix}$**ï¼Œå…¶ä¸­**$s+t&#x3D;n$<strong>ã€‚</strong></p>
</blockquote>
<hr>
<p>ï¼ˆ4ï¼‰å…³äºç§©çš„ä¸ç­‰å¼ï¼š</p>
<p>$rank(A \pm B) \leqslant rank(A) + rank(B)$</p>
<p>$rank(A) + rank(B) -n \leqslant rank(A_{m \times n}B_{n \times m}) \leqslant \min(r(A), r(B))$</p>
<p>$if ;A_{m \times n}B_{n \times m}&#x3D;0, \quad rank(A) + rank(B) \leqslant n$</p>
<hr>
<p>ï¼ˆ5ï¼‰å½¢å¦‚$J(\lambda) &#x3D; \begin{bmatrix}\lambda &amp; 1 &amp; &amp; \ &amp; \lambda &amp; 1 &amp; \ &amp; &amp; â€¦ &amp; 1\ &amp; &amp; &amp; \lambda\end{bmatrix}$ï¼Œç§°ä¸º<strong>Jordanå—</strong>ã€‚Jordanå—å‘ˆä¸Šä¸‰è§’ï¼Œä¸»å¯¹è§’çº¿æ˜¯å®ƒçš„å…¨éƒ¨ç‰¹å¾å€¼ï¼Œç‰¹ç‚¹æ˜¯<strong>ä¸»å¯¹è§’çº¿ä¸Šå…ƒç´ ç›¸ç­‰ï¼Œç´§é‚»ä¸Šæ–¹å…ƒç´ </strong>$a_{i,i+1} &#x3D; 1$<strong>ï¼Œå…¶ä½™å…ƒç´ ä¸º0</strong>ã€‚</p>
<hr>
<p>ï¼ˆ6ï¼‰æ¯ä¸ª$n$é˜¶æ–¹é˜µ$A$éƒ½ç›¸ä¼¼äºä¸€ä¸ªJordançŸ©é˜µï¼Œå³å­˜åœ¨å¯é€†çŸ©é˜µ$P$ï¼Œæœ‰ï¼š</p>
<p>$P^{-1}AP &#x3D; J_A &#x3D; \begin{bmatrix}J_1(\lambda_1) &amp;Â  &amp;Â  &amp; \Â Â &amp; J_2(\lambda_2) &amp;Â  &amp; \Â Â &amp;Â  &amp; â€¦ &amp; \Â Â &amp;Â  &amp;Â  &amp; J_s(\lambda_s)\end{bmatrix}$</p>
<p>å…¶ä¸­$J_A$ç§°ä¸º<strong>Jordanæ ‡å‡†å½¢</strong>ã€‚</p>
<hr>
<p>ï¼ˆ7ï¼‰<strong>Jordanæ ‡å‡†å½¢</strong>çš„æ±‚æ³•ï¼š</p>
<ul>
<li><p>æ±‚çŸ©é˜µ$A$çš„ç‰¹å¾å¤šé¡¹å¼$|\lambda I-A| &#x3D; (\lambda - \lambda_1)^{k_1}(\lambda-\lambda_2)^{k_2}â€¦(\lambda - \lambda_s)^{k_s}$ï¼Œå…¶ä¸­$k_i$æ˜¯ç‰¹å¾å€¼$\lambda_i$çš„<strong>ä»£æ•°é‡æ•°ï¼Œå†³å®šäº†å¯¹è§’çº¿ä¸Šç‰¹å¾å€¼</strong>$\lambda_i$<strong>çš„ä¸ªæ•°</strong>ï¼›</p>
</li>
<li><p>å¯¹$\lambda_i$ï¼Œç”±$(A-\lambda_i I)X&#x3D;0$ï¼Œæ±‚$A$çš„<strong>çº¿æ€§æ— å…³çš„ç‰¹å¾å‘é‡</strong>$\alpha_1,\alpha_2, â€¦,\alpha_{t_i}$ï¼Œå…¶ä¸­$t_i$æ˜¯ç‰¹å¾å€¼$\lambda_i$çš„<strong>å‡ ä½•é‡æ•°ï¼Œå†³å®šäº†Jordanå—çš„ä¸ªæ•°</strong>ï¼›</p>
<ul>
<li><p>å¦‚æœ$k_i &#x3D; t_i$ï¼Œå³<strong>ä»£æ•°é‡æ•°ç­‰äºå‡ ä½•é‡æ•°</strong>ï¼Œè¯´æ˜$\lambda_i$å¯¹åº”çš„Jordanå—æ˜¯å¯¹è§’é˜µï¼›</p>
</li>
<li><p>å¦‚æœ$t_i &lt; k_i$ï¼Œå°±é€‰æ‹©åˆé€‚çš„ç‰¹å¾å‘é‡$\alpha_j$ï¼Œåˆ©ç”¨${\color{red} {|A-\lambda_i I| &#x3D; \alpha_j}}$<strong>æ±‚Jordané“¾</strong>ï¼Œç¡®å®šæ¯ä¸€ä¸ªå°Jordanå—çš„é˜¶æ•°ã€‚</p>
</li>
</ul>
</li>
<li><p>å°†æ‰€æœ‰ç‰¹å¾å€¼$\lambda_i$å¯¹åº”çš„Jordanå—ç»„åˆèµ·æ¥ï¼Œå½¢æˆJordançŸ©é˜µ$J_A$ã€‚</p>
</li>
</ul>
<hr>
<p>ï¼ˆ8ï¼‰<strong>çŸ©é˜µå¤šé¡¹å¼</strong>å¯ä»¥è¡¨ç¤ºä¸º$g(A) &#x3D; a_m A^m + a_{m-1}A^{m-1}+â€¦+a_1A +a_0 I$Â ï¼Œç”±äºæœ‰$A &#x3D; P J_AP^{-1}$ï¼Œæ‰€ä»¥æœ‰ï¼š</p>
<p>$g(A) &#x3D; P \begin{bmatrix}g(J_1(\lambda_1)) &amp;Â  &amp;Â  &amp; \Â Â &amp; g(J_2(\lambda_2)) &amp;Â  &amp; \Â Â &amp;Â  &amp; â€¦ &amp; \Â Â &amp;Â  &amp;Â  &amp; g(J_s(\lambda_s))Â \end{bmatrix} P^{-1}$</p>
<p>è€Œå¯¹äº$g(J(\lambda))$åˆ™æœ‰ï¼š</p>
<p>$g(J(\lambda)) &#x3D; \begin{bmatrix}g(\lambda) &amp; gâ€™(\lambda) &amp; â€¦ &amp; \frac{g^{(r-1)}(\lambda)}{(r-1)!} \Â Â &amp; g(\lambda) &amp; â€¦ &amp; .\Â Â &amp;Â  &amp; â€¦ &amp; .\Â Â &amp;Â  &amp;Â  &amp; g(\lambda)\end{bmatrix}$</p>
<p>å¯¹äº<strong>å¸¸ç”¨çš„å¹‚æŒ‡æ•°å½¢å¼</strong>æœ‰</p>
<p>$J^k(\lambda) &#x3D; \begin{bmatrix}\lambda^k &amp; \frac{(\lambda^k)â€™}{1!} &amp; \frac{(\lambda^k)â€™â€™}{2!} &amp;â€¦ \Â Â &amp;Â  \lambda^k&amp; â€¦ &amp; .\Â Â &amp;Â  &amp; â€¦ &amp; .\Â Â &amp;Â  &amp;Â  &amp;Â  \lambda^k\end{bmatrix}$</p>
<hr>
<p>ï¼ˆ9ï¼‰ä½¿$g(A)&#x3D;0$çš„å¤šé¡¹å¼$g(\lambda)$ç§°ä¸º$A$çš„<strong>åŒ–é›¶å¤šé¡¹å¼</strong>ï¼Œ<strong>ç‰¹å¾å¤šé¡¹å¼å¿…æ˜¯çŸ©é˜µ</strong>$A$<strong>çš„åŒ–é›¶å¤šé¡¹å¼</strong>ã€‚</p>
<blockquote>
<p>ğŸ“Œæ³¨ï¼šåŒ–é›¶å¤šé¡¹å¼çš„æ ¹ä¸€å®šåŒ…å«äº†æ‰€æœ‰çš„ç‰¹å¾å€¼ï¼Œä½†ä¸èƒ½è¯´åŒ–é›¶å¤šé¡¹å¼çš„æ ¹ä¸€å®šæ˜¯ç‰¹å¾å€¼ã€‚</p>
</blockquote>
<hr>
<p>ï¼ˆ10ï¼‰å¯¹äº<strong>æœ€å°å¤šé¡¹å¼</strong></p>
<ul>
<li><p>$m_T(\lambda)$æœ€é«˜é¡¹ç³»æ•°ä¸º<code>1</code>ï¼›</p>
</li>
<li><p>$m_T(\lambda)$æ˜¯$T$çš„ä¸€ä¸ªåŒ–é›¶å¤šé¡¹å¼ï¼›</p>
</li>
<li><p>$m_T(\lambda)$æ˜¯åŒ–é›¶å¤šé¡¹å¼ä¸­æ¬¡æ•°æœ€ä½çš„é‚£ä¸€ä¸ªã€‚</p>
</li>
</ul>
<blockquote>
<p><strong>æœ€å°å¤šé¡¹å¼</strong>$m_T(\lambda)$<strong>çš„æ ¹ä¸€å®šåŒ…å«äº†æ‰€æœ‰çš„ç‰¹å¾å€¼</strong>$\lambda_i$<strong>ï¼Œå­å¼</strong>$(\lambda-\lambda_i)^{r_i}$<strong>çš„å¹‚</strong>$r_i$<strong>ç­‰äºJordanæ ‡å‡†å½¢ä¸­å…³äºç‰¹å¾å€¼</strong>$\lambda_i$<strong>çš„Jordanå—ä¸­çš„æœ€é«˜é˜¶æ•°</strong>ã€‚</p>
</blockquote>
<blockquote>
<p>ğŸ“Œæ¯”å¦‚çŸ©é˜µ$A$æœ‰ä¸€ä¸ªä»£æ•°é‡æ•°ä¸º3çš„ç‰¹å¾å€¼2ï¼Œè¯¥ç‰¹å¾å€¼å¯¹åº”ä¸¤ä¸ªJordanå—ï¼Œåˆ†åˆ«æ˜¯ $\begin{bmatrix}2 &amp; 1 \ &amp; 2 \end{bmatrix}$ä»¥åŠ$[2]$ï¼Œ è¯´æ˜å…¶ä¸­å…¶æœ€é«˜é˜¶æ•°ä¸º2ï¼Œé‚£ä¹ˆåœ¨æœ€å°å¤šé¡¹å¼ä¸­å¯¹åº”çš„å­å¼ä¸º$(\lambda -2)^2$ã€‚</p>
</blockquote>
<blockquote>
<p>ğŸ“Œçº¿æ€§å˜æ¢å¯ä»¥å¯¹è§’åŒ–çš„å……è¦æ¡ä»¶æ˜¯å…¶æœ€å°å¤šé¡¹å¼æ˜¯ä¸€æ¬¡å› å­çš„ä¹˜ç§¯</p>
</blockquote>
<hr>
<p>ï¼ˆ11ï¼‰çº¿æ€§å˜æ¢ä¸Jordanæ ‡å‡†å‹çš„ç»“åˆ</p>
<ul>
<li>çº¿æ€§å˜æ¢åœ¨åŸåŸºçš„å˜æ¢çŸ©é˜µä¸æ˜¯å¯¹è§’çŸ©é˜µï¼Œå¦‚ä½•æ±‚å¾—æ–°åŸºï¼Œä½¿å¾—åœ¨æ–°åŸºä¸‹çš„å˜æ¢çŸ©é˜µæ˜¯å¯¹è§’çŸ©é˜µ</li>
</ul>
<!---->

<ul>
<li>çº¿æ€§å˜æ¢åœ¨åŸåŸºçš„å˜æ¢çŸ©é˜µä¸æ˜¯Jordanæ ‡å‡†å‹ï¼Œå¦‚ä½•æ±‚å¾—æ–°åŸºï¼Œä½¿å¾—åœ¨æ–°åŸºä¸‹çš„å˜æ¢çŸ©é˜µæ˜¯Jordanæ ‡å‡†å‹</li>
</ul>
<p>å¯¹åŸåŸºä¸‹çš„å˜æ¢çŸ©é˜µæ±‚<strong>ç›¸ä¼¼å¯¹è§’åŒ–</strong>ï¼Œå¾—åˆ°çš„ç‰¹å¾å‘é‡ç»„æˆçš„çŸ©é˜µPå³ä¹˜åŸåŸºï¼Œå³æ˜¯å¯ä½¿å˜æ¢çŸ©é˜µæˆä¸ºå¯¹è§’é˜µçš„æ–°åŸº</p>
<p>å¯¹åŸåŸºä¸‹çš„å˜æ¢çŸ©é˜µæ±‚<strong>ç›¸ä¼¼çš„Jordanæ ‡å‡†å‹</strong>$P\Lambda P^{-1}$ï¼Œç”¨$P$å³ä¹˜åŸåŸºï¼Œå³æ˜¯å¯ä½¿å˜æ¢çŸ©é˜µæˆä¸ºJordanæ ‡å‡†å‹çš„æ–°åŸº</p>
<blockquote>
<p>ğŸ“Œå·¦å¼åœ¨ä¹¦ä¸Šå®šä¹‰2.1å¤„æœ‰è¯æ˜ï¼Œå³<br>$T(\xi)&#x3D;\lambda\xi$&amp;#x20;<br>$\xi&#x3D;(\alpha_1,\alpha_2â€¦\alpha_n)\bold X$$T(\xi)&#x3D;(\alpha1,\alpha_2â€¦\alpha_n) A\bold{X}\rightarrow A\bold X&#x3D;\lambda\bold X$&amp;#x20;<br>è¿™è¯´æ˜$\lambda$æ˜¯çŸ©é˜µAçš„ç‰¹å¾å€¼ï¼Œ$\bold X$æ˜¯çŸ©é˜µAå…³äº$\lambda$çš„ç‰¹å¾å‘é‡</p>
</blockquote>
<hr>
<h1 id="3-çŸ©é˜µåˆ†è§£"><a href="#3-çŸ©é˜µåˆ†è§£" class="headerlink" title="3 çŸ©é˜µåˆ†è§£"></a>3 çŸ©é˜µåˆ†è§£</h1><hr>
<p>ï¼ˆ1ï¼‰<strong>ç­‰ä»·æ ‡å‡†å½¢</strong></p>
<p>å¯¹äº$A \in C^{m \times n}$ï¼Œå­˜åœ¨å¯é€†çŸ©é˜µ$P \in C^{m \times m}, Q \in C^{n \times n}$ï¼Œä½¿å¾—</p>
<p>$$<br>A &#x3D; P \begin{bmatrix}I_r &amp; 0Â  \Â 0 &amp; 0\end{bmatrix}Q<br>$$</p>
<p>å…¶ä¸­$r$æ˜¯çŸ©é˜µ$A$çš„ç§©ã€‚</p>
<hr>
<p>ï¼ˆ2ï¼‰<strong>ç›¸ä¼¼æ ‡å‡†å½¢</strong></p>
<p>å­˜åœ¨å¯é€†çŸ©é˜µ$P \in C^{ n \times n}$ï¼Œæœ‰</p>
<p>$$<br>A &#x3D; P \begin{bmatrix}\lambda_1 &amp;Â  &amp;Â  &amp; \Â Â &amp; \lambda_2 &amp;Â  &amp; \Â Â &amp;Â  &amp; â€¦ &amp; \Â Â &amp;Â  &amp;Â  &amp; \lambda_n\end{bmatrix} P^{-1}<br>$$</p>
<hr>
<p>ï¼ˆ3ï¼‰<strong>LUåˆ†è§£</strong></p>
<blockquote>
<p>å®šä¹‰ï¼š$L$<strong>æ˜¯ä¸‹ä¸‰è§’çŸ©é˜µï¼Œ</strong>$U$<strong>æ˜¯ä¸Šä¸‰è§’çŸ©é˜µ</strong>ï¼Œ$A&#x3D;LU$ã€‚</p>
</blockquote>
<blockquote>
<p>ğŸ“Œå­˜åœ¨æ¡ä»¶ï¼šAçš„ç§©ä¸ºrï¼Œå‰ré˜¶é¡ºåºä¸»å­å¼ä¸ä¸º0ï¼Œåˆ™å­˜åœ¨LUåˆ†è§£</p>
</blockquote>
<p><em>æ±‚æ³•</em>ï¼š</p>
<ul>
<li><p>å¯¹äº$(A ;|; I_n)$ï¼Œ<strong>åªç”¨ç¬¬</strong>$i$<strong>è¡Œä¹˜æ•°</strong>$k$<strong>åŠ åˆ°ç¬¬</strong>$j$<strong>è¡Œï¼ˆ</strong>$i &lt; j$<strong>ï¼‰å‹åˆç­‰å˜æ¢å°†</strong>$A$<strong>åŒ–ä¸ºä¸Šä¸‰è§’å½¢</strong>$U$<strong>ï¼Œå¯ä»¥å¾—åˆ°</strong>${\color{red} (U ; |; P)}$ï¼›</p>
</li>
<li><p><strong>å¯çŸ¥</strong>$PA&#x3D;U$<strong>ï¼Œäºæ˜¯æœ‰</strong>$L&#x3D;P^{-1}$<strong>ï¼Œåˆ™</strong>$A&#x3D;LU$ã€‚</p>
</li>
</ul>
<hr>
<p>ï¼ˆ4ï¼‰<strong>LDVåˆ†è§£</strong></p>
<blockquote>
<p>å®šä¹‰ï¼š$L, V$åˆ†åˆ«æ˜¯<strong>å¯¹è§’çº¿å…ƒç´ ä¸º1</strong>çš„ä¸‹ä¸‰è§’çŸ©é˜µå’Œä¸Šä¸‰è§’çŸ©é˜µï¼Œ$D$ä¸ºå¯¹è§’çŸ©é˜µï¼Œ$A&#x3D;LDV$ã€‚</p>
</blockquote>
<p><em>æ±‚æ³•</em>ï¼š</p>
<ul>
<li><p>æ–¹æ³•ä¸€ï¼š</p>
<ol>
<li><p>ç”±LUåˆ†è§£å¾—åˆ°$A &#x3D; LU$ï¼›</p>
</li>
<li><p>é€šè¿‡æ¯è¡Œé™¤ä»¥å¯¹åº”çš„å¯¹è§’çº¿ä¸Šå…ƒç´ çš„å€¼ï¼Œ<strong>å°†</strong>$U$<strong>çš„å¯¹è§’çº¿å…ƒç´ åŒ–ä¸º1</strong>ï¼Œå¾—åˆ°$U&#x3D;D_1V$ï¼›</p>
</li>
<li><p>é€šè¿‡æ¯åˆ—é™¤ä»¥å¯¹åº”çš„å¯¹è§’çº¿ä¸Šå…ƒç´ çš„å€¼ï¼Œå°†$L$çš„å¯¹è§’çº¿å…ƒç´ åŒ–ä¸º1ï¼Œå¾—åˆ°$L&#x3D;L_{real}D_2$</p>
</li>
<li><p>æœ‰$A&#x3D;L_{real}D_2D_1V&#x3D;LDV$ã€‚</p>
</li>
</ol>
</li>
<li><p>æ–¹æ³•äºŒï¼š</p>
<ol>
<li><p>å–çŸ©é˜µ$A$å¯¹è§’çº¿ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¾—åˆ°çŸ©é˜µ$A_1&#x3D;[a_{11}]$ï¼Œåˆ™æœ‰$A_1 &#x3D; L_1D_1V_1 &#x3D; [1][a_{11}][1]$ï¼›</p>
</li>
<li><p>å–åŒ…å«å¯¹è§’çº¿å‰ä¸¤ä¸ªå…ƒç´ çš„äºŒé˜¶çŸ©é˜µ$A_2 &#x3D; \begin{bmatrix}A_1 &amp; \alpha\ \beta &amp; a_{22}\end{bmatrix}$ï¼Œåˆ™æœ‰çŸ©é˜µ$A_2 &#x3D; L_2 D_2 V_2$ï¼Œå…¶ä¸­$L_2 &#x3D; \begin{bmatrix}L_1 &amp; 0\ x &amp; 1\end{bmatrix}$ï¼Œ$D_2 &#x3D; \begin{bmatrix}D_1 &amp; 0\ 0 &amp; d_2\end{bmatrix}$ï¼Œ$V_2 &#x3D; \begin{bmatrix}V_1 &amp; y\ 0 &amp; 1\end{bmatrix}$ï¼Œæ±‚å¾—æœªçŸ¥é‡$x, d_2, y$ï¼›</p>
</li>
<li><p>ä»¥æ­¤ç±»æ¨ï¼Œæœ€ç»ˆå¾—åˆ°$A &#x3D; L_n D_n V_n$ã€‚</p>
</li>
</ol>
</li>
</ul>
<blockquote>
<p>ğŸ“Œæ–¹æ³•äºŒå³ï¼š $A_n &#x3D; \begin{bmatrix}A_{n-1} &amp; \tau\ u^T &amp; a_{nn}\end{bmatrix}&#x3D;\begin{bmatrix}L_{n-1} &amp; 0\ l^T &amp; 1\end{bmatrix}\begin{bmatrix}D_{n-1} &amp; 0\ 0 &amp; d_n\end{bmatrix}\begin{bmatrix}V_{n-1} &amp; v\ 0 &amp; 1\end{bmatrix}$<br>è¿­ä»£ï¼š<br>&amp;#x20;$A_{n-1}&#x3D;L_{n-1}D_{n-1}V_{n-1}\\tau_n&#x3D;L_{n-1}D_{n-1}v_n\u_n^T&#x3D;l_n^TD_{n-1}V_{n-1}\a_{nn}&#x3D;l_n^TD_nv_n+d_n$</p>
</blockquote>
<blockquote>
<p>ğŸ“Œæœ‰LUåˆ†è§£ä¸ä¸€å®šæœ‰LDVåˆ†è§£ï¼ŒLUçš„å¯¹è§’çº¿å¯ä»¥æ˜¯0ï¼Œè€ŒLDVå¯¹è§’çº¿åªèƒ½æ˜¯1</p>
</blockquote>
<hr>
<p>ï¼ˆ5ï¼‰<strong>æ»¡ç§©åˆ†è§£</strong></p>
<blockquote>
<p>å®šä¹‰ï¼šå¯¹äº$rank(A)&#x3D;r$çš„çŸ©é˜µ$A$ï¼Œè‹¥å­˜åœ¨ç§©ä¸º$r$çš„çŸ©é˜µ$B \in F^{m \times r}, ; C \in F^{r \times n}$ï¼Œæœ‰$A&#x3D;BC$ï¼Œç§°ä¸ºçŸ©é˜µ$A$çš„æ»¡ç§©åˆ†è§£ã€‚</p>
</blockquote>
<blockquote>
<p>ğŸ“Œä»»ä½•éé›¶çŸ©é˜µï¼Œéƒ½å­˜åœ¨æ»¡ç§©åˆ†è§£</p>
</blockquote>
<p><em>æ±‚æ³•ï¼šæ–¹æ³•è¾ƒå¤šï¼Œä¸€èˆ¬åªç”¨æœ€ç®€å•çš„ç¬¬3ç§ã€‚</em></p>
<ul>
<li><p>ç”¨<strong>è¡Œåˆç­‰å˜æ¢</strong>æŠŠ$A$åŒ–ä¸ºHermiteæ ‡å‡†å½¢ï¼›</p>
</li>
<li><p>ä¾Hermiteæ ‡å‡†å½¢ä¸­å‘é‡$e_i$æ‰€åœ¨çš„åˆ—çš„ä½ç½®ç¬¬$j_i$åˆ—ï¼Œç›¸åº”åœ°å–å‡º$A$çš„ç¬¬$j_i$åˆ—$a_{ji}$ï¼Œå¾—åˆ° $A$çš„<strong>åˆ—å‘é‡æå¤§æ— å…³ç»„</strong>${a_{j_1}, a_{j_2}, â€¦, a_{j_r}}$ï¼Œ$B &#x3D;(a_{j_1}, a_{j_2}, â€¦, a_{j_r})$;</p>
</li>
<li><p>$A$çš„HermiteçŸ©é˜µä¸­çš„<strong>éé›¶è¡Œ</strong>æ„æˆçŸ©é˜µ$C$ï¼Œå¾—åˆ°æ»¡ç§©åˆ†è§£$A&#x3D;BC$ã€‚</p>
</li>
</ul>
<blockquote>
<p>ğŸ“Œæ±‚çŸ©é˜µ$A&#x3D;\begin{bmatrix}1 &amp; 1 &amp; 2\ 0 &amp; 2 &amp; 2\ 1 &amp; 0 &amp; 1\end{bmatrix}$çš„æ»¡ç§©åˆ†è§£ã€‚</p>
<p>ç­”ï¼š ç”¨è¡Œåˆç­‰å˜æ¢åŒ–$A$ä¸ºHermiteæ ‡å‡†å½¢ï¼š<br>$A &#x3D; \begin{bmatrix}1 &amp; 1 &amp; 2\ 0 &amp; 2 &amp; 2\ 1 &amp; 0 &amp; 1\end{bmatrix} \rightarrow \begin{bmatrix}1 &amp; 1 &amp; 2\ 0 &amp; 2 &amp; 2\ 0 &amp; -1 &amp; -1\end{bmatrix} \rightarrow \begin{bmatrix}1 &amp; 0 &amp; 1\ 0 &amp; 1 &amp; 1\ 0 &amp;0 &amp;0 \end{bmatrix}$<br>å¯çŸ¥$rank(A)&#x3D;2$ï¼Œ$A$çš„å‰ä¸¤åˆ—çº¿æ€§æ— å…³ï¼Œå–å‡ºæ„æˆ$B$ï¼›å–å‡º$A$çš„Hermiteæ ‡å‡†å½¢çš„å‰ä¸¤è¡Œä½œä¸º$C$ï¼Œæœ‰$B &#x3D; \begin{bmatrix} 1&amp;1  \  0&amp;2  \  1&amp;0  \end{bmatrix}, C &#x3D; \begin{bmatrix}1 &amp; 0 &amp; 1\ 0 &amp; 1 &amp; 1\end{bmatrix}, A&#x3D;BC$</p>
</blockquote>
<hr>
<p>ï¼ˆ6ï¼‰<strong>è°±åˆ†è§£</strong></p>
<blockquote>
<p>å®šä¹‰ï¼šçŸ©é˜µ$A$äº’å¼‚çš„ç‰¹å¾å€¼${\lambda_1, \lambda_2, â€¦, \lambda_s}$ç§°ä¸ºçŸ©é˜µ$A$çš„<strong>è°±</strong>ã€‚<strong>å¯ç›¸ä¼¼å¯¹è§’åŒ–æ˜¯å¯ä»¥è°±åˆ†è§£çš„å……è¦æ¡ä»¶</strong>ã€‚</p>
</blockquote>
<p><em>æ±‚æ³•</em>ï¼š</p>
<ul>
<li><p>é€šè¿‡æ±‚ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡å¾—åˆ°</p>
<p>$A &#x3D; P\begin{bmatrix}\lambda_1 &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; \ &amp; â€¦ &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; \ &amp; &amp; \lambda_1 &amp; &amp; &amp; &amp; &amp; &amp; &amp; \ &amp; &amp; &amp; \lambda_2&amp; &amp; &amp; &amp; &amp; &amp; \ &amp; &amp; &amp; &amp; â€¦ &amp; &amp; &amp; &amp; &amp; \ &amp; &amp; &amp; &amp; &amp; \lambda_2 &amp; &amp; &amp; &amp; \ &amp; &amp; &amp; &amp; &amp; &amp; â€¦ &amp; &amp; &amp; \ &amp; &amp; &amp; &amp; &amp; &amp; &amp; \lambda_s &amp; &amp; \ &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; â€¦ &amp; \ &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; \lambda_s\end{bmatrix} P^{-1}$ï¼›</p>
</li>
<li><p>å¯¹è§’é˜µ$\Lambda &#x3D; \lambda_1 \begin{bmatrix}I_{r_1} &amp; &amp; &amp; \ &amp; 0 &amp; &amp; \ &amp; &amp; â€¦ &amp; \ &amp; &amp; &amp; 0\end{bmatrix} + \lambda_2\begin{bmatrix}0 &amp; &amp; &amp; \ &amp; I_{r_2} &amp; &amp; \ &amp; &amp; 0 &amp; \ &amp; &amp; &amp; 0\end{bmatrix} + â€¦ + \lambda_s\begin{bmatrix}0 &amp; &amp; &amp; \ &amp; 0 &amp; &amp; \ &amp; &amp; 0 &amp; \ &amp; &amp; &amp; I_{r_s}\end{bmatrix}$ï¼Œä»¤$Q_i &#x3D; \begin{bmatrix}0 &amp; &amp; &amp; \ &amp;â€¦ &amp; &amp; \ &amp; &amp; I_{r_i} &amp; \ &amp; &amp; &amp; â€¦\end{bmatrix}$ï¼›</p>
</li>
<li><p>å¾—åˆ°$A &#x3D; \sum_{i&#x3D;1}^s \lambda_i P_i$ï¼Œå…¶ä¸­$P_i &#x3D; P Q_i P^{-1}$ã€‚</p>
</li>
</ul>
<hr>
<p>ï¼ˆ7ï¼‰<strong>Schuråˆ†è§£</strong></p>
<blockquote>
<p>URåˆ†è§£ï¼šå¯¹å¯é€†çŸ©é˜µ$A$ï¼Œå­˜åœ¨<strong>é…‰çŸ©é˜µ</strong>$U$<strong>å’Œ</strong>ä¸»å¯¹è§’çº¿ä¸Šå…ƒç´ éƒ½ä¸ºæ­£çš„ä¸Šä¸‰è§’çŸ©é˜µ$R$ï¼Œä½¿$A&#x3D;UR$ã€‚</p>
</blockquote>
<blockquote>
<p>Schuråˆ†è§£ï¼šè®¾$A\in C^{n\times n}$ï¼Œåˆ™å­˜åœ¨é…‰çŸ©é˜µ$U$å’Œä¸Šä¸‰è§’çŸ©é˜µ$T$ï¼Œä½¿å¾—</p>
</blockquote>
<p>$U^HAU&#x3D;T&#x3D;\begin{bmatrix}\lambda_1&amp;t_{12} &amp;â€¦ &amp;t_{1n} \ &amp;\lambda_2 &amp;â€¦ &amp;t_{2n} \ &amp; &amp; â€¦ &amp; \ &amp; &amp; &amp; \lambda_n\end{bmatrix}$</p>
<p>å…¶ä¸­$\lambda_i$æ˜¯çŸ©é˜µ$A$çš„ç‰¹å¾å€¼ï¼Œ$i&#x3D;1,2,â€¦,n$</p>
<p><em>URåˆ†è§£**æ±‚æ³•</em>ï¼š</p>
<ul>
<li><p>å–çŸ©é˜µ$A &#x3D; (A_1, A_2, â€¦, A_n)$çš„åˆ—å‘é‡ï¼Œè¿›è¡Œ<strong>æ–½å¯†ç‰¹æ­£äº¤åŒ–</strong>ï¼Œå¾—åˆ°$u_1,u_2, â€¦,u_n$ï¼Œæœ‰$U&#x3D;(u_1,u_2,â€¦,u_n)$ï¼›</p>
</li>
<li><p>å†ç”±$R &#x3D; U^H A$å¾—åˆ°$R$ï¼Œäºæ˜¯$A&#x3D;UR$ã€‚</p>
</li>
</ul>
<blockquote>
<p>ğŸ“Œæ–½å¯†ç‰¹æ­£äº¤åŒ–æ–¹æ³•ï¼š è®¾$\alpha_1,\alpha_2,â€¦,a_r(r\le n)$æ˜¯çº¿æ€§æ— å…³çš„å‘é‡ç»„ï¼Œåˆ™é€šè¿‡ä»¥ä¸‹æ–¹æ³• $\beta_1&#x3D;\alpha_1\\beta_2&#x3D;\alpha_2-\frac{(\alpha_2,\beta_1)}{(\beta_1,\beta_1)}\beta_1\â€¦â€¦\\beta_k&#x3D;\alpha_k-\sum_{i&#x3D;1}^{k-1}\frac{(\alpha_k,\beta_i)}{(\beta_i,\beta_i)}\beta_i\k&#x3D;3,4,â€¦,r$&amp;#x20;<br>å¾—åˆ°çš„å‘é‡ç»„$\beta_1,\beta_2,â€¦,\beta_r$æ˜¯æ­£äº¤å‘é‡ç»„</p>
</blockquote>
<p><em>Schuråˆ†è§£æ±‚æ³•</em>ï¼š</p>
<ul>
<li><p>$A$ç›¸ä¼¼äºJordanæ ‡å‡†å‹$A&#x3D;PJP^{-1}$ï¼›</p>
</li>
<li><p>é€šè¿‡$P$çš„URåˆ†è§£æœ‰$P&#x3D;UR$ï¼Œåˆ™$A&#x3D;PJP^{-1}&#x3D;URJR^{-1}U^H$ï¼›</p>
</li>
<li><p>ä»¤$T&#x3D;RJR^{-1}$ï¼Œåˆ™$T$æ˜¯ä¸€ä¸ªä¸Šä¸‰è§’å½¢çŸ©é˜µï¼Œå³æœ‰$U^HAU&#x3D;T$ã€‚</p>
</li>
</ul>
<hr>
<p>ï¼ˆ8ï¼‰å‡ ç§ç‰¹æ®ŠçŸ©é˜µï¼š</p>
<ul>
<li><p><strong>æ­£è§„çŸ©é˜µ</strong>ï¼š$A^HA &#x3D; AA^H$ ï¼ˆ<strong>æ­£è§„çŸ©é˜µé…‰ç›¸ä¼¼äºå¯¹è§’é˜µ</strong>ï¼‰</p>
</li>
<li><p><strong>é…‰çŸ©é˜µ</strong>ï¼š$A^HA &#x3D; AA^H&#x3D;I$</p>
</li>
<li><p><strong>HermiteçŸ©é˜µ</strong>ï¼š$A^H &#x3D; A$</p>
</li>
</ul>
<blockquote>
<p>ğŸ“Œå¯¹äºæ­£è§„çŸ©é˜µï¼Œ$A$å’Œ$A^H$çš„ç‰¹å¾å‘é‡ç›¸ç­‰ï¼Œæ›´ä¸€èˆ¬åœ°ï¼Œåªè¦$AB&#x3D;BA$ä¸”$A$å’Œ$B$éƒ½å¯ç›¸ä¼¼å¯¹è§’åŒ–ï¼Œé‚£ä¹ˆAå’ŒBç‰¹å¾å‘é‡å°±ç›¸åŒã€‚&amp;#x20;<br>è¯æ˜ï¼š $A&#x3D;P\Lambda_1 P^{-1}&#x3D;P\begin{bmatrix}\lambda_1 &amp; \ &amp; \lambda_2\ &amp; &amp; â€¦\ &amp; &amp; &amp; \lambda_n\end{bmatrix}P^{-1}$<br>åˆ™$P^{-1}APP^{-1}BP&#x3D;P^{-1}ABP&#x3D;P^{-1}BAP&#x3D;P^{-1}BPP^{-1}AP$&amp;#x20;<br>å³$\begin{bmatrix}\lambda_1&amp;&amp;&amp;\&amp;\lambda_2&amp;&amp;\&amp;&amp;â€¦&amp;\&amp;&amp;&amp;\lambda_n\end{bmatrix}P^{-1}BP&#x3D;P^{-1}BP\begin{bmatrix}\lambda_1&amp;&amp;&amp;\&amp;\lambda_2&amp;&amp;\&amp;&amp;â€¦&amp;\&amp;&amp;&amp;\lambda_n\end{bmatrix}$&amp;#x20;<br>æ‰€ä»¥$P^{-1}BP&#x3D;\begin{bmatrix}\lambda_1^{-1}&amp;&amp;&amp;\&amp;\lambda_2^{-1}&amp;&amp;\&amp;&amp;â€¦&amp;\&amp;&amp;&amp;\lambda_n^{-1}\end{bmatrix}P^{-1}BP\begin{bmatrix}\lambda_1&amp;&amp;&amp;\&amp;\lambda_2&amp;&amp;\&amp;&amp;â€¦&amp;\&amp;&amp;&amp;\lambda_n\end{bmatrix}$<br>ä¹Ÿå°±æ˜¯è¯´$P^{-1}BP$çš„æ¯ä¸ªå…ƒç´ $a_{ij}&#x3D;a_{ij}\frac{\lambda_j}{\lambda_i}$ï¼Œåªæœ‰å¯¹è§’çº¿å…ƒç´ æ˜¯å¯ä»¥æ»¡è¶³æ­¤æ¡ä»¶çš„ï¼Œæ‰€ä»¥$P^{-1}BP$æ˜¯å¯¹è§’çŸ©é˜µ$\begin{bmatrix}k_1&amp;&amp;&amp;\&amp;k_2&amp;&amp;\&amp;&amp;â€¦&amp;\&amp;&amp;&amp;k_n\end{bmatrix}$ ï¼Œ$k_1,k_2,â€¦k_n$ä¹Ÿå°±æ˜¯Bçš„ç‰¹å¾å‘é‡ã€‚<br>å¯¹äº$P&#x3D;[\alpha_1,\alpha_2,â€¦\alpha_n]$çš„åˆ—å‘é‡$\alpha_i$ï¼Œæœ‰$A\alpha_i&#x3D;\lambda_i\alpha_i,B\alpha_i&#x3D;k_i\alpha_i$ï¼Œæ‰€ä»¥$\alpha_i$åŒæ—¶æ˜¯Aå’ŒBçš„ç‰¹å¾å‘é‡ã€‚å³Aå’ŒBç‰¹å¾å‘é‡ç›¸åŒ</p>
</blockquote>
<hr>
<p>ï¼ˆ9ï¼‰<strong>å¥‡å¼‚å€¼åˆ†è§£ï¼ˆSVDåˆ†è§£ï¼‰</strong></p>
<blockquote>
<p><strong>å¥‡å¼‚å€¼</strong>ï¼šå¯¹$rank(A)&#x3D;r$çš„çŸ©é˜µAï¼ŒçŸ©é˜µ$A^HA$çš„<strong>éé›¶ç‰¹å¾å€¼</strong>æœ‰$\lambda_1 \geqslant \lambda_2 \geqslant â€¦ \geqslant \lambda_r &gt;0$ï¼Œåˆ™ç§°æ­£æ•°$\sigma_i &#x3D; \sqrt{\lambda_i}$ä¸ºçŸ©é˜µAçš„å¥‡å¼‚å€¼ã€‚</p>
</blockquote>
<blockquote>
<p>å®šä¹‰ï¼šå¯¹$rank(A)&#x3D;r$çš„çŸ©é˜µ$A \in C^{m \times n}$ï¼Œå¥‡å¼‚å€¼æœ‰$\sigma_1 \geqslant \sigma_2 \geqslant â€¦ \geqslant \sigma_r &gt; 0$ï¼Œåˆ™å­˜åœ¨<strong>é…‰çŸ©é˜µ</strong>$U \in C^{m \times m}, ; V \in C^{n \times n}$ï¼Œåˆ†å—çŸ©é˜µ$\Sigma &#x3D; \begin{bmatrix}\Delta &amp; 0\ 0 &amp; 0\end{bmatrix}$ï¼Œæœ‰$A &#x3D; U \Sigma V^H$ï¼Œå…¶ä¸­$\Delta &#x3D; \begin{bmatrix}\sigma_1 &amp; &amp; &amp; \ &amp; \sigma_2 &amp; &amp; \ &amp; &amp; â€¦ &amp; \ &amp; &amp; &amp; \sigma_r\end{bmatrix}$ã€‚</p>
</blockquote>
<p><em>æ±‚è§£</em>ï¼šç¬¬ä¸€æ­¥å’Œç¬¬ä¸‰æ­¥è¦æ±‚éé›¶ç‰¹å¾å€¼ï¼Œè€Œç¬¬äºŒæ­¥æ— æ­¤è¦æ±‚</p>
<ul>
<li><p>ç”±ç‰¹å¾å¤šé¡¹å¼$|\lambda I - A^HA| &#x3D; 0$æ±‚å¾—ç‰¹å¾å€¼$\lambda_1 \geqslant \lambda_2 \geqslant .. \geqslant \lambda_n$ï¼Œï¼ˆ<strong>åŠ¡å¿…æŒ‰ç…§ä»å¤§åˆ°å°æ’åˆ—</strong>ï¼‰ï¼ˆ<strong>å¥‡å¼‚å€¼çŸ©é˜µä¸­æŸå¥‡å¼‚å€¼ä¸ªæ•°ç­‰äºç‰¹å¾å€¼é‡æ•°</strong>ï¼‰ï¼Œä»¥åŠæ¯ä¸ªç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡$\alpha_1, \alpha_2, â€¦, \alpha_n$ï¼›</p>
</li>
<li><p>å¯¹ç‰¹å¾å‘é‡è¿›è¡Œæ–½å¯†ç‰¹æ­£äº¤åŒ–å’Œå•ä½åŒ–ï¼ˆä¸€èˆ¬åªéœ€è¦å•ä½åŒ–ï¼‰ï¼Œå¾—åˆ°å•ä½æ­£äº¤å‘é‡ç»„$v_1, v_2, ..,v_n$ï¼Œåˆ™$V&#x3D;(v_1, v_2, â€¦,v_n)$ï¼›</p>
</li>
<li><p>å¯¹äºéé›¶ç‰¹å¾å€¼$\lambda_1, â€¦, \lambda_r$å¯¹åº”å¥‡å¼‚å€¼$\sigma_1, â€¦ , \sigma_r$ï¼Œäºæ˜¯æœ‰${\color{red} {u_i &#x3D; \frac{1}{\sigma_i}Av_i}}$ï¼Œè¿™æ ·å¾—åˆ°äº†$r$ä¸ªåˆ—å‘é‡ï¼Œå‰©ä½™çš„è®¾ä¸º$\beta$ï¼Œé€šè¿‡æ­£äº¤çš„ç‰¹æ€§$u_i^T \beta &#x3D; 0$å³å¯æ±‚å¾—ï¼›ï¼ˆUçš„åˆ—å‘é‡ä¹Ÿéœ€è¦æ ‡å‡†åŒ–ï¼‰</p>
</li>
<li><p>äºæ˜¯å¾—åˆ°$A&#x3D;U \Sigma V^H$</p>
</li>
</ul>
<blockquote>
<p>ğŸ“Œå¥‡å¼‚å€¼æ€§è´¨ï¼š<br>&amp;#x20;(1) æ±‚é€†ä¸å…±è½­è½¬ç½®çš„å¯äº¤æ¢æ€§ï¼š $(AA^{-1})^H&#x3D;(A^{-1})^HA^H&#x3D;Iå› æ­¤(A^{-1})^H&#x3D;(A^H)^{-1}$&amp;#x20;<br>(2) $rank(A)&#x3D;rank(A^HA)&#x3D;rank(AA^H)$&amp;#x20;<br>(3) $AA^H$ä¸$A^HA$çš„éé›¶ç‰¹å¾å€¼ç›¸ç­‰&amp;#x20;<br>(4) $AA^H$ä¸$A^HA$éƒ½æ˜¯åŠæ­£å®šçŸ©é˜µï¼Œ$A\in C^{m\times n}$ï¼Œå½“$rank(A)&#x3D;mæˆ–n$æ—¶ï¼ŒäºŒè€…åˆ†åˆ«æ­£å®š&amp;#x20;<br>(5) $A$ä¸$A^{-1}$çš„ç‰¹å¾å€¼äº’ä¸ºå€’æ•°<br>&amp;#x20;$Ax&#x3D;\lambda x\A^{-1}Ax&#x3D;\lambda A^{-1}x\\frac 1\lambda x&#x3D;A^{-1}x$</p>
</blockquote>
<hr>
<p>ï¼ˆ10ï¼‰<strong>æåˆ†è§£ï¼ˆä¸è€ƒï¼‰</strong></p>
<blockquote>
<p>å®šä¹‰ï¼šå¯¹äº$rank(A)&#x3D;r$çš„çŸ©é˜µ$A \in C^{n \times n}$ï¼Œå¯ä»¥è¢«åˆ†è§£ä¸º$A&#x3D;PQ$ï¼Œå…¶ä¸­$P$ä¸ºåŠæ­£å®šçŸ©é˜µï¼Œ$Q$ä¸ºé…‰çŸ©é˜µã€‚</p>
</blockquote>
<p><em>æ±‚æ³•ï¼š</em></p>
<ul>
<li><p>å¯¹$A$è¿›è¡Œå¥‡å¼‚å€¼åˆ†è§£ï¼Œå¾—åˆ°$A&#x3D;U \Sigma V^H$;</p>
</li>
<li><p>å¯ä»¥å¾—åˆ°$A &#x3D; (U \Sigma U^H)(UV^H)$ï¼Œäºæ˜¯$P&#x3D;U \Sigma U^H, ; Q&#x3D;UV^H$ï¼Œ$A&#x3D;PQ$ã€‚</p>
</li>
</ul>
<hr>
<h1 id="4-çŸ©é˜µå¹¿ä¹‰é€†"><a href="#4-çŸ©é˜µå¹¿ä¹‰é€†" class="headerlink" title="4 çŸ©é˜µå¹¿ä¹‰é€†"></a>4 çŸ©é˜µå¹¿ä¹‰é€†</h1><hr>
<p>ï¼ˆ1ï¼‰è®¾$A \in C^{m \times n}, B \in C^{n \times m}$ï¼Œè‹¥æœ‰$BA&#x3D;I_n$ï¼Œåˆ™ç§°$B$æ˜¯$A$çš„ä¸€ä¸ª<strong>å·¦é€†</strong>ã€‚</p>
<blockquote>
<p>ğŸ“Œç­‰ä»·æ¡ä»¶ï¼š<br>- $A$çš„é›¶ç©ºé—´$N(A)&#x3D;{0}$<br>- $m \geqslant n, ; rank(A)&#x3D; n$ï¼Œå³$A$æ˜¯<strong>åˆ—æ»¡ç§©çš„</strong><br>- $A^H A$å¯é€†</p>
</blockquote>
<hr>
<p>ï¼ˆ2ï¼‰è®¾$A \in C^{m \times n}, B \in C^{n \times m}$ï¼Œè‹¥æœ‰$AC &#x3D; I_m$ï¼Œåˆ™ç§°$C$æ˜¯$A$çš„ä¸€ä¸ª<strong>å³é€†</strong>ã€‚</p>
<blockquote>
<p>ğŸ“Œç­‰ä»·æ¡ä»¶ï¼š<br>- $A$çš„åˆ—ç©ºé—´$R(A)&#x3D;C^m$<br>- $m \leqslant n, ; rank(A)&#x3D;m$ï¼Œå³$A$æ˜¯<strong>è¡Œæ»¡ç§©çš„</strong><br>- $AA^H$å¯é€†</p>
</blockquote>
<hr>
<p>ï¼ˆ3ï¼‰å¯¹äº$A \in C^{m \times n}, ; G \in C^{n \times m}$ï¼Œæœ‰$AGA&#x3D;A$ï¼Œç§°$G$æ˜¯$A$çš„ä¸€ä¸ª<strong>å‡å·å¹¿ä¹‰é€†</strong>ã€‚</p>
<p><em>æ±‚æ³•ï¼š</em></p>
<ul>
<li><p>å¯¹$rank(A)&#x3D;r$çš„çŸ©é˜µ$A$ï¼Œæœ‰çŸ©é˜µ$\begin{bmatrix}A &amp; I_m\ I_n &amp; 0 \end{bmatrix}$è¿›è¡Œ<strong>åˆç­‰å˜æ¢ï¼Œå¯¹</strong>$A$<strong>è¡Œå˜æ¢æ—¶</strong>$I_m$<strong>ä¿æŒåŒæ­¥ï¼Œå¯¹</strong>$A$<strong>åˆ—å˜æ¢æ—¶ï¼Œ</strong>$I_n$<strong>ä¿æŒåŒæ­¥ï¼Œå°†</strong>$A$<strong>åŒ–ä¸ºæœ€ç®€å½¢</strong>ï¼Œå¾—åˆ°$\begin{bmatrix} I_r&amp; 0 &amp; P \ 0 &amp; 0 &amp; \ \ Q &amp; &amp; 0 &amp; \end{bmatrix}$ï¼›</p>
</li>
<li><p>æœ‰$G &#x3D; Q\begin{bmatrix}I_r &amp; U\ V &amp; W\end{bmatrix}P$ï¼Œå…¶ä¸­$U,V,W$æ˜¯æ»¡è¶³å›ºå®šé˜¶æ¬¡çš„ä»»æ„çŸ©é˜µã€‚</p>
</li>
</ul>
<hr>
<p>ï¼ˆ4ï¼‰<strong>åŠ å·å¹¿ä¹‰é€†ï¼ˆM-Pé€†ï¼‰</strong></p>
<blockquote>
<p><strong>å®šä¹‰</strong>ï¼šå¯¹äºçŸ©é˜µ$A \in C^{m \times n}, ; G \in C^{n \times m}$ï¼Œæ»¡è¶³4æ¡<br>- $AGA&#x3D;A$<br>- $GAG&#x3D;G$<br>- $(AG)^H &#x3D; AG$<br>- $(GA)^H&#x3D;GA$&amp;#x20;<br>ç§°$G$ä¸º$A$çš„M-Pé€†ã€‚</p>
</blockquote>
<p><em>æ±‚æ³•ï¼š</em></p>
<ul>
<li>æ–¹æ³•ä¸€ï¼š</li>
</ul>
<ol>
<li><p>å¯¹çŸ©é˜µ$A$è¿›è¡Œ<strong>æ»¡ç§©åˆ†è§£</strong>ï¼Œå¾—åˆ°$A&#x3D;BC$;</p>
</li>
<li><p>åˆ™$\color{red}{A^+ &#x3D; C^H(CC^H)^{-1}(B^HB)^{-1}B^H}$ï¼Œä¹Ÿå°±æ˜¯ç­‰äº<code>Cçš„å³é€† x Bçš„å·¦é€†</code>ã€‚</p>
</li>
</ol>
<ul>
<li>æ–¹æ³•äºŒï¼š</li>
</ul>
<ol>
<li><p>å¯¹çŸ©é˜µ$A$è¿›è¡Œ<strong>å¥‡å¼‚å€¼åˆ†è§£</strong>ï¼Œå¾—åˆ°$A &#x3D; U \begin{bmatrix}\Delta &amp;0 \ 0 &amp; 0\end{bmatrix}V^H$ï¼›</p>
</li>
<li><p>åˆ™$\color{red}{A^+ &#x3D; V \begin{bmatrix}\Delta^{-1} &amp; 0\ 0 &amp; 0\end{bmatrix}U^H}$ã€‚</p>
</li>
</ol>
<blockquote>
<p>ğŸ“Œæ€§è´¨<br>- $rank(A) &#x3D; rank(A^+)$<br>- $rank(A^+A) &#x3D; rank(AA^+)&#x3D;rank(A)$</p>
</blockquote>
<hr>
<p>ï¼ˆ5ï¼‰<strong>æŠ•å½±å˜æ¢</strong></p>
<blockquote>
<p><strong>å®šä¹‰</strong>ï¼š$C^n &#x3D; L \oplus M, \quad x&#x3D;y+z, \quad y \in L, z \in M$ï¼ŒæŠ•å½±å˜æ¢$\sigma$å°±æ˜¯æŠŠ$C^n$æ˜ å°„æˆå­ç©ºé—´$L$ï¼Œç§°$\sigma$æ˜¯ä»$C^n$æ²¿å­ç©ºé—´$M$åˆ°å­ç©ºé—´$L$çš„æŠ•å½±å˜æ¢ï¼Œåœ¨ä¸€ç»„åŸºä¸‹å¯¹åº”çš„çŸ©é˜µç§°ä¸º<strong>æŠ•å½±çŸ©é˜µ</strong>ï¼Œå­ç©ºé—´$L$ç§°ä¸º<strong>æŠ•å½±å­ç©ºé—´</strong>ã€‚æ˜¾ç„¶æœ‰ï¼Œå­ç©ºé—´$L$å°±æ˜¯$\sigma$çš„åƒç©ºé—´$R(\sigma)$ï¼Œ$M$å°±æ˜¯$\sigma$çš„æ ¸ç©ºé—´$N(\sigma)$ï¼Œäºæ˜¯$C^n &#x3D; R(\sigma) \oplus N(\sigma)$ã€‚</p>
</blockquote>
<blockquote>
<p>ğŸ“Œ$\sigma$æ˜¯æŠ•å½±å˜æ¢çš„å……è¦æ¡ä»¶æ˜¯$\sigma$å…³äºæŸç»„åŸºä¸‹çš„çŸ©é˜µ$A$æ˜¯<strong>å¹‚ç­‰çŸ©é˜µ</strong>ï¼Œå³$A^2&#x3D;A$ã€‚</p>
</blockquote>
<p><em>æ±‚æ³•ï¼š</em></p>
<ul>
<li><p>æ‰¾å‡ºåƒç©ºé—´$L$çš„ä¸€ç»„åŸº$y_1,y_2,â€¦,y_r$ï¼Œå¾—åˆ°çŸ©é˜µ$B &#x3D; (y_1 ; y_2 ; â€¦ ; y_r)$ï¼›æ‰¾å‡º$M$çš„ä¸€ç»„åŸº$z_{r+1}, â€¦., z_n$ï¼Œå¾—åˆ°çŸ©é˜µ$C&#x3D;(z_{r+1} ; â€¦ ; z_n)$ï¼›</p>
</li>
<li><p>äºæ˜¯æœ‰æŠ•å½±çŸ©é˜µ$\color{red}{A &#x3D; (B | 0)(B|C)^{-1}}$ã€‚</p>
</li>
</ul>
<hr>
<p>ï¼ˆ6ï¼‰<strong>æ­£äº¤æŠ•å½±å˜æ¢</strong></p>
<blockquote>
<p><strong>å®šä¹‰</strong>ï¼šè‹¥$C^n &#x3D; R(\sigma) \oplus N(\sigma)$ï¼Œ$R(\sigma)$çš„<strong>æ­£äº¤è¡¥ç©ºé—´</strong>æ˜¯$R(\sigma)^{\perp} &#x3D; N(\sigma)$ï¼Œç§°$\sigma$æ˜¯<strong>æ­£äº¤æŠ•å½±å˜æ¢</strong>ï¼Œå…¶åœ¨<strong>æ ‡å‡†æ­£äº¤åŸº</strong>ä¸‹å¯¹åº”çš„çŸ©é˜µç§°ä¸ºæ­£äº¤æŠ•å½±çŸ©é˜µã€‚</p>
</blockquote>
<blockquote>
<p>æ­£äº¤æŠ•å½±å˜æ¢ï¼š$\color{red}P(X)&#x3D;X-(X,u)u$ï¼Œ$u$ä¾¿æ˜¯é›¶ç©ºé—´çš„åŸºã€‚</p>
</blockquote>
<blockquote>
<p>ğŸ“Œ$\sigma$æ˜¯æ­£äº¤æŠ•å½±å˜æ¢çš„å……è¦æ¡ä»¶æ˜¯$A$æ˜¯<strong>å¹‚ç­‰HermiteçŸ©é˜µ</strong>ï¼Œå³$A^2&#x3D;A, ;A^H&#x3D;A$ã€‚</p>
</blockquote>
<p><em>æ±‚æ³•ï¼š</em></p>
<p>$A &#x3D; (B | 0)(B|C)^{-1} &#x3D; (B|0)((B|C)^H(B|C))^{-1}(B|C)^H &#x3D; {\color{red} {B(B^HB)^{-1}B^H}}$</p>
<hr>
<p>ï¼ˆ7ï¼‰<strong>æœ€ä½³æœ€å°äºŒä¹˜è§£</strong></p>
<p>$A \in C^{m \times n}, ; b \in C^m$ï¼Œåˆ™${\color{red} {x_0&#x3D;A^+b}}$æ˜¯çº¿æ€§æ–¹ç¨‹ç»„$Ax&#x3D;b$çš„æœ€ä½³æœ€å°äºŒä¹˜è§£ã€‚</p>
<p>$A \in C^{m \times n}, ; B \in C^{m \times k}$ï¼Œåˆ™${\color{red}{X_0 &#x3D; A^+B}}$æ˜¯$AX&#x3D;B$çš„æœ€ä½³æœ€å°äºŒä¹˜è§£ã€‚</p>
<hr>
<h1 id="5-çŸ©é˜µåˆ†æ"><a href="#5-çŸ©é˜µåˆ†æ" class="headerlink" title="5 çŸ©é˜µåˆ†æ"></a>5 çŸ©é˜µåˆ†æ</h1><hr>
<p>ï¼ˆ1ï¼‰<strong>å‘é‡èŒƒæ•°</strong>æ»¡è¶³<strong>æ­£å®šæ€§ã€é½æ¬¡æ€§å’Œä¸‰è§’ä¸ç­‰å¼</strong>ï¼Œå®šä¹‰äº†èŒƒæ•°çš„å†…ç§¯ç©ºé—´ç§°ä¸º<strong>èµ‹èŒƒç©ºé—´</strong>ã€‚</p>
<hr>
<p>ï¼ˆ2ï¼‰é‡è¦çš„<strong>å‘é‡èŒƒæ•°</strong>ï¼š</p>
<p>å¯¹äºå¤å‘é‡$x &#x3D; (x_1 ;; x_2 ;; â€¦ ;; x_n)$ï¼Œæœ‰ï¼š</p>
<ul>
<li><p><strong>2-èŒƒæ•°****ï¼š</strong> â€‹${\color{red}{|x|| &#x3D; \sqrt{|x_1|^2 + |x_2|^2 + â€¦ + |x_n|^2}}}$</p>
</li>
<li><p><strong>1-èŒƒæ•°****ï¼š</strong> â€‹${\color{red}{||x||_1 &#x3D; |x_1| + |x_2| + â€¦ + |x_n|}}$</p>
</li>
<li><p><strong>âˆèŒƒæ•°****ï¼š</strong> â€‹${\color{red}{||x||_{\infty} &#x3D; \underset{i}{\max} |x_i|}}$</p>
</li>
</ul>
<blockquote>
<p>ğŸ“Œæœ‰é™ç»´çº¿æ€§ç©ºé—´çš„ä»»æ„ä¸¤ç§å‘é‡èŒƒæ•°éƒ½æ˜¯<strong>ç­‰ä»·</strong>çš„ã€‚</p>
</blockquote>
<hr>
<p>ï¼ˆ3ï¼‰<strong>çŸ©é˜µèŒƒæ•°</strong>æ»¡è¶³<strong>æ­£å®šæ€§ã€é½æ¬¡æ€§ã€ä¸‰è§’ä¸ç­‰å¼ä»¥åŠç›¸å®¹æ€§</strong>ã€‚</p>
<hr>
<p>ï¼ˆ4ï¼‰é‡è¦çš„<strong>çŸ©é˜µèŒƒæ•°</strong>å’Œ<strong>è¯±å¯¼èŒƒæ•°</strong></p>
<ul>
<li><p><strong>FèŒƒæ•°</strong>ï¼š${\color{red}{||A||_F &#x3D; [tr(A^HA)]^{\frac{1}{2}}}}$</p>
</li>
<li><p><strong>åˆ—å’ŒèŒƒæ•°</strong>ï¼š ${\color{red}{||A||<em>1 &#x3D; \underset{j}{\max}(\sum</em>{i&#x3D;1}^n |a_{ij}|)}}$ï¼Œå³<strong>æ¯ä¸€åˆ—å„å…ƒç´ æ¨¡ç›¸åŠ å…¶ä¸­çš„æœ€å¤§å€¼</strong></p>
</li>
<li><p><strong>è°±èŒƒæ•°</strong>ï¼š${\color{red}{||A||_2 &#x3D; \sqrt{\lambda_1}}}$ï¼Œå…¶ä¸­$\lambda_1$æ˜¯$A^HA$çš„<strong>æœ€å¤§ç‰¹å¾å€¼</strong></p>
</li>
<li><p><strong>è¡Œå’ŒèŒƒæ•°</strong>ï¼š${\color{red}{||A||<em>{\infty} &#x3D; \underset{i}{\max}(\sum</em>{j&#x3D;1}^n |a_{ij}|)}}$ï¼Œå³<strong>æ¯ä¸€è¡Œå„å…ƒç´ æ¨¡ç›¸åŠ å…¶ä¸­çš„æœ€å¤§å€¼</strong></p>
</li>
</ul>
<hr>
<p>ï¼ˆ5ï¼‰<strong>å‘é‡æ”¶æ•›å’ŒçŸ©é˜µæ”¶æ•›</strong>å¿…é¡»å…¶ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ”¶æ•›ã€‚</p>
<blockquote>
<p>ğŸ“Œå‘é‡æŒ‰åˆ†é‡æ”¶æ•›çš„å……è¦æ¡ä»¶æ˜¯<strong>å®ƒæŒ‰ä»»æ„ä¸€ä¸ªå‘é‡èŒƒæ•°æ”¶æ•›</strong>ã€‚</p>
</blockquote>
<blockquote>
<p>ğŸ“Œå½“$k \rightarrow \infty$æ—¶ï¼Œ$||A^{(k)}-A|| \rightarrow 0$ï¼Œç§°<strong>çŸ©é˜µåºåˆ—æŒ‰çŸ©é˜µèŒƒæ•°æ”¶æ•›äº</strong>$A$</p>
</blockquote>
<hr>
<p>ï¼ˆ6ï¼‰<strong>è°±åŠå¾„</strong></p>
<blockquote>
<p><strong>å®šä¹‰</strong>ï¼š$\lambda_1, \lambda_2, â€¦, \lambda_n$æ˜¯çŸ©é˜µ$A \in C^{n \times n}$çš„å…¨éƒ¨ç‰¹å¾å€¼ï¼Œç§°${\color{red}{\rho(A)&#x3D;\underset{i}{\max}|\lambda_i|}}$ä¸º$A$çš„<strong>è°±åŠå¾„</strong>ã€‚</p>
</blockquote>
<blockquote>
<p>ğŸ“Œ$A^k \rightarrow 0(k \rightarrow \infty)$çš„å……è¦æ¡ä»¶æ˜¯$\rho(A) &lt; 1$</p>
</blockquote>
<blockquote>
<p>ğŸ“Œ$A$çš„è°±åŠå¾„æ˜¯$A$çš„ä»»æ„ä¸€ç§çŸ©é˜µèŒƒæ•°çš„ä¸‹ç¡®ç•Œã€‚</p>
</blockquote>
<hr>
<p>ï¼ˆ7ï¼‰<strong>çŸ©é˜µå¹‚çº§æ•°</strong></p>
<p>è‹¥å¤å˜é‡$z$çš„å¹‚çº§æ•°$\sum_{k&#x3D;0}^{\infty}a_kz^k$çš„<strong>æ”¶æ•›åŠå¾„ä¸º</strong>$R$ï¼Œè€Œæ–¹é˜µ$A \in C^{n \times n}$çš„<strong>è°±åŠå¾„ä¸º</strong>$\rho(A)$ï¼Œåˆ™</p>
<ul>
<li><p>å½“${\color{red} {\rho(A) &lt; R}}$æ—¶ï¼ŒçŸ©é˜µå¹‚çº§æ•°$\sum_{k&#x3D;0}^{\infty}a_kA^k$<strong>æ”¶æ•›</strong>ï¼›</p>
</li>
<li><p>å½“${\color{red} {\rho(A) &gt; R}}$æ—¶ï¼ŒçŸ©é˜µå¹‚çº§æ•°$\sum_{k&#x3D;0}^{\infty}a_k A^k$<strong>å‘æ•£</strong></p>
</li>
</ul>
<blockquote>
<p>ğŸ“Œå½“æ±‚è§£$A$çš„ç‰¹å¾å€¼æ¯”è¾ƒå›°éš¾æ—¶ï¼Œç”±äº$A$çš„æ¯ä¸ªèŒƒæ•°éƒ½æ˜¯è°±åŠå¾„$\rho(A)$çš„ä¸Šç•Œï¼Œåªéœ€è¦æ‰¾åˆ°ä¸€ç§ç‰¹æ®Šçš„çŸ©é˜µèŒƒæ•°$||A||$ï¼Œä½¿å¾—$||A|| &lt; R$ï¼Œå°±èƒ½è¯´æ˜çŸ©é˜µå¹‚çº§æ•°æ”¶æ•›ã€‚ï¼ˆä¼˜å…ˆè€ƒè™‘è¡Œå’Œã€åˆ—å’ŒèŒƒæ•°ï¼‰</p>
</blockquote>
<hr>
<p>ï¼ˆ8ï¼‰<strong>å¸¸ç”¨çš„å¹‚çº§æ•°</strong></p>
<ul>
<li><strong>æ”¶æ•›åŸŸæ˜¯æ•´ä¸ªå¤å¹³é¢çš„å¹‚çº§æ•°</strong></li>
</ul>
<p>$e^A &#x3D; \sum_{k&#x3D;0}^{\infty} \frac{1}{k!}A^k$</p>
<p>$\cos A &#x3D; \sum_{k&#x3D;0}^{\infty}\frac{(-1)^k}{(2k)!}A^{2k}$</p>
<p>$\sin A &#x3D; \sum_{k&#x3D;0}^{\infty}\frac{(-1)^k}{(2k+1)!}A^{2k+1}$</p>
<ul>
<li><strong>æ”¶æ•›åŸŸä¸ºå¤å¹³é¢</strong>$|z| &lt; 1$<strong>çš„å¹‚çº§æ•°</strong></li>
</ul>
<p>$(I-A)^{-1} &#x3D; \sum_{k&#x3D;0}^{\infty}A^k, \quad \rho(A) &lt; 1$</p>
<p>$\ln(I+A) &#x3D; \sum_{k&#x3D;1}^{\infty}\frac{(-1)^{k-1}}{k}A^k, \quad \rho(A) &lt; 1$</p>
<hr>
<p>ï¼ˆ9ï¼‰<strong>çŸ©é˜µå‡½æ•°çš„ä¸¤ç§æ±‚æ³•</strong></p>
<ul>
<li><em><strong>æ–¹æ³•ä¸€ï¼šJordanæ ‡å‡†å½¢æ³•</strong></em></li>
</ul>
<ol>
<li><p>æ±‚çŸ©é˜µ$A$çš„Jordanæ ‡å‡†å½¢$J_A$ï¼Œå¾—åˆ°${\color{red} {A &#x3D; PJ_AP^{-1}}}$</p>
</li>
<li><p>è®¾è§£æå‡½æ•°ä¸º$f(z)$ï¼Œåˆ™å¯¹æ¯ä¸€ä¸ªJordanå—æœ‰$f(J_i)&#x3D; \begin{bmatrix}f(\lambda_i) &amp; \frac{fâ€™(\lambda_i)}{1!} &amp; \frac{fâ€™â€™(\lambda_i)}{2!} &amp; â€¦ \ &amp; f(\lambda_i) &amp; \frac{fâ€™(\lambda_i)}{1!} &amp; â€¦\ &amp; &amp; â€¦ &amp; \ &amp; &amp; &amp; f(\lambda_i)\end{bmatrix}$ï¼Œå¾—åˆ°$f(J_A)$</p>
</li>
<li><p>æœ€åå¾—åˆ°$f(A) &#x3D; Pf(J_A)P^{-1}$</p>
</li>
</ol>
<blockquote>
<p>ğŸ“Œè¿™ç§æ–¹æ³•çš„éš¾ç‚¹åœ¨äº<strong>éœ€è¦æ±‚Jordané“¾</strong>ï¼Œè¿‡ç¨‹ä¸­å¯ä»¥ä¼šé‡åˆ°éº»çƒ¦ã€‚<strong>å¦‚æœä¸åŒç‰¹å¾å€¼ä¸ªæ•°è¾ƒå¤šï¼Œå»ºè®®ä½¿ç”¨ç¬¬ä¸€ç§ï¼›è€Œå¦‚æœç‰¹å¾å€¼æ¯”è¾ƒå•ä¸€ï¼Œå¹¶ä¸” ä»£æ•°é‡æ•° - å‡ ä½•é‡æ•° &gt; 2ï¼Œå»ºè®®ä½¿ç”¨ç¬¬äºŒç§</strong></p>
</blockquote>
<ul>
<li><em><strong>æ–¹æ³•äºŒï¼šæœ€å°å¤šé¡¹å¼æ³•</strong></em></li>
</ul>
<ol>
<li><p>å…ˆè®¡ç®—$A$çš„Jordanæ ‡å‡†å½¢ï¼Œç”±æ­¤å¾—åˆ°æœ€å°å¤šé¡¹å¼$m_A(\lambda)&#x3D;(\lambda -\lambda_1)^{n_1}(\lambda-\lambda_2)^{n_2}â€¦(\lambda-\lambda_s)^{n_s}$ï¼Œå…¶ä¸­å¹‚æ¬¡å’Œæœ‰$\sum_{i&#x3D;1}^s n_i &#x3D;m$ï¼›</p>
</li>
<li><p>å¾—åˆ°$g(\lambda)&#x3D;c_0+c_1\lambda+â€¦+c_{m-1}\lambda^{m-1}$ï¼Œå¹¶ä»¤$g^{(j)}(\lambda_i)&#x3D;f^{(j)}(\lambda_i)$ï¼Œè§£å¾—ç³»æ•°$c_0,c_1,â€¦,c_{m-1}$ï¼›</p>
</li>
<li><p>æœ€åå¾—åˆ°$f(A) &#x3D; c_0I + c_1A+â€¦+c_{m-1}A^{m-1}$</p>
</li>
</ol>
<blockquote>
<p>ğŸ“Œå½“<strong>ä¸åŒç‰¹å¾å€¼çš„ä¸ªæ•°æ¯”è¾ƒå¤šæˆ–è€…æœ€å°å¤šé¡¹å¼å¹‚æ¬¡è¾ƒé«˜</strong>æ—¶ï¼Œè®¡ç®—èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œå»ºè®®ä½¿ç”¨ç¬¬ä¸€ç§ã€‚</p>
</blockquote>
<hr>
<p>ï¼ˆ10ï¼‰ä¸¤ä¸ªçŸ¥è¯†ç‚¹ï¼š</p>
<ul>
<li><p>é‡è¦çš„<strong>å¯¼æ•°ï¼š</strong>$\color{red}{\frac{d A^{-1}(t)}{dt} &#x3D; - A^{-1}(t) \big( \frac{d}{dt}A(t)\big)A^{-1}(t)}$</p>
</li>
<li><p>çŸ©é˜µæŒ‡æ•°å‡½æ•°çš„<strong>è¡Œåˆ—å¼ï¼š</strong>$|e^A| &#x3D; e^{trA}$</p>
</li>
</ul>
<blockquote>
<p>ğŸ“Œä¸Šå¼è¯æ˜ï¼šçŸ©é˜µå‡½æ•°çš„ç‰¹å¾å€¼æ˜¯è®©åŸçŸ©é˜µçš„ç‰¹å¾å€¼åšå‡½æ•°å‚æ•°çš„ç»“æœï¼Œå³ $A$çš„ç‰¹å¾å€¼æ˜¯$\lambda$ï¼Œåˆ™$f(A)$çš„ç‰¹å¾å€¼æ˜¯$f(\lambda)$ ç”±äºAç›¸ä¼¼äºJordanæ ‡å‡†å‹ï¼Œæ‰€ä»¥$|e^{A}|&#x3D;|P||e^{J_A}||P^{-1}|$ï¼Œç”±äºè¡Œåˆ—å¼ç­‰äºç‰¹å¾å€¼ä¹‹ç§¯ï¼Œ æ‰€ä»¥$|e^A|&#x3D;|e^{J_A}|&#x3D;e^{\lambda_1}e^{\lambda_2}â€¦&#x3D;e^{\lambda_1+\lambda_2+â€¦}&#x3D;e^{trA}$</p>
</blockquote>
<hr>
<p>ï¼ˆ11ï¼‰çŸ©é˜µå‡½æ•°åº”ç”¨</p>
<blockquote>
<p><strong>ä¸€é˜¶å¸¸ç³»æ•°é½æ¬¡å¾®åˆ†æ–¹ç¨‹ç»„</strong>ï¼š $\begin{cases}\dot{x}(t) &#x3D; Ax(t)\x(t_0) &#x3D; C_{n \times 1}\end{cases}$</p>
</blockquote>
<p>è§£ä¸ºï¼š${\color{red}{x(t) &#x3D; e^{A(t-t_0)}x(t_0)}}$</p>
<blockquote>
<p><strong>ä¸€é˜¶çº¿æ€§å¸¸ç³»æ•°éé½æ¬¡çº¿æ€§æ–¹ç¨‹ç»„</strong>ï¼š$\begin{cases}\dot{x}(t) &#x3D; Ax(t) + f(t)\x(t_0) &#x3D; C\end{cases}$</p>
</blockquote>
<p>è§£ä¸ºï¼š${\color{red} {x(t) &#x3D; e^{A(t-t_0)}x(t_0) + \int_{t_0}^t e^{A(t-\tau)}f(\tau)d \tau}}$</p>
<hr>
<h1 id="6-Kroneckerç§¯"><a href="#6-Kroneckerç§¯" class="headerlink" title="6 Kroneckerç§¯"></a>6 Kroneckerç§¯</h1><hr>
<p>ï¼ˆ1ï¼‰å¯¹äºçŸ©é˜µ$A&#x3D;(a_{ij}) \in C^{m \times n}, ;B&#x3D;(b_{ij}) \in C^{s \times t}$ï¼Œåˆ™<strong>Kç§¯</strong>ä¸ºï¼š</p>
<p>$$<br>A \otimes B &#x3D; \begin{bmatrix}a_{11}B &amp; a_{12}B &amp; â€¦ &amp; a_{1n}B\ a_{21}B &amp; a_{22}B &amp; â€¦ &amp; a_{2n}B\Â â€¦ &amp; â€¦ &amp;Â  &amp; â€¦\ a_{n1}B &amp; a_{n2}B &amp; â€¦ &amp; a_{nn}B\end{bmatrix}<br>$$</p>
<blockquote>
<p>ğŸ“ŒKç§¯ä¸å…·æœ‰äº¤æ¢å¾‹ï¼Œå³$A \otimes B \neq B \otimes A$</p>
</blockquote>
<hr>
<p>ï¼ˆ2ï¼‰é‡è¦æ€§è´¨</p>
<ul>
<li><p>$I \otimes I &#x3D; I$</p>
</li>
<li><p>$(A \otimes B)(C \otimes D) &#x3D; (AC) \otimes (BD)$</p>
</li>
<li><p>$(A \otimes B)^k &#x3D; A^k \otimes B^k$</p>
</li>
<li><p>$(A \otimes B) &#x3D; (I_m \otimes B)(A \otimes I_n)$</p>
</li>
<li><p>$(A \otimes B)^{-1} &#x3D; A^{-1} \otimes B^{-1}$</p>
</li>
<li><p>$|A \otimes B| &#x3D; |B \otimes A| &#x3D; |A|^n|B|^m$ï¼ˆ<strong>è¿™é‡Œçš„</strong><strong><strong><strong>è¡¨ç¤º</strong></strong>çš„é˜¶æ•°ï¼Œ</strong><strong><strong><strong>è¡¨ç¤º</strong></strong></strong><strong>çš„é˜¶æ•°</strong>ï¼‰</p>
</li>
<li><p>$rank(A \otimes B) &#x3D; rank(A)rank(B)$</p>
</li>
<li><p>é…‰çŸ©é˜µçš„Kç§¯ä¹Ÿæ˜¯é…‰çŸ©é˜µ</p>
</li>
<li><p>HermiteçŸ©é˜µçš„Kç§¯ä¹Ÿæ˜¯HermiteçŸ©é˜µ</p>
</li>
</ul>
<hr>
<p>ï¼ˆ3ï¼‰<strong>Kå’Œ</strong>ï¼šè®¾$A \in F^{m \times m}, ;B \in F^{n \times n}$ï¼Œ$A \oplus B &#x3D; A \otimes I_n + I_m \otimes B$</p>
<hr>
<p>ï¼ˆ4ï¼‰è‹¥$A$çš„ç‰¹å¾å€¼æ˜¯$\lambda_i$ï¼Œç›¸åº”çš„ç‰¹å¾å‘é‡æ˜¯$x_i$ï¼›$B$çš„ç‰¹å¾å€¼æ˜¯$\mu_i$ï¼Œç›¸åº”çš„ç‰¹å¾å‘é‡ä¸º$y_i$ï¼›åˆ™ï¼š</p>
<ul>
<li><p>$**A \otimes B$çš„ç‰¹å¾å€¼æ˜¯$\color{red}{\lambda_i \mu_i}$ï¼Œå¯¹åº”çš„ç‰¹å¾å‘é‡æ˜¯$\color{red}{x_i \otimes y_i}$**</p>
</li>
<li><p>$**A \oplus B$çš„ç‰¹å¾å€¼æ˜¯$\color{red}{\lambda_i + \mu_i}$ï¼Œå¯¹åº”çš„ç‰¹å¾å‘é‡æ˜¯$\color{red}{x_i \otimes y_i}$**</p>
</li>
</ul>
<blockquote>
<p>ğŸ“ŒKç§¯ä¸‹çš„å¥‡å¼‚å€¼ä¹Ÿå’Œç‰¹å¾å€¼æœ‰ä¸€æ ·çš„ç»“è®º</p>
</blockquote>
<hr>
<p>ï¼ˆ5ï¼‰è®¾$f(z)$æ˜¯è§£æå‡½æ•°ï¼Œ$A \in F^{n \times n}$ï¼Œ$f(A)$å­˜åœ¨ï¼Œåˆ™</p>
<ul>
<li><p>$f(I_m \otimes A) &#x3D; I_m \otimes f(A)$</p>
</li>
<li><p>$f(A \otimes I_m) &#x3D; f(A) \otimes I_m$</p>
</li>
</ul>
<hr>
<p>ï¼ˆ6ï¼‰è®¾çŸ©é˜µ$A \in F^{m \times n}, \quad A&#x3D;(A_1, A_2,â€¦,A_n)$ï¼Œåˆ™$Vec(A) &#x3D; \begin{bmatrix}A_1\ A_2\ â€¦\ A_n\end{bmatrix} \in F^{nm}$</p>
<blockquote>
<p>ğŸ“Œ${\color{red}{Vec(ABC) &#x3D; (C^T \otimes A)Vec(B)}}$</p>
</blockquote>
<ul>
<li><p>$Vec(AX) &#x3D; (I_s \otimes A)Vec(X)$</p>
</li>
<li><p>$Vec(XC) &#x3D; (C^T \otimes I_k) Vec(X)$</p>
</li>
</ul>
<hr>
<p>ï¼ˆ7ï¼‰æ±‚è§£çŸ©é˜µæ–¹ç¨‹$AX+XB&#x3D;D$ï¼Œå°†ä¸¤è¾¹åŒæ—¶å–<strong>å‘é‡åŒ–ç®—å­</strong>ï¼Œå¾—åˆ°${\color{red}{(I_m \otimes A + B^T \otimes I_n)Vec(X) &#x3D; Vec(D)}}$ï¼Œæœ€åé€šè¿‡å¸¸è§„çš„æ±‚éé½æ¬¡çº¿æ€§æ–¹ç¨‹ç»„çš„æ–¹æ³•æ±‚è§£ã€‚</p>
<hr>
<p>ï¼ˆ8ï¼‰æ±‚å¾®åˆ†æ–¹ç¨‹ï¼š$\begin{cases}\dot{X}(t) &#x3D; AX(t) + X(t)B\X(0) &#x3D; C\end{cases}$</p>
<ul>
<li><p>ç”¨å‘é‡åŒ–ç®—å­ä½œç”¨åœ¨æ–¹ç¨‹ä¸¤è¾¹ï¼Œå¾—åˆ°$Vec(\dot{X}(t)) &#x3D; (I_n \otimes A + B^T \otimes I_m)Vec(X(t))$å’Œ$Vec(X(0)) &#x3D; Vec(C)$</p>
</li>
<li><p>ä»¤$Y(t) &#x3D; Vec(X(t)), \quad C_1 &#x3D; Vec(C), \quad G &#x3D; I_n \otimes A + B^T \otimes I_m$ï¼Œé€šè¿‡æ±‚è§£æ™®é€šå¾®åˆ†æ–¹ç¨‹çš„æ–¹æ³•å¾—åˆ°$Y(t) &#x3D; e^{Gt}C_1$ï¼›</p>
</li>
<li><p>å°†$Y(t), ; G, ; C_1$å¸¦å…¥åŒ–ç®€æ±‚å¾—$X(t)$ã€‚</p>
</li>
</ul>
<hr>
]]></content>
      <categories>
        <category>æ•°å­¦</category>
      </categories>
      <tags>
        <tag>æ•°å­¦æ–¹æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¾è®¡æ¨¡å¼ï¼ˆC++ï¼‰</title>
    <url>/2022/06/06/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h1><blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p><a href="https://github.com/liu-jianhao/Cpp-Design-Patterns">https://github.com/liu-jianhao/Cpp-Design-Patterns</a></p>
<p><a href="http://service.qbjavawa.top/time/beautyOfDesignPatterns.html" title="æå®¢æ—¶é—´ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹">æå®¢æ—¶é—´ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹</a></p>
<p><a href="https://zhulao.gitee.io/blog/2019/03/31/23%E7%A7%8D%E7%BB%8F%E5%85%B8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F(%E9%99%84c++%E5%AE%9E%E7%8E%B0%E4%BB%A3%E7%A0%81)/index.html">https://zhulao.gitee.io/blog/2019/03/31/23ç§ç»å…¸è®¾è®¡æ¨¡å¼(é™„c++å®ç°ä»£ç )/index.html</a></p>
<p><a href="https://design-patterns.readthedocs.io/zh_CN/latest/index.html">https://design-patterns.readthedocs.io/zh_CN/latest/index.html</a></p>
</blockquote>
<p><strong>é¢å‘å¯¹è±¡ã€è®¾è®¡åŸåˆ™ã€è®¾è®¡æ¨¡å¼ã€ç¼–ç¨‹è§„èŒƒã€ä»£ç é‡æ„äº”è€…ä¹‹é—´çš„å…³ç³»ï¼š</strong></p>
<ul>
<li><p>é¢å‘å¯¹è±¡ï¼šå› å…¶ä¸°å¯Œçš„ç‰¹æ€§ï¼ˆå°è£…ã€æŠ½è±¡ã€ç»§æ‰¿ã€å¤šæ€ï¼‰ï¼Œå¯ä»¥å®ç°å¾ˆå¤šå¤æ‚çš„è®¾è®¡æ€è·¯ï¼Œæ˜¯å¾ˆå¤šè®¾è®¡åŸåˆ™ã€è®¾è®¡æ¨¡å¼ç­‰ç¼–ç å®ç°çš„åŸºç¡€ã€‚</p>
</li>
<li><p>è®¾è®¡åŸåˆ™ï¼šä»£ç è®¾è®¡çš„ç»éªŒæ€»ç»“ï¼ŒæŒ‡å¯¼å¯¹äºæŸäº›åœºæ™¯ä¸‹ï¼Œæ˜¯å¦åº”è¯¥ä½¿ç”¨æŸç§è®¾è®¡æ¨¡å¼ã€‚ï¼ˆæ¯”å¦‚ï¼Œâ€œå¼€é—­åŸåˆ™â€æ˜¯å¦‚ç­–ç•¥ã€æ¨¡æ¿ç­‰è®¾è®¡æ¨¡å¼çš„æŒ‡å¯¼åŸåˆ™ï¼‰</p>
</li>
<li><p>è®¾è®¡æ¨¡å¼ï¼šé’ˆå¯¹è½¯ä»¶å¼€å‘ä¸­é‡åˆ°çš„è®¾è®¡é—®é¢˜ï¼Œè€Œæ€»ç»“å‡ºæ¥çš„ä¸€å¥—è§£å†³æ–¹æ¡ˆæˆ–è€…è®¾è®¡æ€è·¯ã€‚ä¸»è¦ç›®çš„æ˜¯æé«˜ä»£ç çš„å¯æ‰©å±•æ€§ã€‚</p>
</li>
<li><p>ç¼–ç¨‹è§„èŒƒï¼š<br>è§£å†³ä»£ç å¯è¯»æ€§é—®é¢˜ã€‚ç›¸æ¯”äºè®¾è®¡åŸåˆ™ã€è®¾è®¡æ¨¡å¼ï¼Œæ›´åŠ å…·ä½“ã€æ›´åé‡ä»£ç ç»†èŠ‚ã€‚</p>
</li>
<li><p>é‡æ„æŠ€å·§ï¼š<br>æ˜¯ä¿æŒä»£ç è´¨é‡ä¸ä¸‹é™çš„æœ‰æ•ˆæ‰‹æ®µï¼Œåˆ©ç”¨çš„å°±æ˜¯é¢å‘å¯¹è±¡ã€è®¾è®¡åŸåˆ™ã€è®¾è®¡æ¨¡å¼ã€ç¼–ç è§„èŒƒè¿™äº›ç†è®ºã€‚</p>
</li>
</ul>
<p><img src="/design_pattern-image/image_LDUVW8iNHp.png"></p>
<h1 id="UML"><a href="#UML" class="headerlink" title="UML"></a>UML</h1><blockquote>
<p>ç”»å›¾å·¥å…·ï¼šdraw.io</p>
</blockquote>
<h2 id="ç±»å›¾"><a href="#ç±»å›¾" class="headerlink" title="ç±»å›¾"></a>ç±»å›¾</h2><p>è€ƒè™‘ç»™åŠ¨ç‰©å›­å»ºä¸€ä¸ªæ¨¡ã€‚åŠ¨ç‰©å›­é‡Œæœ‰å¾ˆå¤šåŠ¨ç‰©ï¼Œå‡å¯ä»¥å±äºåŠ¨ç‰©ç±»å‹ï¼Œå› æ­¤å¯ä»¥å»ºç«‹ä¸€ä¸ªæ¯”è¾ƒå¤§çš„Animalç±»ã€‚æ¯ä¸ªè¯¥ç±»çš„å®ä¾‹å°±æ˜¯ä¸€ä¸ªç‰¹å®šåŠ¨ç‰©ã€‚å¯ä»¥é€šè¿‡å±æ€§ä»¥åŒºåˆ†ä¸åŒå®ä¾‹ï¼Œå› æ­¤åŠ ä¸Šnameã€idã€ageå±æ€§ã€‚å±æ€§ååé¢å¯ä»¥æ¥ä¸ŠæœŸæœ›çš„åŸºç¡€ç±»å‹ï¼Œæ¯”å¦‚æ˜¯æ•´æ•°ï¼Œè¿˜æ˜¯å­—ç¬¦ã€‚åŒæ—¶åŠ ä¸Šæ–¹æ³•æ¥è®¾ç½®è¿™äº›å±æ€§ï¼Œæˆ–è€…æè¿°å®ä¾‹çš„åŠ¨ä½œã€‚æ¯”å¦‚æ·»åŠ <code>setName()</code>æ–¹æ³•ï¼Œï¼ˆä¹Ÿå¯ä»¥ç»™æ–¹æ³•åŠ ä¸Šå‚æ•°å’Œè¿”å›ç±»å‹<code>setName(var1, var2):string</code>ï¼‰</p>
<p>UMLç±»å›¾ä¸­å¯¹å¯è§æ€§çš„è¡¨è¾¾ä¸C++ä¸­ä¸€è‡´ï¼šå‡å·è¡¨ç¤ºprivateï¼ŒåŠ å·è¡¨ç¤ºpublicï¼Œ#è¡¨ç¤ºprotectedã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæ³¢æµªçº¿~è¡¨ç¤ºpackage&#x2F;defaultï¼Œå…¶å«ä¹‰æ˜¯å¯ä»¥è¢«åŒä¸€packageå†…çš„ä»»ä½•ç±»æ‰€è®¿é—®ã€‚</p>
<p><img src="/design_pattern-image/image_CYbCbwv9cS.png"></p>
<ul>
<li><p>ç»§æ‰¿å…³ç³»ï¼ˆInheritanceï¼‰ï¼š</p>
<p>ç°åœ¨Animalç±»ä¸­çš„æ–¹æ³•å’Œå±æ€§éƒ½æ˜¯privateçš„ã€‚åŠ¨ç‰©ä¹Ÿæ˜¯æœ‰å…·ä½“ç±»å‹çš„ï¼Œæ¯”å¦‚ä¹Œé¾Ÿã€æ°´ç­å’Œæ‡’çŒ´ã€‚å› æ­¤ï¼Œå†ä¸ºè¿™ä¸‰ä¸ªç±»å‹åˆ¶å®šæ–°çš„classï¼Œä»–ä»¬ç»§æ‰¿è‡ªAnimalç±»ï¼Œæœ‰åŠ¨ç‰©çš„å…±æœ‰å±æ€§æ–¹æ³•ï¼Œåˆæœ‰è‡ªå·±çš„ç‹¬ç‰¹è¡Œä¸ºã€‚åŒæ—¶ï¼ŒAnimalç±»è¿˜éœ€è¦æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ã€‚æŠ½è±¡ç±»å¯ä»¥ç”¨ï¼šåŠ å°–æ‹¬å·&lt;&lt;Animal&gt;&gt;æˆ–è€…æ–œä½“<em>Animal</em>æ¥è¡¨ç¤ºã€‚<strong>ç»§æ‰¿ç”¨ç©ºå¿ƒç®­å¤´æ¥è¡¨ç¤º</strong>ã€‚</p>
<p><img src="/design_pattern-image/image_XUXXAJ9ezw.png"></p>
</li>
<li><p>å…³è”å…³ç³»ï¼ˆAssociationï¼‰ï¼š</p>
<p>æ¯”å¦‚æ°´ç­å’Œæµ·èƒ†éƒ½å±äºåŠ¨ç‰©ï¼Œè€Œæ°´ç­åƒæµ·èƒ†ï¼Œå› æ­¤è¿™ä¸¤ä¸ªç±»å‹ä¹‹é—´å‡ºç°äº†å…³è”å…³ç³»ï¼Œå…³è”è¡Œä¸ºå°±æ˜¯eatã€‚å…³è”å…³ç³»ç”¨ä¸€æ¡æ™®é€šç›´çº¿å°±å¯ä»¥è¡¨ç¤ºã€‚</p>
<p><img src="/design_pattern-image/image_XWGnxcAC0A.png"></p>
<p>é™¤äº†è¿™æ ·çš„æ™®é€šç›´çº¿è¡¨ç¤ºï¼Œè¿˜å¯ä»¥ç”¨å¸¦ç®­å¤´çš„ç›´çº¿æ¥è¡¨ç¤ºã€‚</p>
<p><img src="/design_pattern-image/image_Ya565F9o_R.png"></p>
<p>æ¯”å¦‚å›¾ä¸­è¡¨ç¤ºï¼ŒAçŸ¥é“Bï¼Œä½†Bä¸çŸ¥é“Aã€‚</p>
</li>
<li><p>èšåˆå…³ç³»ï¼ˆAggregationï¼‰ï¼š</p>
<p>èšåˆå…³ç³»æ¯”è¾ƒæŠ½è±¡ï¼Œå…¶æè¿°æ•´ä½“ä¸éƒ¨åˆ†çš„å…³ç³»ã€‚éƒ¨åˆ†å½’å±äºæ•´ä½“ï¼Œä½†äºŒè€…å¹¶éå¼ºä¾èµ–ï¼Œæ•´ä½“æ²¡äº†ï¼Œéƒ¨åˆ†ä¾ç„¶å¯ä»¥åœ¨ã€‚</p>
<p>åŠ¨ç‰©é™¤å´å…·ä½“ç±»å‹å¤–ï¼Œä¹Ÿå¯ä»¥æŒ‰çº²ç›®åˆ’åˆ†ã€‚æ¯”å¦‚å¯ä»¥æœ‰ä¸€ä¸ªæ°´ç”ŸåŠ¨ç‰©ç±»ï¼Œè€Œä¹Œé¾Ÿä¹Ÿå¯ä»¥å±äºæ°´ç”ŸåŠ¨ç‰©ã€‚ä½†æ˜¯äºŒè€…çš„å…³ç³»å¹¶éé‚£ä¹ˆå¼ºçƒˆï¼Œå³ä½¿æ°´ç”ŸåŠ¨ç‰©ç±»åœ¨ä»£ç ä¸­æ²¡æœ‰äº†ï¼Œä¹Œé¾Ÿç±»ä¾ç„¶å¯ä»¥å­˜åœ¨ã€‚å› æ­¤äºŒè€…å±äºèšåˆå…³ç³»ï¼Œå¯ç”¨<strong>ç©ºå¿ƒè±å½¢ç›´çº¿</strong>è¡¨ç¤ºã€‚</p>
<p><img src="/design_pattern-image/image__mx-L3DfW4.png"></p>
</li>
<li><p>ç»„åˆå…³ç³»ï¼ˆCompositionï¼‰ï¼š</p>
<p>&amp;#x20;ç»„åˆå…³ç³»ä¸åŒäºèšåˆï¼Œå…¶æè¿°äº†æ¯”è¾ƒå¼ºçš„ä¾èµ–å…³ç³»ã€‚æ¯”å¦‚æœ‰ä¸€ä¸ªç±»Aå’Œç±»Bï¼Œå‰è€…ä¸åè€…å¼ºå…³è”ï¼Œæœ‰å‰è€…å°±ä¼šæœ‰åè€…ï¼Œè€Œä¸”ç±»Aæ²¡äº†ï¼Œç±»Bä¹Ÿä¸å¤å­˜åœ¨ã€‚æ­¤ä¸ºç»„åˆå…³ç³»ï¼Œç»„åˆå…³ç³»ä½¿ç”¨<strong>å®å¿ƒè±å½¢ç›´çº¿</strong>è¡¨ç¤ºã€‚è€Œä¸”å¯ä»¥ç”¨æ•°å­—è¡¨ç¤ºï¼Œåœ¨è¿™æ ·çš„ä¾èµ–å…³ç³»ä¸­ï¼Œæ¯ä¸ªç±»å¯ä»¥æœ‰å‡ ä¸ªå®ä¾‹ã€‚</p>
<p>å½“æ˜¯1å¯¹1çš„å…³ç³»æ—¶ï¼Œä¹Ÿå¯ä»¥æ³¨è§£å½“å‰ä¸ºhas aè¿˜æ˜¯is aå…³ç³»ã€‚</p>
<p>æ¯”å¦‚åœ¨åŠ¨ç‰©å›­ä¸­ï¼Œæ¯ä¸ªæ‡’çŒ´éƒ½éœ€è¦åˆ¶å®šçªï¼Œä¸€ä¸ªçŒ´å¯ä»¥æœ‰ä¸€ä¸ªçªä¹Ÿå¯ä»¥æœ‰å¤šä¸ªçªï¼Œå½“çŒ´å­ä¸åœ¨äº†ï¼Œä¸å…¶ç»‘å®šçš„çªä¹Ÿå°±æ‹†æ¯äº†ã€‚</p>
<p><img src="/design_pattern-image/image_EChel9f6VJ.png"></p>
</li>
</ul>
<p>å› æ­¤ï¼Œæ•´ä½“çš„ç±»å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="/design_pattern-image/class_test_y7PGig-rKD.png"></p>
<ul>
<li><p>ä¾èµ–å…³ç³»ï¼š</p>
<p>ä¸Šé¢çš„ä¾‹å­ä¸­æ²¡æœ‰æåˆ°ä¾èµ–å…³ç³»ã€‚ä¾èµ–å…³ç³»ç”¨ä¸€å¥—å¸¦ç®­å¤´çš„è™šçº¿è¡¨ç¤ºï¼Œç”¨äºæè¿°ä¸€ä¸ªå¯¹è±¡åœ¨è¿è¡ŒæœŸé—´ä¼šç”¨åˆ°å¦ä¸€ä¸ªå¯¹è±¡çš„å…³ç³»ã€‚</p>
<p><img src="/design_pattern-image/image_KyqJhsbeTU.png"></p>
<p>å¦‚å›¾è¡¨ç¤ºAä¾èµ–äºBã€‚ä¾èµ–æœ‰æ–¹å‘ï¼Œè€ŒåŒå‘ä¾èµ–æ˜¯ä¸€ç§éå¸¸ç³Ÿç³•çš„ç»“æ„ï¼Œåº”æ€»æ˜¯ä¿æŒå•å‘ä¾èµ–ï¼Œæœç»åŒå‘ä¾èµ–çš„äº§ç”Ÿã€‚</p>
</li>
</ul>
<h2 id="ç”¨ä¾‹å›¾"><a href="#ç”¨ä¾‹å›¾" class="headerlink" title="ç”¨ä¾‹å›¾"></a>ç”¨ä¾‹å›¾</h2><p>ç”¨ä¾‹å›¾å¯ä»¥åˆ†ä¸ºå››ä¸ªä¸»ä½“ï¼šSystemsã€Actorsã€Use Casesã€Relationships</p>
<ul>
<li><p>Systemsï¼šç³»ç»Ÿå°±æ˜¯æ­£åœ¨å¼€å‘çš„ä¸œè¥¿ï¼Œå¯ä»¥æ˜¯appï¼Œå¯ä»¥æ˜¯è½¯ä»¶ç»„ä»¶ã€ç½‘ç«™ç­‰ç­‰ã€‚ç”¨ä¸€ä¸ªé•¿æ–¹å½¢è¡¨ç¤ºã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œè¦å¼€å‘ä¸€ä¸ªé“¶è¡Œåº”ç”¨ï¼Œé‚£ä¹ˆå°±ç”»ä¸€ä¸ªé•¿æ–¹å½¢ï¼Œå‘½åä¸ºBanking app</p>
<p><img src="/design_pattern-image/image_JkMI5Bfiix.png"></p>
</li>
<li><p>Actorsï¼šç”¨æˆ·å°±æ˜¯ä½¿ç”¨ç³»ç»Ÿæ¥è¾¾æˆç›®æ ‡çš„äººæˆ–ç‰©ï¼ˆæ¯”å¦‚ä¸€ä¸ªç»„ç»‡ã€æˆ–å¤–éƒ¨è®¾å¤‡ï¼‰ã€‚</p>
<p>Actoråœ¨å®é™…ä»£ç ä¸­è¦è¢«è§†ä¸ºç±»å‹ã€‚</p>
<p>åœ¨æ­¤ä¾‹å­ä¸­ï¼Œå¯ä»¥åˆ†æå‡ºæœ‰ä¸¤ä¸ªActorã€‚é¦–å…ˆæ˜¯é¡¾å®¢ï¼Œå…¶ä¸‹è½½Appå¹¶è¿›è¡Œç°é‡‘å­˜å–ã€‚è€Œå¦ä¸€ä¸ªåˆ™æ˜¯é“¶è¡Œè‡ªå·±ï¼Œé“¶è¡Œå‘appæä¾›ä¿¡æ¯ï¼Œæ¯”å¦‚äº¤æ˜“æµæ°´æˆ–è´¦æˆ·ä½™é¢ã€‚</p>
<blockquote>
<p>ğŸ“Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š<br>1. Actoræ°¸è¿œæ˜¯å¤–éƒ¨å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´è¦å§‹ç»ˆç½®äºæè¿°Systemçš„æ–¹æ¡†å¤–ã€‚<br>2. Actorçš„å®šä¹‰ä¸è¦å¤ªå…·ä½“ï¼Œæ¯”å¦‚ä¸è¦æŠŠBankè¿™ä¸ªActorå‘½åä¸ºå»ºè¡Œã€‚</p>
</blockquote>
<p>æ—¢ç„¶å­˜åœ¨å¤šä¸ªActorï¼Œé‚£ä¹ˆå°±å¼•ç”³å‡ºäº†Primary Actorså’ŒSecondary Actorsçš„æ¦‚å¿µã€‚å‰è€…ä¸»åŠ¨å¯ç”¨ç³»ç»Ÿï¼Œè€Œåè€…åˆ™è¾ƒä¸ºè¢«åŠ¨ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œé¡¾å®¢ä¸ºPrimary Actorï¼Œä»–ä»¬ä¼šæ‹¿å‡ºæ‰‹æœºï¼Œæ‰“å¼€appå†è¿›è¡Œç›¸å…³æ“ä½œã€‚è€Œé“¶è¡Œåˆ™æ˜¯Secondary Actorï¼Œé“¶è¡Œåªä¼šåœ¨é¡¾å®¢é‡‡å–è¡ŒåŠ¨ä¹‹åå†è¡ŒåŠ¨ã€‚æ¯”å¦‚é¡¾å®¢åœ¨appä¸ŠæŸ¥è¯¢è´¦æˆ·ä½™é¢ï¼Œæ­¤äº‹é“¶è¡Œæ‰ä¼šå‚ä¸ç³»ç»Ÿæä¾›ä¿¡æ¯ã€‚</p>
<p>Primary Actoræ”¾åœ¨Systemçš„å·¦è¾¹ï¼Œè€ŒSecondary Actoræ”¾åœ¨Systemçš„å³è¾¹ã€‚</p>
<p><img src="/design_pattern-image/image_4PEEOGeed7.png"></p>
</li>
<li><p>Use Casesï¼š</p>
<p>ç”¨ä¾‹ç”¨äºæè¿°ç³»ç»Ÿçš„è‹¥å¹²åŠŸèƒ½ï¼Œç”¨æ¤­åœ†è¡¨ç¤ºã€‚å®ƒä»¬è¢«æ”¾åœ¨Systemä¸­ï¼Œå› ä¸ºç”¨ä¾‹æ˜¯ç³»ç»Ÿå†…éƒ¨çš„åŠ¨ä½œã€‚æœ¬ä¾‹ä¸­ï¼Œé“¶è¡Œappæœ‰è¿™ä¹ˆå‡ é¡¹åŠŸèƒ½ï¼šé¡¾å®¢ç™»å½•ã€æŸ¥è´¦ã€è½¬è´¦ã€ä»˜æ¬¾ã€‚</p>
<blockquote>
<p>ğŸ“Œä¸åŒäºActorï¼ŒUse Caseéœ€è¦å…·ä½“ã€‚æ¯”å¦‚è½¬è´¦å†™æˆäº†Transfer Fundsï¼Œä½†å¦‚æœä»…å†™Transferï¼Œå°±ä¼šè®©äººæ‘¸ä¸ç€å¤´è„‘ã€‚</p>
</blockquote>
<p><img src="/design_pattern-image/image_NcXLfHbvGQ.png"></p>
</li>
<li><p>Relationshipsï¼š</p>
<p>Relationshipåæ˜ äº†actorä¸use caseä¹‹é—´ï¼Œä»¥åŠuse caseä¸use caseä¹‹é—´çš„å…³ç³»ã€äº¤æµæˆ–äº’åŠ¨ã€‚</p>
<ol>
<li><p>å…³è”ï¼ˆAssociationï¼‰ï¼šç”¨äºæè¿°Actorä¸Use Caseä¹‹é—´çš„äº¤äº’</p>
<p><img src="/design_pattern-image/image_pKnmoRy7CD.png"></p>
</li>
<li><p>åŒ…å«ï¼ˆIncludeï¼‰ä¸æ‰©å±•ï¼ˆExtendï¼‰ï¼š</p>
<ul>
<li><p>åŒ…å«ï¼šåŒ…å«å…³ç³»æ˜¾ç¤ºäº†åŸºæœ¬ç”¨ä¾‹å’ŒåŒ…å«ç”¨ä¾‹ä¹‹é—´çš„<strong>ä¾èµ–å…³ç³»</strong>ã€‚</p>
<p>æ¯æ¬¡æ‰§è¡ŒåŸºæœ¬ç”¨ä¾‹ï¼ˆBase Use Caseï¼‰æ—¶ï¼ŒåŒ…å«ç”¨ä¾‹ï¼ˆIncluded Use Caseï¼‰ä¹Ÿä¼šè¢«æ‰§è¡Œã€‚ä¸ºäº†è¡¨ç¤ºåŒ…å«å…³ç³»ï¼Œéœ€è¦ç”±åŸºæœ¬ç”¨ä¾‹å‘åŒ…å«ç”¨ä¾‹æ‹‰ä¸€æ¡&lt;&lt;include&gt;&gt;çš„çº¿ã€‚</p>
<p><img src="/design_pattern-image/image__0BMljJHon.png"></p>
</li>
<li><p>æ‰©å±•ï¼šåŸºæœ¬ç”¨ä¾‹å’Œæ‰©å±•ç”¨ä¾‹ä¹‹é—´æ²¡æœ‰å¤ªä¸¥æ ¼çš„ä¾èµ–å…³ç³»ã€‚åªæœ‰åœ¨æ‰§è¡ŒåŸºæœ¬ç”¨ä¾‹ï¼Œæ»¡è¶³æŸäº›æ¡ä»¶æ—¶ï¼Œæ‰©å±•ç”¨ä¾‹æ‰ä¼šè¢«æ‰§è¡Œã€‚å› æ­¤å¯ä»¥ç†è§£ä¸ºï¼Œ<strong>æ‰©å±•ç”¨ä¾‹ç”¨äºæ‰©å±•åŸºæœ¬ç”¨ä¾‹çš„è¡Œä¸º</strong>ã€‚ä¸ºäº†è¡¨ç¤ºæ‰©å±•å…³ç³»ï¼Œéœ€è¦ç”±æ‰©å±•ç”¨ä¾‹å‘åŸºæœ¬ç”¨ä¾‹æ‹‰ä¸€æ¡&lt;&lt;extend&gt;&gt;çš„çº¿ã€‚</p>
<p><img src="/design_pattern-image/image_0KgZ9eRCub.png"></p>
</li>
</ul>
<p>å½“é¡¾å®¢è¦ç™»å½•appæ—¶ï¼Œç³»ç»Ÿä¼šéªŒè¯é¡¾å®¢è¾“å…¥çš„å¯†ç ï¼Œå¯†ç æ­£ç¡®åˆ™ç™»å½•æˆåŠŸï¼Œä¸æ­£ç¡®åˆ™è¿”å›ä¸€æ¡ç™»å½•å¤±è´¥çš„ä¿¡æ¯ã€‚å› æ­¤å¯ä»¥åœ¨ç³»ç»Ÿä¸­åŠ ä¸Šä¸¤ä¸ªuse caseï¼šéªŒè¯å¯†ç ã€å’Œæ‰“å°ç™»å½•é”™è¯¯ä¿¡æ¯ã€‚</p>
<p>æ¯æ¬¡æ‰§è¡ŒLog inç”¨ä¾‹ï¼Œéƒ½å¿…é¡»æ‰§è¡ŒVerify Passwordç”¨ä¾‹ï¼Œå› æ­¤ï¼ŒäºŒè€…é—´å­˜åœ¨åŒ…å«å…³ç³»ï¼Œå‰è€…åŒ…å«åè€…ã€‚</p>
<p>è€Œä¸”ï¼Œå½“æ‰§è¡ŒLog inç”¨ä¾‹æ—¶ï¼ŒDisplay Login Errorç”¨ä¾‹å¹¶ä¸ä¼šæ€»æ˜¯æ‰§è¡Œï¼Œåªæœ‰ä¸€ç§æƒ…å†µï¼šå¯†ç é”™è¯¯æ—¶ï¼Œæ‰ä¼šå¾—ä»¥æ‰§è¡Œã€‚å› æ­¤ï¼ŒäºŒè€…é—´å­˜åœ¨æ‰©å±•å…³ç³»ã€‚</p>
<p><img src="/design_pattern-image/image_vAbbVjx40d.png"></p>
<blockquote>
<p>ğŸ“Œå¤šä¸ªåŸºæœ¬ç”¨ä¾‹å¯ä»¥åŒæ—¶ä¸æŸä¸€ä¸ªç”¨ä¾‹ï¼Œäº§ç”ŸåŒ…å«æˆ–æ‰©å±•å…³ç³»ã€‚</p>
</blockquote>
<p>å½“é¡¾å®¢è¦è½¬è´¦æ—¶ï¼Œç³»ç»Ÿä¹Ÿéœ€è¦é¦–å…ˆæŸ¥çœ‹è´¦æˆ·æ˜¯å¦æœ‰è¶³å¤Ÿçš„ä½™é¢ã€‚å› æ­¤è¿˜éœ€è¦æ·»åŠ éªŒè¯ä½™é¢æ˜¯å¦å……è¶³çš„ç”¨ä¾‹ã€‚åŒæ—¶ï¼Œç”¨æˆ·è¦ä»˜æ¬¾æ—¶ï¼ˆmake paymentï¼‰ï¼Œä¹Ÿéœ€è¦ç”¨åˆ°æŸ¥è¯¢ä½™é¢æ˜¯å¦å……è¶³çš„ç”¨ä¾‹ã€‚å› æ­¤å¯ä»¥è®©è¿™ä¸¤ä¸ªåŸºæœ¬ç”¨ä¾‹ï¼ŒåŒæ—¶æŒ‡å‘ä¸€ä¸ªåŒ…å«ç”¨ä¾‹ã€‚</p>
<p><img src="/design_pattern-image/image_ibUD6jaxfN.png"></p>
</li>
<li><p>æ³›åŒ–ï¼ˆGeneralizationï¼‰ï¼š</p>
<p>æ³›åŒ–ï¼Œä¹Ÿå¯ç§°ä¸ºç»§æ‰¿ï¼ˆinheritanceï¼‰ï¼Œä¸é¢å‘å¯¹è±¡ä¸­ç±»çš„ç»§æ‰¿å¾ˆç›¸ä¼¼ã€‚å­ç”¨ä¾‹ï¼ˆSpecialized Use Casesï¼‰ç»§æ‰¿çˆ¶ç”¨ä¾‹ï¼ˆGeneral Use Casesï¼‰çš„è¡Œä¸ºï¼Œä½†åŒæ—¶åˆå¯ä»¥æ·»åŠ è‡ªèº«çš„ç‹¬ç‰¹è¡Œä¸ºã€‚ä»å­ç”¨ä¾‹å‘çˆ¶ç”¨ä¾‹æ‹‰ä¸€ä¸ªä¸‹é¢è¿™æ ·çš„ç®­å¤´è¡¨ç¤ºç»§æ‰¿å…³ç³»ã€‚</p>
<p><img src="/design_pattern-image/image_0y67h-mcvx.png"></p>
<p>æ¯”å¦‚æœ¬ä¾‹ä¸­ï¼Œä»˜æ¬¾å¯ä»¥åˆ†ä¸ºä»æ”¯ç¥¨è´¦æˆ·ä»˜æ¬¾ï¼Œä¹Ÿå¯ä»¥ä»å‚¨è“„è´¦æˆ·ä»˜æ¬¾ã€‚äºŒè€…å±äºä»˜æ¬¾çš„å­ç”¨ä¾‹ã€‚</p>
<p><img src="/design_pattern-image/image_f8r81cnzno.png"></p>
<p>é™¤äº†å¯¹Use Caseè¿›è¡Œç»§æ‰¿å¤–ï¼Œè¿˜å¯ä»¥è®©Actorä¹‹é—´æœ‰ç»§æ‰¿å…³ç³»ã€‚æ¯”å¦‚é¡¾å®¢ä¸­å¯ä»¥åˆ†ä¸ºè€é¡¾å®¢å’Œæ–°é¡¾å®¢ã€‚è€Œä¸ç®¡æ–°è€ï¼Œå®ƒä»¬éƒ½æ˜¯é¡¾å®¢ï¼Œä½†æ˜¯å¯èƒ½å…·å¤‡ç‹¬ç‰¹çš„è¡Œä¸ºå’Œå±æ€§ï¼Œå¦‚æœè®¾è®¡æˆç±»ï¼Œå¯ä»¥æœ‰è¿™æ ·çš„ç»§æ‰¿å…³ç³»ï¼š</p>
<p><img src="/design_pattern-image/image_ZR-aggSc9b.png"></p>
</li>
<li><p>å¸¦æ‰©å±•ç‚¹çš„ç”¨ä¾‹ï¼ˆUse Cases with extension pointsï¼‰</p>
<p>ä¸€ä¸ªå¸¦æ‰©å±•ç‚¹çš„ç”¨ä¾‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸Šé¢æ˜¯ç”¨ä¾‹åï¼Œä¸‹é¢æ˜¯æ‰©å±•ç‚¹ã€‚æ‰©å±•ç‚¹è¯¦ç»†æè¿°äº†æ‰©å±•å…³ç³»ã€‚</p>
<p><img src="/design_pattern-image/image_J6ROHGk-HQ.png"></p>
<p>æ¯”å¦‚ç”¨æˆ·å¯ä»¥åœ¨appä¸­è®¾ç½®é…ç½®æ–‡ä»¶ï¼Œå› æ­¤å¯ä»¥æœ‰Set up Profileç”¨ä¾‹ï¼Œè€Œæ‹“å±•ç‚¹è¡¨ç¤ºï¼Œå½“ç”¨æˆ·è¿›å…¥Set up Profileæ—¶ï¼Œå¯ä»¥å¯¼èˆªåˆ°å‡ ä¸ªä¸åŒçš„ç•Œé¢ã€‚å¦‚æœé¡¾å®¢ä¸çŸ¥é“è¯¥å¦‚ä½•å¯¼èˆªï¼Œå¯ä»¥è®¿é—®é…ç½®æ–‡ä»¶å¸®åŠ©ï¼Œå¦‚æœé¡¾å®¢éœ€è¦è¯¢é—®ç§äººä¿¡æ¯ï¼Œå¯ä»¥å»éšç§ä¿¡æ¯ç•Œé¢å»æŸ¥çœ‹ã€‚æ‰©å±•ç‚¹æŒ‡å‘å¯¹åº”çš„æ‰©å±•ç”¨ä¾‹ã€‚åŒæ—¶è¿˜å¯ä»¥è®¾ç½®<strong>æ³¨é‡Š</strong>ï¼Œæ³¨æ˜å½“æ»¡è¶³ä»€ä¹ˆæ¡ä»¶æ—¶ä¼šå¼•å¯¼åˆ°ç›¸åº”çš„æ‰©å±•ç‚¹ã€‚</p>
<p><img src="/design_pattern-image/image_UX7gfhHr6j.png"></p>
</li>
</ol>
</li>
</ul>
<p>æœ€ç»ˆå°±å¾—åˆ°äº†è¿™æ ·ä¸€ä¸ªé“¶è¡Œappçš„ç”¨ä¾‹å›¾ç¤ºä¾‹ï¼š</p>
<p><img src="/design_pattern-image/use_case_TSxykT_OIm.png"></p>
<h2 id="æ—¶åº-x2F-åºåˆ—å›¾"><a href="#æ—¶åº-x2F-åºåˆ—å›¾" class="headerlink" title="æ—¶åº&#x2F;åºåˆ—å›¾"></a>æ—¶åº&#x2F;åºåˆ—å›¾</h2><blockquote>
<p>æ—¶åºå›¾æ˜¾ç¤ºäº†ä»£ç ä¸­çš„ç±»&#x2F;å¯¹è±¡åœ¨å…¶æ‰§è¡Œé¡ºåºè¿‡ç¨‹ä¸­çš„ç›¸äº’ä½œç”¨ï¼Œæ¢è¨€ä¹‹ï¼Œå…¶æ˜¾ç¤ºäº†åºåˆ—äº‹ä»¶ã€‚</p>
</blockquote>
<p>ä¸‹é¢ä»¥ä¸€ä¸ªATMæœºå­˜å–ï¼Œå¯¼è‡´çš„é“¶è¡Œç³»ç»Ÿæ‰§è¡Œæµç¨‹æ¥ç†è§£æ—¶åºå›¾ã€‚</p>
<ul>
<li><p>objectsï¼ˆå¯¹è±¡ï¼‰&amp; actorï¼ˆå‚ä¸è€…ï¼‰ï¼š</p>
<p>ä¸€ä¸ªäººå»ATMæœºå–é’±ï¼ŒATMæœºå°†äºé“¶è¡ŒæœåŠ¡å™¨é€šä¿¡ï¼Œä¹‹åé‚£ä¸ªäººçš„è´¦æˆ·å°±ä¼šè¢«å­˜å–ã€‚ATMæœºã€é“¶è¡ŒæœåŠ¡å™¨å’Œé“¶è¡Œè´¦æˆ·ï¼Œä¸‰è€…å‡å±äºé“¶è¡Œç³»ç»Ÿã€‚å› æ­¤è¿™ä¸‰é¡¹å¯ä»¥ç®—ä½œobjectsã€‚è€Œé‚£ä¸ªäººä¸å±äºé“¶è¡Œç³»ç»Ÿï¼Œè€Œä¸”ä»–æ¥å¼•å‘çš„äº‹ä»¶ï¼Œå› æ­¤ä»–æ˜¯ä¸€åactorã€‚</p>
<p>ç”»å›¾æ—¶actoræ”¾åœ¨ç³»ç»Ÿå·¦è¾¹ï¼Œåœ¨å…¶å³é™†ç»­ç”»å¯¹è±¡ï¼ŒæŒ‰ç…§ä¸actorçš„è¿œè¿‘ç”»ï¼ˆæ¯”å¦‚ATMæœºä¸äººçš„å…³ç³»æœ€è¿‘ï¼Œå› æ­¤å³è¾¹çš„ç¬¬ä¸€ä¸ªå¯¹è±¡æ˜¯ATMæœºï¼‰</p>
<p><img src="/design_pattern-image/image_trdsYDdxEi.png"></p>
</li>
<li><p>lifelinesï¼ˆç”Ÿå‘½çº¿ï¼‰</p>
<p>ç”Ÿå‘½çº¿æ˜¯ä½äºå¯¹è±¡ä¸‹æ–¹å‚ç›´çš„è™šçº¿ï¼Œæ˜¾ç¤ºç€ä¸€ä¸ªå¯¹è±¡æˆ–è€…å‚ä¸è€…å­˜åœ¨çš„æ—¶é—´ã€‚æ²¿ç€ç”Ÿå‘½çº¿å‘ä¸‹ä»£è¡¨ç€æ—¶é—´çš„æµé€ã€‚</p>
<p><img src="/design_pattern-image/image_W5xw_j8CIc.png"></p>
</li>
<li><p>messagesï¼ˆä¿¡æ¯ï¼‰</p>
<p>messagesåœ¨å¯¹è±¡ä¹‹é—´ä¼ é€’ï¼Œä»¥è¡¨ç¤ºç›¸äº’ä½œç”¨æ—¶çš„åŠ¨ä½œæˆ–ä¿¡æ¯ã€‚å„å¯¹è±¡çš„messageæ²¿ç€ç”Ÿå‘½çº¿å‘ä¸‹æŒªåŠ¨ï¼Œè¡¨ç¤ºäº‹ä»¶çš„å‰åå‘ç”Ÿå…³ç³»ã€‚</p>
<p>è€ƒè™‘æ•´ä¸ªç³»ç»Ÿçš„æ‰§è¡Œé¡ºåºï¼Œactoræ¥åˆ°ATMæœºå‰çš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯æ’å…¥é“¶è¡Œå¡ï¼›æ¥ç€ATMæœºä¸é“¶è¡ŒæœåŠ¡å™¨é€šä¿¡æ¥æ ¸å¯¹æ­¤å¡æ˜¯å¦æœ‰æ•ˆï¼›é“¶è¡ŒæœåŠ¡å™¨å°†æŸ¥è¯¢å¹¶å‘ATMæœºè¿”å›æ ¸å¯¹ç»“æœã€‚</p>
<p>æ’å…¥å¡ç‰‡ï¼Œé€šä¿¡è¦æ±‚æ ¸å¯¹ï¼Œå‡å±äºä¿¡æ¯ï¼Œç”±å®çº¿ç®­å¤´è¡¨ç¤ºã€‚è€Œè¿”å›æ ¸å¯¹ç»“æœï¼Œåˆ™å±äº<strong>è¿”å›ä¿¡æ¯</strong>ï¼ˆreturn&#x2F;reply messageï¼‰ï¼Œç”±è™šçº¿ç®­å¤´è¡¨ç¤ºã€‚</p>
<blockquote>
<p>ğŸ“Œéœ€æ³¨æ„ï¼Œè¿”å›ä¿¡æ¯å¹¶æ²¡æœ‰æ˜ç¡®çš„æ–¹å‘ï¼Œå¯ä»¥ä»å³æŒ‡å‘å·¦ï¼Œä¹Ÿå¯ä»¥ä»å·¦æŒ‡å‘å³ï¼Œéœ€è¦è§†å…·ä½“æƒ…å†µè€Œå®šã€‚</p>
</blockquote>
<p><img src="/design_pattern-image/image_-cM53juFhs.png"></p>
<p>ä½†æ˜¯åœ¨è¿”å›ä¿¡æ¯çš„æ—¶å€™ï¼Œé—®é¢˜å‡ºç°äº†ã€‚æœ‰ä¸¤ç§å¯èƒ½çš„å›å¤ä¿¡æ¯ï¼Œå¡å¯ç”¨ï¼Œæˆ–è€…ä¸å¯ç”¨ã€‚é‚£ä¹ˆå¦‚ä½•åœ¨åŒä¸€å¼ å›¾æè¿°ä¸¤ç§å¯èƒ½æƒ…å†µçš„å‘ç”Ÿå‘¢ï¼ŒUMLçš„è§£å†³æ–¹æ¡ˆæ˜¯alternative frameã€‚</p>
</li>
<li><p>Alternative Frameï¼ˆé€‰é¡¹ï¼‰</p>
<p>å½“é“¶è¡ŒæœåŠ¡å™¨åé¦ˆï¼Œæ­¤æ—¶å¡æœ‰æ•ˆæ—¶ï¼ŒATMæœºå°±ä¼šè¦æ±‚actorè¾“å…¥å¡å¯†ç ï¼›è€Œå½“åé¦ˆå¡æ— æ•ˆæ—¶ï¼Œå°±ä¼šå°†å¡å¼¹å‡ºã€‚</p>
<p>ç”±äºè¦æ±‚è¾“å…¥å¯†ç è¿™ä¸€äº‹ä»¶ï¼Œå¹¶ä¸æ˜¯åœ¨å›åº”ï¼Œå› æ­¤ä¸å½’å±äºè¿”å›ä¿¡æ¯ï¼Œè¦ç”¨å®çº¿ç®­å¤´ç”»ã€‚Alternative frameä¸­ï¼Œå·¦è¾¹å†™æ¡ä»¶ï¼Œå¹¶ç”¨è™šçº¿åˆ’åˆ†ä¸¤ä¸ªæ¡ä»¶å¯¹åº”çš„è¡Œä¸ºã€‚</p>
<p><img src="/design_pattern-image/image_LTFo_mo471.png"></p>
<p>å‰©ä¸‹çš„æ“ä½œå°±æ˜¯é¡ºç†æˆç« çš„é“¶è¡Œå–é’±æ“ä½œã€‚å¡æœ‰æ•ˆåï¼Œç”¨æˆ·ä¼šè¾“å…¥å¯†ç ï¼Œé“¶è¡ŒæœåŠ¡å™¨åé¦ˆå¯†ç æ˜¯å¦æ­£ç¡®ã€‚å¯†ç æ­£ç¡®åï¼Œç”¨æˆ·è¾“å…¥éœ€è¦å–é’±çš„é‡‘é¢ï¼Œé“¶è¡ŒæœåŠ¡å™¨ä¼šå‘é“¶è¡Œè´¦æˆ·æ ¸å®æ˜¯å¦æœ‰è¶³å¤Ÿå¤šçš„é’±ã€‚</p>
<p><img src="/design_pattern-image/image_kP5-Yda8Cq.png"></p>
</li>
<li><p>Activation Boxesï¼ˆæ¿€æ´»æ¡†ï¼‰ï¼š</p>
<p>Activation boxesæ˜¾ç¤ºå¯¹è±¡è¿›ç¨‹çš„å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ã€‚é€šè¿‡æ¿€æ´»æ¡†å¯ä»¥è½»æ¾çœ‹åˆ°å¯¹è±¡ä½•æ—¶å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œä½•æ—¶å¤„äºç©ºé—²çŠ¶æ€ã€‚ä¸‹é¢æ ¹æ®messagesæ¥ç»™å„ä¸ªå¯¹è±¡åŠ ä¸Šæ¿€æ´»æ¡†ã€‚</p>
<p><img src="/design_pattern-image/sequence_test.drawio_PZeOtyidOi.png"></p>
<p>é€šè¿‡æ¿€æ´»æ¡†å¯ä»¥çœ‹å‡ºï¼Œé“¶è¡Œè´¦æˆ·å¯¹è±¡æ˜¾ç„¶æ¯”å¦å¤–ä¸¤ä¸ªå¯¹è±¡æ›´ä¸æ´»è·ƒã€‚</p>
<blockquote>
<p>ğŸ“Œæ¿€æ´»æ¡†åªèƒ½ä½œç”¨äºobjectsï¼Œä¸èƒ½ä½œç”¨äºactorsã€‚</p>
</blockquote>
</li>
</ul>
<h1 id="é¢å‘å¯¹è±¡"><a href="#é¢å‘å¯¹è±¡" class="headerlink" title="é¢å‘å¯¹è±¡"></a>é¢å‘å¯¹è±¡</h1><ul>
<li><p>ç›¸æ¯”äºé¢å‘è¿‡ç¨‹ï¼Œä¸ºä»€ä¹ˆé¡¹ç›®å¼€å‘ä½¿ç”¨é¢å‘å¯¹è±¡ï¼Ÿ</p>
<p>å¤æ—©çš„ç¨‹åºéœ€æ±‚è¶³å¤Ÿç®€å•ï¼Œæ•´ä¸ªç¨‹åºçš„å¤„ç†æµç¨‹åªæœ‰ä¸€æ¡ä¸»çº¿ï¼Œå¾ˆå®¹æ˜“è¢«åˆ’åˆ†æˆé¡ºåºæ‰§è¡Œçš„å‡ ä¸ªæ­¥éª¤ï¼Œå¾ˆé€‚åˆé¢å‘è¿‡ç¨‹é£æ ¼ã€‚</p>
<p>ä½†å¯¹äºå¤§è§„æ¨¡å¤æ‚ç¨‹åºçš„å¼€å‘æ¥è¯´ï¼Œæ•´ä¸ªç¨‹åºçš„å¤„ç†æµç¨‹é”™ç»¼å¤æ‚ï¼Œç”»å‡ºæ¥çš„è¯ä¼šæ˜¯ä¸€ä¸ªç½‘çŠ¶ç»“æ„ï¼Œå†ç”¨é¢å‘è¿‡ç¨‹æ¥æ€è€ƒä¼šæ¯”è¾ƒåƒåŠ›ï¼Œæ­¤æ—¶é¢å‘å¯¹è±¡çš„æ€ç»´å°†æ›´å…·ä¼˜åŠ¿ã€‚å³ï¼Œå°†éœ€æ±‚ç¿»è¯‘ä¸ºç±»ï¼Œå¹¶ä¸”åœ¨ç±»ä¹‹é—´å»ºç«‹äº¤äº’å…³ç³»ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œé¢å‘å¯¹è±¡ä¹Ÿå¼ºåˆ¶ç¨‹åºå‘˜å°†ä»£ç çš„ç»„ç»‡æ–¹å¼æ›´æ¸…æ™°ã€æ›´æ¨¡å—åŒ–ã€‚</p>
</li>
</ul>
<h2 id="å››å¤§ç‰¹æ€§"><a href="#å››å¤§ç‰¹æ€§" class="headerlink" title="å››å¤§ç‰¹æ€§"></a>å››å¤§ç‰¹æ€§</h2><blockquote>
<p>å››å¤§ç‰¹æ€§ï¼šå°è£…ã€æŠ½è±¡ã€ç»§æ‰¿ã€å¤šæ€ã€‚è¿™å››å¤§ç‰¹æ€§ä½¿å¾—ç¨‹åºç›¸æ¯”äºé¢å‘è¿‡ç¨‹é£æ ¼çš„ä»£ç ï¼Œæ›´åŠ æ˜“æ‰©å±•ã€æ˜“å¤ç”¨ã€æ˜“ç»´æŠ¤ã€‚</p>
</blockquote>
<ol>
<li><p>å°è£…ï¼šä¿¡æ¯éšè—&#x2F;æ•°æ®è®¿é—®ä¿æŠ¤ï¼Œç±»é€šè¿‡æš´éœ²æœ‰é™çš„è®¿é—®æ¥å£ï¼Œæˆæƒå¤–éƒ¨ä»…èƒ½é€šè¿‡ç±»æä¾›çš„æ–¹å¼ï¼ˆæ¯”å¦‚æ–¹æ³•ï¼‰æ¥è®¿é—®å†…éƒ¨ä¿¡æ¯æˆ–è€…æ•°æ®ã€‚</p>
<p>å¦‚æœå¯¹ç±»ä¸­çš„å±æ€§ä¸åšé™åˆ¶ï¼Œä»»ä½•ä»£ç éƒ½èƒ½è®¿é—®ã€ä¿®æ”¹çš„è¯ï¼Œæ„å‘³ç€ä¸å¯æ§ã€‚å³å±æ€§å¯èƒ½è¢«éšæ„åœ°ä»¥å„ç§æ–¹å¼ä¿®æ”¹ï¼Œè€Œä¸”ä¿®æ”¹é€»è¾‘å¯èƒ½æ•£è½åœ¨ä»£ç ä¸­çš„å„ä¸ªè§’è½ï¼Œå½±å“ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œä»…æš´éœ²å¿…è¦çš„æ“ä½œï¼Œä¹Ÿèƒ½æé«˜ç±»çš„æ˜“ç”¨æ€§ã€‚è°ƒç”¨è€…åªéœ€ä½¿ç”¨apiå°±å¥½ï¼Œä¸å¿…è¿‡äºç»†è‡´çš„äº†è§£ä¸šåŠ¡é€»è¾‘ï¼Œå‡å°‘å¿ƒæ™ºè´Ÿæ‹…ã€‚è€Œä¸”ç”¨é”™çš„æ¦‚ç‡ä¼šå‡å°‘ã€‚</p>
</li>
<li><p>æŠ½è±¡ï¼šæŠ½è±¡é€šå¸¸ç”±æ¥å£ã€æŠ½è±¡ç±»æ¥å®ç°ã€‚å…¶éšè—æ–¹æ³•çš„å…·ä½“å®ç°ï¼Œè®©è°ƒç”¨è€…åªéœ€å…³å¿ƒæ–¹æ³•æä¾›äº†å“ªäº›åŠŸèƒ½ï¼Œå¹¶ä¸éœ€è¦çŸ¥é“è¿™äº›åŠŸèƒ½æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p>
<p>é€šè¿‡æŠ½è±¡ï¼Œä¸€æ–¹é¢é™ä½è°ƒç”¨è€…çš„æ“ä½œéš¾åº¦ï¼Œå¦ä¸€æ–¹é¢å¯ä»¥ä¿æŒå…¼å®¹èƒ½åŠ›ï¼Œå³ä½¿å…·ä½“ç±»çš„å…·ä½“å®ç°æ›´æ”¹äº†ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°ä¸Šå±‚ä»£ç ã€‚</p>
</li>
<li><p>ç»§æ‰¿ï¼šç»§æ‰¿è¡¨ç¤ºç±»ä¹‹é—´çš„is-aå…³ç³»ï¼Œæ¯”å¦‚çŒ«æ˜¯ä¸€ç§å“ºä¹³åŠ¨ç‰©ã€‚</p>
<p>ç»§æ‰¿çš„ä¸»è¦ä½œç”¨åœ¨äºä»£ç å¤ç”¨ï¼Œå¯ä»¥é¿å…ä»£ç é‡å¤å†™å¾ˆå¤šéã€‚ä½†æ˜¯ç»§æ‰¿å±‚æ¬¡è¿‡æ·±ä¹Ÿä¼šå¯¼è‡´ä»£ç å¯è¯»æ€§å·®ã€å¯ç»´æŠ¤æ€§å˜å·®ã€‚</p>
</li>
<li><p>å¤šæ€ï¼šå­ç±»å¯ä»¥æ›¿æ¢çˆ¶ç±»ï¼Œåœ¨å®é™…çš„ä»£ç è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œè°ƒç”¨å­ç±»çš„æ–¹æ³•å®ç°ã€‚</p>
<p>å¤šæ€ä»£ç çš„ä½œç”¨åœ¨äºæé«˜ä»£ç çš„å¯æ‰©å±•æ€§å’Œå¤ç”¨æ€§ã€‚æ¯”å¦‚ä¸€ä¸ª<code>print(Animal var)</code>å°±å¯ä»¥æ‰“å°æ‰€æœ‰ç±»å‹åŠ¨ç‰©çš„ä¿¡æ¯ã€‚å¤šæ€æ˜¯ä¼—å¤šè®¾è®¡æ¨¡å¼å®ç°çš„åŸºçŸ³ã€‚</p>
</li>
</ol>
<h2 id="åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹"><a href="#åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹" class="headerlink" title="åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹"></a>åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹</h2><blockquote>
<p>Program to an interface, not an implementation</p>
</blockquote>
<p>ä»æœ¬è´¨ä¸Šæ¥çœ‹ï¼Œâ€œæ¥å£â€å°±æ˜¯ä¸€ç»„â€œåè®®â€æˆ–è€…â€œçº¦å®šâ€ï¼Œæ˜¯åŠŸèƒ½æä¾›è€…æä¾›ç»™ä½¿ç”¨è€…çš„ä¸€ä¸ªâ€œåŠŸèƒ½åˆ—è¡¨â€ã€‚è¿™æ¡åŸåˆ™å¸Œæœ›ï¼Œå®é™…ä»£ç ä¸­ï¼Œä¸Šå±‚ä»£ç å¤šç”¨æŠ½è±¡å‡ºæ¥çš„æ¥å£ï¼Œè€Œéå…·ä½“å®ç°äº†åŠŸèƒ½çš„ç±»ã€‚è¿™æ ·å¯ä»¥å¸¦æ¥å¥½å¤„ï¼š</p>
<ul>
<li><p><strong>æ¥å£ä¸å®ç°ç›¸åˆ†ç¦»</strong>ã€‚å°è£…ä¸ç¨³å®šçš„å®ç°ï¼Œæš´éœ²ç¨³å®šçš„æ¥å£ã€‚è¿™æ ·å½“å®ç°å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œä¸Šæ¸¸ç³»ç»Ÿçš„ä»£ç åŸºæœ¬ä¸Šä¸éœ€è¦åšæ”¹åŠ¨ï¼Œä»¥æ­¤é™ä½è€¦åˆæ€§ï¼Œæé«˜æ‰©å±•æ€§ã€‚</p>
<p><strong>å¥½çš„ä»£ç è®¾è®¡ï¼Œä¸ä»…èƒ½åº”å¯¹å½“ä¸‹çš„éœ€æ±‚ï¼Œè€Œä¸”åœ¨å°†æ¥éœ€æ±‚å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œä»ç„¶èƒ½å¤Ÿåœ¨ä¸ç ´ååŸæœ‰ä»£ç è®¾è®¡çš„æƒ…å†µä¸‹çµæ´»åº”å¯¹</strong>ã€‚</p>
</li>
</ul>
<h2 id="å¤šç”¨ç»„åˆå°‘ç”¨ç»§æ‰¿"><a href="#å¤šç”¨ç»„åˆå°‘ç”¨ç»§æ‰¿" class="headerlink" title="å¤šç”¨ç»„åˆå°‘ç”¨ç»§æ‰¿"></a>å¤šç”¨ç»„åˆå°‘ç”¨ç»§æ‰¿</h2><p>ç»§æ‰¿çš„å¼Šç«¯ä¸ä»…å±€é™äºç®€å•ç»§æ‰¿çš„å±‚æ¬¡è¿‡æ·±é—®é¢˜ã€‚è€ƒè™‘â€œé¸Ÿâ€è¿™ä¸ªç±»ï¼š</p>
<ol>
<li><p>æ–¹æ³•é€‰æ‹©å—é™ï¼š</p>
<p>å¤§éƒ¨åˆ†é¸Ÿéƒ½ä¼šé£ï¼Œé‚£ä¹ˆå¯ä¸å¯ä»¥åœ¨AbstractBirdæŠ½è±¡ç±»ä¸­ï¼Œå®šä¹‰ä¸€ä¸ªflyæ–¹æ³•å‘¢ï¼Ÿ</p>
<ul>
<li><p>å¦‚æœå®šä¹‰äº†ï¼Œä¾ç„¶æœ‰ä¸€äº›é¸Ÿæ˜¯ä¸ä¼šé£çš„ï¼Œæ¯”å¦‚é¸µé¸Ÿï¼Œä½†æ˜¯é¸µé¸Ÿç±»ä¸­å´ä»ç„¶æœ‰flyæ–¹æ³•ï¼Œå³ä½¿å°†é¸µé¸Ÿç±»ä¸­çš„flyå†…éƒ¨å†™æŠ›å‡ºå¼‚å¸¸çš„ä»£ç ï¼Œä¹Ÿä¸ä¼šå¼ºåˆ¶ç¨‹åºå‘˜åœ¨å†™ä»£ç æ—¶é¿å…è®© é¸µé¸Ÿç­‰é¸Ÿç±»flyï¼Œåœ¨åç»­æ‰©å±•ä¸­éš¾å…æœ‰æ¼ç½‘ä¹‹é±¼ï¼Œå¯¼è‡´é”™è¯¯ã€‚</p>
</li>
<li><p>å¦‚æœä¸å®šä¹‰ï¼Œé‚£ä¹ˆå½“ä¼šé£çš„é¸Ÿç±»æƒ³flyæ—¶ï¼Œå°±è¦å¤šå†™å¾ˆå¤šå®ç°ä»–ä»¬flyæ–¹æ³•çš„ä»£ç ï¼Œæœ‰æ‚–äºâ€œç»§æ‰¿æé«˜ä»£ç å¤ç”¨â€çš„ç›®çš„ã€‚</p>
</li>
</ul>
</li>
<li><p>æ´¾ç”Ÿå…³ç³»å¤æ‚ï¼š</p>
<p>é‚£ä¹ˆæ˜¯å¦å¯ä»¥ç»™AbstractBirdæ´¾ç”Ÿä¸¤ä¸ªç±»ï¼Œä¸€ä¸ªä¼šé£é¸Ÿç±»ï¼Œä¸€ä¸ªä¸ä¼šé£é¸Ÿç±»ï¼Œå†åœ¨ä¼šé£ç±»é‡Œæ´¾ç”Ÿå…·ä½“çš„é¸Ÿç±»ï¼Œä¸ä¼šé£é¸Ÿç±»é‡Œæ´¾ç”Ÿé¸µé¸Ÿç±»ã€‚</p>
<p>è¡¨é¢ä¸Šè¿™æ ·å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯åœ¨åé¢çš„æ‰©å±•ä¸­ï¼Œè¿™æ ·çš„è®¾è®¡å¯èƒ½ä¼šå¸¦æ¥æ›´ä¸ºä¸¥é‡çš„é—®é¢˜ã€‚æ¯”å¦‚æ­¤æ—¶éœ€æ±‚å˜æ›´ï¼Œè¿˜æƒ³åŠ ä¸ŠTweetæ–¹æ³•ï¼Œå³è®©é¸Ÿå„¿å«å‡ºæ¥ã€‚æ²¿è¢­åˆšæ‰çš„æ€è·¯ï¼ŒAbstractBirdæ´¾ç”Ÿå‡ºæ¥äº†å››ä¸ªç±»ï¼šä¼šé£ä¼šå«ã€ä¼šé£ä¸ä¼šå«ã€ä¸ä¼šé£ä¼šå«ã€ä¸ä¼šé£ä¸ä¼šå«ã€‚ä¸¤ä¸ªåŠŸèƒ½è¡ç”Ÿå‡ºäº†å››ç§ç»„åˆã€‚ä¹Ÿå°±æ˜¯nä¸ªåŠŸèƒ½ä¼šæœ‰$2^n$ç§ç»„åˆï¼Œå‘ˆæŒ‡æ•°å½¢å¼å˜åŒ–ã€‚</p>
<p>é‚£ä¹ˆåé¢è¿˜è¦åŠ ä¸‹è›‹ï¼ˆåˆ¤æ–­æ˜¯å¦ä¼šä¸‹è›‹ï¼‰ç­‰åŠŸèƒ½ï¼Œå°†ä¼šç»„åˆçˆ†ç‚¸ã€‚è¿™æ ·ç»§æ‰¿çš„å…³ç³»è¶Šæ¥è¶Šå¤æ‚ï¼Œå¯è¯»æ€§æå·®ï¼Œè€Œä¸”æéš¾ç»´æŠ¤ã€‚</p>
</li>
</ol>
<blockquote>
<p>ğŸ“Œç»§æ‰¿ä¸»è¦æœ‰ä¸‰ä¸ªä½œç”¨ï¼šè¡¨ç¤ºis-aå…³ç³»ï¼Œæ”¯æŒå¤šæ€ç‰¹æ€§ï¼Œä»£ç å¤ç”¨ã€‚è€Œè¿™ä¸‰ä¸ªä½œç”¨éƒ½å¯ä»¥é€šè¿‡ç»„åˆã€æ¥å£ã€å§”æ‰˜ä¸‰ä¸ªæŠ€æœ¯æ‰‹æ®µæ¥è¾¾æˆã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåˆ©ç”¨ç»„åˆè¿˜èƒ½è§£å†³å±‚æ¬¡è¿‡æ·±ã€è¿‡å¤æ‚çš„ç»§æ‰¿å…³ç³»å½±å“ä»£ç å¯ç»´æŠ¤æ€§çš„é—®é¢˜ã€‚</p>
</blockquote>
<ul>
<li><p>ç»„åˆã€æ¥å£ã€å§”æ‰˜çš„å®ç°æ–¹æ¡ˆï¼š</p>
<p>é’ˆå¯¹ä¸åŒéœ€æ±‚ï¼Œå®šä¹‰ä¸åŒçš„æ¥å£ï¼Œä¹‹åæ¯ä¸ªé¸Ÿç±»å°†è¿™äº›æ¥å£ç»„åˆåœ¨ä¸€èµ·ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Flyable</span> &#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Tweetable</span> &#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">tweet</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EggLayable</span> &#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">layEgg</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Ostrich</span> <span class="keyword">implements</span> <span class="title class_">Tweetable</span>, EggLayable &#123;<span class="comment">//é¸µé¸Ÿ</span></span><br><span class="line">  <span class="comment">//... çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•...</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">tweet</span><span class="params">()</span> &#123; <span class="comment">//... &#125;</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">layEgg</span><span class="params">()</span> &#123; <span class="comment">//... &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Sparrow</span> impelents Flayable, Tweetable, EggLayable &#123;<span class="comment">//éº»é›€</span></span><br><span class="line">  <span class="comment">//... çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•...</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span> &#123; <span class="comment">//... &#125;</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">tweet</span><span class="params">()</span> &#123; <span class="comment">//... &#125;</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">layEgg</span><span class="params">()</span> &#123; <span class="comment">//... &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥å£åªå£°æ˜æ–¹æ³•ï¼Œä¸å®šä¹‰å®ç°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªä¼šä¸‹è›‹çš„é¸Ÿéƒ½è¦å®ç°ä¸€élayEgg()æ–¹æ³•ï¼Œå¹¶ä¸”å®ç°é€»è¾‘æ˜¯ä¸€æ ·çš„ï¼Œè¿™å°±ä¼šå¯¼è‡´ä»£ç é‡å¤çš„é—®é¢˜ã€‚å¯ä»¥é€šè¿‡ç»„åˆ+å§”æ‰˜çš„æ–¹å¼æ¥æ¶ˆé™¤ä»£ç é‡å¤ã€‚é’ˆå¯¹ä¸‰ä¸ªæ¥å£å†å®šä¹‰ä¸‰ä¸ªå®ç°ç±»ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼šå®ç°äº†fly()æ–¹æ³•çš„FlyAbilityç±»ã€å®ç°äº†tweet()æ–¹æ³•çš„TweetAbilityç±»ã€å®ç°äº†layEgg()æ–¹æ³•çš„EggLayAbilityç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Flyable</span> &#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span>ï¼›</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlyAbility</span> <span class="keyword">implements</span> <span class="title class_">Flyable</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span> &#123; <span class="comment">//... &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//çœç•¥Tweetable/TweetAbility/EggLayable/EggLayAbility</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Ostrich</span> <span class="keyword">implements</span> <span class="title class_">Tweetable</span>, EggLayable &#123;<span class="comment">//é¸µé¸Ÿ</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">TweetAbility</span> <span class="variable">tweetAbility</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TweetAbility</span>(); <span class="comment">//ç»„åˆ</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">EggLayAbility</span> <span class="variable">eggLayAbility</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EggLayAbility</span>(); <span class="comment">//ç»„åˆ</span></span><br><span class="line">  <span class="comment">//... çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•...</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">tweet</span><span class="params">()</span> &#123;</span><br><span class="line">    tweetAbility.tweet(); <span class="comment">// å§”æ‰˜</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">layEgg</span><span class="params">()</span> &#123;</span><br><span class="line">    eggLayAbility.layEgg(); <span class="comment">// å§”æ‰˜</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>äºæ˜¯ç»„åˆ+æ¥å£+å§”æ‰˜ï¼Œè¾¾æˆäº†ä»£ç é‡å¤å°‘ã€ä¹Ÿä¸å¿…å†æœ‰å¤æ‚ç»§æ‰¿å…³ç³»çš„ç›®çš„ã€‚</p>
</li>
</ul>
<h1 id="è®¾è®¡åŸåˆ™"><a href="#è®¾è®¡åŸåˆ™" class="headerlink" title="è®¾è®¡åŸåˆ™"></a>è®¾è®¡åŸåˆ™</h1><blockquote>
<p>SOLIDåŸåˆ™ï¼šç”±5ä¸ªè®¾è®¡åŸåˆ™ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼Œå•ä¸€èŒè´£åŸåˆ™ã€å¼€é—­åŸåˆ™ã€é‡Œæ°æ›¿æ¢åŸåˆ™ã€æ¥å£éš”ç¦»åŸåˆ™å’Œä¾èµ–åè½¬åŸåˆ™ï¼Œå¯¹åº”Sã€Oã€Lã€Iã€D 5ä¸ªè‹±æ–‡å­—æ¯</p>
</blockquote>
<h2 id="å•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle-Responsibility-Principle-SRPï¼‰"><a href="#å•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle-Responsibility-Principle-SRPï¼‰" class="headerlink" title="å•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle Responsibility Principle, SRPï¼‰"></a>å•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle Responsibility Principle, SRPï¼‰</h2><blockquote>
<p>ä¸€ä¸ªç±»&#x2F;æ¨¡å—åªè´Ÿè´£å®Œæˆä¸€ä¸ªèŒè´£ï¼ˆæˆ–è€…åŠŸèƒ½ï¼‰</p>
</blockquote>
<p>ä¸€ä¸ªç±»åªè´Ÿè´£å®Œæˆä¸€ä¸ªèŒè´£æˆ–è€…åŠŸèƒ½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸è¦è®¾è®¡å¤§è€Œå…¨çš„ç±»ï¼Œè¦è®¾è®¡ç²’åº¦å°ã€åŠŸèƒ½å•ä¸€çš„ç±»ã€‚æ¢ä¸ªè§’åº¦å°±æ˜¯ï¼Œä¸€ä¸ªç±»åŒ…å«äº†ä¸¤ä¸ªæˆ–è€…ä¸¤ä¸ªä»¥ä¸Šä¸šåŠ¡ä¸ç›¸å¹²çš„åŠŸèƒ½ï¼Œé‚£æˆ‘ä»¬å°±è¯´å®ƒèŒè´£ä¸å¤Ÿå•ä¸€ï¼Œåº”è¯¥å°†å®ƒæ‹†åˆ†æˆå¤šä¸ªåŠŸèƒ½æ›´åŠ å•ä¸€ã€ç²’åº¦æ›´ç»†çš„ç±»ã€‚</p>
<p>&amp;#x20;ä»¥ä¸‹å‡ ç‚¹å¯ä»¥è¾…åŠ©åˆ¤æ–­ç±»çš„èŒè´£æ˜¯å¦è¶³å¤Ÿå•ä¸€ï¼š</p>
<ul>
<li><p>ç±»ä¸­çš„ä»£ç è¡Œæ•°ã€å‡½æ•°æˆ–å±æ€§è¿‡å¤šï¼Œä¼šå½±å“ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œæˆ‘ä»¬å°±éœ€è¦è€ƒè™‘å¯¹ç±»è¿›è¡Œæ‹†åˆ†ï¼›</p>
</li>
<li><p>ç±»ä¾èµ–çš„å…¶ä»–ç±»è¿‡å¤šï¼Œæˆ–è€…ä¾èµ–ç±»çš„å…¶ä»–ç±»è¿‡å¤šï¼Œä¸ç¬¦åˆé«˜å†…èšã€ä½è€¦åˆçš„è®¾è®¡æ€æƒ³ï¼Œæˆ‘ä»¬å°±éœ€è¦è€ƒè™‘å¯¹ç±»è¿›è¡Œæ‹†åˆ†ï¼›</p>
</li>
<li><p>ç§æœ‰æ–¹æ³•è¿‡å¤šï¼Œæˆ‘ä»¬å°±è¦è€ƒè™‘èƒ½å¦å°†ç§æœ‰æ–¹æ³•ç‹¬ç«‹åˆ°æ–°çš„ç±»ä¸­ï¼Œè®¾ç½®ä¸ºpublicæ–¹æ³•ï¼Œä¾›æ›´å¤šçš„ç±»ä½¿ç”¨ï¼Œä»è€Œæé«˜ä»£ç çš„å¤ç”¨æ€§ï¼›</p>
</li>
<li><p>æ¯”è¾ƒéš¾ç»™ç±»èµ·ä¸€ä¸ªåˆé€‚åå­—ï¼Œå¾ˆéš¾ç”¨ä¸€ä¸ªä¸šåŠ¡åè¯æ¦‚æ‹¬ï¼Œæˆ–è€…åªèƒ½ç”¨ä¸€äº›ç¬¼ç»Ÿçš„Managerã€Contextä¹‹ç±»çš„è¯è¯­æ¥å‘½åï¼Œè¿™å°±è¯´æ˜ç±»çš„èŒè´£å®šä¹‰å¾—å¯èƒ½ä¸å¤Ÿæ¸…æ™°ï¼›</p>
</li>
<li><p>ç±»ä¸­å¤§é‡çš„æ–¹æ³•éƒ½æ˜¯é›†ä¸­æ“ä½œç±»ä¸­çš„æŸå‡ ä¸ªå±æ€§ï¼Œæ¯”å¦‚ï¼Œåœ¨UserInfoä¾‹å­ä¸­ï¼Œå¦‚æœä¸€åŠçš„æ–¹æ³•éƒ½æ˜¯åœ¨æ“ä½œaddressä¿¡æ¯ï¼Œé‚£å°±å¯ä»¥è€ƒè™‘å°†è¿™å‡ ä¸ªå±æ€§å’Œå¯¹åº”çš„æ–¹æ³•æ‹†åˆ†å‡ºæ¥ã€‚</p>
</li>
</ul>
<h2 id="å¼€é—­åŸåˆ™ï¼šå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­ï¼ˆOpen-Closed-Principleï¼‰"><a href="#å¼€é—­åŸåˆ™ï¼šå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­ï¼ˆOpen-Closed-Principleï¼‰" class="headerlink" title="å¼€é—­åŸåˆ™ï¼šå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­ï¼ˆOpen Closed Principleï¼‰"></a>å¼€é—­åŸåˆ™ï¼šå¯¹æ‰©å±•å¼€æ”¾ã€ä¿®æ”¹å…³é—­ï¼ˆOpen Closed Principleï¼‰</h2><p>æ·»åŠ ä¸€ä¸ªæ–°çš„åŠŸèƒ½åº”è¯¥æ˜¯ï¼Œåœ¨å·²æœ‰ä»£ç åŸºç¡€ä¸Šæ‰©å±•ä»£ç ï¼ˆæ–°å¢æ¨¡å—ã€ç±»ã€æ–¹æ³•ç­‰ï¼‰ï¼Œè€Œéä¿®æ”¹å·²æœ‰ä»£ç ï¼ˆä¿®æ”¹æ¨¡å—ã€ç±»ã€æ–¹æ³•ç­‰ï¼‰ã€‚</p>
<p>ä½“ç°åœ¨C++ä»£ç çš„è¯ï¼Œç”¨çˆ¶ç±»æŒ‡é’ˆå»æŒ‡å‘å­ç±»ï¼Œä½“ç°äº†è¿™æ ·çš„å¼€é—­åŸåˆ™ï¼š</p>
<p>æ¯”å¦‚å®šä¹‰ä¸€ä¸ªCalculatoræŠ½è±¡ç±»ï¼Œé€šè¿‡å­ç±»ç»§æ‰¿çš„æ–¹å¼æ‰©å±•å‡ºåŠ å‡ä¹˜é™¤çš„åŠŸèƒ½ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¡ç®—å™¨ç±»  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Calculator</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="comment">//æŠ½è±¡æ¥å£ç±»ï¼Œå­ç±»å®ç°</span></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">double</span> <span class="title">getompute</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">getParam</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é™¤</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Division</span> : <span class="keyword">public</span> Calculator</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">double</span> <span class="title">getompute</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mA / mB;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">getParam</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    mA = a;</span><br><span class="line">    mB = b;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">double</span> mA;</span><br><span class="line">  <span class="type">double</span> mB;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//ä¹˜</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Multiplication</span> : <span class="keyword">public</span> Calculator</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">double</span> <span class="title">getompute</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mA * mB;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">getParam</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    mA = a;</span><br><span class="line">    mB = b;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">double</span> mA;</span><br><span class="line">  <span class="type">double</span> mB;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//å‡</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Subtraction</span> : <span class="keyword">public</span> Calculator</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">double</span> <span class="title">getompute</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mA - mB;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">getParam</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    mA = a;</span><br><span class="line">    mB = b;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">double</span> mA;</span><br><span class="line">  <span class="type">double</span> mB;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//åŠ </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Addition</span> : <span class="keyword">public</span> Calculator</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">double</span> <span class="title">getompute</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mA + mB;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">getParam</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    mA = a;</span><br><span class="line">    mB = b;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">double</span> mA;</span><br><span class="line">  <span class="type">double</span> mB;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Calculator* Add = <span class="keyword">new</span> Addition;</span><br><span class="line">  Add-&gt;<span class="built_in">getParam</span>(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">  <span class="type">double</span> c = Add-&gt;<span class="built_in">getompute</span>();</span><br><span class="line">  cout &lt;&lt; c &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆæ­¤æ—¶ï¼Œè¿˜æƒ³æ·»åŠ ä¸€ä¸ªæ±‚æ ¹çš„åŠŸèƒ½ï¼Œå°±åªéœ€å†æ·»åŠ ä¸€ä¸ªæ±‚æ ¹è¿ç®—çš„å­ç±»å³å¯ã€‚</p>
<h2 id="é‡Œå¼æ›¿æ¢åŸåˆ™ï¼ˆLiskov-Substitution-Principleï¼‰"><a href="#é‡Œå¼æ›¿æ¢åŸåˆ™ï¼ˆLiskov-Substitution-Principleï¼‰" class="headerlink" title="é‡Œå¼æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰"></a>é‡Œå¼æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰</h2><p>å­ç±»å¯¹è±¡èƒ½å¤Ÿæ›¿æ¢ç¨‹åºä¸­çˆ¶ç±»å¯¹è±¡å‡ºç°çš„ä»»ä½•åœ°æ–¹ï¼Œå¹¶ä¸”ä¿è¯åŸæ¥ç¨‹åºçš„é€»è¾‘è¡Œä¸ºä¸å˜åŠæ­£ç¡®æ€§ä¸è¢«ç ´åã€‚ä¹Ÿå°±æ˜¯å­ç±»å¯¹è±¡æ›¿æ¢äº†çˆ¶ç±»å¯¹è±¡çš„å†…åœ¨å®ç°ï¼Œä½†æ˜¯å¯¹å¤–çš„æ¥å£ä¿æŒä¸çˆ¶ç±»å¯¹è±¡ä¸€è‡´ã€‚</p>
<p>æ˜æ˜¾è¿èƒŒLSPçš„ä»£ç ï¼š</p>
<ul>
<li><p>å­ç±»è¿èƒŒçˆ¶ç±»å£°æ˜è¦å®ç°çš„åŠŸèƒ½</p>
<p>æ¯”å¦‚çˆ¶ç±»ä¸­æä¾›çš„sortByAmount()å‡½æ•°ï¼Œæ˜¯æŒ‰ç…§ç±»ä¸­çš„é‡‘é¢å±æ€§è¿›è¡Œä»å°åˆ°å¤§çš„æ’åºï¼Œè€Œå­ç±»é‡å†™æ­¤å‡½æ•°æ—¶ï¼Œæ˜¯æŒ‰ç…§æ—¥æœŸå±æ€§è¿›è¡Œæ’åºçš„ã€‚é‚£ä¹ˆå­ç±»çš„è®¾è®¡å°±è¿èƒŒäº†é‡Œå¼æ›¿æ¢åŸåˆ™ã€‚</p>
</li>
<li><p>å­ç±»è¿èƒŒçˆ¶ç±»å¯¹è¾“å…¥ã€è¾“å‡ºã€å¼‚å¸¸çš„çº¦å®š</p>
<p>æ¯”å¦‚çˆ¶ç±»ä¸­çš„æŸä¸ªå‡½æ•°çº¦å®šäº†ï¼š</p>
<ol>
<li><p>è¿è¡Œå‡ºé”™æ—¶è¿”å›nullï¼›è·å–æ•°æ®ä¸ºç©ºæ—¶è¿”å›ç©ºé›†åˆã€‚è€Œå­ç±»é‡è½½å‡½æ•°ä¹‹åï¼Œå®ç°å˜äº†ï¼Œè¿è¡Œå‡ºé”™è¿”å›å¼‚å¸¸ï¼Œè·å–ä¸åˆ°æ•°æ®è¿”å›nullï¼›</p>
</li>
<li><p>è¾“å…¥æ•°æ®å¯ä»¥æ˜¯ä»»æ„æ•´æ•°ï¼Œä½†å­ç±»å®ç°çš„æ—¶å€™ï¼Œåªå…è®¸è¾“å…¥æ•°æ®æ˜¯æ­£æ•´æ•°ï¼Œè´Ÿæ•°å°±æŠ›å‡ºï¼›</p>
</li>
<li><p>çº¦å®šåªä¼šæŠ›å‡ºAå¼‚å¸¸ï¼Œå­ç±»å®ç°æ—¶å´åªå…è®¸æŠ›å‡ºBå¼‚å¸¸</p>
</li>
</ol>
<p>è¿™äº›éƒ½å¯¼è‡´å­ç±»è¿èƒŒé‡Œå¼æ›¿æ¢åŸåˆ™ã€‚</p>
</li>
<li><p>å­ç±»è¿èƒŒçˆ¶ç±»æ³¨é‡Šä¸­æ‰€ç½—åˆ—çš„ä»»ä½•ç‰¹æ®Šè¯´æ˜</p>
</li>
</ul>
<blockquote>
<p>ğŸ“Œç†è§£LSPï¼Œæœ€æ ¸å¿ƒå°±æ˜¯ç†è§£â€œæŒ‰ç…§åè®®è®¾è®¡â€ï¼Œå³çˆ¶ç±»å®šä¹‰äº†å‡½æ•°çš„â€œåè®®â€ï¼Œé‚£ä¹ˆå­ç±»å¯ä»¥æ”¹å˜å‡½æ•°çš„å†…éƒ¨å®ç°é€»è¾‘ï¼Œä½†ä¸èƒ½æ”¹å˜å‡½æ•°åŸæœ‰çš„â€œåè®®â€ã€‚</p>
</blockquote>
<h2 id="æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface-Segregation-Principleï¼‰"><a href="#æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface-Segregation-Principleï¼‰" class="headerlink" title="æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼‰"></a>æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼‰</h2><p>æ¥å£çš„è°ƒç”¨è€…&#x2F;ä½¿ç”¨è€…ï¼Œä¸åº”è¯¥è¢«å¼ºè¿«å»ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£ã€‚</p>
<p>è¿™é‡Œçš„æ¥å£Interfaceä¸å±€é™äºç¼–ç¨‹è¯­è¨€é‡Œçš„ç±»ä¼¼äºæŠ½è±¡ç±»çš„æ¥å£ï¼Œè€Œæ˜¯å¯ç†è§£ä¸ºï¼š</p>
<ol>
<li><p>ä¸€ç»„APIæ¥å£é›†åˆ</p>
<p>å¦‚æœéƒ¨åˆ†æ¥å£åªè¢«éƒ¨åˆ†è°ƒç”¨è€…ä½¿ç”¨ï¼Œå°±éœ€è¦å°†è¿™éƒ¨åˆ†æ¥å£éš”ç¦»å‡ºæ¥ï¼Œå•ç‹¬ç»™è¿™éƒ¨åˆ†è°ƒç”¨è€…ä½¿ç”¨ï¼Œè€Œä¸å¼ºè¿«å…¶ä»–è°ƒç”¨è€…ä¹Ÿä¾èµ–è¿™éƒ¨åˆ†ä¸ä¼šè¢«ç”¨åˆ°çš„æ¥å£ã€‚</p>
</li>
<li><p>å•ä¸ªAPIæ¥å£æˆ–å‡½æ•°</p>
<p>éƒ¨åˆ†è°ƒç”¨è€…åªéœ€è¦å‡½æ•°ä¸­çš„éƒ¨åˆ†åŠŸèƒ½ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦æŠŠå‡½æ•°æ‹†åˆ†æˆç²’åº¦æ›´ç»†çš„å¤šä¸ªå‡½æ•°ï¼Œè®©è°ƒç”¨è€…åªä¾èµ–å®ƒéœ€è¦çš„é‚£ä¸ªç»†ç²’åº¦å‡½æ•°ã€‚</p>
</li>
<li><p>OOPä¸­çš„æ¥å£æ¦‚å¿µ</p>
<p>æ¥å£çš„è®¾è®¡è¦å°½é‡å•ä¸€ï¼Œä¸è¦è®©æ¥å£çš„å®ç°ç±»å’Œè°ƒç”¨è€…ï¼Œä¾èµ–ä¸éœ€è¦çš„æ¥å£å‡½æ•°ã€‚</p>
</li>
</ol>
<blockquote>
<p>ğŸ“Œå•ä¸€èŒè´£åŸåˆ™é’ˆå¯¹çš„æ˜¯æ¨¡å—ã€ç±»ã€æ¥å£çš„è®¾è®¡ã€‚æ¥å£éš”ç¦»åŸåˆ™ç›¸å¯¹äºå•ä¸€èŒè´£åŸåˆ™ï¼Œä¸€æ–¹é¢æ›´ä¾§é‡äºæ¥å£çš„è®¾è®¡ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿæ˜¯ä¸ºå•ä¸€èŒè´£çš„åˆ¤å®šæä¾›äº†ä¸€ç§æ–°æ€è·¯ã€‚<br>å¯ä»¥é€šè¿‡è°ƒç”¨è€…å¦‚ä½•ä½¿ç”¨æ¥å£æ¥é—´æ¥åˆ¤å®šè®¾è®¡æ˜¯å¦å¤ŸèŒè´£å•ä¸€ã€‚</p>
</blockquote>
<h2 id="ä¾èµ–åè½¬åŸåˆ™ï¼ˆDependency-Inversoin-Principleï¼‰"><a href="#ä¾èµ–åè½¬åŸåˆ™ï¼ˆDependency-Inversoin-Principleï¼‰" class="headerlink" title="ä¾èµ–åè½¬åŸåˆ™ï¼ˆDependency Inversoin Principleï¼‰"></a>ä¾èµ–åè½¬åŸåˆ™ï¼ˆDependency Inversoin Principleï¼‰</h2><p><a href="https://www.cnblogs.com/yyxt/p/5141577.html">https://www.cnblogs.com/yyxt/p/5141577.html</a></p>
<h3 id="ä¾èµ–åè½¬"><a href="#ä¾èµ–åè½¬" class="headerlink" title="ä¾èµ–åè½¬"></a>ä¾èµ–åè½¬</h3><p>åº”ç”¨ç¨‹åºä¾èµ–äºç±»åº“ï¼Œé‚£ä¹ˆä¸€æ—¦ç±»åº“å‘ç”Ÿå˜åŒ–ï¼Œåº”ç”¨ç¨‹åºä¹Ÿè¦ç›¸åº”æ”¹å˜ã€‚ä¸ºäº†ç ´é™¤è¿™ç§ä¾èµ–å…³ç³»ï¼Œå¯ä»¥ä½¿ç”¨ä¾èµ–åè½¬ã€‚</p>
<p>åœ¨ç±»åº“ä¸­æŠ½è±¡å‡ºä¸€ä¸ªæ¥å£ï¼Œå…·ä½“çš„å®ç°ç±»æ´¾ç”Ÿè‡ªæ¥å£ï¼Œåº”ç”¨ç¨‹åºä¹Ÿè°ƒç”¨æ¥å£ï¼Œè¿™æ ·åšï¼š</p>
<ol>
<li><p>åº”ç”¨ç¨‹åºè°ƒç”¨ç±»åº“çš„æŠ½è±¡æ¥å£ï¼Œä¾èµ–äºç±»åº“çš„æŠ½è±¡æ¥å£ï¼›å…·ä½“çš„å®ç°ç±»æ´¾ç”Ÿè‡ªç±»åº“çš„æŠ½è±¡æ¥å£ï¼Œä¹Ÿä¾èµ–äºç±»åº“çš„æŠ½è±¡æ¥å£ã€‚</p>
</li>
<li><p>åº”ç”¨ç¨‹åºå’Œå…·ä½“çš„ç±»åº“å®ç°å®Œå…¨ç‹¬ç«‹ï¼Œç›¸äº’ä¹‹é—´æ²¡æœ‰ç›´æ¥çš„ä¾èµ–å…³ç³»ï¼Œåªè¦ä¿æŒæ¥å£ç±»çš„ç¨³å®šï¼Œåº”ç”¨ç¨‹åºå’Œç±»åº“çš„å…·ä½“å®ç°éƒ½å¯ä»¥ç‹¬ç«‹åœ°å‘ç”Ÿå˜åŒ–ã€‚</p>
</li>
<li><p>ç±»åº“å®Œå…¨å¯ä»¥ç‹¬ç«‹é‡ç”¨ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥å’Œä»»ä½•ä¸€ä¸ªå®ç°äº†ç›¸åŒæŠ½è±¡æ¥å£çš„ç±»åº“ååŒå·¥ä½œã€‚</p>
</li>
</ol>
<p><img src="/design_pattern-image/image_ETQzqXUn8L.png"></p>
<h3 id="æ§åˆ¶åè½¬"><a href="#æ§åˆ¶åè½¬" class="headerlink" title="æ§åˆ¶åè½¬"></a>æ§åˆ¶åè½¬</h3><p>æ¡†æ¶ç³»ç»Ÿä¸ç±»åº“ï¼š</p>
<ul>
<li><p>æ¡†æ¶æ˜¯ä¸€ä¸ªâ€œåŠæˆå“â€çš„åº”ç”¨ç¨‹åºï¼Œè€Œç±»åº“åªåŒ…å«ä¸€ç³»åˆ—å¯è¢«åº”ç”¨ç¨‹åºè°ƒç”¨çš„ç±»ã€‚</p>
</li>
<li><p>ç±»åº“ç»™ç”¨æˆ·æä¾›äº†ä¸€ç³»åˆ—å¯å¤ç”¨çš„ç±»ï¼Œç”¨æˆ·ä½¿ç”¨æ—¶ï¼Œå¯ä»¥åˆ›å»ºè¿™äº›ç±»çš„å®ä¾‹ï¼Œæˆ–è€…ä»è¿™äº›ç±»ä¸­ç»§æ‰¿å‡ºæ–°çš„æ´¾ç”Ÿç±»ï¼Œç„¶åè°ƒç”¨ç±»ä¸­ç›¸åº”çš„åŠŸèƒ½ã€‚åœ¨è¿™è¿‡ç¨‹ä¸­ï¼Œç±»åº“æ€»æ˜¯è¢«åŠ¨åœ°å“åº”ç”¨æˆ·çš„è°ƒç”¨è¯·æ±‚ã€‚</p>
</li>
<li><p>æ¡†æ¶åˆ™ä¼šä¸ºæŸä¸€ç‰¹å®šç›®çš„å®ç°ä¸€ä¸ªåŸºæœ¬çš„ã€å¯æ‰§è¡Œçš„æ¶æ„ã€‚æ¡†æ¶ä¸­å·²ç»åŒ…å«äº†åº”ç”¨ç¨‹åºä»å¯åŠ¨åˆ°è¿è¡Œçš„ä¸»è¦æµç¨‹ï¼Œæµç¨‹ä¸­é‚£äº›æ— æ³•é¢„å…ˆç¡®å®šçš„æ­¥éª¤ç•™ç»™ç”¨æˆ·æ¥å®ç°ã€‚ç¨‹åºè¿è¡Œæ—¶æ¡†æ¶ç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨ç”¨æˆ·å®ç°çš„åŠŸèƒ½ç»„ä»¶ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ¡†æ¶çš„è¡Œä¸ºæ˜¯ä¸»åŠ¨çš„ã€‚</p>
</li>
</ul>
<p>è®¾è®¡æ¡†æ¶æ˜¯æ§åˆ¶åè½¬çš„å…¸å‹åº”ç”¨åœºæ™¯ã€‚ä»¥ä¸€ä¸ªGUIæ¡†æ¶ä¸ºä¾‹ï¼Œæœ€ç®€å•çš„æ–¹å¼å¦‚å·¦å›¾ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡æ¡†æ¶ä¸­çš„CreateWindowå‡½æ•°åˆ›å»ºçª—å£ï¼Œä½†æ˜¯GUIæ¡†æ¶å¹¶ä¸çŸ¥é“çª—å£æ¥æ”¶åˆ°æ¶ˆæ¯ä»¥åè¯¥å¦‚ä½•å¤„ç†ï¼Œæ‰€ä»¥æ¥æ”¶åˆ°æ¶ˆæ¯æ—¶ä¼šè°ƒç”¨åº”ç”¨ç¨‹åºä¸­çš„çª—å£å‡½æ•°ã€‚è€Œè¿™å½¢æˆäº†åŒå‘ä¾èµ–å…³ç³»ã€‚</p>
<p>è¿™ç§åŒå‘ä¾èµ–å…³ç³»ç¼ºé™·è¾ƒä¸¥é‡ï¼šæ¢ä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åºï¼Œç”šè‡³å¯èƒ½éœ€è¦ä¿®æ”¹GUIæ¡†æ¶ã€‚</p>
<p><img src="/design_pattern-image/image_VVVa9OaJk4.png"></p>
<p>ä½¿ç”¨<strong>æ§åˆ¶åè½¬</strong>å¯ä»¥æ¶ˆé™¤è¿™æ ·çš„ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯å°†ä¸»æ§æƒä»åº”ç”¨ç¨‹åºè½¬ç§»åˆ°æ¡†æ¶ã€‚åœ¨è°ƒç”¨CreateWindowæ—¶ï¼Œå…¶æ¥æ”¶ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆå‚æ•°ï¼Œè¯¥å‡½æ•°æŒ‡é’ˆæŒ‡å‘ç”¨æˆ·å®ç°çš„æ¶ˆæ¯å¤„ç†å‡½æ•°ã€‚å› æ­¤ï¼Œå½“GUIæ¡†æ¶æ¥æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œé€šè¿‡è¯¥æŒ‡é’ˆè‡ªåŠ¨å¤„ç†æ¶ˆæ¯ã€‚è¿™å°±æ˜¯<strong>åŠ¨æ€è°ƒç”¨æœºåˆ¶</strong>ï¼Œä¹Ÿè¢«ç§°ä¸º<strong>å›è°ƒå‡½æ•°</strong>ã€‚æ­¤æ—¶æ”¹å˜åº”ç”¨ç¨‹åºï¼Œåªä¼šæ”¹å˜è‡ªå®šä¹‰è¡Œä¸ºï¼ŒGUIæ¡†æ¶æ— éœ€æ›´æ”¹ã€‚</p>
<p><img src="/design_pattern-image/image__fRxSpewKb.png"></p>
<h3 id="ä¾èµ–æ³¨å…¥"><a href="#ä¾èµ–æ³¨å…¥" class="headerlink" title="ä¾èµ–æ³¨å…¥"></a>ä¾èµ–æ³¨å…¥</h3><p>ä¸é€šè¿‡new()çš„æ–¹å¼åœ¨ç±»å†…éƒ¨åˆ›å»ºä¾èµ–ç±»å¯¹è±¡ï¼Œè€Œæ˜¯å°†ä¾èµ–çš„ç±»å¯¹è±¡åœ¨å¤–éƒ¨åˆ›å»ºå¥½ä¹‹åï¼Œé€šè¿‡æ„é€ å‡½æ•°ã€å‡½æ•°å‚æ•°ç­‰æ–¹å¼ä¼ é€’ï¼ˆæˆ–æ³¨å…¥ï¼‰ç»™ç±»ä½¿ç”¨ã€‚</p>
<p>æ¯”å¦‚ä¸Šé¢å®ç°æ§åˆ¶åè½¬çš„æ–¹å¼ï¼šå‘CreateWindowä¸­æ³¨å…¥æ¶ˆæ¯å¤„ç†çš„å‡½æ•°æŒ‡é’ˆï¼Œå°±å¯ä»¥ç†è§£ä¸ºä¸€ç§ç‰¹æ®Šçš„ï¼Œé¢å‘è¿‡ç¨‹çš„ä¾èµ–æ³¨å…¥ã€‚</p>
<blockquote>
<p>ğŸ“Œ<strong>æ§åˆ¶åè½¬</strong>æ˜¯ä¸€ä¸ªæ¯”è¾ƒç¬¼ç»Ÿçš„è®¾è®¡æ€æƒ³ï¼Œå¹¶ä¸æ˜¯ä¸€ç§å…·ä½“çš„å®ç°æ–¹æ³•ï¼Œä¸€èˆ¬ç”¨æ¥æŒ‡å¯¼æ¡†æ¶å±‚é¢çš„è®¾è®¡ã€‚<br><strong>ä¾èµ–æ³¨å…¥</strong>æ˜¯å®ç°æ§åˆ¶åè½¬çš„ä¸€ç§å…·ä½“çš„ç¼–ç æŠ€å·§ã€‚<br><strong>ä¾èµ–åè½¬</strong>ä¹Ÿæ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼ŒæŒ‡å¯¼æ¡†æ¶å±‚é¢çš„è®¾è®¡ã€‚é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—ï¼Œè€Œæ˜¯äºŒè€…å…±åŒä¾èµ–åŒä¸€ä¸ªæŠ½è±¡ã€‚</p>
</blockquote>
<h2 id="KISSåŸåˆ™"><a href="#KISSåŸåˆ™" class="headerlink" title="KISSåŸåˆ™"></a>KISSåŸåˆ™</h2><blockquote>
<p>Keep It Simple and Stupid<br>Keep It Short and Simple<br>Keep It Simple and Straightforward</p>
</blockquote>
<p>å°½é‡æŠŠä»£ç å†™å¾—ç®€å•ï¼Œè™½ç„¶â€œç®€å•â€çš„å®šä¹‰å¾ˆæ¨¡ç³Šã€‚</p>
<ul>
<li><p>ä¸è¦ä½¿ç”¨åŒäº‹å¯èƒ½ä¸æ‡‚çš„æŠ€æœ¯æ¥å®ç°ä»£ç ã€‚</p>
</li>
<li><p>ä¸è¦é‡å¤é€ è½®å­ï¼Œè¦å–„äºä½¿ç”¨å·²ç»æœ‰çš„å·¥å…·ç±»åº“ã€‚</p>
</li>
<li><p>ä¸è¦è¿‡åº¦ä¼˜åŒ–ã€‚ä¸è¦è¿‡åº¦ä½¿ç”¨ä¸€äº›å¥‡æŠ€æ·«å·§ï¼ˆæ¯”å¦‚ï¼Œä½è¿ç®—ä»£æ›¿ç®—æœ¯è¿ç®—ã€å¤æ‚çš„æ¡ä»¶è¯­å¥ä»£æ›¿if-elseã€ä½¿ç”¨ä¸€äº›è¿‡äºåº•å±‚çš„å‡½æ•°ç­‰ï¼‰æ¥ä¼˜åŒ–ä»£ç ï¼Œç‰ºç‰²ä»£ç çš„å¯è¯»æ€§ã€‚</p>
</li>
</ul>
<h3 id="YAGNIåŸåˆ™"><a href="#YAGNIåŸåˆ™" class="headerlink" title="YAGNIåŸåˆ™"></a>YAGNIåŸåˆ™</h3><blockquote>
<p>You Ainâ€™t Gonna Need It</p>
</blockquote>
<p>ä¸è¦å»è®¾è®¡å½“å‰ç”¨ä¸åˆ°çš„åŠŸèƒ½ï¼›ä¸è¦å»ç¼–å†™å½“å‰ç”¨ä¸åˆ°çš„ä»£ç â€”â€”ä¸è¦åšè¿‡åº¦è®¾è®¡ã€‚</p>
<p>æ¯”å¦‚ï¼Œç³»ç»Ÿæš‚æ—¶åªç”¨Rediså­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œä»¥åå¯èƒ½ä¼šç”¨åˆ°zookeeperã€‚æ ¹æ®YAGNIåŸåˆ™ï¼Œåœ¨æœªç”¨åˆ°ZooKeeperä¹‹å‰ï¼Œæ²¡å¿…è¦æå‰ç¼–å†™è¿™éƒ¨åˆ†ä»£ç ã€‚</p>
<p>å†æ¯”å¦‚ï¼Œä¸è¦åœ¨é¡¹ç›®ä¸­æå‰å¼•å…¥ä¸éœ€è¦ä¾èµ–çš„å¼€å‘åŒ…ã€‚</p>
<h2 id="DRYåŸåˆ™ï¼ˆDonâ€™t-Repeat-Yourselfï¼‰"><a href="#DRYåŸåˆ™ï¼ˆDonâ€™t-Repeat-Yourselfï¼‰" class="headerlink" title="DRYåŸåˆ™ï¼ˆDonâ€™t Repeat Yourselfï¼‰"></a>DRYåŸåˆ™ï¼ˆDonâ€™t Repeat Yourselfï¼‰</h2><blockquote>
<p>ä¸è¦å†™é‡å¤çš„ä»£ç </p>
</blockquote>
<p>æœ‰ä¸‰ç§ä»£ç é‡å¤çš„æƒ…å†µï¼šå®ç°é€»è¾‘é‡å¤ã€åŠŸèƒ½è¯­ä¹‰é‡å¤ã€ä»£ç æ‰§è¡Œé‡å¤ã€‚å‡ºç°è¿™ä¸‰ç§æƒ…å†µåï¼Œéœ€è¦å»è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚</p>
<p>ä½†æ˜¯â€œå®ç°é€»è¾‘é‡å¤ï¼ŒåŠŸèƒ½è¯­ä¹‰ä¸é‡å¤çš„ä»£ç â€å¹¶ä¸è¿åDRYåŸåˆ™ã€‚</p>
<h2 id="è¿ªç±³ç‰¹æ³•åˆ™ï¼ˆLaw-of-Demeterï¼‰"><a href="#è¿ªç±³ç‰¹æ³•åˆ™ï¼ˆLaw-of-Demeterï¼‰" class="headerlink" title="è¿ªç±³ç‰¹æ³•åˆ™ï¼ˆLaw of Demeterï¼‰"></a>è¿ªç±³ç‰¹æ³•åˆ™ï¼ˆLaw of Demeterï¼‰</h2><blockquote>
<p>åˆ«åï¼šæœ€å°çŸ¥è¯†åŸåˆ™ï¼ˆThe Least Knowlwdge Principleï¼‰</p>
</blockquote>
<ul>
<li><p>ä½•ä¸ºâ€œé«˜å†…èšã€æ¾è€¦åˆâ€ï¼Ÿ</p>
<ul>
<li><p>é«˜å†…èšï¼š</p>
<p>ç›¸è¿‘çš„åŠŸèƒ½åº”è¯¥æ”¾åˆ°åŒä¸€ä¸ªç±»ä¸­ï¼Œä¸ç›¸è¿‘çš„åŠŸèƒ½ä¸è¦æ”¾åˆ°åŒä¸€ä¸ªç±»ä¸­ã€‚ç›¸è¿‘çš„åŠŸèƒ½å¾€å¾€ä¼šè¢«åŒæ—¶ä¿®æ”¹ï¼Œæ”¾åˆ°åŒä¸€ä¸ªç±»ä¸­ï¼Œä¿®æ”¹ä¼šæ¯”è¾ƒé›†ä¸­ï¼Œä»£ç å®¹æ˜“ç»´æŠ¤ã€‚å•ä¸€èŒè´£åŸåˆ™æ˜¯å®ç°ä»£ç é«˜å†…èšéå¸¸æœ‰æ•ˆçš„è®¾è®¡åŸåˆ™ã€‚</p>
</li>
<li><p>æ¾è€¦åˆï¼š</p>
<p>åœ¨ä»£ç ä¸­ï¼Œç±»ä¸ç±»ä¹‹é—´çš„ä¾èµ–å…³ç³»ç®€å•æ¸…æ™°ã€‚å³ä½¿ä¸¤ä¸ªç±»æœ‰ä¾èµ–å…³ç³»ï¼Œä¸€ä¸ªç±»çš„ä»£ç æ”¹åŠ¨ä¸ä¼šæˆ–è€…å¾ˆå°‘å¯¼è‡´ä¾èµ–ç±»çš„ä»£ç æ”¹åŠ¨ã€‚</p>
<p>ä¾èµ–æ³¨å…¥ã€æ¥å£éš”ç¦»ã€åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹ï¼Œä»¥åŠè¿ªç±³ç‰¹æ³•åˆ™ï¼Œéƒ½æ˜¯ä¸ºäº†å®ç°ä»£ç çš„æ¾è€¦åˆã€‚</p>
</li>
</ul>
</li>
<li><p>æœ€å°çŸ¥è¯†ï¼š</p>
<p>ä¸è¯¥æœ‰ç›´æ¥ä¾èµ–å…³ç³»çš„ç±»ä¹‹é—´ï¼Œä¸è¦æœ‰ä¾èµ–ï¼›æœ‰ä¾èµ–å…³ç³»çš„ç±»ä¹‹é—´ï¼Œå°½é‡åªä¾èµ–å¿…è¦çš„æ¥å£ã€‚è¿ªç±³ç‰¹æ³•åˆ™æ˜¯å¸Œæœ›å‡å°‘ç±»ä¹‹é—´çš„è€¦åˆï¼Œè®©ç±»è¶Šç‹¬ç«‹è¶Šå¥½ã€‚æ¯ä¸ªç±»éƒ½åº”è¯¥å°‘äº†è§£ç³»ç»Ÿçš„å…¶ä»–éƒ¨åˆ†ã€‚ä¸€æ—¦å‘ç”Ÿå˜åŒ–ï¼Œéœ€è¦äº†è§£è¿™ä¸€å˜åŒ–çš„ç±»å°±ä¼šæ¯”è¾ƒå°‘ã€‚</p>
</li>
</ul>
<h1 id="ç¼–ç¨‹è§„èŒƒ"><a href="#ç¼–ç¨‹è§„èŒƒ" class="headerlink" title="ç¼–ç¨‹è§„èŒƒ"></a>ç¼–ç¨‹è§„èŒƒ</h1><h3 id="1-å‘½åçš„é•¿åº¦"><a href="#1-å‘½åçš„é•¿åº¦" class="headerlink" title="1. å‘½åçš„é•¿åº¦"></a>1. å‘½åçš„é•¿åº¦</h3><p>å‘½åä¸€å®šè¦å‡†ç¡®è¾¾æ„ã€‚å¯¹äºä¸€äº›é»˜è®¤çš„ã€å¤§å®¶éƒ½æ¯”è¾ƒç†ŸçŸ¥çš„è¯ï¼Œæ¯”è¾ƒæ¨èç”¨ç¼©å†™ã€‚è¿™æ ·ä¸€æ–¹é¢èƒ½è®©å‘½åçŸ­ä¸€äº›ï¼Œå¦ä¸€æ–¹é¢åˆä¸å½±å“é˜…è¯»ç†è§£ï¼Œæ¯”å¦‚ï¼Œsecè¡¨ç¤ºsecondã€strè¡¨ç¤ºstringã€numè¡¨ç¤ºnumberã€docè¡¨ç¤ºdocumentã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¯¹äºä½œç”¨åŸŸæ¯”è¾ƒå°çš„å˜é‡ï¼Œå¯ä»¥ä½¿ç”¨ç›¸å¯¹çŸ­çš„å‘½åï¼Œæ¯”å¦‚ä¸€äº›å‡½æ•°å†…çš„ä¸´æ—¶å˜é‡ã€‚ç›¸åï¼Œå¯¹äºç±»åè¿™ç§ä½œç”¨åŸŸæ¯”è¾ƒå¤§çš„ï¼Œæ›´æ¨èç”¨é•¿çš„å‘½åæ–¹å¼ã€‚</p>
<h3 id="2-åˆ©ç”¨ä¸Šä¸‹æ–‡ç®€åŒ–å‘½å"><a href="#2-åˆ©ç”¨ä¸Šä¸‹æ–‡ç®€åŒ–å‘½å" class="headerlink" title="2. åˆ©ç”¨ä¸Šä¸‹æ–‡ç®€åŒ–å‘½å"></a>2. åˆ©ç”¨ä¸Šä¸‹æ–‡ç®€åŒ–å‘½å</h3><p>æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼Œæˆå‘˜å˜é‡å’Œæˆå‘˜æ–¹æ³•éƒ½å€ŸåŠ©äº†Userè¿™æ ·çš„ç±»åä¸Šä¸‹æ–‡ï¼Œçœå»äº†å‘½åæ—¶é‡å¤æ·»åŠ å‰ç¼€â€œuserâ€çš„éº»çƒ¦ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  string name;       <span class="comment">//string userName;å€ŸåŠ©Userç±»è¿™ä¸ªä¸Šä¸‹æ–‡</span></span><br><span class="line">  string password;   <span class="comment">//string userPassword;</span></span><br><span class="line">  string avatarUrl;  <span class="comment">//string userAvatarUrl;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function">string <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function">string <span class="title">getPassword</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function">string <span class="title">getAvatarUrl</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  User user = <span class="keyword">new</span> <span class="built_in">User</span>();</span><br><span class="line">  user.<span class="built_in">getName</span>();   <span class="comment">//å€ŸåŠ©userå¯¹è±¡è¿™ä¸ªä¸Šä¸‹æ–‡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-å‘½åè¦å¯è¯»ã€å¯æœç´¢"><a href="#3-å‘½åè¦å¯è¯»ã€å¯æœç´¢" class="headerlink" title="3. å‘½åè¦å¯è¯»ã€å¯æœç´¢"></a>3. å‘½åè¦å¯è¯»ã€å¯æœç´¢</h3><h3 id="4-å‘½åæ¥å£å’ŒæŠ½è±¡ç±»"><a href="#4-å‘½åæ¥å£å’ŒæŠ½è±¡ç±»" class="headerlink" title="4. å‘½åæ¥å£å’ŒæŠ½è±¡ç±»"></a>4. å‘½åæ¥å£å’ŒæŠ½è±¡ç±»</h3><ul>
<li><p>æ¥å£ï¼šæœ‰ä¸¤ç§å¸¸è§çš„æ–¹å¼</p>
<ul>
<li><p>åŠ å‰ç¼€â€œIâ€è¡¨ç¤ºä¸€ä¸ªInterfaceï¼Œæ¯”å¦‚IUserServiceï¼Œå¯¹åº”çš„å®ç°ç±»å‘½åä¸ºUserServiceã€‚</p>
</li>
<li><p>ä¸åŠ å‰ç¼€ï¼Œæ¯”å¦‚UserServiceï¼Œå¯¹åº”çš„å®ç°ç±»åŠ åç¼€â€œImplâ€ï¼Œæ¯”å¦‚UserServiceImplã€‚</p>
</li>
</ul>
</li>
<li><p>æŠ½è±¡ç±»ï¼šæœ‰ä¸¤ç§å¸¸è§çš„æ–¹å¼</p>
<ul>
<li><p>åŠ å‰ç¼€â€œAbstractâ€ï¼Œæ¯”å¦‚AbstractConfigurationã€‚</p>
</li>
<li><p>ä¸å¸¦å‰ç¼€ï¼Œè®©å¯¹åº”ç±»åŠ åç¼€â€œImplâ€æˆ–è€…å…¶ä»–ä¸åŠŸèƒ½ç›¸å…³çš„å‘½åã€‚</p>
</li>
</ul>
</li>
</ul>
<h3 id="5-æ³¨é‡Šå†™ä»€ä¹ˆ"><a href="#5-æ³¨é‡Šå†™ä»€ä¹ˆ" class="headerlink" title="5. æ³¨é‡Šå†™ä»€ä¹ˆ"></a>5. æ³¨é‡Šå†™ä»€ä¹ˆ</h3><p>æ³¨é‡Šçš„å†…å®¹ä¸»è¦éœ€è¦åŒ…å«ä¸‰æ–¹é¢ï¼šåšä»€ä¹ˆã€ä¸ºä»€ä¹ˆã€æ€ä¹ˆåšã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* (what) Bean factory to create beans. </span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* (why) The class likes Spring IOC framework, but is more lightweight. </span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* (how) Create objects from different sources sequentially:</span></span><br><span class="line"><span class="comment">* user specified object &gt; SPI &gt; configuration &gt; default object.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BeansFactory</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-æ³¨é‡Šçš„å¤šå°‘"><a href="#6-æ³¨é‡Šçš„å¤šå°‘" class="headerlink" title="6. æ³¨é‡Šçš„å¤šå°‘"></a>6. æ³¨é‡Šçš„å¤šå°‘</h3><p>ç±»å’Œå‡½æ•°ä¸€å®šè¦å†™æ³¨é‡Šï¼Œè€Œä¸”è¦å†™å¾—å°½å¯èƒ½å…¨é¢ã€è¯¦ç»†ï¼Œè€Œå‡½æ•°å†…éƒ¨çš„æ³¨é‡Šè¦ç›¸å¯¹å°‘ä¸€äº›ã€‚ä¸€èˆ¬éƒ½æ˜¯é å¥½çš„å‘½åã€æç‚¼å‡½æ•°ã€è§£é‡Šæ€§å˜é‡ã€æ€»ç»“æ€§æ³¨é‡Šæ¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€‚</p>
<h3 id="7-ç±»ã€å‡½æ•°å¤šå¤§æ‰åˆé€‚"><a href="#7-ç±»ã€å‡½æ•°å¤šå¤§æ‰åˆé€‚" class="headerlink" title="7. ç±»ã€å‡½æ•°å¤šå¤§æ‰åˆé€‚"></a>7. ç±»ã€å‡½æ•°å¤šå¤§æ‰åˆé€‚</h3><p>äº‹å®ä¸Šå¾ˆéš¾ç•Œå®šï¼Œå¤ªå¤šæˆ–å¤ªå°‘éƒ½ä¸åˆé€‚ã€‚</p>
<ul>
<li><p>å‡½æ•°ï¼šæœ‰ä¸€ç§è¯´æ³•æ˜¯å‡½æ•°ä»£ç çš„è¡Œæ•°ï¼Œæœ€å¥½ä¸è¦è¶…è¿‡ä¸€ä¸ªæ˜¾ç¤ºå±çš„å‚ç›´é«˜åº¦ã€‚</p>
</li>
<li><p>ç±»ï¼šä¸»è¦ä¸»è§‚æ¥åˆ¤æ–­ï¼Œå½“ä¸€ä¸ªç±»çš„ä»£ç è¯»èµ·æ¥è®©ä½ æ„Ÿè§‰å¤´å¤§äº†ï¼Œå®ç°æŸä¸ªåŠŸèƒ½æ—¶ä¸çŸ¥é“è¯¥ç”¨å“ªä¸ªå‡½æ•°äº†ï¼Œæƒ³ç”¨å“ªä¸ªå‡½æ•°ç¿»åŠå¤©éƒ½æ‰¾ä¸åˆ°äº†ï¼Œåªç”¨åˆ°ä¸€ä¸ªå°åŠŸèƒ½è¦å¼•å…¥æ•´ä¸ªç±»ï¼ˆç±»ä¸­åŒ…å«å¾ˆå¤šæ— å…³æ­¤åŠŸèƒ½å®ç°çš„å‡½æ•°ï¼‰çš„æ—¶å€™ï¼Œè¿™å°±è¯´æ˜ç±»çš„è¡Œæ•°è¿‡å¤šäº†</p>
</li>
</ul>
<h3 id="8-ä¸€è¡Œä»£ç å¤šé•¿æœ€åˆé€‚"><a href="#8-ä¸€è¡Œä»£ç å¤šé•¿æœ€åˆé€‚" class="headerlink" title="8. ä¸€è¡Œä»£ç å¤šé•¿æœ€åˆé€‚"></a>8. ä¸€è¡Œä»£ç å¤šé•¿æœ€åˆé€‚</h3><p>Google Java Style Guideæ–‡æ¡£ä¸­ï¼Œä¸€è¡Œä»£ç æœ€é•¿é™åˆ¶ä¸º100ä¸ªå­—ç¬¦ã€‚éµå¾ªçš„åŸåˆ™æ˜¯ï¼šæœ€é•¿æœ€å¥½ä¸è¦è¶…è¿‡IDEæ˜¾ç¤ºçš„å®½åº¦ã€‚</p>
<h3 id="9-å–„ç”¨ç©ºè¡Œåˆ†å‰²å•å…ƒå—"><a href="#9-å–„ç”¨ç©ºè¡Œåˆ†å‰²å•å…ƒå—" class="headerlink" title="9. å–„ç”¨ç©ºè¡Œåˆ†å‰²å•å…ƒå—"></a>9. å–„ç”¨ç©ºè¡Œåˆ†å‰²å•å…ƒå—</h3><p>å¯¹äºæ¯”è¾ƒé•¿çš„å‡½æ•°ï¼Œå¦‚æœé€»è¾‘ä¸Šå¯ä»¥åˆ†ä¸ºå‡ ä¸ªç‹¬ç«‹çš„ä»£ç å—ï¼Œåœ¨ä¸æ–¹ä¾¿å°†è¿™äº›ç‹¬ç«‹çš„ä»£ç å—æŠ½å–æˆå°å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œä½¿å¾—é€»è¾‘æ›´åŠ æ¸…æ™°ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨ç±»çš„æˆå‘˜å˜é‡ä¸å‡½æ•°ä¹‹é—´ã€é™æ€æˆå‘˜å˜é‡ä¸æ™®é€šæˆå‘˜å˜é‡ä¹‹é—´ã€å„å‡½æ•°ä¹‹é—´ã€ç”šè‡³å„æˆå‘˜å˜é‡ä¹‹é—´ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥é€šè¿‡æ·»åŠ ç©ºè¡Œçš„æ–¹å¼ï¼Œè®©è¿™äº›ä¸åŒæ¨¡å—çš„ä»£ç ä¹‹é—´ï¼Œç•Œé™æ›´åŠ æ˜ç¡®ã€‚</p>
<h3 id="10-å››æ ¼ç¼©è¿›è¿˜æ˜¯ä¸¤æ ¼ç¼©è¿›"><a href="#10-å››æ ¼ç¼©è¿›è¿˜æ˜¯ä¸¤æ ¼ç¼©è¿›" class="headerlink" title="10. å››æ ¼ç¼©è¿›è¿˜æ˜¯ä¸¤æ ¼ç¼©è¿›"></a>10. å››æ ¼ç¼©è¿›è¿˜æ˜¯ä¸¤æ ¼ç¼©è¿›</h3><p>ä¸å›ºå®šï¼Œæœ€å¥½å’Œä¸šå†…æ¨èçš„é£æ ¼ç»Ÿä¸€ã€è·Ÿè‘—åå¼€æºé¡¹ç›®ç»Ÿä¸€ã€‚</p>
<p>ç¼©è¿›æ—¶å°½é‡åˆ«ç”¨tabé”®ã€‚å› ä¸ºåœ¨ä¸åŒçš„IDEä¸‹ï¼Œtabé”®çš„æ˜¾ç¤ºå®½åº¦ä¸åŒï¼Œæœ‰çš„æ˜¾ç¤ºä¸ºå››æ ¼ç¼©è¿›ï¼Œæœ‰çš„æ˜¾ç¤ºä¸ºä¸¤æ ¼ç¼©è¿›ã€‚å¦‚æœåœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œä¸åŒçš„åŒäº‹ä½¿ç”¨ä¸åŒçš„ç¼©è¿›æ–¹å¼ï¼ˆç©ºæ ¼ç¼©è¿›æˆ–tabé”®ç¼©è¿›ï¼‰ï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´æœ‰çš„ä»£ç æ˜¾ç¤ºä¸ºä¸¤æ ¼ç¼©è¿›ã€æœ‰çš„ä»£ç æ˜¾ç¤ºä¸ºå››æ ¼ç¼©è¿›ã€‚</p>
<h3 id="11-å¤§æ‹¬å·æ˜¯å¦è¦å¦èµ·ä¸€è¡Œ"><a href="#11-å¤§æ‹¬å·æ˜¯å¦è¦å¦èµ·ä¸€è¡Œ" class="headerlink" title="11. å¤§æ‹¬å·æ˜¯å¦è¦å¦èµ·ä¸€è¡Œ"></a>11. å¤§æ‹¬å·æ˜¯å¦è¦å¦èµ·ä¸€è¡Œ</h3><p>åªè¦å›¢é˜Ÿç»Ÿä¸€ã€ä¸šå†…ç»Ÿä¸€ã€è·Ÿå¼€æºé¡¹ç›®çœ‹é½å°±å¥½äº†ï¼Œæ²¡æœ‰ç»å¯¹çš„ä¼˜åŠ£ä¹‹åˆ†ã€‚</p>
<h3 id="12-æŠŠä»£ç åˆ†å‰²æˆæ›´å°çš„å•å…ƒå—"><a href="#12-æŠŠä»£ç åˆ†å‰²æˆæ›´å°çš„å•å…ƒå—" class="headerlink" title="12. æŠŠä»£ç åˆ†å‰²æˆæ›´å°çš„å•å…ƒå—"></a>12. æŠŠä»£ç åˆ†å‰²æˆæ›´å°çš„å•å…ƒå—</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é‡æ„å‰çš„ä»£ç </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invest</span><span class="params">(<span class="type">long</span> userId, <span class="type">long</span> financialProductId)</span> &#123;</span><br><span class="line">  <span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">  calendar.setTime(date);</span><br><span class="line">  calendar.set(Calendar.DATE, (calendar.get(Calendar.DATE) + <span class="number">1</span>));</span><br><span class="line">  <span class="keyword">if</span> (calendar.get(Calendar.DAY_OF_MONTH) == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡æ„åçš„ä»£ç ï¼šæç‚¼å‡½æ•°ä¹‹åé€»è¾‘æ›´åŠ æ¸…æ™°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invest</span><span class="params">(<span class="type">long</span> userId, <span class="type">long</span> financialProductId)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (isLastDayOfMonth(<span class="keyword">new</span> <span class="title class_">Date</span>())) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isLastDayOfMonth</span><span class="params">(Date date)</span> &#123;</span><br><span class="line">  <span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">  calendar.setTime(date);</span><br><span class="line">  calendar.set(Calendar.DATE, (calendar.get(Calendar.DATE) + <span class="number">1</span>));</span><br><span class="line">  <span class="keyword">if</span> (calendar.get(Calendar.DAY_OF_MONTH) == <span class="number">1</span>) &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="13-é¿å…å‡½æ•°å‚æ•°è¿‡å¤š"><a href="#13-é¿å…å‡½æ•°å‚æ•°è¿‡å¤š" class="headerlink" title="13. é¿å…å‡½æ•°å‚æ•°è¿‡å¤š"></a>13. é¿å…å‡½æ•°å‚æ•°è¿‡å¤š</h3><p>å‡½æ•°åŒ…å«3ã€4ä¸ªå‚æ•°çš„æ—¶å€™è¿˜æ˜¯èƒ½æ¥å—çš„ï¼Œå¤§äºç­‰äº5ä¸ªçš„æ—¶å€™ï¼Œä¼šè®¤ä¸ºå‚æ•°æœ‰ç‚¹å¤šäº†ï¼Œå½±å“ä»£ç çš„å¯è¯»æ€§ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿä¸æ–¹ä¾¿ã€‚é’ˆå¯¹å‚æ•°è¿‡å¤šï¼Œä¸€èˆ¬æœ‰2ç§å¤„ç†æ–¹æ³•ï¼š</p>
<ul>
<li><p>è€ƒè™‘å‡½æ•°æ˜¯å¦èŒè´£å•ä¸€ï¼Œæ˜¯å¦èƒ½é€šè¿‡æ‹†åˆ†æˆå¤šä¸ªå‡½æ•°çš„æ–¹å¼æ¥å‡å°‘å‚æ•°ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">User <span class="title">getUser</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‹†åˆ†æˆå¤šä¸ªå‡½æ•°</span></span><br><span class="line"><span class="function">User <span class="title">getUserByUsername</span><span class="params">(string username)</span></span>;</span><br><span class="line"><span class="function">User <span class="title">getUserByTelephone</span><span class="params">(string telephone)</span></span>;</span><br><span class="line"><span class="function">User <span class="title">getUserByEmail</span><span class="params">(string email)</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å°†å‡½æ•°çš„å‚æ•°å°è£…æˆå¯¹è±¡ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">postBlog</span><span class="params">(string title, string summary, string keywords, string content, string category, <span class="type">long</span> authorId)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°†å‚æ•°å°è£…æˆå¯¹è±¡</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Blog</span>&#123;</span><br><span class="line">  string title;</span><br><span class="line">  string summary;</span><br><span class="line">  string keywords;</span><br><span class="line">  string content;</span><br><span class="line">  string category;</span><br><span class="line">  <span class="type">long</span> authorId;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">postBlog</span><span class="params">(Blog blog)</span></span>;</span><br></pre></td></tr></table></figure>

<p>å‡½æ•°å‚æ•°å°è£…æˆå¯¹è±¡è¿˜å¯ä»¥å¸¦æ¥ä¸€ä¸ªå¥½å¤„ï¼šå¦‚æœå‡½æ•°æ˜¯å¯¹å¤–æš´éœ²çš„æŠ½è±¡æ¥å£ï¼Œå°†å‚æ•°å°è£…æˆå¯¹è±¡ï¼Œå¯ä»¥æé«˜æ¥å£çš„å…¼å®¹æ€§ã€‚å½“æœ‰éœ€è¦å¾€æ¥å£ä¸­æ·»åŠ æ–°çš„å‚æ•°æ—¶ï¼Œè€çš„æ¥å£è°ƒç”¨è€…å°±ä¸éœ€è¦ä¿®æ”¹ä»£ç æ¥å…¼å®¹æ–°çš„æ¥å£äº†ã€‚</p>
</li>
</ul>
<h3 id="14-å‹¿ç”¨å‡½æ•°å‚æ•°æ¥æ§åˆ¶é€»è¾‘"><a href="#14-å‹¿ç”¨å‡½æ•°å‚æ•°æ¥æ§åˆ¶é€»è¾‘" class="headerlink" title="14. å‹¿ç”¨å‡½æ•°å‚æ•°æ¥æ§åˆ¶é€»è¾‘"></a>14. å‹¿ç”¨å‡½æ•°å‚æ•°æ¥æ§åˆ¶é€»è¾‘</h3><ul>
<li><p>å‡½æ•°å‚æ•°ä¸ºå¸ƒå°”ç±»å‹ï¼Œæ§åˆ¶äº†å†…éƒ¨é€»è¾‘ï¼Œtrueçš„æ—¶å€™èµ°è¿™å—é€»è¾‘ï¼Œfalseçš„æ—¶å€™èµ°å¦ä¸€å—é€»è¾‘ã€‚è¿™è¿èƒŒäº†å•ä¸€èŒè´£åŸåˆ™å’Œæ¥å£éš”ç¦»åŸåˆ™ï¼Œå› æ­¤å»ºè®®æ‹†åˆ†æˆä¸¤ä¸ªå‡½æ•°ï¼Œå¯è¯»æ€§ä¸Šä¹Ÿè¦æ›´å¥½ã€‚</p>
</li>
<li><p>ä¸Šé¢è¿™æ¡å¹¶ä¸æ˜¯å¿…é¡»è¦éµå®ˆçš„ã€‚å¦‚æœå‡½æ•°æ˜¯privateç§æœ‰å‡½æ•°ï¼Œå½±å“èŒƒå›´æœ‰é™ï¼Œæˆ–è€…æ‹†åˆ†åçš„ä¸¤å‡½æ•°ç»å¸¸è¢«åŒæ—¶è°ƒç”¨ï¼Œå¯ä»¥é…Œæƒ…è€ƒè™‘ä¿ç•™è¯¥æ ‡è¯†å‚æ•°ã€‚</p>
</li>
<li><p>æœ‰ä¸€ç§â€œæ ¹æ®å‚æ•°æ˜¯å¦ä¸ºnullâ€æ¥æ§åˆ¶é€»è¾‘çš„æƒ…å†µã€‚å’Œå¸ƒå°”ç±»å‹ç±»ä¼¼ï¼Œæœ‰è¯¥å‚æ•°çš„å‡½æ•°ä¹Ÿå¯ä»¥é€šè¿‡åˆ¤æ–­æ¡ä»¶è¿›è¡Œå‡½æ•°æ‹†åˆ†ã€‚</p>
</li>
</ul>
<h3 id="15-å‡½æ•°è®¾è®¡è¦èŒè´£å•ä¸€"><a href="#15-å‡½æ•°è®¾è®¡è¦èŒè´£å•ä¸€" class="headerlink" title="15. å‡½æ•°è®¾è®¡è¦èŒè´£å•ä¸€"></a>15. å‡½æ•°è®¾è®¡è¦èŒè´£å•ä¸€</h3><p>å‡½æ•°å’Œç±»çš„è®¾è®¡å‡è¦æ»¡è¶³å•ä¸€èŒè´£åŸåˆ™ã€‚</p>
<h3 id="16-ç§»é™¤è¿‡æ·±çš„åµŒå¥—å±‚æ¬¡"><a href="#16-ç§»é™¤è¿‡æ·±çš„åµŒå¥—å±‚æ¬¡" class="headerlink" title="16. ç§»é™¤è¿‡æ·±çš„åµŒå¥—å±‚æ¬¡"></a>16. ç§»é™¤è¿‡æ·±çš„åµŒå¥—å±‚æ¬¡</h3><p>ä»£ç åµŒå¥—å±‚æ¬¡è¿‡æ·±å¾€å¾€æ˜¯å› ä¸ºif-elseã€switch-caseã€forå¾ªç¯è¿‡åº¦åµŒå¥—å¯¼è‡´çš„ï¼Œå»ºè®®åµŒå¥—ä¸è¶…è¿‡ä¸¤å±‚ã€‚</p>
<p>æœ‰ä¸‹é¢4ç§å¸¸è§çš„è§£å†³åµŒå¥—è¿‡æ·±çš„æ€è·¯ï¼š</p>
<ul>
<li><p>å»æ‰å¤šä½™çš„ifæˆ–elseè¯­å¥</p>
</li>
<li><p>ä½¿ç”¨continueã€breakã€returnå…³é”®å­—ï¼Œæå‰é€€å‡ºåµŒå¥—</p>
</li>
<li><p>è°ƒæ•´æ‰§è¡Œé¡ºåºæ¥å‡å°‘åµŒå¥—</p>
</li>
<li><p>å°†éƒ¨åˆ†åµŒå¥—é€»è¾‘å°è£…æˆå‡½æ•°è°ƒç”¨ï¼Œä»¥æ­¤æ¥å‡å°‘åµŒå¥—</p>
</li>
</ul>
<h3 id="17-å­¦ä¼šä½¿ç”¨è§£é‡Šæ€§å˜é‡"><a href="#17-å­¦ä¼šä½¿ç”¨è§£é‡Šæ€§å˜é‡" class="headerlink" title="17. å­¦ä¼šä½¿ç”¨è§£é‡Šæ€§å˜é‡"></a>17. å­¦ä¼šä½¿ç”¨è§£é‡Šæ€§å˜é‡</h3><p>å¸¸ç”¨çš„ç”¨è§£é‡Šæ€§å˜é‡æ¥æé«˜ä»£ç å¯è¯»æ€§çš„æƒ…å†µæœ‰ä¸‹é¢ 2ç§ï¼š</p>
<ul>
<li><p>å¸¸é‡å–ä»£é­”æ³•æ•°å­—ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">double</span> <span class="title function_">CalculateCircularArea</span><span class="params">(<span class="type">double</span> radius)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="number">3.1415</span>) * radius * radius;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>è§£é‡Šæ€§å˜é‡æ¥è§£é‡Šå¤æ‚è¡¨è¾¾å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">const <span class="type">double</span> <span class="variable">PI</span> <span class="operator">=</span> <span class="number">3.1415</span>;</span><br><span class="line"><span class="type">double</span> <span class="title function_">CalculateCircularArea</span><span class="params">(<span class="type">double</span> radius)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> PI * radius * radius;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="GoFâ€”â€”23ç§è®¾è®¡æ¨¡å¼"><a href="#GoFâ€”â€”23ç§è®¾è®¡æ¨¡å¼" class="headerlink" title="GoFâ€”â€”23ç§è®¾è®¡æ¨¡å¼"></a>GoFâ€”â€”23ç§è®¾è®¡æ¨¡å¼</h1><p><img src="/design_pattern-image/image_wZCYDEcI8Y.png"></p>
<ul>
<li><p>åˆ›å»ºå‹æ¨¡å¼ï¼šç”¨äºæè¿°â€œæ€æ ·åˆ›å»ºå¯¹è±¡â€ï¼Œå…¶ä¸»è¦ç‰¹ç‚¹æ˜¯â€œå°†å¯¹è±¡çš„åˆ›å»ºä¸ä½¿ç”¨åˆ†ç¦»â€ã€‚</p>
</li>
<li><p>ç»“æ„å‹æ¨¡å¼ï¼šç”¨äºæè¿°å¦‚ä½•å°†ç±»æˆ–å¯¹è±¡æŒ‰æŸç§å¸ƒå±€ç»„æˆæ›´å¤§çš„ç»“æ„ã€‚</p>
</li>
<li><p>è¡Œä¸ºå‹æ¨¡å¼ï¼šç”¨äºæè¿°ç±»æˆ–å¯¹è±¡ä¹‹é—´æ€æ ·ç›¸äº’åä½œå…±åŒå®Œæˆå•ä¸ªå¯¹è±¡éƒ½æ— æ³•å•ç‹¬å®Œæˆçš„ä»»åŠ¡ï¼Œä»¥åŠæ€æ ·åˆ†é…èŒè´£ã€‚</p>
</li>
</ul>
<h2 id="åˆ›å»ºå‹"><a href="#åˆ›å»ºå‹" class="headerlink" title="åˆ›å»ºå‹"></a>åˆ›å»ºå‹</h2><blockquote>
<p>ğŸ“Œå·¥å‚(5) &gt; å•ä¾‹(4) &gt; åŸå‹(3) &gt; å»ºé€ è€…(2)</p>
</blockquote>
<h3 id="1-å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰"><a href="#1-å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰" class="headerlink" title="1 å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰"></a>1 å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰</h3><p>å•ä¾‹æ¨¡å¼è¡¨ç¤ºä¸€ä¸ªç±»åªä¼šæœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œå½“ç¨‹åºæƒ³åˆ›å»ºæ–°çš„å¯¹è±¡æ—¶ï¼Œåˆ›å»ºçš„æ–°å¯¹è±¡å…¶å®å’Œä¹‹å‰åˆ›å»ºçš„å¯¹è±¡åœ¨ä¸€ä¸ªåœ°å€ï¼Œå³åä¹‰ä¸Šçš„å¤šä¸ªå¯¹è±¡å®é™…åªæœ‰ä¸€ä¸ªã€‚å•ä¾‹æ¨¡å¼åˆ†ä¸ºæ‡’æ±‰å¼å’Œé¥¿æ±‰å¼ä¸¤ç§ï¼š</p>
<ul>
<li><p>æ‡’æ±‰å¼ï¼šç±»åŠ è½½æ—¶æ²¡æœ‰ç”Ÿæˆå•ä¾‹ã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨getInstanceæ–¹æ³•æ—¶æ‰å»åˆ›å»ºï¼›</p>
</li>
<li><p>é¥¿æ±‰å¼ï¼šç±»ä¸€æ—¦åŠ è½½å°±åˆ›å»ºä¸€ä¸ªå•ä¾‹ï¼Œç›¸æ¯”äºæ‡’æ±‰å¼æ›´åŠ çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯ä¹Ÿä¼šä¸¢å¤±å»¶è¿Ÿå®ä¾‹åŒ–æ‰€å¸¦æ¥çš„èŠ‚çº¦èµ„æºçš„å¥½å¤„ã€‚</p>
</li>
</ul>
<h4 id="æ ˆä¸Šå•ä¾‹ï¼ˆæ‡’æ±‰å¼ï¼‰"><a href="#æ ˆä¸Šå•ä¾‹ï¼ˆæ‡’æ±‰å¼ï¼‰" class="headerlink" title="æ ˆä¸Šå•ä¾‹ï¼ˆæ‡’æ±‰å¼ï¼‰"></a>æ ˆä¸Šå•ä¾‹ï¼ˆæ‡’æ±‰å¼ï¼‰</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  ~<span class="built_in">Singleton</span>()&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;~Singleton() destruct&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">static</span> Singleton&amp; <span class="title">CreateObject</span><span class="params">()</span></span>&#123; <span class="comment">//ç”¨æˆ·åªèƒ½é€šè¿‡æ­¤å‡½æ•°æ„é€ å¯¹è±¡</span></span><br><span class="line">    <span class="type">static</span> Singleton obj;           <span class="comment">//é™æ€ä»¥å•ä¾‹</span></span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">Singleton</span>(Singleton&amp; obj) = <span class="keyword">delete</span>;             <span class="comment">//ç¦ç”¨æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">  Singleton* <span class="keyword">operator</span>= (Singleton&amp; obj) = <span class="keyword">delete</span>; <span class="comment">//ç¦ç”¨æ‹·è´æ„é€ å‡½æ•°ï¼Œä¸ä¸Šä¸€è¡ŒäºŒè€…æ‹©ä¸€</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="built_in">Singleton</span>() &#123;                     <span class="comment">//å°é—­æ„é€ å‡½æ•°ï¼Œä¸è®©ç”¨æˆ·æœ‰æ¥è§¦åˆ°æ„é€ å‡½æ•°çš„æœºä¼š</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Singleton() construct&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Singleton&amp; pObj1 = Singleton::<span class="built_in">CreateObject</span>();</span><br><span class="line">  Singleton&amp; pObj2 = Singleton::<span class="built_in">CreateObject</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>CreateObjectæ˜¯staticå‡½æ•°ï¼š</p>
<p>é¿å¼€æ— å¯¹è±¡æ—¶æ²¡æ³•è°ƒç”¨æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡çš„æ­»ç»“ï¼Œç›´æ¥ç”¨é™æ€å‡½æ•°æ„é€ å¯¹è±¡</p>
</li>
<li><p>CreateObjectè¿”å›çš„æ˜¯å¼•ç”¨è€Œä¸æ˜¯æŒ‡é’ˆï¼š</p>
<p>è™½è¯´ä¹Ÿå¯ä»¥ç”¨æŒ‡é’ˆ</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> Singleton* m_pObject = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="function"><span class="type">static</span> Singleton* <span class="title">CreateObject</span><span class="params">()</span></span>&#123; <span class="comment">//ç”¨æˆ·åªèƒ½é€šè¿‡æ­¤å‡½æ•°æ„é€ å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">if</span>(m_pObject == <span class="literal">nullptr</span>)&#123;</span><br><span class="line">      m_pObject = <span class="keyword">new</span> <span class="built_in">Singleton</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> m_pObject;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†è¿™ä¹ˆå†™å­˜åœ¨çš„é—®é¢˜æ˜¯ï¼Œå› ä¸ºæ˜¯æŒ‡é’ˆï¼Œå› ä¸ºç”¨äº†newï¼Œæ‰€ä»¥å¯èƒ½å­˜åœ¨å†…å­˜æ³„éœ²é—®é¢˜ã€‚å³ä½¿ç”¨æˆ·å¯ä»¥åœ¨mainå‡½æ•°é‡Œ<code>delete pObj1</code>ï¼Œè€Œä¸”ç¼–è¯‘ä¸ä¼šæŠ¥é”™ï¼Œä½†æ­¤æ—¶Singletonä¸å†æ˜¯çº¿ç¨‹å®‰å…¨çš„äº†ã€‚</p>
</li>
<li><p>ç¦ç”¨æ‹·è´æ„é€ å‡½æ•°ï¼š</p>
<p>ä¼ å›çš„æ˜¯å¼•ç”¨ï¼Œä½†è‹¥å…è®¸æ‹·è´æ„é€ å‡½æ•°ï¼Œè¿™ä¹ˆå†™æ—¶ä»ä¸ä¼šæŠ¥é”™</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">Singleton pObj2 = Singleton::<span class="built_in">CreateObject</span>();</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶çš„pObj2æ˜¯é€šè¿‡æ‹·è´æ„é€ å‡½æ•°ï¼Œæ–°åˆ›å»ºçš„Singletonå¯¹è±¡ï¼Œå¹¶æŠŠobjçš„å†…å®¹æ‹·è´äº†è¿‡æ¥ã€‚é‚£ä¹ˆæ­¤æ—¶pObj2å’ŒpObj1çš„åœ°å€ä¸å†ç›¸åŒï¼ŒäºŒè€…æˆä¸ºäº†ä¸¤ä¸ªå¯¹è±¡ï¼Œæ‰“ç ´äº†å•ä¾‹æ¨¡å¼ã€‚</p>
<p>å› æ­¤ï¼Œæ­¤å¤„ç¦ç”¨æ‹·è´æ„é€ ï¼Œå¼ºè¿«ç”¨æˆ·å¿…é¡»ç”¨å¼•ç”¨æ¥æ¥å¯¹è±¡ã€‚</p>
</li>
</ul>
<h4 id="å †ä¸Šå•ä¾‹ï¼ˆæ‡’æ±‰å¼ï¼‰"><a href="#å †ä¸Šå•ä¾‹ï¼ˆæ‡’æ±‰å¼ï¼‰" class="headerlink" title="å †ä¸Šå•ä¾‹ï¼ˆæ‡’æ±‰å¼ï¼‰"></a>å †ä¸Šå•ä¾‹ï¼ˆæ‡’æ±‰å¼ï¼‰</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">Singleton</span>();</span><br><span class="line">    <span class="built_in">Singleton</span>(<span class="type">const</span> Singleton&amp; other);</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> Singleton* <span class="title">getInstance</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="type">static</span> Singleton* m_instance;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Singleton* Singleton::m_instance=<span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//çº¿ç¨‹éå®‰å…¨ç‰ˆæœ¬</span></span><br><span class="line"><span class="function">Singleton* <span class="title">Singleton::getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (m_instance == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        m_instance = <span class="keyword">new</span> <span class="built_in">Singleton</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> m_instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬ï¼Œä½†é”çš„ä»£ä»·è¿‡é«˜</span></span><br><span class="line"><span class="function">Singleton* <span class="title">Singleton::getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Lock lock;</span><br><span class="line">    <span class="keyword">if</span> (m_instance == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        m_instance = <span class="keyword">new</span> <span class="built_in">Singleton</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> m_instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åŒæ£€æŸ¥é”ï¼Œä½†ç”±äºå†…å­˜è¯»å†™reorderä¸å®‰å…¨ï¼ˆç¼–è¯‘å™¨ä¼˜åŒ–æ—¶å¯èƒ½æŠŠç¬¬äºŒä¸ªæ£€æŸ¥ä¼˜åŒ–æ‰ï¼‰</span></span><br><span class="line"><span class="function">Singleton* <span class="title">Singleton::getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(m_instance==<span class="literal">nullptr</span>)&#123;</span><br><span class="line">        Lock lock;</span><br><span class="line">        <span class="keyword">if</span> (m_instance == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            m_instance = <span class="keyword">new</span> <span class="built_in">Singleton</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> m_instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//C++ 11ç‰ˆæœ¬ä¹‹åçš„è·¨å¹³å°å®ç° (volatile)</span></span><br><span class="line">std::atomic&lt;Singleton*&gt; Singleton::m_instance;</span><br><span class="line">std::mutex Singleton::m_mutex;</span><br><span class="line"></span><br><span class="line"><span class="function">Singleton* <span class="title">Singleton::getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Singleton* tmp = m_instance.<span class="built_in">load</span>(std::memory_order_relaxed);</span><br><span class="line">    std::<span class="built_in">atomic_thread_fence</span>(std::memory_order_acquire);<span class="comment">//è·å–å†…å­˜fence</span></span><br><span class="line">    <span class="keyword">if</span> (tmp == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(m_mutex)</span></span>;</span><br><span class="line">        tmp = m_instance.<span class="built_in">load</span>(std::memory_order_relaxed);</span><br><span class="line">        <span class="keyword">if</span> (tmp == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            tmp = <span class="keyword">new</span> Singleton;</span><br><span class="line">            std::<span class="built_in">atomic_thread_fence</span>(std::memory_order_release);<span class="comment">//é‡Šæ”¾å†…å­˜fence</span></span><br><span class="line">            m_instance.<span class="built_in">store</span>(tmp, std::memory_order_relaxed);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å †ä¸Šå•ä¾‹ï¼ˆé¥¿æ±‰å¼ï¼‰"><a href="#å †ä¸Šå•ä¾‹ï¼ˆé¥¿æ±‰å¼ï¼‰" class="headerlink" title="å †ä¸Šå•ä¾‹ï¼ˆé¥¿æ±‰å¼ï¼‰"></a>å †ä¸Šå•ä¾‹ï¼ˆé¥¿æ±‰å¼ï¼‰</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">namespace</span> singleton &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">HungrySingleton</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">      <span class="function">HungrySingleton* <span class="title">getInstance</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> instance_; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">      <span class="built_in">HungrySingleton</span>() &#123;&#125;</span><br><span class="line">      <span class="type">static</span> HungrySingleton* instance_;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  HungrySingleton* HungrySingleton::instance_ = <span class="keyword">new</span> <span class="built_in">HungrySingleton</span>();</span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">// namespace singleton</span></span><br></pre></td></tr></table></figure>

<h3 id="2-å·¥å‚æ¨¡å¼ï¼ˆFactoryï¼‰"><a href="#2-å·¥å‚æ¨¡å¼ï¼ˆFactoryï¼‰" class="headerlink" title="2 å·¥å‚æ¨¡å¼ï¼ˆFactoryï¼‰"></a>2 å·¥å‚æ¨¡å¼ï¼ˆFactoryï¼‰</h3><blockquote>
<p>å·¥å‚æ¨¡å¼ä¸­ï¼Œåˆ›å»ºå¯¹è±¡æ—¶ä¸ä¼šå¯¹å®¢æˆ·ç«¯æš´éœ²åˆ›å»ºé€»è¾‘ï¼Œè€Œæ˜¯é€šè¿‡ä½¿ç”¨ä¸€ä¸ªå…±åŒçš„æ¥å£æ¥æŒ‡å‘æ–°åˆ›å»ºçš„å¯¹è±¡</p>
</blockquote>
<h4 id="2-1-ç®€å•å·¥å‚"><a href="#2-1-ç®€å•å·¥å‚" class="headerlink" title="2.1 ç®€å•å·¥å‚"></a>2.1 ç®€å•å·¥å‚</h4><p>ä»¥ç‚’é‹ä¸ºä¾‹ã€‚é‹å‚å¯ä»¥æŒ‡å®šç”Ÿäº§è€å…‹ã€é˜¿è¿ªè¾¾æ–¯å’Œæå®ç‰Œå­çš„é‹ã€‚</p>
<ul>
<li><p>å·¥å‚ç±»ï¼šå·¥å‚æ¨¡å¼çš„æ ¸å¿ƒç±»ï¼Œä¼šå®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºæŒ‡å®šçš„å…·ä½“å®ä¾‹å¯¹è±¡çš„æ¥å£ã€‚</p>
</li>
<li><p>æŠ½è±¡äº§å“ç±»ï¼šæ˜¯å…·ä½“äº§å“ç±»çš„ç»§æ‰¿çš„çˆ¶ç±»æˆ–å®ç°çš„æ¥å£ã€‚</p>
</li>
<li><p>å…·ä½“äº§å“ç±»ï¼šå·¥å‚ç±»æ‰€åˆ›å»ºçš„å¯¹è±¡å°±æ˜¯æ­¤å…·ä½“äº§å“å®ä¾‹ã€‚</p>
</li>
</ul>
<p><img src="/design_pattern-image/image_pIG1eoG7w-.png"></p>
<p>ç‰¹ç‚¹åœ¨äºå°è£…äº†åˆ›å»ºå…·ä½“äº§å“å¯¹è±¡çš„å‡½æ•°ã€‚</p>
<p>ç¼ºç‚¹åœ¨äºæ‰©å±•æ€§éå¸¸å·®ï¼Œæ–°å¢äº§å“çš„æ—¶å€™ï¼Œéœ€è¦å»ä¿®æ”¹å·¥å‚ç±»ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é‹å­æŠ½è±¡ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shoes</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Shoes</span>() &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Show</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è€å…‹é‹å­</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NiKeShoes</span> : <span class="keyword">public</span> Shoes</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Show</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;æˆ‘æ˜¯è€å…‹çƒé‹ï¼Œæˆ‘çš„å¹¿å‘Šè¯­ï¼šJust do it&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é˜¿è¿ªè¾¾æ–¯é‹å­</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AdidasShoes</span> : <span class="keyword">public</span> Shoes</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Show</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;æˆ‘æ˜¯é˜¿è¿ªè¾¾æ–¯çƒé‹ï¼Œæˆ‘çš„å¹¿å‘Šè¯­:Impossible is nothing&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æå®é‹å­</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LiNingShoes</span> : <span class="keyword">public</span> Shoes</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Show</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;æˆ‘æ˜¯æå®çƒé‹ï¼Œæˆ‘çš„å¹¿å‘Šè¯­ï¼šEverything is possible&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">SHOES_TYPE</span></span><br><span class="line">&#123;</span><br><span class="line">    NIKE,</span><br><span class="line">    LINING,</span><br><span class="line">    ADIDAS</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ€»é‹å‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShoesFactory</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// æ ¹æ®é‹å­ç±»å‹åˆ›å»ºå¯¹åº”çš„é‹å­å¯¹è±¡</span></span><br><span class="line">    <span class="function">Shoes *<span class="title">CreateShoes</span><span class="params">(SHOES_TYPE type)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (type)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> NIKE:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">NiKeShoes</span>();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> LINING:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">LiNingShoes</span>();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> ADIDAS:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">AdidasShoes</span>();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>mainå‡½æ•°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æ„é€ å·¥å‚å¯¹è±¡</span></span><br><span class="line">    ShoesFactory shoesFactory;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»é‹å·¥å‚å¯¹è±¡åˆ›å»ºé˜¿è¿ªè¾¾æ–¯é‹å¯¹è±¡</span></span><br><span class="line">    Shoes *pNikeShoes = shoesFactory.<span class="built_in">CreateShoes</span>(NIKE);</span><br><span class="line">    <span class="keyword">if</span> (pNikeShoes != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// è€å…‹çƒé‹å¹¿å‘Šå–Šèµ·</span></span><br><span class="line">        pNikeShoes-&gt;<span class="built_in">Show</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é‡Šæ”¾èµ„æº</span></span><br><span class="line">        <span class="keyword">delete</span> pNikeShoes;</span><br><span class="line">        pNikeShoes = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»é‹å·¥å‚å¯¹è±¡åˆ›å»ºé˜¿è¿ªè¾¾æ–¯é‹å¯¹è±¡</span></span><br><span class="line">    Shoes *pLiNingShoes = shoesFactory.<span class="built_in">CreateShoes</span>(LINING);</span><br><span class="line">    <span class="keyword">if</span> (pLiNingShoes != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æå®çƒé‹å¹¿å‘Šå–Šèµ·</span></span><br><span class="line">        pLiNingShoes-&gt;<span class="built_in">Show</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é‡Šæ”¾èµ„æº</span></span><br><span class="line">        <span class="keyword">delete</span> pLiNingShoes;</span><br><span class="line">        pLiNingShoes = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»é‹å·¥å‚å¯¹è±¡åˆ›å»ºé˜¿è¿ªè¾¾æ–¯é‹å¯¹è±¡</span></span><br><span class="line">    Shoes *pAdidasShoes = shoesFactory.<span class="built_in">CreateShoes</span>(ADIDAS);</span><br><span class="line">    <span class="keyword">if</span> (pAdidasShoes != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// é˜¿è¿ªè¾¾æ–¯çƒé‹å¹¿å‘Šå–Šèµ·</span></span><br><span class="line">        pAdidasShoes-&gt;<span class="built_in">Show</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é‡Šæ”¾èµ„æº</span></span><br><span class="line">        <span class="keyword">delete</span> pAdidasShoes;</span><br><span class="line">        pAdidasShoes = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-å·¥å‚æ–¹æ³•"><a href="#2-2-å·¥å‚æ–¹æ³•" class="headerlink" title="2.2 å·¥å‚æ–¹æ³•"></a>2.2 å·¥å‚æ–¹æ³•</h4><p>ç®€å•å·¥å‚çš„ç¼ºç‚¹åœ¨äºï¼Œè°ƒç”¨å·¥å‚æ¥åˆ›å»ºå¯¹è±¡æ—¶ï¼Œæ˜¯ä¼ å…¥äº§å“ç±»åˆ«çš„ã€‚æ¯å½“å¢åŠ ä¸€ä¸ªç±»åˆ«æ—¶ï¼Œå°±éœ€è¦ä¿®æ”¹ä¸€æ¬¡å·¥å‚ç±»ã€‚è¿™è¿åäº†å¼€é—­åŸåˆ™ï¼Œè€Œå·¥å‚æ–¹æ³•æ˜¯å¯¹è¿™ç§è¡Œä¸ºçš„è¡¥æ•‘ã€‚ä½¿ç”¨å·¥å‚æ–¹æ³•ï¼Œæ¯æ¬¡éœ€è¦å¢åŠ ä¸€ä¸ªç±»åˆ«æ—¶ï¼Œåªéœ€è¦å†å®ç°ä¸¤ä¸ªå…·ä½“ç±»å°±è¡Œï¼Œä¸å¿…å†å»ä¿®æ”¹å·¥å‚ç±»çš„å†…å®¹ã€‚</p>
<p>å·¥å‚æ–¹æ³•ç›¸æ¯”äºç®€å•å·¥å‚ï¼Œæ·»åŠ äº†ä¸€ä¸ªå…·ä½“å·¥å‚ç±»ï¼Œæ¯ä¸€ä¸ªå…·ä½“å·¥å‚ç±»å’Œç›¸åº”çš„å…·ä½“äº§å“ç±»æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œç”±å…·ä½“å·¥å‚ç±»æ¥ç”Ÿäº§ï¼ˆåˆ›å»ºï¼‰ç›¸åº”çš„å…·ä½“äº§å“ç±»å¯¹è±¡ã€‚</p>
<ul>
<li><p>æŠ½è±¡å·¥å‚ç±»ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼çš„æ ¸å¿ƒç±»ï¼Œæä¾›åˆ›å»ºå…·ä½“äº§å“çš„æ¥å£ï¼Œç”±å…·ä½“å·¥å‚ç±»å®ç°ã€‚</p>
</li>
<li><p>å…·ä½“å·¥å‚ç±»ï¼šç»§æ‰¿äºæŠ½è±¡å·¥å‚ï¼Œå®ç°åˆ›å»ºå¯¹åº”å…·ä½“äº§å“å¯¹è±¡çš„æ–¹å¼ã€‚</p>
</li>
<li><p>æŠ½è±¡äº§å“ç±»ï¼šå®ƒæ˜¯å…·ä½“äº§å“ç»§æ‰¿çš„çˆ¶ç±»ï¼ˆåŸºç±»ï¼‰ã€‚</p>
</li>
<li><p>å…·ä½“äº§å“ç±»ï¼šå…·ä½“å·¥å‚æ‰€åˆ›å»ºçš„å¯¹è±¡ï¼Œå°±æ˜¯æ­¤ç±»ã€‚</p>
</li>
</ul>
<p><img src="/design_pattern-image/image_psTux_rw_R.png"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ€»é‹å‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShoesFactory</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Shoes *<span class="title">CreateShoes</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">ShoesFactory</span>() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è€å…‹ç”Ÿäº§è€…/ç”Ÿäº§é“¾</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NiKeProducer</span> : <span class="keyword">public</span> ShoesFactory</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">Shoes *<span class="title">CreateShoes</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">NiKeShoes</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é˜¿è¿ªè¾¾æ–¯ç”Ÿäº§è€…/ç”Ÿäº§é“¾</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AdidasProducer</span> : <span class="keyword">public</span> ShoesFactory</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">Shoes *<span class="title">CreateShoes</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">AdidasShoes</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æå®ç”Ÿäº§è€…/ç”Ÿäº§é“¾</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LiNingProducer</span> : <span class="keyword">public</span> ShoesFactory</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">Shoes *<span class="title">CreateShoes</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">LiNingShoes</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>mainå‡½æ•°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ================ ç”Ÿäº§è€å…‹æµç¨‹ ==================== //</span></span><br><span class="line">    <span class="comment">// é‹å‚å¼€è®¾è€å…‹ç”Ÿäº§çº¿</span></span><br><span class="line">    ShoesFactory *niKeProducer = <span class="keyword">new</span> <span class="built_in">NiKeProducer</span>();</span><br><span class="line">    <span class="comment">// è€å…‹ç”Ÿäº§çº¿äº§å‡ºçƒé‹</span></span><br><span class="line">    Shoes *nikeShoes = niKeProducer-&gt;<span class="built_in">CreateShoes</span>();</span><br><span class="line">    <span class="comment">// è€å…‹çƒé‹å¹¿å‘Šå–Šèµ·</span></span><br><span class="line">    nikeShoes-&gt;<span class="built_in">Show</span>();</span><br><span class="line">    <span class="comment">// é‡Šæ”¾èµ„æº</span></span><br><span class="line">    <span class="keyword">delete</span> nikeShoes;</span><br><span class="line">    <span class="keyword">delete</span> niKeProducer;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ================ ç”Ÿäº§é˜¿è¿ªè¾¾æ–¯æµç¨‹ ==================== //</span></span><br><span class="line">    <span class="comment">// é‹å‚å¼€è®¾é˜¿è¿ªè¾¾æ–¯ç”Ÿäº§è€…</span></span><br><span class="line">    ShoesFactory *adidasProducer = <span class="keyword">new</span> <span class="built_in">AdidasProducer</span>();</span><br><span class="line">    <span class="comment">// é˜¿è¿ªè¾¾æ–¯ç”Ÿäº§çº¿äº§å‡ºçƒé‹</span></span><br><span class="line">    Shoes *adidasShoes = adidasProducer-&gt;<span class="built_in">CreateShoes</span>();</span><br><span class="line">    <span class="comment">// é˜¿è¿ªè¾¾æ–¯çƒé‹å¹¿å–Šèµ·</span></span><br><span class="line">    adidasShoes-&gt;<span class="built_in">Show</span>();</span><br><span class="line">    <span class="comment">// é‡Šæ”¾èµ„æº</span></span><br><span class="line">    <span class="keyword">delete</span> adidasShoes;</span><br><span class="line">    <span class="keyword">delete</span> adidasProducer;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-æŠ½è±¡å·¥å‚"><a href="#2-3-æŠ½è±¡å·¥å‚" class="headerlink" title="2.3 æŠ½è±¡å·¥å‚"></a>2.3 æŠ½è±¡å·¥å‚</h4><ul>
<li><p>ä¸å·¥å‚æ–¹æ³•çš„ä¸åŒï¼šå…·ä½“å·¥å‚ç±»ä¸å†ç”Ÿäº§å”¯ä¸€çš„äº§å“ï¼Œè€Œæ˜¯ç”Ÿäº§å¤šä¸ªäº§å“ã€‚ä¹Ÿå°±æ˜¯æŠ½è±¡å·¥å‚ç±»å°†ä¸ä»…ä»…æä¾›å¯¹æŸä¸€ç§äº§å“çš„åˆ›å»ºæ–¹æ³•ï¼Œè¿˜æä¾›å¤šç§äº§å“çš„åˆ›å»ºæ–¹æ³•ã€‚</p>
</li>
<li><p>åº”ç”¨åœºæ™¯ï¼šå½“ç³»ç»Ÿæ‰€æä¾›çš„å·¥å‚æ‰€éœ€ç”Ÿäº§çš„å…·ä½“äº§å“å¹¶ä¸æ˜¯ä¸€ä¸ªç®€å•çš„å¯¹è±¡ï¼Œè€Œæ˜¯å¤šä¸ªä½äºä¸åŒäº§å“ç­‰çº§ç»“æ„ä¸­å±äºä¸åŒç±»å‹çš„å…·ä½“äº§å“æ—¶éœ€è¦ä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼ã€‚</p>
<p>é‡åˆ°æ­¤ç±»åœºæ™¯æ—¶ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼æ¯”å·¥å‚æ–¹æ³•æ¨¡å¼æ›´ä¸ºç®€å•ã€æœ‰æ•ˆç‡ã€‚</p>
</li>
</ul>
<p><img src="/design_pattern-image/image_aZYjDQ9kcg.png"></p>
<p>è€ƒè™‘ä¸Šé¢çš„ä¾‹å­ã€‚æ­¤æ—¶å‚å®¶ä¸å†å±€é™äºç”Ÿäº§é‹å­ï¼Œè¿˜æƒ³ç”Ÿäº§è€å…‹ã€é˜¿è¿ªè¾¾æ–¯ã€æå®çš„è¡£æœã€‚é‚£ä¹ˆå°±å¯ä»¥åº”ç”¨æŠ½è±¡å·¥å‚æ¥æ›¿ä»£å·¥å‚æ–¹æ³•ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŸºç±» è¡£æœ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Clothe</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Show</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Clothe</span>() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è€å…‹è¡£æœ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NiKeClothe</span> : <span class="keyword">public</span> Clothe</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Show</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;æˆ‘æ˜¯è€å…‹è¡£æœï¼Œæ—¶å°šæˆ‘æœ€åœ¨è¡Œï¼&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŸºç±» é‹å­</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shoes</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Show</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Shoes</span>() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è€å…‹é‹å­</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NiKeShoes</span> : <span class="keyword">public</span> Shoes</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Show</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;æˆ‘æ˜¯è€å…‹çƒé‹ï¼Œè®©ä½ é…·èµ·æ¥ï¼&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ€»å‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Factory</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Shoes *<span class="title">CreateShoes</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> Clothe *<span class="title">CreateClothe</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Factory</span>() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è€å…‹ç”Ÿäº§è€…/ç”Ÿäº§é“¾</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NiKeProducer</span> : <span class="keyword">public</span> Factory</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">Shoes *<span class="title">CreateShoes</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">NiKeShoes</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">Clothe *<span class="title">CreateClothe</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">NiKeClothe</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>mainå‡½æ•°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ================ ç”Ÿäº§è€å…‹æµç¨‹ ==================== //</span></span><br><span class="line">    <span class="comment">// é‹å‚å¼€è®¾è€å…‹ç”Ÿäº§çº¿</span></span><br><span class="line">    Factory *niKeProducer = <span class="keyword">new</span> <span class="built_in">NiKeProducer</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è€å…‹ç”Ÿäº§çº¿äº§å‡ºçƒé‹</span></span><br><span class="line">    Shoes *nikeShoes = niKeProducer-&gt;<span class="built_in">CreateShoes</span>();</span><br><span class="line">  <span class="comment">// è€å…‹ç”Ÿäº§çº¿äº§å‡ºè¡£æœ</span></span><br><span class="line">    Clothe *nikeClothe = niKeProducer-&gt;<span class="built_in">CreateClothe</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è€å…‹çƒé‹å¹¿å‘Šå–Šèµ·</span></span><br><span class="line">    nikeShoes-&gt;<span class="built_in">Show</span>();</span><br><span class="line">  <span class="comment">// è€å…‹è¡£æœå¹¿å‘Šå–Šèµ·</span></span><br><span class="line">    nikeClothe-&gt;<span class="built_in">Show</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡Šæ”¾èµ„æº</span></span><br><span class="line">    <span class="keyword">delete</span> nikeShoes;</span><br><span class="line">  <span class="keyword">delete</span> nikeClothe;</span><br><span class="line">    <span class="keyword">delete</span> niKeProducer;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-4-æ¨¡æ¿å·¥å‚ï¼ˆC-ï¼‰"><a href="#2-4-æ¨¡æ¿å·¥å‚ï¼ˆC-ï¼‰" class="headerlink" title="2.4 æ¨¡æ¿å·¥å‚ï¼ˆC++ï¼‰"></a>2.4 æ¨¡æ¿å·¥å‚ï¼ˆC++ï¼‰</h4><p><a href="https://zhuanlan.zhihu.com/p/83537599">https://zhuanlan.zhihu.com/p/83537599</a></p>
<p>æ¨¡æ¿å·¥å‚ç›¸å½“äºåœ¨å·¥å‚æ–¹æ³•çš„åŸºç¡€ä¸Šè¿›è¡Œä¼˜åŒ–ï¼Œä½¿å…¶èƒ½å¤Ÿè·å¾—æŠ½è±¡å·¥å‚çš„æ•ˆæœã€‚è€Œä¸”æ¯”èµ·æŠ½è±¡å·¥å‚æ¥ï¼Œå½“éœ€è¦æ–°æ·»åŠ ç±»åˆ«æ—¶ï¼ˆæ¯”å¦‚åœ¨é‹å’Œè¡£æœçš„åŸºç¡€ä¸Šï¼Œè¿˜è¦æ·»åŠ è£¤å­ï¼‰ï¼Œæ‰©å±•æ€§æ›´å¼ºï¼Œç¬¦åˆå¼€é—­åŸåˆ™ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŸºç±» é‹å­</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shoes</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Show</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Shoes</span>() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è€å…‹é‹å­</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NiKeShoes</span> : <span class="keyword">public</span> Shoes</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Show</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;æˆ‘æ˜¯è€å…‹çƒé‹ï¼Œæˆ‘çš„å¹¿å‘Šè¯­ï¼šJust do it&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŸºç±» è¡£æœ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Clothe</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Show</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Clothe</span>() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼˜è¡£åº“è¡£æœ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UniqloClothe</span> : <span class="keyword">public</span> Clothe</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Show</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;æˆ‘æ˜¯ä¼˜è¡£åº“è¡£æœï¼Œæˆ‘çš„å¹¿å‘Šè¯­ï¼šI am Uniqlo&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æŠ½è±¡æ¨¡æ¿å·¥å‚ç±»</span></span><br><span class="line"><span class="comment">// æ¨¡æ¿å‚æ•°ï¼šAbstractProduct_t äº§å“æŠ½è±¡ç±»</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">AbstractProduct_t</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractFactory</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> AbstractProduct_t *<span class="title">CreateProduct</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">AbstractFactory</span>() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“æ¨¡æ¿å·¥å‚ç±»</span></span><br><span class="line"><span class="comment">// æ¨¡æ¿å‚æ•°ï¼šAbstractProduct_t äº§å“æŠ½è±¡ç±»ï¼ŒConcreteProduct_t äº§å“å…·ä½“ç±»</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">AbstractProduct_t</span>, <span class="keyword">class</span> <span class="title class_">ConcreteProduct_t</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteFactory</span> : <span class="keyword">public</span> AbstractFactory&lt;AbstractProduct_t&gt;</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">AbstractProduct_t *<span class="title">CreateProduct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">ConcreteProduct_t</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>mainå‡½æ•°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æ„é€ è€å…‹é‹çš„å·¥å‚å¯¹è±¡</span></span><br><span class="line">    ConcreteFactory&lt;Shoes, NiKeShoes&gt; nikeFactory;</span><br><span class="line">    <span class="comment">// åˆ›å»ºè€å…‹é‹å¯¹è±¡</span></span><br><span class="line">    Shoes *pNiKeShoes = nikeFactory.<span class="built_in">CreateProduct</span>();</span><br><span class="line">    <span class="comment">// æ‰“å°è€å…‹é‹å¹¿å‘Šè¯­</span></span><br><span class="line">    pNiKeShoes-&gt;<span class="built_in">Show</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ ä¼˜è¡£åº“è¡£æœçš„å·¥å‚å¯¹è±¡</span></span><br><span class="line">    ConcreteFactory&lt;Clothe, UniqloClothe&gt; uniqloFactory;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¼˜è¡£åº“è¡£æœå¯¹è±¡</span></span><br><span class="line">    Clothe *pUniqloClothe = uniqloFactory.<span class="built_in">CreateProduct</span>();</span><br><span class="line">    <span class="comment">// æ‰“å°ä¼˜è¡£åº“å¹¿å‘Šè¯­</span></span><br><span class="line">    pUniqloClothe-&gt;<span class="built_in">Show</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡Šæ”¾èµ„æº</span></span><br><span class="line">    <span class="keyword">delete</span> pNiKeShoes;</span><br><span class="line">    pNiKeShoes = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> pUniqloClothe;</span><br><span class="line">    pUniqloClothe = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-å»ºé€ è€…æ¨¡å¼ï¼ˆBuilderï¼‰"><a href="#3-å»ºé€ è€…æ¨¡å¼ï¼ˆBuilderï¼‰" class="headerlink" title="3 å»ºé€ è€…æ¨¡å¼ï¼ˆBuilderï¼‰"></a>3 å»ºé€ è€…æ¨¡å¼ï¼ˆBuilderï¼‰</h3><blockquote>
<p>å°†ä¸€ä¸ª<strong>å¤æ‚å¯¹è±¡</strong>åˆ†è§£æˆå¤šä¸ªç›¸å¯¹ç®€å•çš„éƒ¨åˆ†ï¼Œç„¶åæ ¹æ®ä¸åŒéœ€è¦åˆ†åˆ«åˆ›å»ºå®ƒä»¬ï¼Œæœ€åæ„å»ºæˆè¯¥å¤æ‚å¯¹è±¡ã€‚<br>Builderä¾§é‡â€œé›¶éƒ¨ä»¶çš„ç»„è£…è¿‡ç¨‹â€ã€‚</p>
</blockquote>
<p><img src="/design_pattern-image/image_YPbrcpWDP5.png"></p>
<ul>
<li><p>åº”ç”¨åœºæ™¯ï¼šå»ºé€ è€…æ¨¡å¼ä¸»è¦ç”¨äºâ€œåˆ†æ­¥éª¤æ„å»ºä¸€ä¸ªå¤æ‚çš„å¯¹è±¡â€ã€‚åœ¨è¿™å…¶ä¸­â€œåˆ†æ­¥éª¤â€æ˜¯ä¸€ä¸ªç¨³å®šçš„ç®—æ³•ï¼Œè€Œå¤æ‚å¯¹è±¡çš„å„ä¸ªéƒ¨åˆ†ç»å¸¸å˜åŒ–ã€‚</p>
</li>
<li><p>ç¼ºç‚¹ï¼šè¿™é‡Œçš„â€œç»„è£…è¿‡ç¨‹â€ï¼Œæˆ–è€…è¯´â€œæ­¥éª¤â€ï¼Œæ˜¯å›ºå®šçš„ï¼Œæ— æ³•ä¿®æ”¹ã€‚</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">House</span>&#123;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HouseBuilder</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function">House* <span class="title">GetResult</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> pHouse;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">virtual</span> ~<span class="built_in">HouseBuilder</span>()&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">  House* pHouse;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">BuildPart1</span><span class="params">()</span></span>=<span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">BuildPart2</span><span class="params">()</span></span>=<span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">BuildPart3</span><span class="params">()</span></span>=<span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">BuildPart4</span><span class="params">()</span></span>=<span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">BuildPart5</span><span class="params">()</span></span>=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StoneHouse</span>: <span class="keyword">public</span> House&#123;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StoneHouseBuilder</span>: <span class="keyword">public</span> HouseBuilder&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">BuildPart1</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="comment">//pHouse-&gt;Part1 = ...;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">BuildPart2</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">BuildPart3</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">BuildPart4</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">BuildPart5</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">///@briefï¼šDirectorï¼Œç»„è£…å„ä¸ªpartï¼Œâ€œæ­¥éª¤â€æ˜¯ç”±å®ƒåˆ¶å®šå¹¶å®ç°çš„</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HouseDirector</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  HouseBuilder* pHouseBuilder;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">HouseDirector</span>(HouseBuilder* pHouseBuilder)&#123;</span><br><span class="line">      <span class="keyword">this</span>-&gt;pHouseBuilder=pHouseBuilder;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">House* <span class="title">Construct</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    pHouseBuilder-&gt;<span class="built_in">BuildPart1</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)&#123;</span><br><span class="line">        pHouseBuilder-&gt;<span class="built_in">BuildPart2</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> flag=pHouseBuilder-&gt;<span class="built_in">BuildPart3</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">        pHouseBuilder-&gt;<span class="built_in">BuildPart4</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pHouseBuilder-&gt;<span class="built_in">BuildPart5</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pHouseBuilder-&gt;<span class="built_in">GetResult</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="4-åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰"><a href="#4-åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰" class="headerlink" title="4 åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰"></a>4 åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰</h3><blockquote>
<p>å°†ä¸€ä¸ªå¯¹è±¡ä½œä¸ºåŸå‹ï¼Œé€šè¿‡å¯¹å…¶è¿›è¡Œå¤åˆ¶è€Œå…‹éš†å‡ºå¤šä¸ªå’ŒåŸå‹ç±»ä¼¼çš„æ–°å®ä¾‹ã€‚</p>
</blockquote>
<ul>
<li><p>åº”ç”¨åœºæ™¯ï¼š</p>
<p>é’ˆå¯¹<strong>ç»“æ„å¤æ‚çš„å¯¹è±¡ç»“æ„</strong>ï¼Œç”±äºéœ€æ±‚å˜åŒ–ï¼Œå¯¹è±¡å†…éƒ¨ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å¯¹å¤–æš´éœ²çš„æ¥å£ä»ç„¶æ˜¯ç¨³å®šçš„ã€‚åŸå‹æ¨¡å¼è´Ÿè´£åº”å¯¹è¿™ç§å˜åŒ–ï¼Œä»å®¢æˆ·ç¨‹åºéš”ç¦»å‡ºæ˜“å˜å¯¹è±¡ï¼Œä»è€Œä½¿å¾—ä¾èµ–è¿™äº›å¯¹è±¡çš„å®¢æˆ·ç¨‹åºä¸å¿…éšç€éœ€æ±‚æ”¹å˜è€Œæ”¹å˜ã€‚</p>
</li>
<li><p>å®ç°æ–¹å¼ï¼š</p>
<p>å®šä¹‰æŠ½è±¡ç±»ï¼ŒåŸå‹ä¸ºæ´¾ç”Ÿå‡ºæ¥çš„å…·ä½“ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œéœ€è¦å…¶ä»–ï¼ˆå‘ç”Ÿäº†å˜åŒ–çš„ï¼‰å®ä¾‹æ—¶ï¼Œä»åŸå‹æ‹·è´ã€‚</p>
</li>
</ul>
<p><img src="/design_pattern-image/image_vGYSLsjdRm.png"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// @brief æŠ½è±¡åŸå‹ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractPrototype</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">AbstractPrototype</span>() = <span class="keyword">default</span>;</span><br><span class="line">  <span class="keyword">virtual</span> ~<span class="built_in">AbstractPrototype</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> AbstractPrototype* <span class="title">clone</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief å…·ä½“åŸå‹ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcretePrototype</span> : <span class="keyword">public</span> AbstractPrototype &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">ConcretePrototype</span>() = <span class="keyword">default</span>;</span><br><span class="line">  ~<span class="built_in">ConcretePrototype</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">AbstractPrototype* <span class="title">clone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">ConcretePrototype</span>(*<span class="keyword">this</span>);<span class="comment">//è°ƒç”¨æ‹·è´æ„é€ </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="built_in">ConcretePrototype</span>(<span class="type">const</span> ConcretePrototype&amp; other) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;ConcretePrototype copy construct!\n&quot;</span>);</span><br><span class="line">        <span class="comment">// ......æ‹·è´æ“ä½œ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Test_02_prototype_impl_1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;-------------------- %s --------------------\n&quot;</span>, __FUNCTION__);</span><br><span class="line">    prototype::AbstractPrototype* ptr_a = <span class="keyword">new</span> prototype::<span class="built_in">ConcretePrototype</span>();</span><br><span class="line">    prototype::AbstractPrototype* ptr_b = ptr_a-&gt;<span class="built_in">clone</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> ptr_a;</span><br><span class="line">    <span class="keyword">delete</span> ptr_b; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç»“æ„å‹"><a href="#ç»“æ„å‹" class="headerlink" title="ç»“æ„å‹"></a>ç»“æ„å‹</h2><blockquote>
<p>ğŸ“Œé—¨é¢(5) &gt; é€‚é…å™¨(4) &#x3D; ç»„åˆ(4) &#x3D; ä»£ç†(4) &gt; æ¡¥æ¥(3) &#x3D; è£…é¥°(3) &gt; äº«å…ƒ(1)</p>
</blockquote>
<h3 id="5-ä»£ç†æ¨¡å¼ï¼ˆProxyï¼‰"><a href="#5-ä»£ç†æ¨¡å¼ï¼ˆProxyï¼‰" class="headerlink" title="5 ä»£ç†æ¨¡å¼ï¼ˆProxyï¼‰"></a>5 ä»£ç†æ¨¡å¼ï¼ˆProxyï¼‰</h3><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå®¢æˆ·ä¸æƒ³æˆ–è€…ä¸èƒ½ç›´æ¥å¼•ç”¨ä¸€ä¸ªå¯¹è±¡ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡ä¸€ä¸ªç§°ä¹‹ä¸ºâ€œä»£ç†â€çš„ç¬¬ä¸‰æ–¹æ¥å®ç° é—´æ¥å¼•ç”¨ã€‚ä»£ç†å¯¹è±¡å¯ä»¥åœ¨å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´èµ·åˆ°â€œä¸­ä»‹â€çš„ä½œç”¨ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ä»£ç†å¯¹è±¡å»æ‰å®¢æˆ·ä¸å…è®¸çœ‹åˆ°çš„å†…å®¹ï¼Œæˆ–è€…æ·»åŠ å®¢æˆ·éœ€è¦çš„é¢å¤–æœåŠ¡ã€‚</p>
<blockquote>
<p>äº‹å®ä¸Šï¼Œä»£ç†æ¨¡å¼å’Œç§‘å­¦ä¸Šç½‘æ—¶æ‰€é…ç½®çš„ä»£ç†æ˜¯å¼‚æ›²åŒå·¥çš„ã€‚æ— æ³•ç›´æ¥è®¿é—®åˆ°æµ·å¤–çš„æœºå™¨ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ä¸€ä¸ªä»£ç†æ¥è®¿é—®æµ·å¤–ï¼Œè€Œå®¢æˆ·ç«¯è°ƒç”¨ä»£ç†å³å¯ã€‚</p>
</blockquote>
<p><img src="/design_pattern-image/image_LaOkWgxP2d.png"></p>
<p><img src="/design_pattern-image/image_Bl0RbJxcRV.png"></p>
<ul>
<li><p>subjectï¼šæŠ½è±¡è§’è‰²</p>
</li>
<li><p>Proxyï¼šä»£ç†è§’è‰²</p>
</li>
<li><p>RealSubjectï¼šçœŸå®è§’è‰²</p>
</li>
</ul>
<!---->

<ul>
<li><p>åº”ç”¨åœºæ™¯ï¼š</p>
<ol>
<li><p>è¿œç¨‹ä»£ç†ï¼šä¸ºä¸€ä¸ªå¤„äºä¸åŒåœ°å€ç©ºé—´çš„å¯¹è±¡æä¾›ä¸€ä¸ªæœ¬åœ°çš„ä»£ç†ï¼Œè¿™ä¸ªä¸åŒåœ°å€ç©ºé—´å¯ä»¥åœ¨åŒä¸€å°ä¸»æœºä¸­ï¼Œä¹Ÿå¯åœ¨å¦ä¸€å°ä¸»æœºä¸­ï¼Œè¿œç¨‹ä»£ç†åˆå«åšå¤§ä½¿ã€‚</p>
</li>
<li><p>è™šæ‹Ÿä»£ç†ï¼šå¦‚æœéœ€è¦åˆ›å»ºä¸€ä¸ªèµ„æºæ¶ˆè€—è¾ƒå¤§çš„å¯¹è±¡ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªæ¶ˆè€—ç›¸å¯¹è¾ƒå°çš„å¯¹è±¡æ¥è¡¨ç¤ºï¼ŒçœŸå®å¯¹è±¡åªåœ¨éœ€è¦æ—¶æ‰ä¼šè¢«çœŸæ­£åˆ›å»ºã€‚</p>
</li>
<li><p>å†™æ—¶æ‹·è´ä»£ç†ï¼šè™šæ‹Ÿä»£ç†çš„ä¸€ç§ï¼ŒæŠŠå¤åˆ¶ï¼ˆå…‹éš†ï¼‰æ“ä½œå»¶è¿Ÿåˆ°åªæœ‰åœ¨å®¢æˆ·ç«¯çœŸæ­£éœ€è¦æ—¶æ‰æ‰§è¡Œã€‚</p>
</li>
<li><p>ä¿æŠ¤ä»£ç†ï¼šæ§åˆ¶å¯¹ä¸€ä¸ªå¯¹è±¡çš„è®¿é—®ï¼Œå¯ä»¥ç»™ä¸åŒçš„ç”¨æˆ·æä¾›ä¸åŒçº§åˆ«çš„ä½¿ç”¨æƒé™ã€‚</p>
</li>
<li><p>ç¼“å†²ä»£ç†ï¼šä¸ºæŸä¸€ä¸ªç›®æ ‡æ“ä½œçš„ç»“æœæä¾›ä¸´æ—¶çš„å­˜å‚¨ç©ºé—´ï¼Œä»¥ä¾¿å¤šä¸ªå®¢æˆ·ç«¯å¯ä»¥å…±äº«è¿™äº›ç»“æœã€‚</p>
</li>
<li><p>é˜²ç«å¢™ä»£ç†ï¼šä¿æŠ¤ç›®æ ‡ä¸è®©æ¶æ„ç”¨æˆ·æ¥è¿‘ã€‚</p>
</li>
<li><p>åŒæ­¥åŒ–ä»£ç†ï¼šä½¿å‡ ä¸ªç”¨æˆ·èƒ½å¤ŸåŒæ—¶ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡è€Œæ²¡æœ‰å†²çªã€‚</p>
</li>
<li><p>æ™ºèƒ½å¼•ç”¨ä»£ç†ï¼šå½“ä¸€ä¸ªå¯¹è±¡è¢«å¼•ç”¨æ—¶ï¼Œæä¾›ä¸€äº›é¢å¤–çš„æ“ä½œï¼Œå¦‚å°†æ­¤å¯¹è±¡è¢«è°ƒç”¨çš„æ¬¡æ•°è®°å½•ä¸‹æ¥ç­‰ã€‚</p>
</li>
</ol>
</li>
<li><p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li><p>ä»£ç†æ¨¡å¼èƒ½å¤Ÿåè°ƒè°ƒç”¨è€…å’Œè¢«è°ƒç”¨è€…ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†ç³»ç»Ÿçš„è€¦åˆåº¦ã€‚</p>
</li>
<li><p>è¿œç¨‹ä»£ç†ä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥è®¿é—®åœ¨è¿œç¨‹æœºå™¨ä¸Šçš„å¯¹è±¡ï¼Œè¿œç¨‹æœºå™¨å¯èƒ½å…·æœ‰æ›´å¥½çš„è®¡ç®—æ€§èƒ½ä¸å¤„ç†é€Ÿåº¦ï¼Œå¯ä»¥å¿«é€Ÿå“åº”å¹¶å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ã€‚</p>
</li>
<li><p>è™šæ‹Ÿä»£ç†é€šè¿‡ä½¿ç”¨ä¸€ä¸ªå°å¯¹è±¡æ¥ä»£è¡¨ä¸€ä¸ªå¤§å¯¹è±¡ï¼Œå¯ä»¥å‡å°‘ç³»ç»Ÿèµ„æºçš„æ¶ˆè€—ï¼Œå¯¹ç³»ç»Ÿè¿›è¡Œä¼˜åŒ–å¹¶æé«˜è¿è¡Œé€Ÿåº¦ã€‚</p>
</li>
<li><p>ä¿æŠ¤ä»£ç†å¯ä»¥æ§åˆ¶å¯¹çœŸå®å¯¹è±¡çš„ä½¿ç”¨æƒé™ã€‚</p>
</li>
</ol>
</li>
<li><p>ç¼ºç‚¹ï¼š</p>
<p>å®¢æˆ·ç«¯å’ŒçœŸå®å¯¹è±¡ä¹‹é—´å¢åŠ äº†ä»£ç†å¯¹è±¡ï¼Œå› æ­¤æœ‰äº›ç±»å‹çš„ä»£ç†æ¨¡å¼å¯èƒ½ä¼šé€ æˆè¯·æ±‚çš„å¤„ç†é€Ÿåº¦å˜æ…¢ï¼Œè€Œä¸”å¢åŠ äº†ç³»ç»Ÿå®ç°çš„å¤æ‚åº¦ã€‚</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Proxy</span> : <span class="keyword">public</span> Subject&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Proxy</span>()&#123;</span><br><span class="line">    m_pRealSubject = <span class="keyword">new</span> <span class="built_in">RealSubject</span>();</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">virtual</span> ~<span class="built_in">Proxy</span>()&#123;</span><br><span class="line">    <span class="keyword">delete</span> m_pReakSubject;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">request</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">preRequest</span>();</span><br><span class="line">    m_pRealSubject-&gt;<span class="built_in">request</span>();</span><br><span class="line">    <span class="built_in">afterRequest</span>();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">afterRequest</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">preRequest</span><span class="params">()</span></span>;  </span><br><span class="line">  RealSubject *m_pRealSubject;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">int main()&#123;</span></span><br><span class="line"><span class="comment">  Proxy proxy;</span></span><br><span class="line"><span class="comment">  proxy.request();</span></span><br><span class="line"><span class="comment">  return 0;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="6-æ¡¥æ¥æ¨¡å¼ï¼ˆBridgeï¼‰"><a href="#6-æ¡¥æ¥æ¨¡å¼ï¼ˆBridgeï¼‰" class="headerlink" title="6 æ¡¥æ¥æ¨¡å¼ï¼ˆBridgeï¼‰"></a>6 æ¡¥æ¥æ¨¡å¼ï¼ˆBridgeï¼‰</h3><p>æ¡¥æ¥æ¨¡å¼åŒæ—¶ä½¿ç”¨äº†â€œ<strong>æ¥å£ä¸å®ç°ç›¸åˆ†ç¦»</strong>â€å’Œâ€œ<strong>ç»„åˆä»£æ›¿ç»§æ‰¿</strong>â€çš„æ€æƒ³ã€‚</p>
<ul>
<li><p>åº”ç”¨åœºæ™¯ï¼š</p>
<p>æŸäº›ç±»å‹çš„å›ºæœ‰å®ç°é€»è¾‘ï¼Œä½¿å¾—å®ƒä»¬å…·æœ‰ä¸¤ä¸ªå˜åŒ–çš„ç»´åº¦ï¼Œç”šè‡³å¤šä¸ªå˜åŒ–çš„ç»´åº¦ã€‚æ¯”å¦‚è¯´å›¾å½¢æ—¢å¯æŒ‰å½¢çŠ¶åˆ†ï¼Œåˆå¯æŒ‰é¢œè‰²åˆ†ã€‚è€ŒPhotoshopè¿™æ ·çš„è½¯ä»¶ï¼Œèƒ½ç”»ä¸åŒå½¢çŠ¶å’Œä¸åŒé¢œè‰²çš„å›¾å½¢ï¼Œè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ<br>æ­¤æ—¶å¯ä»¥ä½¿ç”¨æ¡¥æ¥æ¨¡å¼ï¼Œå¯ä»¥å‚è€ƒå‰æ–‡â€œç»„åˆä»£æ›¿ç»§æ‰¿â€ä¸­é¸Ÿç±»çš„ä¾‹å­ã€‚</p>
</li>
<li><p>æ¡¥æ¥æ¨¡å¼ç»“æ„ï¼š</p>
<p><img src="/design_pattern-image/image_mczjtZsYoT.png"></p>
<p>Abstractionï¼šæŠ½è±¡ç±»</p>
<p>RefinedAbstractionï¼šæ‰©å……æŠ½è±¡ç±»ï¼Œå³æ‰©å……Abstractionæ‰€å®šä¹‰çš„æ¥å£ï¼Œä»–åŒæ—¶è¿æ¥Abstractionå’ŒImplementorï¼Œæ˜¯â€œæ¡¥æ¥â€ä¸­çš„é‚£åº§æ¡¥ã€‚</p>
<p>Implementorï¼šå®ç°ç±»æ¥å£</p>
<p>ConcreteImplementorï¼šå…·ä½“å®ç°ç±»</p>
<p>æ‰©å……æŠ½è±¡ç±»æ„é€ æ—¶æ¥æ”¶å…·ä½“å®ç°ç±»ä¸ºå‚æ•°ï¼Œä»è€Œè®©æ‰©å……æŠ½è±¡ç±»ç»„åˆäº†è‹¥å¹²å…·ä½“å®ç°ç±»çš„åŠŸèƒ½ã€‚</p>
</li>
</ul>
<p>å½“ç„¶ï¼Œæ‰©å……æŠ½è±¡ç±»ä¸ä¸€å®šæ˜¯å¿…éœ€çš„ï¼Œç”±æ­¤è¡ç”Ÿå‡ºä¸¤ç§æ¡¥æ¥æ¨¡å¼çš„å®ç°æ–¹å¼ã€‚</p>
<h4 id="ç®€å•çš„æŠ½è±¡ä¸å®ç°ç›¸åˆ†ç¦»"><a href="#ç®€å•çš„æŠ½è±¡ä¸å®ç°ç›¸åˆ†ç¦»" class="headerlink" title="ç®€å•çš„æŠ½è±¡ä¸å®ç°ç›¸åˆ†ç¦»"></a>ç®€å•çš„æŠ½è±¡ä¸å®ç°ç›¸åˆ†ç¦»</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// @brief æŠ½è±¡ç±»æ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractInterface</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">AbstractInterface</span>();</span><br><span class="line">    ~<span class="built_in">AbstractInterface</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Request</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Impl</span>;</span><br><span class="line">    Impl* impl_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief å®ç°ç±»æ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractInterface</span>::Impl &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;this is AbstractInterface::Impl::Request!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// æŠ½è±¡ç±»æ¥å£çš„å®ç° - è°ƒç”¨å®ç°ç±»æ¥å£</span></span><br><span class="line">AbstractInterface::<span class="built_in">AbstractInterface</span>() &#123;</span><br><span class="line">    impl_ = <span class="keyword">new</span> <span class="built_in">Impl</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AbstractInterface::~<span class="built_in">AbstractInterface</span>() &#123;</span><br><span class="line">    <span class="keyword">delete</span> impl_;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AbstractInterface::Request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    impl_-&gt;<span class="built_in">Request</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å¤æ‚çš„æŠ½è±¡ä¸å®ç°ç›¸åˆ†ç¦»"><a href="#å¤æ‚çš„æŠ½è±¡ä¸å®ç°ç›¸åˆ†ç¦»" class="headerlink" title="å¤æ‚çš„æŠ½è±¡ä¸å®ç°ç›¸åˆ†ç¦»"></a>å¤æ‚çš„æŠ½è±¡ä¸å®ç°ç›¸åˆ†ç¦»</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// @brief å®ç°åŒ–è§’è‰², å®šä¹‰å®ç°åŒ–è§’è‰²çš„æ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractImplementor</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">AbstractImplementor</span>() &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Request</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief å…·ä½“å®ç°åŒ–è§’è‰², ç»™å‡ºå®ç°åŒ–è§’è‰²æ¥å£çš„å…·ä½“å®ç°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteImplementorA</span> : <span class="keyword">public</span> AbstractImplementor &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;this ConcreteImplementorA::Request!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteImplementorB</span> : <span class="keyword">public</span> AbstractImplementor &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;this ConcreteImplementorB::Request!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief æŠ½è±¡ç±»è§’è‰², å¯¹å®ç°åŒ–å¯¹è±¡çš„å¼•ç”¨</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractRole</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">AbstractRole</span>(AbstractImplementor* impl) : <span class="built_in">impl_</span>(impl) &#123;&#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">AbstractRole</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Request</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    AbstractImplementor* impl_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief æ‰©å±•æŠ½è±¡åŒ–è§’è‰², å®ç°çˆ¶ç±»ä¸­çš„ä¸šåŠ¡æ–¹æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExtendRole</span> : <span class="keyword">public</span> AbstractRole &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ExtendRole</span>(AbstractImplementor* impl) : <span class="built_in">AbstractRole</span>(impl) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        impl_-&gt;<span class="built_in">Request</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Test_08_bridge_impl_2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    AbstractImplementor* ptr_implA = <span class="keyword">new</span> <span class="built_in">ConcreteImplementorA</span>();</span><br><span class="line">    AbstractImplementor* ptr_implB = <span class="keyword">new</span> <span class="built_in">ConcreteImplementorB</span>();</span><br><span class="line"></span><br><span class="line">    AbstractRole* ptr_role_1 = <span class="keyword">new</span> <span class="built_in">ExtendRole</span>(ptr_implA);</span><br><span class="line">    ptr_role_1-&gt;<span class="built_in">Request</span>();</span><br><span class="line"></span><br><span class="line">    AbstractRole* ptr_role_2 = <span class="keyword">new</span> <span class="built_in">ExtendRole</span>(ptr_implB);</span><br><span class="line">    ptr_role_2-&gt;<span class="built_in">Request</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> ptr_role_1, ptr_role_2;</span><br><span class="line">    <span class="keyword">delete</span> ptr_implA, ptr_implB;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ“Œæ¡¥æ¥æ¨¡å¼çš„â€œæ¡¥â€ä½“ç°åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Ÿ<br>æ¯”å¦‚è¯´Photoshopçš„ä¾‹å­ï¼Œé¢œè‰²å’Œå½¢çŠ¶è¢«ç»„åˆåœ¨äº†ä¸€èµ·ã€‚å†æ¯”å¦‚é¸Ÿçš„ä¾‹å­ï¼Œé£å±æ€§å’Œå«å±æ€§ä¹Ÿè¢«ç»„åˆåœ¨äº†ä¸€èµ·ã€‚<strong>æ¡¥æ¥å°±åƒæ¶èµ·äº†ä¸€åº§æ¡¥ä¸€æ ·ï¼Œè¿æ¥äº†ä¸¤ä¸ªä¸åŒçš„ç±»å‹ï¼Œä»è€Œè¿›è¡Œç»„åˆ</strong>ã€‚<br>ä½“ç°åœ¨ä»£ç ä¸Šçš„è¯ï¼Œå°±æ˜¯RefineAbstractionçš„æ„é€ å‡½æ•°ä¸­ï¼Œä¼ å…¥äº†ä¸åŒImplementorç±»å‹çš„æŒ‡é’ˆï¼Œäºæ˜¯åœ¨RefineAbstractionå¯¹è±¡å†…éƒ¨ï¼Œå°±å¯ä»¥ç»„åˆä¸åŒç±»å‹çš„å¯¹è±¡ã€‚<br>åŒæ—¶ï¼Œç”¨æˆ·ä»…éœ€è¦è°ƒç”¨æŠ½è±¡æ¥å£Abstractionå³å¯ã€‚</p>
</blockquote>
<h3 id="7-è£…é¥°å™¨æ¨¡å¼ï¼ˆDecoratorï¼‰"><a href="#7-è£…é¥°å™¨æ¨¡å¼ï¼ˆDecoratorï¼‰" class="headerlink" title="7 è£…é¥°å™¨æ¨¡å¼ï¼ˆDecoratorï¼‰"></a>7 è£…é¥°å™¨æ¨¡å¼ï¼ˆDecoratorï¼‰</h3><p>è£…é¥°å™¨åŠ¨æ€çš„ç»™å¯¹è±¡å¢åŠ ä¸€äº›èŒè´£ï¼Œå³å¢åŠ é¢å¤–çš„åŠŸèƒ½ã€‚é‡‡ç”¨äº†â€œ<strong>ç»„åˆä»£æ›¿ç»§æ‰¿</strong>â€çš„åŸåˆ™ï¼Œç”¨ç»„åˆå…³ç³»åˆ›å»ºä¸€ä¸ªåŒ…è£…å¯¹è±¡æ¥åŒ…è£¹çœŸå®å¯¹è±¡ï¼Œå¹¶åœ¨ä¿æŒçœŸå®å¯¹è±¡çš„ç±»ç»“æ„ä¸å˜çš„å‰æä¸‹ï¼Œæä¾›é¢å¤–çš„åŠŸèƒ½ã€‚</p>
<ul>
<li><p>åº”ç”¨åœºæ™¯ï¼š</p>
</li>
<li><p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li><p>è£…é¥°æ¨¡å¼å¯ä»¥æä¾›æ¯”ç»§æ‰¿æ›´å¤šçš„çµæ´»æ€§ã€‚</p>
</li>
<li><p>å¯ä»¥é€šè¿‡åŠ¨æ€çš„æ–¹å¼æ¥æ‰©å±•ä¸€ä¸ªå¯¹è±¡çš„åŠŸèƒ½ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶å¯ä»¥åœ¨è¿è¡Œæ—¶é€‰æ‹©ä¸åŒçš„è£…é¥°å™¨ï¼Œä»è€Œå®ç°ä¸åŒçš„è¡Œä¸ºã€‚</p>
</li>
<li><p>é€šè¿‡ä½¿ç”¨ä¸åŒçš„å…·ä½“è£…é¥°ç±»ä»¥åŠè¿™äº›è£…é¥°ç±»çš„æ’åˆ—ç»„åˆï¼Œå¯ä»¥åˆ›é€ å‡ºå¾ˆå¤šä¸åŒè¡Œä¸ºçš„ç»„åˆã€‚å¯ä»¥ä½¿ç”¨å¤šä¸ªå…·ä½“è£…é¥°ç±»æ¥è£…é¥°åŒä¸€å¯¹è±¡ï¼Œå¾—åˆ°åŠŸèƒ½æ›´ä¸ºå¼ºå¤§çš„å¯¹è±¡ã€‚</p>
</li>
<li><p>ä½¿ç”¨æ—¶è¿›è¡Œç»„åˆå³å¯ï¼ŒåŸæœ‰ä»£ç æ— é¡»æ”¹å˜ï¼Œç¬¦åˆâ€œå¼€é—­åŸåˆ™â€ã€‚</p>
</li>
</ol>
</li>
<li><p>ç¼ºç‚¹ï¼š</p>
<ol>
<li><p>è£…é¥°ç±»å’Œå°å¯¹è±¡çš„äº§ç”Ÿå°†å¢åŠ ç³»ç»Ÿçš„å¤æ‚åº¦ï¼ŒåŠ å¤§å­¦ä¹ ä¸ç†è§£çš„éš¾åº¦ã€‚</p>
</li>
<li><p>è£…é¥°æ¨¡å¼æ¯”ç»§æ‰¿æ›´åŠ æ˜“äºå‡ºé”™ï¼Œæ’é”™ä¹Ÿå¾ˆå›°éš¾ï¼Œå¯¹äºå¤šæ¬¡è£…é¥°çš„å¯¹è±¡ï¼Œè°ƒè¯•æ—¶å¯»æ‰¾é”™è¯¯å¯èƒ½éœ€è¦é€çº§æ’æŸ¥ï¼Œè¾ƒä¸ºçƒ¦çã€‚</p>
</li>
</ol>
</li>
</ul>
<p><img src="/design_pattern-image/image_KLc8axDXNy.png"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// @brief æŠ½è±¡ç»„ä»¶ - è¢«è£…é¥°çš„æ¥å£åŸºç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractComponent</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">AbstractComponent</span>() &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Request</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief å…·ä½“ç»„ä»¶ - è¢«è£…é¥°çš„æ¥å£æ´¾ç”Ÿç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteComponent</span> : <span class="keyword">public</span> AbstractComponent &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;this is ConcreteComponent::Request!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// @brief æŠ½è±¡è£…é¥°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractDecorator</span> : <span class="keyword">public</span> AbstractComponent &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">AbstractDecorator</span>(AbstractComponent* comp) : <span class="built_in">comp_</span>(comp) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (comp_) comp_-&gt;<span class="built_in">Request</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    AbstractComponent* comp_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief å…·ä½“è£…é¥°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteDecoratorA</span> : <span class="keyword">public</span> AbstractDecorator &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ConcreteDecoratorA</span>(AbstractComponent* comp) : <span class="built_in">AbstractDecorator</span>(comp) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">PreRequest</span>();</span><br><span class="line">        AbstractDecorator::<span class="built_in">Request</span>();</span><br><span class="line">        <span class="built_in">PostRequest</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">PreRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ConcreteDecoratorA::PreRequest!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">PostRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ConcreteDecoratorA::PostRequest!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ“Œä»£ç ä¸­çš„è¿™è¡Œæ“ä½œ<code>ConcreteDecoratorA(AbstractComponent* comp):AbstractDecorator(comp)</code>æ˜¯C++11çš„æ–°ç‰¹æ€§ï¼šå§”æ‰˜æ„é€ å‡½æ•°(delegating constructor)ï¼Œå³ä¸€ä¸ªæ„é€ å‡½æ•°å¯ä»¥åœ¨åˆå§‹åŒ–æˆå‘˜åˆ—è¡¨ä¸­ï¼Œè°ƒç”¨å¦ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚<br>å§”æ‰˜æ„é€ å‡½æ•°çš„æˆå‘˜åˆå§‹å€¼åˆ—è¡¨<strong>åªèƒ½æœ‰å”¯ä¸€çš„å‚æ•°ï¼Œå°±æ˜¯æ„é€ å‡½æ•°</strong>ã€‚<br>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå°±æ˜¯åˆ›å»ºConcreteDecoratorAå¯¹è±¡æ—¶ï¼Œä¼šå…ˆå°†è¢«å¯¹è±¡åˆ›å»ºä¸ºAbstractDecoratorå¯¹è±¡çš„å†…å®¹ï¼Œå¦‚æœ{ }ä¸­æœ‰å†…å®¹ï¼Œå°±ç»§ç»­æ‰§è¡Œ{ }ä¸­çš„å†…å®¹ã€‚<br>ä½†æ˜¯å§”æ‰˜æ„é€ å‡½æ•°æ˜“å‘ç”Ÿæ­»é”çš„é—®é¢˜ï¼Œè€ƒè™‘ä¸‹é¢ä»£ç ï¼š<br>class B{<br>private:<br>&amp;#x20;   int *a;<br>&amp;#x20;   std::string *s;<br>public:<br>&amp;#x20;   B(int a) : B(â€œTestâ€) {<br>&amp;#x20;       _*a &#x3D; a;<br>&amp;#x20;   }<br>&amp;#x20;   B(std::string s) : B(100){<br>&amp;#x20;      *_s &#x3D; â€œTestâ€;<br>&amp;#x20;   }<br>};<br>è¿™ä¸€ä»½ä»£ç å¯ä»¥ç¼–è¯‘ï¼Œä½†æ˜¯å´æ— æ³•è¿è¡Œã€‚å› ä¸ºä¸€æ—¦åˆå§‹åŒ–ï¼Œæ— è®ºæ‰§è¡Œå“ªä¸€ä¸ªå‡½æ•°ï¼Œä¸€å®šä¼šé™·å…¥æ— ç©·æ— å°½çš„å¾ªç¯è°ƒç”¨ä¸­ã€‚</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//mainå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  AbstractComponent* ptr_comp = <span class="keyword">new</span> <span class="built_in">ConcreteComponent</span>();</span><br><span class="line">  ptr_comp-&gt;<span class="built_in">Request</span>(); <span class="comment">//åŸæœ‰ç»„ä»¶è¯¥æœ‰çš„åŠŸèƒ½ä¸å˜</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//å¯¹ç°æœ‰ç»„ä»¶çš„åŠŸèƒ½è¿›è¡Œæ‰©å±•</span></span><br><span class="line">  AbstractDecorator* ptr_decorator = <span class="keyword">new</span> <span class="built_in">ConcreteDecoratorA</span>(ptr_comp);</span><br><span class="line">  ptr_decorator-&gt;<span class="built_in">Request</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰"><a href="#8-é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰" class="headerlink" title="8 é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰"></a>8 é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰</h3><ul>
<li><p>é€‚é…å™¨æ¨¡å¼ä¸­çš„è§’è‰²ï¼š</p>
<p>Targetï¼ˆç›®æ ‡æ¥å£ï¼‰ã€Adapterï¼ˆé€‚é…å™¨ç±»ï¼‰ã€Adapteeï¼ˆé€‚é…è€…ç±»ï¼‰ã€Clientï¼ˆå®¢æˆ·ç±»ï¼‰ã€‚</p>
</li>
<li><p>åº”ç”¨åœºæ™¯ï¼š</p>
<p>ç°æœ‰çš„ç±»å¯ä»¥æ»¡è¶³å®¢æˆ·ç±»çš„åŠŸèƒ½éœ€è¦ï¼Œä½†æ˜¯å®ƒæ‰€æä¾›çš„æ¥å£ä¸ä¸€å®šæ˜¯å®¢æˆ·ç±»æ‰€æœŸæœ›çš„ã€‚é€‚é…å™¨æ¨¡å¼å°±æ˜¯åœ¨äºŒè€…ä¹‹é—´æ·»åŠ ä¸€ä¸ªç±»è¿›è¡Œæ¥å£çš„è½¬åŒ–ã€‚è€Œæ·»åŠ çš„ç”¨äºè½¬åŒ–æ¥å£çš„ç±»å°±æ˜¯é€‚é…å™¨ç±»ï¼Œè¢«åŒ…è£…çš„ç±»å³é€‚é…è€…ç±»ã€‚</p>
<p>é€‚é…å™¨æ¨¡å¼ï¼Œé€šè¿‡é€‚é…å™¨ç±»ï¼Œåœ¨é€‚é…è€…ç±»å¤–éƒ¨åŒ…è£…ï¼ŒåŒ…è£…æˆç›®æ ‡æ¥å£ã€‚</p>
</li>
</ul>
<p>é€‚é…å™¨æ¨¡å¼æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š</p>
<ol>
<li><p>å¯¹è±¡é€‚é…å™¨</p>
<p>Adapteråªç»§æ‰¿Targetä»¥æä¾›æ¥å£çš„å®ç°ï¼Œæ¥æ”¶Adapteeçš„å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚</p>
</li>
<li><p>ç±»é€‚é…å™¨</p>
<p>å¤šé‡ç»§æ‰¿ï¼ŒAdapterç±»åŒæ—¶ç»§æ‰¿Targetå’ŒAdapteeã€‚</p>
</li>
</ol>
<p>äºŒè€…å‡èƒ½è·å¾—AdapteeåŠŸèƒ½çš„åŒæ—¶å‘å®¢æˆ·æä¾›ç›®æ ‡æ¥å£ã€‚ä¸¤ç§å®ç°æ–¹å¼çš„ç±»å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="/design_pattern-image/image_-s6OMPY2i6.png"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç›®æ ‡æ¥å£ï¼ˆæ–°æ¥å£ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ITarget</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">process</span><span class="params">()</span></span>=<span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é—ç•™æ¥å£ï¼ˆè€æ¥å£ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IAdaptee</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">int</span> data)</span></span>=<span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">bar</span><span class="params">()</span></span>=<span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é—ç•™ç±»å‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OldClass</span>: <span class="keyword">public</span> IAdaptee&#123;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯¹è±¡é€‚é…å™¨</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Adapter</span>: <span class="keyword">public</span> ITarget&#123; <span class="comment">//ç»§æ‰¿</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    IAdaptee* pAdaptee;<span class="comment">//ç»„åˆ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Adapter</span>(IAdaptee* pAdaptee)&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;pAdaptee=pAdaptee;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">process</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> data=pAdaptee-&gt;<span class="built_in">bar</span>();</span><br><span class="line">        pAdaptee-&gt;<span class="built_in">foo</span>(data);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç±»é€‚é…å™¨</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Adapter</span>: <span class="keyword">public</span> ITarget,</span><br><span class="line">               <span class="keyword">protected</span> OldClass&#123; <span class="comment">//å¤šç»§æ‰¿</span></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">process</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> data = <span class="keyword">this</span>-&gt;<span class="built_in">bar</span>();</span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">foo</span>(data);</span><br><span class="line">  &#125;            </span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    IAdaptee* pAdaptee=<span class="keyword">new</span> <span class="built_in">OldClass</span>();</span><br><span class="line"></span><br><span class="line">    ITarget* pTarget=<span class="keyword">new</span> <span class="built_in">Adapter</span>(pAdaptee);<span class="comment">//ä½¿ç”¨å¯¹è±¡é€‚é…å™¨</span></span><br><span class="line"></span><br><span class="line">    ITarget* pTarget=<span class="keyword">new</span> <span class="built_in">Adapter</span>();<span class="comment">//ä½¿ç”¨ç±»é€‚é…å™¨</span></span><br><span class="line"></span><br><span class="line">    pTarget-&gt;<span class="built_in">process</span>();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-é—¨é¢-x2F-å¤–è§‚æ¨¡å¼ï¼ˆFacadeï¼‰"><a href="#9-é—¨é¢-x2F-å¤–è§‚æ¨¡å¼ï¼ˆFacadeï¼‰" class="headerlink" title="9 é—¨é¢&#x2F;å¤–è§‚æ¨¡å¼ï¼ˆFacadeï¼‰"></a>9 é—¨é¢&#x2F;å¤–è§‚æ¨¡å¼ï¼ˆFacadeï¼‰</h3><p>å®¢æˆ·ç«¯æƒ³åŒæ—¶è°ƒç”¨å¤šä¸ªå¤æ‚çš„å­ç³»ç»Ÿï¼Œè€Œå¤–è§‚æ¨¡å¼ä¸ºè¿™äº›å­ç³»ç»Ÿæä¾›ä¸€ä¸ªä¸€è‡´çš„æ¥å£ï¼Œä½¿å®ƒä»¬æ›´å®¹æ˜“è¢«è®¿é—®ã€‚</p>
<blockquote>
<p>ç°å®ç”Ÿæ´»çš„ç±»æ¯”ï¼šå¦‚åŠæˆ¿äº§è¯æˆ–æ³¨å†Œä¸€å®¶å…¬å¸ï¼Œæœ‰æ—¶è¦åŒå¤šä¸ªéƒ¨é—¨è”ç³»ï¼Œè¿™æ—¶è¦æ˜¯æœ‰ä¸€ä¸ªç»¼åˆéƒ¨é—¨èƒ½è§£å†³ä¸€åˆ‡æ‰‹ç»­é—®é¢˜å°±å¥½äº†ã€‚å¤–è§‚æ¨¡å¼å°±æ˜¯åœ¨è½¯ä»¶å±‚é¢åšè¿™æ ·çš„äº‹</p>
</blockquote>
<ul>
<li><p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li><p>é™ä½äº†å­ç³»ç»Ÿä¸å®¢æˆ·ç«¯ä¹‹é—´çš„è€¦åˆåº¦ï¼Œä½¿å¾—å­ç³»ç»Ÿçš„å˜åŒ–ä¸ä¼šå½±å“è°ƒç”¨å®ƒçš„å®¢æˆ·ç±»</p>
</li>
<li><p>å¯¹å®¢æˆ·å±è”½äº†å­ç³»ç»Ÿç»„ä»¶ï¼Œå‡å°‘äº†å®¢æˆ·å¤„ç†çš„å¯¹è±¡æ•°ç›®ï¼Œå¹¶ä½¿å¾—å­ç³»ç»Ÿä½¿ç”¨èµ·æ¥æ›´åŠ å®¹æ˜“</p>
</li>
<li><p>é™ä½äº†å¤§å‹è½¯ä»¶ç³»ç»Ÿä¸­çš„ç¼–è¯‘ä¾èµ–æ€§ï¼Œç®€åŒ–äº†ç³»ç»Ÿåœ¨ä¸åŒå¹³å°ä¹‹é—´çš„ç§»æ¤è¿‡ç¨‹ï¼Œå› ä¸ºç¼–è¯‘ä¸€ä¸ªå­ç³»ç»Ÿä¸ä¼šå½±å“å…¶ä»–çš„å­ç³»ç»Ÿï¼Œä¹Ÿä¸ä¼šå½±å“å¤–è§‚å¯¹è±¡</p>
</li>
</ol>
</li>
<li><p>ç¼ºç‚¹ï¼š</p>
<p>å¢åŠ æ–°çš„å­ç³»ç»Ÿå¯èƒ½éœ€è¦ä¿®æ”¹å¤–è§‚ç±»æˆ–å®¢æˆ·ç«¯çš„ä»£ç ï¼Œè¿èƒŒäº†â€œå¼€é—­åŸåˆ™â€ã€‚</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// @brief å…·ä½“å®ç°å­æ¨¡å—</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SubModuleImplementorA</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">PreRequest</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;SubModuleImplementorA::PreRequest!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SubModuleImplementorB</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">RealRequest</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;SubModuleImplementorB::RealRequest!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SubModuleImplementorC</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">PostRequest</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;SubModuleImplementorC::PostRequest!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief å¤–è§‚è§’è‰²</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Facade</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Facade</span>() &#123;</span><br><span class="line">        implA_.<span class="built_in">reset</span>(<span class="keyword">new</span> <span class="built_in">SubModuleImplementorA</span>());<span class="comment">//resetä¼šä½¿å¼•ç”¨è®¡æ•°-1</span></span><br><span class="line">        implB_.<span class="built_in">reset</span>(<span class="keyword">new</span> <span class="built_in">SubModuleImplementorB</span>());</span><br><span class="line">        implC_.<span class="built_in">reset</span>(<span class="keyword">new</span> <span class="built_in">SubModuleImplementorC</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        implA_-&gt;<span class="built_in">PreRequest</span>();</span><br><span class="line">        implB_-&gt;<span class="built_in">RealRequest</span>();</span><br><span class="line">        implC_-&gt;<span class="built_in">PostRequest</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::shared_ptr&lt;SubModuleImplementorA&gt; implA_;</span><br><span class="line">    std::shared_ptr&lt;SubModuleImplementorB&gt; implB_;</span><br><span class="line">    std::shared_ptr&lt;SubModuleImplementorC&gt; implC_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Test_10_facade_impl_1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;-------------------- %s --------------------\n&quot;</span>, __FUNCTION__);</span><br><span class="line">    <span class="function">std::shared_ptr&lt;Facade&gt; <span class="title">ptr</span><span class="params">(<span class="keyword">new</span> Facade())</span></span>;</span><br><span class="line">    ptr-&gt;<span class="built_in">Request</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ“Œshared_ptrçš„reset(new class())ç”¨æ³•ï¼Œå…ˆnewå‡ºæ¥å¯¹è±¡ï¼Œå†å°†shared_ptrå¼•ç”¨è®¡æ•°-1ã€‚å› æ­¤ï¼Œè‹¥ä¹‹å‰æŒ‡é’ˆåªæŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œ-1åä¸º0ï¼Œè‡ªåŠ¨ææ„ï¼ŒæŒ‡é’ˆæ‚¬ç©ºï¼Œå°±å¯ä»¥æŒ‡å‘æ–°newå‡ºæ¥çš„å¯¹è±¡ã€‚</p>
</blockquote>
<h3 id="10-ç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰"><a href="#10-ç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰" class="headerlink" title="10 ç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰"></a>10 ç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰</h3><p>ç»„åˆæ¨¡å¼å°†å¯¹è±¡<strong>ç»„åˆæˆæ ‘çŠ¶å±‚æ¬¡ç»“æ„</strong>ï¼Œä½¿ç”¨æˆ·<strong>å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡å…·æœ‰ä¸€è‡´çš„è®¿é—®æ€§</strong>ã€‚</p>
<ul>
<li><p>åº”ç”¨åœºæ™¯ï¼š</p>
<p>è½¯ä»¶å¼€å‘ä¸­å­˜åœ¨å¾ˆå¤šâ€œéƒ¨åˆ†-æ•´ä½“â€çš„å…³ç³»ï¼Œå¦‚æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶ä¸æ–‡ä»¶å¤¹ç­‰ç­‰ã€‚å¯¹è¿™äº›ç®€å•å¯¹è±¡ä¸å¤åˆå¯¹è±¡çš„å¤„ç†ï¼Œç”¨ç»„åˆæ¨¡å¼æ¥å®ç°ä¼šæ¯”è¾ƒæ–¹ä¾¿ã€‚</p>
</li>
<li><p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li><p>å®¢æˆ·ç«¯ä»£ç å¯ä»¥ä¸€è‡´åœ°å¤„ç†å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡ï¼Œæ— é¡»å…³å¿ƒè‡ªå·±å¤„ç†çš„å•ä¸ªå¯¹è±¡è¿˜æ˜¯ç»„åˆå¯¹è±¡ï¼Œç®€åŒ–äº†å®¢æˆ·ç«¯ä»£ç çš„è®¾è®¡ï¼›</p>
</li>
<li><p>æ›´å®¹æ˜“åœ¨ç»„åˆä½“å†…åŠ å…¥æ–°çš„å¯¹è±¡ï¼Œå®¢æˆ·ç«¯ä¸ä¼šå› ä¸ºåŠ å…¥äº†æ–°çš„å¯¹è±¡è€Œæ›´æ”¹æºç ï¼Œæ»¡è¶³â€œå¼€é—­åŸåˆ™â€ã€‚</p>
</li>
</ul>
</li>
<li><p>ç¼ºç‚¹ï¼š</p>
<ul>
<li><p>è®¾è®¡è¾ƒå¤æ‚ï¼Œå®¢æˆ·ç«¯éœ€è¦èŠ±æ›´å¤šæ—¶é—´ç†æ¸…ç±»ä¹‹é—´çš„å±‚æ¬¡å…³ç³»ï¼›</p>
</li>
<li><p>ä¸å®¹æ˜“ç”¨ç»§æ‰¿çš„æ–¹æ³•å¢åŠ åŠŸèƒ½ã€‚</p>
</li>
</ul>
</li>
</ul>
<h4 id="é€æ˜å¼"><a href="#é€æ˜å¼" class="headerlink" title="é€æ˜å¼"></a>é€æ˜å¼</h4><p>æŠ½è±¡ç»„ä»¶å£°æ˜å­ç±»ä¸­çš„å…¨éƒ¨æ–¹æ³•ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯æ— éœ€åŒºåˆ«å¶å­å¯¹è±¡å’Œä¸­é—´çš„æ ‘æå¯¹è±¡ï¼Œå¯¹å®¢æˆ·ç«¯é€æ˜ã€‚</p>
<blockquote>
<p>ç¼ºç‚¹åœ¨äºï¼Œå¶å­ç±»æœ¬ä¸å¿…æœ‰Add()ã€Remove()è¿™æ ·çš„æ–¹æ³•ï¼Œå´è¦å®ç°å®ƒä»¬ï¼Œä»è€Œæœ‰å®‰å…¨é—®é¢˜ã€‚</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Component</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">process</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Component</span>()&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ‘æèŠ‚ç‚¹ &amp; å¶å­èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Composite</span> : <span class="keyword">public</span> Component&#123;</span><br><span class="line"></span><br><span class="line">    string name;</span><br><span class="line">    list&lt;Component*&gt; elements;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Composite</span>(<span class="type">const</span> string &amp; s) : <span class="built_in">name</span>(s) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(Component* element)</span> </span>&#123;</span><br><span class="line">        elements.<span class="built_in">push_back</span>(element);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">remove</span><span class="params">(Component* element)</span></span>&#123;</span><br><span class="line">        elements.<span class="built_in">remove</span>(element);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">process</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. process current node</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. process leaf nodes</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e : elements)</span><br><span class="line">            e-&gt;<span class="built_in">process</span>(); <span class="comment">//å¤šæ€è°ƒç”¨</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯¹ç»„åˆå¯¹è±¡å’Œå•ä¸ªå¯¹è±¡æ‰§è¡Œä¸€è‡´å¤„ç†</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Invoke</span><span class="params">(Component &amp; c)</span></span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    c.<span class="built_in">process</span>();</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å®‰å…¨å¼"><a href="#å®‰å…¨å¼" class="headerlink" title="å®‰å…¨å¼"></a>å®‰å…¨å¼</h4><p>å°†ç®¡ç†å­componentçš„æ–¹æ³•ç§»åˆ°æ ‘æcomponentä¸­ï¼ŒæŠ½è±¡componentå’Œå¶å­componentæ²¡æœ‰å¯¹å­componentçš„ç®¡ç†æ–¹æ³•ï¼Œä»è€Œé¿å…ä¸Šä¸€ç§æ–¹å¼çš„å®‰å…¨æ€§é—®é¢˜ã€‚</p>
<blockquote>
<p>ç”±äºå¶å­å’Œåˆ†æ”¯æœ‰ä¸åŒçš„æ¥å£ï¼Œå› æ­¤å®¢æˆ·ç«¯åœ¨è°ƒç”¨æ—¶è¦çŸ¥é“å¶å­å¯¹è±¡å’Œæ ‘æå¯¹è±¡çš„å­˜åœ¨ï¼Œä¸å†ä¸¥æ ¼é€æ˜ã€‚</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Component</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">process</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Component</span>()&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ‘èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Composite</span> : <span class="keyword">public</span> Component&#123;</span><br><span class="line"></span><br><span class="line">    string name;</span><br><span class="line">    list&lt;Component*&gt; elements;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Composite</span>(<span class="type">const</span> string &amp; s) : <span class="built_in">name</span>(s) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(Component* element)</span> </span>&#123;</span><br><span class="line">        elements.<span class="built_in">push_back</span>(element);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">remove</span><span class="params">(Component* element)</span></span>&#123;</span><br><span class="line">        elements.<span class="built_in">remove</span>(element);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">process</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. process current node</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. process leaf nodes</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e : elements)</span><br><span class="line">            e-&gt;<span class="built_in">process</span>(); <span class="comment">//å¤šæ€è°ƒç”¨</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¶å­èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Leaf</span> : <span class="keyword">public</span> Component&#123;</span><br><span class="line">    string name;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Leaf</span>(string s) : <span class="built_in">name</span>(s) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">process</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//process current node</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯¹ç»„åˆå¯¹è±¡å’Œå•ä¸ªå¯¹è±¡æ‰§è¡Œä¸€è‡´å¤„ç†</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Invoke</span><span class="params">(Component &amp; c)</span></span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    c.<span class="built_in">process</span>();</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//mainå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">Composite <span class="title">root</span><span class="params">(<span class="string">&quot;root&quot;</span>)</span></span>;</span><br><span class="line">    <span class="function">Composite <span class="title">treeNode1</span><span class="params">(<span class="string">&quot;treeNode1&quot;</span>)</span></span>;</span><br><span class="line">    <span class="function">Composite <span class="title">treeNode2</span><span class="params">(<span class="string">&quot;treeNode2&quot;</span>)</span></span>;</span><br><span class="line">    <span class="function">Leaf <span class="title">leat1</span><span class="params">(<span class="string">&quot;left1&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    root.<span class="built_in">add</span>(&amp;treeNode1);</span><br><span class="line">    treeNode1.<span class="built_in">add</span>(&amp;treeNode2);</span><br><span class="line">    treeNode2.<span class="built_in">add</span>(&amp;leaf1);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">process</span>(root);</span><br><span class="line">    <span class="built_in">process</span>(leaf1);</span><br><span class="line">    <span class="built_in">process</span>(treeNode2);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="11-äº«å…ƒæ¨¡å¼ï¼ˆFlyweightï¼‰"><a href="#11-äº«å…ƒæ¨¡å¼ï¼ˆFlyweightï¼‰" class="headerlink" title="11 äº«å…ƒæ¨¡å¼ï¼ˆFlyweightï¼‰"></a>11 äº«å…ƒæ¨¡å¼ï¼ˆFlyweightï¼‰</h3><p>å¾ˆå¤šæƒ…å†µä¸‹ï¼Œéœ€è¦åœ¨ç³»ç»Ÿä¸­å¢åŠ ç±»å’Œå¯¹è±¡çš„ä¸ªæ•°ï¼Œå½“å¯¹è±¡æ•°é‡å¤ªå¤šæ—¶ï¼Œå°†å¯¼è‡´è¿è¡Œä»£ä»·è¿‡é«˜ï¼Œå¸¦æ¥æ€§èƒ½ä¸‹é™ç­‰é—®é¢˜ã€‚äº«å…ƒæ¨¡å¼é’ˆå¯¹æ­¤é—®é¢˜è¯ç”Ÿï¼Œå…¶ä½¿å¾—ç›¸åŒæˆ–ç›¸ä¼¼å¯¹è±¡åœ¨é‡ç”¨æ—¶ï¼Œå…±äº«æŸä¸€ä¸ªå¯¹è±¡çš„å†…å®¹ã€‚</p>
<p>åœ¨äº«å…ƒæ¨¡å¼ä¸­å¯ä»¥å…±äº«çš„ç›¸åŒå†…å®¹ç§°ä¸ºå†…éƒ¨çŠ¶æ€ï¼Œè€Œé‚£äº›éœ€è¦å¤–éƒ¨ç¯å¢ƒæ¥è®¾ç½®çš„ä¸èƒ½å…±äº«çš„å†…å®¹ç§°ä¸ºå¤–éƒ¨çŠ¶æ€ã€‚äº«å…ƒæ¨¡å¼ä¸­é€šå¸¸ä¼šå‡ºç°å·¥å‚æ¨¡å¼ï¼Œéœ€åˆ›å»ºä¸€ä¸ªäº«å…ƒå·¥å‚æ¥ç»´æŠ¤ä¸€ä¸ªäº«å…ƒæ± ï¼Œç”¨äºå­˜å‚¨å…·æœ‰ç›¸åŒå†…éƒ¨çŠ¶æ€çš„äº«å…ƒå¯¹è±¡ã€‚</p>
<p>äº«å…ƒæ¨¡å¼çš„ä¼˜ç‚¹åœ¨äºï¼Œ<strong>å¯ä»¥æå¤§å‡å°‘å†…å­˜ä¸­å¯¹è±¡çš„æ•°é‡</strong>ï¼Œä½¿å¾—ç›¸åŒå¯¹è±¡æˆ–ç›¸ä¼¼å¯¹è±¡åœ¨å†…å­˜ä¸­åªä¿å­˜ä¸€ä»½</p>
<p>ï¼ˆFlyweightå…¶å®å°±æ˜¯è½»é‡çº§ï¼‰</p>
<p><img src="/design_pattern-image/image_NoWKqwuRPL.png"></p>
<ul>
<li><p>Flyweightï¼šæŠ½è±¡äº«å…ƒç±»ï¼Œæè¿°ä¸€ä¸ªæ¥å£ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£Flyweightå¯ä»¥æ¥å—å¹¶ä½œç”¨äºå¤–éƒ¨çŠ¶æ€</p>
</li>
<li><p>ConcreteFlyweightï¼šå…·ä½“äº«å…ƒç±»ï¼Œå®šä¹‰äº†ä¸€äº›å†…éƒ¨çŠ¶æ€ã€‚ConcreteFlyweightå¯¹è±¡å¿…é¡»æ˜¯å¯å…±äº«çš„</p>
</li>
<li><p>UnsharedConcreteFlyweightï¼šéå…±äº«å…·ä½“äº«å…ƒç±»</p>
</li>
<li><p>FlyweightFactoryï¼šäº«å…ƒå·¥å‚ç±»ï¼Œåˆ›å»ºå¹¶ç®¡ç†FlyWeightã€‚å½“ç”¨æˆ·è¯·æ±‚ä¸€ä¸ªFlyweightæ—¶ï¼ŒFlyweightFactoryå¯¹è±¡æä¾›ä¸€ä¸ªå·²åˆ›å»ºçš„å®ä¾‹ï¼Œå¦‚æœè¯·æ±‚çš„å®ä¾‹ä¸å­˜åœ¨ï¼Œå°±æ–°åˆ›å»ºä¸€ä¸ªå®ä¾‹ã€‚</p>
</li>
</ul>
<p><img src="/design_pattern-image/image_Qpd2kj70i2.png"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// @brief éäº«å…ƒç±», ä»¥å‚æ•°çš„å½¢å¼æ³¨å…¥å…·ä½“äº«å…ƒçš„ç›¸å…³æ–¹æ³•ä¸­</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UnsharableConcreteFlyweight</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">UnsharableConcreteFlyweight</span>(<span class="type">const</span> std::string&amp; content) : <span class="built_in">content_</span>(content) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">GetContent</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> content_; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string content_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief æŠ½è±¡äº«å…ƒç±», ä¸ºå…·ä½“äº«å…ƒè§„èŒƒéœ€è¦å®ç°çš„å…¬å…±æ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractFlyweight</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">AbstractFlyweight</span>() &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Run</span><span class="params">(UnsharableConcreteFlyweight* unsharable_content_ptr)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief å…·ä½“äº«å…ƒç±», å®ç°æŠ½è±¡äº«å…ƒè§’è‰²ä¸­æ‰€è§„å®šçš„æ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteFlyweightA</span> : <span class="keyword">public</span> AbstractFlyweight &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Run</span><span class="params">(UnsharableConcreteFlyweight* unsharable_content_ptr)</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ConcreteFlyweightA::Run!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        std::cout &lt;&lt; unsharable_content_ptr-&gt;<span class="built_in">GetContent</span>() &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteFlyweightB</span> : <span class="keyword">public</span> AbstractFlyweight &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Run</span><span class="params">(UnsharableConcreteFlyweight* unsharable_content_ptr)</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ConcreteFlyweightB::Run!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        std::cout &lt;&lt; unsharable_content_ptr-&gt;<span class="built_in">GetContent</span>() &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief äº«å…ƒå·¥å‚ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FlyweightFactory</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">FlyweightType</span> &#123;</span><br><span class="line">        ConcreteA = <span class="number">0</span>,</span><br><span class="line">        ConcreteB,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">FlyweightFactory</span>() &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> it = fly_weights_.<span class="built_in">begin</span>(); it != fly_weights_.<span class="built_in">end</span>(); it++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (it-&gt;second) <span class="keyword">delete</span> it-&gt;second;</span><br><span class="line">        &#125;</span><br><span class="line">        fly_weights_.<span class="built_in">clear</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">AbstractFlyweight* <span class="title">GetFlyweight</span><span class="params">(<span class="type">const</span> std::string&amp; key, <span class="type">const</span> FlyweightType&amp; type = ConcreteA)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> it = fly_weights_.<span class="built_in">find</span>(key);</span><br><span class="line">        <span class="keyword">if</span> (fly_weights_.<span class="built_in">end</span>() == it) &#123;</span><br><span class="line">            AbstractFlyweight* ptr = <span class="literal">nullptr</span>;</span><br><span class="line">            <span class="keyword">if</span> (ConcreteA == type) &#123;</span><br><span class="line">                ptr = <span class="keyword">new</span> <span class="built_in">ConcreteFlyweightA</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (ConcreteB == type) &#123;</span><br><span class="line">                ptr = <span class="keyword">new</span> <span class="built_in">ConcreteFlyweightB</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            fly_weights_[key] = ptr;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> fly_weights_[key];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::map&lt;std::string, AbstractFlyweight*&gt; fly_weights_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>mainå‡½æ•°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">std::shared_ptr&lt;UnsharableConcreteFlyweight&gt; <span class="title">unsharable_content_ptr_1</span><span class="params">(<span class="keyword">new</span> UnsharableConcreteFlyweight(<span class="string">&quot;unsharable_content_ptr_1&quot;</span>))</span></span>;</span><br><span class="line">    <span class="function">std::shared_ptr&lt;UnsharableConcreteFlyweight&gt; <span class="title">unsharable_content_ptr_2</span><span class="params">(<span class="keyword">new</span> UnsharableConcreteFlyweight(<span class="string">&quot;unsharable_content_ptr_2&quot;</span>))</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::shared_ptr&lt;FlyweightFactory&gt; <span class="title">ptr</span><span class="params">(<span class="keyword">new</span> FlyweightFactory())</span></span>;</span><br><span class="line">    AbstractFlyweight* flyweight_ptr_A_red = ptr-&gt;<span class="built_in">GetFlyweight</span>(<span class="string">&quot;Red&quot;</span>);</span><br><span class="line">    AbstractFlyweight* flyweight_ptr_A_point = ptr-&gt;<span class="built_in">GetFlyweight</span>(<span class="string">&quot;Point&quot;</span>);</span><br><span class="line"></span><br><span class="line">    flyweight_ptr_A_red-&gt;<span class="built_in">Run</span>(unsharable_content_ptr_1.<span class="built_in">get</span>());</span><br><span class="line">    flyweight_ptr_A_point-&gt;<span class="built_in">Run</span>(unsharable_content_ptr_2.<span class="built_in">get</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ConcreteFlyweightA::Run!</span></span><br><span class="line"><span class="comment">// unsharable_content_ptr_1</span></span><br><span class="line"><span class="comment">// ConcreteFlyweightA::Run!</span></span><br><span class="line"><span class="comment">// unsharable_content_ptr_2</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ“Œäº«å…ƒæ¨¡å¼åœ¨ç¼–è¾‘å™¨è½¯ä»¶ä¸­å¤§é‡ä½¿ç”¨ï¼Œå¦‚åœ¨ä¸€ä¸ªæ–‡æ¡£ä¸­å¤šæ¬¡å‡ºç°ç›¸åŒçš„å›¾ç‰‡ï¼Œåˆ™åªéœ€è¦åˆ›å»ºä¸€ä¸ªå›¾ç‰‡å¯¹è±¡ï¼Œé€šè¿‡åœ¨åº”ç”¨ç¨‹åºä¸­è®¾ç½®è¯¥å›¾ç‰‡å‡ºç°çš„ä½ç½®ï¼Œå¯ä»¥å®ç°è¯¥å›¾ç‰‡åœ¨ä¸åŒåœ°æ–¹å¤šæ¬¡é‡å¤æ˜¾ç¤ºã€‚</p>
</blockquote>
<h2 id="è¡Œä¸ºå‹"><a href="#è¡Œä¸ºå‹" class="headerlink" title="è¡Œä¸ºå‹"></a>è¡Œä¸ºå‹</h2><blockquote>
<p>ğŸ“Œè¿­ä»£å™¨(5) &#x3D; è§‚å¯Ÿè€…(5) &gt; å‘½ä»¤(4) &#x3D; ç­–ç•¥(4) &gt; èŒè´£é“¾(3) &#x3D; çŠ¶æ€(3) &#x3D; æ¨¡æ¿(3) &gt; ä¸­ä»‹(2) &#x3D; å¤‡å¿˜å½•(2) &gt; è®¿é—®è€…(1) &#x3D; è§£é‡Šå™¨(1)&amp;#x20;</p>
</blockquote>
<h3 id="12-è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰"><a href="#12-è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰" class="headerlink" title="12 è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰"></a>12 è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰</h3><p>è§‚å¯Ÿè€…æ¨¡å¼å»ºç«‹å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„ä¸€å¯¹å¤šä¾èµ–å…³ç³»ã€‚ä¸€ä¸ªå¯¹è±¡å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå°†è‡ªåŠ¨é€šçŸ¥å…¶ä»–å¯¹è±¡ï¼Œå…¶ä»–å¯¹è±¡ä¼šåšå‡ºç›¸åº”çš„ååº”ï¼ˆå¦‚è¢«è‡ªåŠ¨æ›´æ–°ï¼‰ã€‚</p>
<p>å‘ç”Ÿæ”¹å˜çš„å¯¹è±¡ç§°ä¸ºè§‚å¯Ÿç›®æ ‡ï¼Œè€Œè¢«é€šçŸ¥çš„å¯¹è±¡ç§°ä¸ºè§‚å¯Ÿè€…ã€‚</p>
<blockquote>
<p>è§‚å¯Ÿè€…æ¨¡å¼åˆè¢«ç§°ä½œå‘å¸ƒ-è®¢é˜…æ¨¡å¼(Publish&#x2F;Subscribe)ã€æ¨¡å‹-è§†å›¾æ¨¡å¼(Model&#x2F;View)ã€æº-ç›‘å¬å™¨æ¨¡å¼(Source&#x2F;Listener)ã€ä»å±è€…æ¨¡å¼(Dependents)ã€‚</p>
</blockquote>
<p><img src="/design_pattern-image/image_zETtFplPnQ.png"></p>
<ul>
<li><p>ä¼˜ç‚¹ï¼šæ”¯æŒå¹¿æ’­é€šä¿¡ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ã€‚å¯ä»¥å®ç°è¡¨ç¤ºå±‚å’Œæ•°æ®é€»è¾‘å±‚çš„åˆ†ç¦»ï¼Œåœ¨è§‚å¯Ÿç›®æ ‡å’Œè§‚å¯Ÿè€…ä¹‹é—´å»ºç«‹ä¸€ä¸ªæŠ½è±¡çš„è€¦åˆã€‚</p>
</li>
<li><p>ç¼ºç‚¹ï¼š</p>
<ul>
<li><p>å¦‚æœä¸€ä¸ªè§‚å¯Ÿç›®æ ‡å¯¹è±¡æœ‰å¾ˆå¤šç›´æ¥å’Œé—´æ¥çš„è§‚å¯Ÿè€…çš„è¯ï¼Œå°†æ‰€æœ‰è§‚å¯Ÿè€…éƒ½é€šçŸ¥åˆ°ä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´</p>
</li>
<li><p>å¦‚æœè§‚å¯Ÿè€…å’Œè§‚å¯Ÿç›®æ ‡ä¹‹é—´æœ‰å¾ªç¯ä¾èµ–ï¼Œè§‚å¯Ÿç›®æ ‡ä¼šè§¦å‘å®ƒä»¬ä¹‹é—´å¾ªç¯è°ƒç”¨ï¼Œå¯èƒ½ç³»ç»Ÿå´©æºƒ</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// @brief æŠ½è±¡è§‚å¯Ÿè€…, åŒ…å«äº†ä¸€ä¸ªæ›´æ–°è‡ªå·±çš„æŠ½è±¡æ–¹æ³•ï¼Œå½“æ¥åˆ°å…·ä½“ä¸»é¢˜çš„æ›´æ”¹é€šçŸ¥æ—¶è¢«è°ƒç”¨ã€‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractObserver</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ~<span class="built_in">AbstractObserver</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¢«å‘ŠçŸ¥æ—¶åšå‡ºå“åº”</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Response</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief å…·ä½“è§‚å¯Ÿè€…, å®ç°æŠ½è±¡è§‚å¯Ÿè€…ä¸­å®šä¹‰çš„æŠ½è±¡æ–¹æ³•ï¼Œä»¥ä¾¿åœ¨å¾—åˆ°ç›®æ ‡çš„æ›´æ”¹é€šçŸ¥æ—¶æ›´æ–°è‡ªèº«çš„çŠ¶æ€ã€‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteObserverA</span> : <span class="keyword">public</span> AbstractObserver &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Response</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;this is ConcreteObserverA::Response!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteObserverB</span> : <span class="keyword">public</span> AbstractObserver &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Response</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;this is ConcreteObserverB::Response!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief æŠ½è±¡ä¸»é¢˜ç±», å®ƒæä¾›äº†ä¸€ä¸ªç”¨äºä¿å­˜è§‚å¯Ÿè€…å¯¹è±¡çš„èšé›†ç±»å’Œå¢åŠ ã€åˆ é™¤è§‚å¯Ÿè€…å¯¹è±¡çš„æ–¹æ³•ï¼Œä»¥åŠé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…çš„æŠ½è±¡æ–¹æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractSubject</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">AbstractSubject</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">NotifyObserver</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">AddObserver</span><span class="params">(AbstractObserver* observer)</span> </span>&#123;</span><br><span class="line">        observers_.<span class="built_in">emplace_back</span>(observer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">RemoveObserver</span><span class="params">(AbstractObserver* observer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> it = observers_.<span class="built_in">begin</span>(); it != observers_.<span class="built_in">end</span>(); it++) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((*it) == observer) &#123;</span><br><span class="line">                observers_.<span class="built_in">erase</span>(it++);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    std::vector&lt;AbstractObserver*&gt; observers_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief å…·ä½“ä¸»é¢˜ç±», å®ƒå®ç°æŠ½è±¡ç›®æ ‡ä¸­çš„é€šçŸ¥æ–¹æ³•ï¼Œå½“å…·ä½“ä¸»é¢˜çš„å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œé€šçŸ¥æ‰€æœ‰æ³¨å†Œè¿‡çš„è§‚å¯Ÿè€…å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteSubject</span> : <span class="keyword">public</span> AbstractSubject &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">NotifyObserver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span>* observer : observers_) &#123;</span><br><span class="line">            observer-&gt;<span class="built_in">Response</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;-------------------- %s --------------------\n&quot;</span>, __FUNCTION__);</span><br><span class="line">  <span class="function">std::shared_ptr&lt;AbstractSubject&gt; <span class="title">ptr_subject</span><span class="params">(<span class="keyword">new</span> ConcreteSubject())</span></span>;</span><br><span class="line">  <span class="function">std::shared_ptr&lt;AbstractObserver&gt; <span class="title">ptr_observer_A</span><span class="params">(<span class="keyword">new</span> ConcreteObserverA())</span></span>;</span><br><span class="line">  <span class="function">std::shared_ptr&lt;AbstractObserver&gt; <span class="title">ptr_observer_B</span><span class="params">(<span class="keyword">new</span> ConcreteObserverB())</span></span>;</span><br><span class="line"></span><br><span class="line">  ptr_subject-&gt;<span class="built_in">AddObserver</span>(ptr_observer_A.<span class="built_in">get</span>());</span><br><span class="line">  ptr_subject-&gt;<span class="built_in">AddObserver</span>(ptr_observer_B.<span class="built_in">get</span>());</span><br><span class="line"></span><br><span class="line">  ptr_subject-&gt;<span class="built_in">NotifyObserver</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="13-æ¨¡æ¿æ–¹æ³•ï¼ˆTemplateï¼‰"><a href="#13-æ¨¡æ¿æ–¹æ³•ï¼ˆTemplateï¼‰" class="headerlink" title="13 æ¨¡æ¿æ–¹æ³•ï¼ˆTemplateï¼‰"></a>13 æ¨¡æ¿æ–¹æ³•ï¼ˆTemplateï¼‰</h3><blockquote>
<p>å®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•çš„éª¨æ¶ï¼ˆç¨³å®šï¼‰ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿï¼ˆå˜åŒ–ï¼‰åˆ°å­ç±»ä¸­</p>
</blockquote>
<p>å…¶å®æ¨¡æ¿æ–¹æ³•é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å®šä¹‰ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œåœ¨è¯¥ç±»ä¸­å°†ä¸€ä¸ªç®—æ³•çš„å¤§è‡´æ¡†æ¶å†™å¥½ï¼Œè€Œç»†èŠ‚åˆ™ç”±å…¶æ´¾ç”Ÿçš„å…·ä½“ç±»æ¥å®ç°ã€‚</p>
<ul>
<li><p>åº”ç”¨åœºæ™¯ï¼š</p>
<p>åœ¨é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡è¿‡ç¨‹ä¸­ï¼Œç¨‹åºå‘˜å¸¸å¸¸ä¼šé‡åˆ°è¿™ç§æƒ…å†µï¼šè®¾è®¡ä¸€ä¸ªç³»ç»Ÿæ—¶çŸ¥é“äº†ç®—æ³•æ‰€éœ€çš„å…³é”®æ­¥éª¤ï¼Œè€Œä¸”ç¡®å®šäº†è¿™äº›æ­¥éª¤çš„æ‰§è¡Œé¡ºåºï¼Œä½†æŸäº›æ­¥éª¤çš„å…·ä½“å®ç°è¿˜æœªçŸ¥ï¼Œæˆ–è€…è¯´æŸäº›æ­¥éª¤çš„å®ç°ä¸å…·ä½“çš„ç¯å¢ƒç›¸å…³ã€‚</p>
<p>å¯¹åº”äºç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼Œå¯ä»¥ç±»æ¯”å†™è®ºæ–‡çš„è¿‡ç¨‹ã€‚å†™è®ºæ–‡éœ€è¦æå‰å†™å‡ºæçº²ï¼Œç¡®å®šå„æ®µçš„æ ‡é¢˜å’Œæ•´ä½“ç»“æ„ï¼Œä½†æ˜¯æ¯å°æ®µçš„æ–‡å­—å¯ä»¥åé¢å†å…·ä½“å†™ã€‚</p>
</li>
<li><p>å®ç°æ–¹å¼ï¼š</p>
<p><img src="/design_pattern-image/image_wg36lPjQXx.png"></p>
<p>æŠ½è±¡ç±»è´Ÿè´£ç»™å‡ºä¸€ä¸ªç®—æ³•çš„è½®å»“å’Œéª¨æ¶ï¼Œå®šä¹‰ä¸¤ç§ç±»å‹çš„æ–¹æ³•</p>
<ol>
<li><p>æ¨¡æ¿æ–¹æ³•ï¼šå®šä¹‰åœ¨æŠ½è±¡ç±»ä¸­çš„ï¼ŒæŠŠåŸºæœ¬æ“ä½œæ–¹æ³•ç»„åˆåœ¨ä¸€èµ·å½¢æˆæ€»ç®—æ³•æˆ–æ€»è¡Œä¸ºçš„æ–¹æ³•ã€‚</p>
<p>å­ç±»ä¼šä¸åŠ ä¿®æ”¹åœ°å®Œå…¨ç»§æ‰¿è¿™ä¸ªæ–¹æ³•ã€‚</p>
</li>
<li><p>åŸºæœ¬æ–¹æ³•ï¼š</p>
<ul>
<li><p>æŠ½è±¡æ–¹æ³•ï¼ˆå»¶è¿Ÿçš„å†…å®¹ï¼‰ï¼šåœ¨æŠ½è±¡ç±»ä¸­å£°æ˜ï¼Œç”±å…·ä½“å­ç±»å®ç°</p>
</li>
<li><p>å…·ä½“æ–¹æ³•ï¼ˆéª¨æ¶ï¼‰ï¼šåœ¨æŠ½è±¡ç±»ä¸­å·²å®ç°ï¼Œå…·ä½“å­ç±»ä¸­å¯ä»¥ç»§æ‰¿æˆ–é‡å†™å®ƒ</p>
</li>
<li><p>é’©å­æ–¹æ³•ï¼šæŠ½è±¡ç±»ä¸­å·²å®ç°ï¼ŒåŒ…æ‹¬ç”¨äºåˆ¤æ–­çš„é€»è¾‘æ–¹æ³•å’Œéœ€è¦å­ç±»é‡å†™çš„ç©ºæ–¹æ³•ä¸¤ç§ã€‚</p>
</li>
</ul>
</li>
</ol>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">namespace</span> template_method &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief æŠ½è±¡ç±», ç»™å‡ºä¸€ä¸ªç®—æ³•çš„è½®å»“å’Œéª¨æ¶</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractClass</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">AbstractClass</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// @brief æ¨¡æ¿æ–¹æ³•, å®šä¹‰äº†ç®—æ³•çš„éª¨æ¶ï¼ŒæŒ‰æŸç§é¡ºåºè°ƒç”¨å…¶åŒ…å«çš„åŸºæœ¬æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">TemplateMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">SpecificMethodA</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">HookMethodB</span>()) &#123;</span><br><span class="line">            <span class="built_in">HookMethodA</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">AbstractMethod</span>();</span><br><span class="line">        <span class="built_in">SpecificMethodB</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="comment">/// @brief åŸºæœ¬æ–¹æ³•, å¯ä»¥æœ‰ä¸‰ç§</span></span><br><span class="line">    <span class="comment">///             - æŠ½è±¡æ–¹æ³•ï¼šåœ¨æŠ½è±¡ç±»ä¸­ç”³æ˜ï¼Œç”±å…·ä½“å­ç±»å®ç°</span></span><br><span class="line">    <span class="comment">///             - å…·ä½“æ–¹æ³•ï¼šåœ¨æŠ½è±¡ç±»ä¸­å·²ç»å®ç°ï¼Œåœ¨å…·ä½“å­ç±»ä¸­å¯ä»¥ç»§æ‰¿æˆ–é‡å†™å®ƒ</span></span><br><span class="line">    <span class="comment">///             - é’©å­æ–¹æ³•ï¼šåœ¨æŠ½è±¡ç±»ä¸­å·²ç»å®ç°ï¼ŒåŒ…æ‹¬ç”¨äºåˆ¤æ–­çš„é€»è¾‘æ–¹æ³•å’Œéœ€è¦å­ç±»é‡å†™çš„ç©ºæ–¹æ³•ä¸¤ç§</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">AbstractMethod</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">SpecificMethodA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;this is AbstractClass::SpecificMethodA!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">SpecificMethodB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;this is AbstractClass::SpecificMethodB!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">HookMethodA</span><span class="params">()</span> </span>&#123;    <span class="comment">// é€šå¸¸ä¸ºç©ºå®ç°</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;this is AbstractClass::HookMethodA!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">HookMethodB</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="literal">false</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief å…·ä½“ç±», å®ç°æŠ½è±¡ç±»ä¸­æ‰€å®šä¹‰çš„æŠ½è±¡æ–¹æ³•å’Œé’©å­æ–¹æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteClass</span> : <span class="keyword">public</span> AbstractClass &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">AbstractMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;this is ConcreteClass::AbstractMethod!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">SpecificMethodB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;this is ConcreteClass::SpecificMethodB!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">HookMethodA</span><span class="params">()</span> </span>&#123;    <span class="comment">// é€šå¸¸ä¸ºç©ºå®ç°</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;this is ConcreteClass::HookMethodA!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">HookMethodB</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="literal">true</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">// namespace template_method</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Test_13_composite_impl_1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;-------------------- %s --------------------\n&quot;</span>, __FUNCTION__);</span><br><span class="line">    template_method::AbstractClass* ptr = <span class="keyword">new</span> template_method::<span class="built_in">ConcreteClass</span>();</span><br><span class="line">    ptr-&gt;<span class="built_in">TemplateMethod</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> ptr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li><p><strong>å°è£…äº†ä¸å˜éƒ¨åˆ†ï¼Œæ‰©å±•å¯å˜éƒ¨åˆ†</strong>ã€‚å®ƒæŠŠè®¤ä¸ºæ˜¯ä¸å˜éƒ¨åˆ†çš„ç®—æ³•å°è£…åˆ°çˆ¶ç±»ä¸­å®ç°ï¼Œè€ŒæŠŠå¯å˜éƒ¨åˆ†ç®—æ³•ç”±å­ç±»ç»§æ‰¿å®ç°ï¼Œä¾¿äºå­ç±»ç»§ç»­æ‰©å±•ã€‚</p>
</li>
<li><p>åœ¨çˆ¶ç±»ä¸­æå–äº†å…¬å…±çš„éƒ¨åˆ†ä»£ç ï¼Œä¾¿äºä»£ç å¤ç”¨ã€‚</p>
</li>
<li><p>éƒ¨åˆ†æ–¹æ³•æ˜¯ç”±å­ç±»å®ç°çš„ï¼Œå› æ­¤å­ç±»å¯ä»¥é€šè¿‡æ‰©å±•æ–¹å¼å¢åŠ ç›¸åº”çš„åŠŸèƒ½ï¼Œ<strong>ç¬¦åˆå¼€é—­åŸåˆ™</strong>ã€‚</p>
</li>
</ol>
</li>
<li><p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>å¯¹æ¯ä¸ªä¸åŒçš„å®ç°éƒ½éœ€è¦å®šä¹‰ä¸€ä¸ªå­ç±»ï¼Œè¿™ä¼šå¯¼è‡´<strong>ç±»çš„ä¸ªæ•°å¢åŠ </strong>ï¼Œç³»ç»Ÿæ›´åŠ åºå¤§ï¼Œè®¾è®¡ä¹Ÿæ›´åŠ æŠ½è±¡</li>
</ol>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>ğŸ“Œä¸€èˆ¬æ¨èå°†ä¸‰ç§åŸºæœ¬æ–¹æ³•è®¾ç½®ä¸ºprotected<br>æ¨¡æ¿æ–¹æ³•ä¸­ï¼Œå­˜åœ¨ç”±å­ç±»å½±å“çˆ¶ç±»çš„åå‘æ§åˆ¶ï¼Œæ˜¯â€œæ§åˆ¶åè½¬â€çš„å…¸å‹åº”ç”¨</p>
</blockquote>
<h3 id="14-ç­–ç•¥æ¨¡å¼ï¼ˆStrategy-x2F-Policyï¼‰"><a href="#14-ç­–ç•¥æ¨¡å¼ï¼ˆStrategy-x2F-Policyï¼‰" class="headerlink" title="14 ç­–ç•¥æ¨¡å¼ï¼ˆStrategy&#x2F;Policyï¼‰"></a>14 ç­–ç•¥æ¨¡å¼ï¼ˆStrategy&#x2F;Policyï¼‰</h3><p>è½¯ä»¶å¼€å‘ä¸­å¾€å¾€ä¼šé‡åˆ°è¿™æ ·çš„æƒ…å†µï¼šå®ç°æŸä¸€ä¸ªåŠŸèƒ½æœ‰å¤šä¸ªé€”å¾„ã€‚è€Œè¿™äº›ä¸åŒçš„æ–¹å¼å‡è¢«ç§°ä¸ºç­–ç•¥ï¼Œæ¯ä¸€ç§æ–¹å¼å°±æ˜¯ä¸€ä¸ªç­–ç•¥ã€‚</p>
<p>æ¯”å¦‚å®ç°ä¸€ä¸ªè´Ÿè´£æŸ¥æ‰¾ä»»åŠ¡çš„ç±»ï¼Œè€ŒæŸ¥æ‰¾æœ‰è‹¥å¹²ç§ç®—æ³•ï¼Œåœ¨ç±»ä¸­æ¯ä¸€ä¸ªæ–¹æ³•å¯¹åº”ç€ä¸€ç§ç®—æ³•ã€‚æˆ–è€…å°†æ‰€æœ‰çš„ç®—æ³•éƒ½å°è£…è¿›ä¸€ä¸ªæ–¹æ³•ä¸­ï¼Œé€šè¿‡è¾“å…¥å‚æ•°å’Œifâ€¦elseâ€¦æ¥åˆ¤å®šå…·ä½“ä½¿ç”¨ä½•ç§æŸ¥æ‰¾ç®—æ³•ã€‚è¿™ä¸¤ç§æ–¹å¼éƒ½å±äºç¡¬ç¼–ç ï¼ˆhard codingï¼‰ï¼Œæ˜¯ä¸æ¨èçš„ã€‚</p>
<p>åŸå› åœ¨äºï¼Œæ¯å¢åŠ ä¸€ç§æ–°çš„æŸ¥æ‰¾ç®—æ³•ï¼Œå°±éœ€è¦ä¿®æ”¹å°è£…ç®—æ³•ç±»çš„æºä»£ç ï¼›è€Œä¸”æ›´æ¢æŸ¥æ‰¾ç®—æ³•æ—¶ï¼Œä¹Ÿéœ€è¦ä¿®æ”¹å®¢æˆ·ç«¯çš„è°ƒç”¨ä»£ç ã€‚å¦‚æœç®—æ³•ç±»ä¸­å°è£…äº†å¤§é‡ç®—æ³•ï¼Œé‚£ä¹ˆè¯¥ç±»çš„ä»£ç ä¼šæ¯”è¾ƒå¤æ‚ï¼Œç»´æŠ¤è¾ƒä¸ºå›°éš¾ã€‚</p>
<p>ç­–ç•¥æ¨¡å¼æ—¨åœ¨è§£å†³è¿™æ ·çš„é—®é¢˜ï¼ˆå¯ä»¥è®°å¿†ä¸ºï¼Œè§£å†³ä»£ç ä¸­çš„å¤§é‡ifâ€¦elseâ€¦ï¼‰ï¼Œå…¶å°†ä¼—å¤šç­–ç•¥éƒ½å†™æˆä¸€ä¸ªç±»ï¼Œåˆ©ç”¨æŠ½è±¡ç­–ç•¥ç±»ä¸ºç”¨æˆ·æä¾›æ¥å£ã€‚åŒæ—¶ï¼Œè®©ä¸€ä¸ªContextç±»ï¼ˆç¯å¢ƒç±»ï¼‰æ¥è€¦åˆå®¢æˆ·ç«¯å’Œç®—æ³•ç±»ï¼Œæä¾›setStrategyç”¨äºæ›´æ¢ç®—æ³•ï¼Œå¹¶è¿›è¡Œç»Ÿä¸€è¯­ä¹‰çš„æ‰§è¡Œ</p>
<p><img src="/design_pattern-image/image_6PaWAnTsVZ.png"></p>
<ul>
<li><p>Contextï¼šç¯å¢ƒç±»</p>
</li>
<li><p>Strategyï¼šæŠ½è±¡ç­–ç•¥ç±»</p>
</li>
<li><p>ConcreteStrategyï¼šå…·ä½“ç­–ç•¥ç±»</p>
</li>
</ul>
<p><img src="/design_pattern-image/image_OPxig-n88x.png"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// @brief æŠ½è±¡ç­–ç•¥ç±», å®šä¹‰äº†ä¸€ä¸ªå…¬å…±æ¥å£ï¼Œå„ç§ä¸åŒçš„ç®—æ³•ä»¥ä¸åŒçš„æ–¹å¼å®ç°è¿™ä¸ªæ¥å£ï¼Œç¯å¢ƒè§’è‰²ä½¿ç”¨è¿™ä¸ªæ¥å£è°ƒç”¨ä¸åŒçš„ç®—æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractStrategy</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">AbstractStrategy</span>() &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">StrategyMethod</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief å…·ä½“ç­–ç•¥ç±», å®ç°äº†æŠ½è±¡ç­–ç•¥å®šä¹‰çš„æ¥å£ï¼Œæä¾›å…·ä½“çš„ç®—æ³•å®ç°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteStrategyA</span> : <span class="keyword">public</span> AbstractStrategy &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">StrategyMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;this is ConcreteStrategyA::StrategyMethod!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteStrategyB</span> : <span class="keyword">public</span> AbstractStrategy &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">StrategyMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;this is ConcreteStrategyB::StrategyMethod!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief ç¯å¢ƒç±», æŒæœ‰ä¸€ä¸ªç­–ç•¥ç±»çš„å¼•ç”¨ï¼Œæœ€ç»ˆç»™å®¢æˆ·ç«¯è°ƒç”¨</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Context</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">SetStrategy</span><span class="params">(AbstractStrategy* strategy)</span> </span>&#123;</span><br><span class="line">        strategy_ = strategy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">StrategyMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (strategy_) strategy_-&gt;<span class="built_in">StrategyMethod</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    AbstractStrategy* strategy_ = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    AbstractStrategy* ptr_strategy_A = <span class="keyword">new</span> <span class="built_in">ConcreteStrategyA</span>();</span><br><span class="line">    AbstractStrategy* ptr_strategy_B = <span class="keyword">new</span> <span class="built_in">ConcreteStrategyB</span>();</span><br><span class="line"></span><br><span class="line">    Context env_;</span><br><span class="line">    env_.<span class="built_in">SetStrategy</span>(ptr_strategy_A);</span><br><span class="line">    env_.<span class="built_in">StrategyMethod</span>();</span><br><span class="line"></span><br><span class="line">    env_.<span class="built_in">SetStrategy</span>(ptr_strategy_B);</span><br><span class="line">    env_.<span class="built_in">StrategyMethod</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> ptr_strategy_A;</span><br><span class="line">    <span class="keyword">delete</span> ptr_strategy_B;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li><p>ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä¸ä¿®æ”¹åŸæœ‰ç³»ç»Ÿçš„åŸºç¡€ä¸Šé€‰æ‹©ç®—æ³•è¡Œä¸ºï¼Œä¹Ÿå¯ä»¥çµæ´»åœ°å¢åŠ æ–°çš„ç®—æ³•æˆ–è¡Œä¸º</p>
</li>
<li><p>é¿å…å¤šé‡æ¡ä»¶è¯­å¥</p>
</li>
<li><p>æä¾›äº†ç®¡ç†ç›¸å…³çš„ç®—æ³•æ—çš„åŠæ³•</p>
</li>
</ul>
</li>
<li><p>ç¼ºç‚¹ï¼š</p>
<p>å®¢æˆ·ç«¯å¿…é¡»çŸ¥é“æ‰€æœ‰çš„ç­–ç•¥ç±»ï¼Œå¹¶è‡ªè¡Œå†³å®šä½¿ç”¨å“ªä¸€ä¸ªç­–ç•¥ç±»ã€‚</p>
</li>
</ul>
<h3 id="15-èŒè´£é“¾æ¨¡å¼ï¼ˆChain-of-Responsibilityï¼‰"><a href="#15-èŒè´£é“¾æ¨¡å¼ï¼ˆChain-of-Responsibilityï¼‰" class="headerlink" title="15 èŒè´£é“¾æ¨¡å¼ï¼ˆChain of Responsibilityï¼‰"></a>15 èŒè´£é“¾æ¨¡å¼ï¼ˆChain of Responsibilityï¼‰</h3><p>è€ƒè™‘è¿™æ ·çš„ä¾‹å­ï¼šä¼ä¸šçš„é‡‡è´­å®¡æ‰¹æ˜¯ä¸€èˆ¬æ˜¯åˆ†çº§è¿›è¡Œçš„ï¼Œå³æ ¹æ®é‡‡è´­é‡‘é¢çš„ä¸åŒç”±ä¸åŒå±‚æ¬¡çš„ä¸»ç®¡äººå‘˜æ¥å®¡æ‰¹ã€‚ä¸»ä»»å¯ä»¥å®¡æ‰¹5ä¸‡å…ƒä»¥ä¸‹çš„é‡‡è´­å•ï¼Œå‰¯è‘£äº‹é•¿å¯ä»¥å®¡æ‰¹5ä¸‡å…ƒè‡³10ä¸‡å…ƒçš„é‡‡è´­å•ï¼Œè‘£äº‹é•¿å¯ä»¥å®¡æ‰¹10ä¸‡å…ƒè‡³50ä¸‡å…ƒçš„é‡‡è´­å•ï¼Œ50ä¸‡å…ƒåŠä»¥ä¸Šçš„é‡‡è´­å•å°±éœ€è¦å¼€è‘£äº‹ä¼šè®¨è®ºå†³å®šã€‚</p>
<p>é‚£ä¹ˆä¸€ä¸ªè‡ªåŠ¨åŒ–çš„å®¡æ‰¹ç±»å¯ä»¥å†™æˆå¦‚ä¸‹å½¢å¼ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PurchaseRequestHandler</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handlePurchaseRequest</span><span class="params">(<span class="type">const</span> PurchaseRequest&amp; request)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> amount = request.<span class="built_in">getAmount</span>();</span><br><span class="line">        <span class="keyword">if</span>(amount &lt; <span class="number">50000</span>) &#123; <span class="keyword">this</span>-&gt;<span class="built_in">handleByDirector</span>(request); &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(amount &lt; <span class="number">100000</span>) &#123; <span class="keyword">this</span>-&gt;<span class="built_in">handleByVicePresident</span>(request); &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(amount &lt; <span class="number">500000</span>) &#123; <span class="keyword">this</span>-&gt;<span class="built_in">handleByPresident</span>(request); &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123; <span class="keyword">this</span>-&gt;<span class="built_in">handleByCongress</span>(request); &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// ä¸»ä»»å®¡æ‰¹é‡‡è´­å•</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handleByDirector</span><span class="params">(<span class="type">const</span> PurchaseRequest&amp; request)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‰¯è‘£äº‹é•¿å®¡æ‰¹é‡‡è´­å•</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handleByVicePresident</span><span class="params">(<span class="type">const</span> PurchaseRequest&amp; request)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è‘£äº‹é•¿å®¡æ‰¹é‡‡è´­å•</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handleByPresident</span><span class="params">(<span class="type">const</span> PurchaseRequest&amp; request)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è‘£äº‹ä¼šå®¡æ‰¹é‡‡è´­å•</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handleByCongress</span><span class="params">(<span class="type">const</span> PurchaseRequest&amp; request)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ä»”ç»†å®¡è§†è¿™æ®µä»£ç çš„è¯ï¼Œé¦–å…ˆï¼Œå®ƒè¿åäº†å•ä¸€èŒè´£åŸåˆ™ï¼Œå„ä¸ªçº§åˆ«çš„å®¡æ‰¹æ–¹æ³•éƒ½é›†ä¸­åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œæµ‹è¯•å’Œç»´æŠ¤éš¾åº¦å¤§ã€‚åŒæ—¶ä¸å¤Ÿçµæ´»ï¼Œç°æœ‰å®¡æ‰¹æµç¨‹ä»â€œä¸»ä»»â†’å‰¯è‘£â†’è‘£äº‹é•¿â†’è‘£äº‹ä¼šâ€æ”¹ä¸ºâ€œä¸»ä»»â†’è‘£äº‹é•¿â†’è‘£äº‹ä¼šâ€ï¼Œå°±å¿…é¡»ä¿®æ”¹ç±»çš„æºä»£ç ã€‚</p>
<blockquote>
<p>èŒè´£é“¾æ¨¡å¼é¢å‘çš„åœºæ™¯ï¼šä¸€ä¸ªè¯·æ±‚æœ‰å¤šä¸ªå¯¹è±¡å¯ä»¥å¤„ç†ï¼Œä½†æ˜¯æ¯ä¸ªå¯¹è±¡çš„å¤„ç†æ¡ä»¶æˆ–æƒé™ä¸åŒã€‚</p>
</blockquote>
<p>èŒè´£é“¾è´Ÿè´£è§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œå°†æ¯ä¸€çº§å†™æˆå¯¹è±¡åï¼Œæ’æˆä¸€ä¸ªé“¾è¡¨ã€‚è€Œæ¯ä¸€çº§çš„æ‰§è¡Œé¡ºåºï¼Œäº¤ç”±å®¢æˆ·ç«¯æ¥ç®¡ç†ã€‚</p>
<p><img src="/design_pattern-image/image_764XUH49fC.png"></p>
<p><img src="/design_pattern-image/image_XcWdMEsFCy.png"></p>
<ul>
<li><p>Handlerï¼šæŠ½è±¡å¤„ç†è€…ï¼Œsuccessorè´Ÿè´£å¯¹ä¸‹ä¸€çº§çš„å¼•ç”¨ï¼Œé€šè¿‡successorï¼Œå¤„ç†è€…ä»¬å¯ä»¥è¿æˆä¸€æ¡é“¾</p>
</li>
<li><p>ConcreteHandlerï¼šå…·ä½“å¤„ç†è€…ï¼Œç»§æ‰¿æŠ½è±¡å¤„ç†è€…ï¼Œè´Ÿè´£å…·ä½“å®ç°å¯¹è¯·æ±‚çš„å“åº”ã€‚</p>
</li>
</ul>
<p>èŒè´£é“¾æ¨¡å¼ä»£ç æ¨¡æ¿ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æŠ½è±¡å¤„ç†è€…</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setSuccessor</span><span class="params">(<span class="type">const</span> std::shared_ptr&lt;Handler&gt;&amp; successor)</span> </span>&#123;</span><br><span class="line">        successor_ = successor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">handleRequest</span><span class="params">(<span class="type">const</span> Request&amp; request)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    std::shared_ptr&lt;Handler&gt; successor_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“å¤„ç†è€…</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteHandler</span> : <span class="keyword">public</span> Handler &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handleRequest</span><span class="params">(<span class="type">const</span> Request&amp; request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="comment">/*æ»¡è¶³æŸä¸ªæ¡ä»¶*/</span>) &#123; </span><br><span class="line">            <span class="comment">// TO DO </span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123; successor_-&gt;<span class="built_in">handleRequest</span>(request); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ“ŒèŒè´£é“¾æ¨¡å¼æ›´ç»†åˆ†çš„è¯ä¹Ÿæœ‰ä¸¤ç§ï¼šçº¯èŒè´£é“¾å’Œéçº¯èŒè´£é“¾<br>çº¯èŒè´£é“¾ä¸­ï¼Œæ¯ä¸€çº§ç›´æ¥å®Œå…¨æ‰¿æ‹…å¯¹è¯·æ±‚çš„å“åº”ï¼›<br>éçº¯èŒè´£é“¾ä¸­ï¼Œæ¯ä¸€çº§æ‰¿æ‹…éƒ¨åˆ†å“åº”å·¥ä½œã€‚</p>
</blockquote>
<p>é’ˆå¯¹ä¸Šé¢çš„ä¾‹å­ï¼Œä½¿ç”¨èŒè´£é“¾æ¨¡å¼ä¿®æ”¹çš„ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é‡‡è´­è¯·æ±‚å¤„ç†ç±»ï¼šæŠ½è±¡å¤„ç†ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PurchaseRequestHandler</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setSuccessor</span><span class="params">(<span class="type">const</span> std::shared_ptr&lt;PurchaseRequestHandler&gt;&amp; successor)</span> </span>&#123;</span><br><span class="line">        successor_ = successor;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">handlePurchaseRequest</span><span class="params">(<span class="type">const</span> PurchaseRequest&amp; request)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    std::shared_ptr&lt;PurchaseRequestHandler&gt; successor_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸»ä»»ç±»ï¼šå…·ä½“å¤„ç†è€…</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DirectorHandler</span> : <span class="keyword">public</span> PurchaseRequestHandler &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handlePurchaseRequest</span><span class="params">(<span class="type">const</span> PurchaseRequest&amp; request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(request.<span class="built_in">getAmount</span>() &lt; <span class="number">50000</span>) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123; successor_-&gt;<span class="built_in">handlePurchaseRequest</span>(request); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">... ...</span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯ä»£ç </span></span><br><span class="line">PurchaseRequest request;</span><br><span class="line">request.<span class="built_in">setAmount</span>(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">std::shared_ptr&lt;PurchaseRequestHandler&gt; director = std::<span class="built_in">make_shared</span>&lt;DirectorHandler&gt;();</span><br><span class="line">std::shared_ptr&lt;PurchaseRequestHandler&gt; vicePresident = std::<span class="built_in">make_shared</span>&lt;VicePresidentHandler&gt;();</span><br><span class="line">std::shared_ptr&lt;PurchaseRequestHandler&gt; president = std::<span class="built_in">make_shared</span>&lt;PresidentHandler&gt;();</span><br><span class="line">std::shared_ptr&lt;PurchaseRequestHandler&gt; congress = std::<span class="built_in">make_shared</span>&lt;CongressHandler&gt;();</span><br><span class="line">director-&gt;<span class="built_in">setSuccessor</span>(vicePresident);</span><br><span class="line">vicePresident-&gt;<span class="built_in">setSuccessor</span>(president);</span><br><span class="line">president-&gt;<span class="built_in">setSuccessor</span>(congress);</span><br><span class="line"></span><br><span class="line">director-&gt;<span class="built_in">handlePurchaseRequest</span>(request);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li><p>ç”±å®¢æˆ·ç«¯è´Ÿè´£èŒè´£é“¾çš„åˆ›å»ºï¼Œé“¾ä¸­å¯¹è±¡ä¸éœ€è¦çŸ¥é“é“¾çš„ç»“æ„ï¼Œé™ä½äº†ç³»ç»Ÿè€¦åˆåº¦</p>
</li>
<li><p>çµæ´»æ€§æ›´å¼ºï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„å…·ä½“è¯·æ±‚å¤„ç†è€…æ—¶æ— éœ€æ›´æ”¹åŸæœ‰ç³»ç»Ÿçš„ä»£ç ï¼Œåªéœ€è¦åœ¨å®¢æˆ·ç«¯é‡æ–°å»ºé“¾å³å¯ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ã€‚</p>
</li>
</ul>
</li>
<li><p>ç¼ºç‚¹ï¼š</p>
<ul>
<li><p>å¯èƒ½ä¼šå‡ºç°å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œå¯¼è‡´ç³»ç»Ÿè¿›å…¥æ­»å¾ªç¯</p>
</li>
<li><p>ç³»ç»Ÿæ€§èƒ½å—åˆ°ä¸€å®šå½±å“ï¼Œä»£ç è°ƒè¯•æ—¶ä¸å¤ªæ–¹ä¾¿</p>
</li>
<li><p>ç”±äºä¸€ä¸ªè¯·æ±‚æ²¡æœ‰æ˜ç¡®çš„æ¥æ”¶è€…ï¼Œé‚£ä¹ˆå°±ä¸èƒ½ä¿è¯å®ƒä¸€å®šä¼šè¢«å¤„ç†ï¼Œè¯¥è¯·æ±‚å¯èƒ½ä¸€ç›´åˆ°é“¾çš„æœ«ç«¯éƒ½å¾—ä¸åˆ°å¤„ç†ã€‚</p>
</li>
</ul>
</li>
</ul>
<h3 id="16-çŠ¶æ€æ¨¡å¼ï¼ˆStateï¼‰"><a href="#16-çŠ¶æ€æ¨¡å¼ï¼ˆStateï¼‰" class="headerlink" title="16 çŠ¶æ€æ¨¡å¼ï¼ˆStateï¼‰"></a>16 çŠ¶æ€æ¨¡å¼ï¼ˆStateï¼‰</h3><p>çŠ¶æ€æ¨¡å¼å°†å„ç§å¯èƒ½çš„è¡Œä¸ºæ„å»ºæˆäº†çŠ¶æ€æœºï¼Œæ¯æ¬¡è¯·æ±‚æ—¶è‡ªåŠ¨åˆ‡æ¢çŠ¶æ€ï¼ˆæ›´æ”¹è¡Œä¸ºï¼‰ã€‚</p>
<ul>
<li><p>åº”ç”¨åœºæ™¯ï¼š</p>
<p>åœ¨è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œ<strong>åº”ç”¨ç¨‹åºä¸­çš„æœ‰äº›å¯¹è±¡å¯èƒ½ä¼šæ ¹æ®ä¸åŒçš„æƒ…å†µåšå‡ºä¸åŒçš„è¡Œä¸º</strong>ï¼Œæˆ‘ä»¬æŠŠè¿™ç§å¯¹è±¡ç§°ä¸ºæœ‰çŠ¶æ€çš„å¯¹è±¡ï¼Œè€ŒæŠŠå½±å“å¯¹è±¡è¡Œä¸ºçš„ä¸€ä¸ªæˆ–å¤šä¸ªåŠ¨æ€å˜åŒ–çš„å±æ€§ç§°ä¸ºçŠ¶æ€ã€‚å½“æœ‰çŠ¶æ€çš„å¯¹è±¡ä¸å¤–éƒ¨äº‹ä»¶äº§ç”Ÿäº’åŠ¨æ—¶ï¼Œå…¶å†…éƒ¨çŠ¶æ€ä¼šå‘ç”Ÿæ”¹å˜ï¼Œä»è€Œä½¿å¾—å…¶è¡Œä¸ºä¹Ÿéšä¹‹å‘ç”Ÿæ”¹å˜ã€‚å¦‚äººçš„æƒ…ç»ªæœ‰é«˜å…´çš„æ—¶å€™å’Œä¼¤å¿ƒçš„æ—¶å€™ï¼Œä¸åŒçš„æƒ…ç»ªæœ‰ä¸åŒçš„è¡Œä¸ºï¼Œå½“ç„¶å¤–ç•Œä¹Ÿä¼šå½±å“å…¶æƒ…ç»ªå˜åŒ–ã€‚</p>
</li>
<li><p>çŠ¶æ€æ¨¡å¼æµç¨‹ï¼š</p>
<p>ä¼ ç»Ÿæ–¹æ¡ˆå¯èƒ½ä¼šé€‰æ‹©ç”¨ifâ€¦elseâ€¦æ¥è¿›è¡Œåˆ†æ”¯ï¼Œæ¶µç›–æ‰€æœ‰çš„è¡Œä¸ºã€‚è¿™æ ·çš„è¯ä¸ç¬¦åˆå¼€é—­åŸåˆ™ä¸æ˜“ç»´æŠ¤æ‰©å±•ã€‚çŠ¶æ€æ¨¡å¼å°†æ¯ç§çŠ¶æ€åŠå…¶è¡Œä¸ºå°è£…æˆäº†å…·ä½“çŠ¶æ€ç±»ConcreteStateï¼Œè€Œæ‰€æœ‰çš„å…·ä½“çŠ¶æ€ç±»ç»§æ‰¿è‡ªæŠ½è±¡çŠ¶æ€ç±»ã€‚ç”¨æˆ·ä¸Contextç±»äº¤äº’ï¼ŒContextè®°å½•ç€å½“å‰ç³»ç»Ÿçš„çŠ¶æ€ï¼Œå½“ç”¨æˆ·è¯·æ±‚æ—¶ï¼ŒContextå¯¹è±¡å°†æ ¹æ®å½“å‰çŠ¶æ€è°ƒç”¨å…·ä½“çŠ¶æ€ç±»çš„è¡Œä¸ºï¼ŒåŒæ—¶æ ¹æ®å‘ç”Ÿçš„è¡Œä¸ºæ›´æ”¹è‡ªå·±ç»´æŠ¤çš„çŠ¶æ€ï¼Œä»¥ä¾›ä¸‹ä¸€æ¬¡è¯·æ±‚ä½¿ç”¨ã€‚æœ¬è´¨ä¸Šï¼Œåœ¨ç±»ä¹‹é—´å»ºç«‹çŠ¶æ€æœºï¼Œè€ŒçŠ¶æ€è½¬æ¢çš„è§„åˆ™ç»´æŠ¤åœ¨äº†å„ä¸ªå…·ä½“çŠ¶æ€ç±»ä¸­ã€‚</p>
</li>
</ul>
<p><img src="/design_pattern-image/image_hN2yH2ASOc.png"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Context</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Context</span>()&#123;</span><br><span class="line">    m_pState = ConcreteStateA::<span class="built_in">Instance</span>();</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">virtual</span> ~<span class="built_in">Context</span>();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">changeState</span><span class="params">(State * st)</span></span>&#123;</span><br><span class="line">    m_pState = st;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">request</span><span class="params">()</span></span>&#123;</span><br><span class="line">    m_pState-&gt;<span class="built_in">handle</span>(<span class="keyword">this</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  State *m_pState;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteStateA</span> : <span class="keyword">public</span> State</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="keyword">virtual</span> ~<span class="built_in">ConcreteStateA</span>();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">static</span> State * <span class="title">Instance</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="literal">NULL</span> == m_pState)</span><br><span class="line">    &#123;</span><br><span class="line">      m_pState = <span class="keyword">new</span> <span class="built_in">ConcreteStateA</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> m_pState;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">handle</span><span class="params">(Context * c)</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;doing something in State A.\n done,change state to B&quot;</span> &lt;&lt; endl;</span><br><span class="line">    c-&gt;<span class="built_in">changeState</span>(ConcreteStateB::<span class="built_in">Instance</span>());</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="built_in">ConcreteStateA</span>();</span><br><span class="line">  <span class="type">static</span> State * m_pState;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> a = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">  <span class="keyword">if</span>(<span class="string">&#x27;0&#x27;</span> == a)</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;yes&quot;</span> &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;no&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">  Context * c = <span class="keyword">new</span> <span class="built_in">Context</span>();</span><br><span class="line">  c-&gt;<span class="built_in">request</span>();</span><br><span class="line">  c-&gt;<span class="built_in">request</span>();</span><br><span class="line">  c-&gt;<span class="built_in">request</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">delete</span> c;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ä¼˜ç‚¹ï¼š</p>
<p>ç›¸æ¯”äºifâ€¦elseâ€¦è¿›è¡ŒçŠ¶æ€å˜æ›´ä¸åˆ¤æ–­ï¼ŒçŠ¶æ€æ¨¡å¼ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ï¼Œè€Œä¸”å¼€é—­åŸåˆ™ä¹Ÿæ”¯æŒå¾—æ›´å¥½ä¸€äº›ã€‚</p>
</li>
<li><p>ç¼ºç‚¹ï¼š</p>
<p>å¯¹å¼€é—­åŸåˆ™ä»ç„¶ä¸æ˜¯å¾ˆå‹å¥½ï¼Œæƒ³æ‰©å±•æ–°çŠ¶æ€å°±å¿…é¡»ä¿®æ”¹è‹¥å¹²å…·ä½“çŠ¶æ€ç±»çš„æºç ï¼Œä¿®æ”¹è¡Œä¸ºä¹Ÿéœ€è¦ä¿®æ”¹å¯¹åº”çš„æºç ã€‚å› æ­¤éœ€è¦å¼€å‘è€…å°½å¯èƒ½äº‹å…ˆè€ƒè™‘åˆ°æ‰€æœ‰çš„å¯èƒ½çŠ¶æ€ã€‚</p>
</li>
</ul>
<h3 id="17-è¿­ä»£å™¨æ¨¡å¼ï¼ˆIteratorï¼‰"><a href="#17-è¿­ä»£å™¨æ¨¡å¼ï¼ˆIteratorï¼‰" class="headerlink" title="17 è¿­ä»£å™¨æ¨¡å¼ï¼ˆIteratorï¼‰"></a>17 è¿­ä»£å™¨æ¨¡å¼ï¼ˆIteratorï¼‰</h3><p>è¿­ä»£å™¨æä¾›ä¸€ç§æ–¹æ³•æ¥é¡ºåºè®¿é—®èšåˆå¯¹è±¡ä¸­çš„ä¸€ç³»åˆ—æ•°æ®ï¼Œè€Œä¸æš´éœ²èšåˆå¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚</p>
<p><img src="/design_pattern-image/image_LPlCPfrZ0o.png"></p>
<ul>
<li><p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li><p>è®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡çš„å†…å®¹è€Œæ— éœ€æš´éœ²å®ƒçš„å†…éƒ¨è¡¨ç¤º</p>
</li>
<li><p>éå†ä»»åŠ¡äº¤ç”±è¿­ä»£å™¨å®Œæˆï¼Œç®€åŒ–äº†èšåˆç±»ï¼ˆèšåˆç±»å¯ä»¥ä¸ç”¨æ“å¿ƒå®ç°è¿­ä»£çš„åŠŸèƒ½ï¼‰</p>
</li>
<li><p>æ”¯æŒä»¥ä¸åŒçš„æ–¹å¼éå†ä¸€ä¸ªèšåˆï¼Œç”šè‡³å¯ä»¥è‡ªå®šä¹‰è¿­ä»£å™¨çš„å­ç±»ä»¥æ”¯æŒæ–°çš„éå†</p>
</li>
<li><p>å¢åŠ æ–°çš„èšåˆç±»å’Œè¿­ä»£å™¨ç±»éƒ½å¾ˆæ–¹ä¾¿ï¼Œæ— éœ€ä¿®æ”¹åŸæœ‰ä»£ç </p>
</li>
<li><p>å°è£…æ€§è‰¯å¥½ï¼Œä¸ºéå†ä¸åŒçš„èšåˆç»“æ„æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£</p>
</li>
</ul>
</li>
</ul>
<p>C++çš„STLè‡ªå¸¦äº†Iteratorï¼Œæ— éœ€å†æ‰‹åŠ¨å®ç°ã€‚ç„¶è€Œä¸ºäº†èƒ½å¤Ÿæ›´ç›´è§‚çš„çœ‹è¿­ä»£å™¨æ¨¡å¼æ˜¯æ€ä¹ˆæ“ä½œçš„ï¼Œè¿™é‡Œç®€å•å†™äº†ä¸€ä¸‹ï¼š</p>
<ul>
<li>Aggregate</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Aggregate</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">count</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">push</span><span class="params">(<span class="type">const</span> std::string&amp; strValue)</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">virtual</span> std::string <span class="keyword">operator</span>[](<span class="type">int</span> nIndex) = <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> Iterator* <span class="title">createIterator</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteAggregate</span> :</span><br><span class="line">  <span class="keyword">public</span> Aggregate</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  ~<span class="built_in">ConcreteAggregate</span>();</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">count</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(<span class="type">const</span> std::string&amp; strValue)</span><span class="keyword">override</span></span>;</span><br><span class="line">  <span class="comment">//é‡è½½ä¸‹æ ‡è¿ç®—ç¬¦ï¼Œåªé‡è½½äº†å–å€¼åŠŸèƒ½</span></span><br><span class="line">  std::string <span class="keyword">operator</span>[](<span class="type">int</span> nIndex);</span><br><span class="line">  <span class="function">Iterator* <span class="title">createIterator</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  std::vector&lt;std::string&gt; m_vecItems;</span><br><span class="line">  Iterator* m_pIterator&#123; <span class="literal">nullptr</span> &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ConcreteAggregate::~<span class="built_in">ConcreteAggregate</span>()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="literal">nullptr</span> != m_pIterator)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">delete</span> m_pIterator;</span><br><span class="line">    m_pIterator = <span class="literal">nullptr</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ConcreteAggregate::count</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> m_vecItems.<span class="built_in">size</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ConcreteAggregate::push</span><span class="params">(<span class="type">const</span> std::string&amp; strValue)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  m_vecItems.<span class="built_in">push_back</span>(strValue);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">std::string ConcreteAggregate::<span class="keyword">operator</span>[](<span class="type">int</span> nIndex)</span><br><span class="line">&#123;</span><br><span class="line">  std::string strRet;</span><br><span class="line">  <span class="keyword">if</span> (nIndex &lt; <span class="built_in">count</span>())</span><br><span class="line">  &#123;</span><br><span class="line">    strRet = m_vecItems[nIndex];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> strRet;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Iterator* <span class="title">ConcreteAggregate::createIterator</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="literal">nullptr</span> == m_pIterator)</span><br><span class="line">  &#123;</span><br><span class="line">    m_pIterator = <span class="keyword">new</span> <span class="built_in">ConcreteIterator</span>(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> m_pIterator;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Iterator</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Iterator</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> std::string <span class="title">first</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> std::string <span class="title">next</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">isDone</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> std::string <span class="title">currentItem</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteIterator</span> :</span><br><span class="line">  <span class="keyword">public</span> Iterator</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">ConcreteIterator</span>(Aggregate* pAggregate);</span><br><span class="line">  <span class="function">std::string <span class="title">first</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function">std::string <span class="title">next</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="type">bool</span> <span class="title">isDone</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function">std::string <span class="title">currentItem</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  Aggregate* m_pAggregate&#123; <span class="literal">nullptr</span> &#125;;</span><br><span class="line">  <span class="type">int</span> m_nCurrent&#123; <span class="number">0</span> &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ConcreteIterator::<span class="built_in">ConcreteIterator</span>(Aggregate* pAggregate)</span><br><span class="line">  :<span class="built_in">Iterator</span>(), <span class="built_in">m_pAggregate</span>(pAggregate)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">ConcreteIterator::first</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (*m_pAggregate)[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">ConcreteIterator::next</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  std::string strRet;</span><br><span class="line">  m_nCurrent++;</span><br><span class="line">  <span class="keyword">if</span> (m_nCurrent &lt; m_pAggregate-&gt;<span class="built_in">count</span>())</span><br><span class="line">  &#123;</span><br><span class="line">    strRet = (*m_pAggregate)[m_nCurrent];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> strRet;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">ConcreteIterator::isDone</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (m_nCurrent &gt;= m_pAggregate-&gt;<span class="built_in">count</span>()) ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">ConcreteIterator::currentItem</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (*m_pAggregate)[m_nCurrent];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>client</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">client</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  ConcreteAggregate* pName = <span class="keyword">new</span> <span class="built_in">ConcreteAggregate</span>();</span><br><span class="line">  <span class="keyword">if</span> (<span class="literal">nullptr</span> != pName)</span><br><span class="line">  &#123;</span><br><span class="line">    pName-&gt;<span class="built_in">push</span>(<span class="string">&quot;å¢¨ç™½&quot;</span>);</span><br><span class="line">    pName-&gt;<span class="built_in">push</span>(<span class="string">&quot;é‡‘æˆˆé“é©¬&quot;</span>);</span><br><span class="line">    pName-&gt;<span class="built_in">push</span>(<span class="string">&quot;æ°”åä¸‡é‡Œå¦‚è™&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Iterator* iter = pName-&gt;<span class="built_in">createIterator</span>();</span><br><span class="line">  <span class="keyword">if</span> (<span class="literal">nullptr</span> != iter)</span><br><span class="line">  &#123;</span><br><span class="line">    std::string strItem = iter-&gt;<span class="built_in">first</span>();</span><br><span class="line">    <span class="keyword">while</span> (!iter-&gt;<span class="built_in">isDone</span>())</span><br><span class="line">    &#123;</span><br><span class="line">      std::cout &lt;&lt; iter-&gt;<span class="built_in">currentItem</span>() &lt;&lt; std::endl;</span><br><span class="line">      iter-&gt;<span class="built_in">next</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;================================&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; pName-&gt;<span class="built_in">count</span>(); ++i)</span><br><span class="line">  &#123;</span><br><span class="line">    std::cout &lt;&lt; (*pName)[i] &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="18-è®¿é—®è€…æ¨¡å¼ï¼ˆVisitorï¼‰"><a href="#18-è®¿é—®è€…æ¨¡å¼ï¼ˆVisitorï¼‰" class="headerlink" title="18 è®¿é—®è€…æ¨¡å¼ï¼ˆVisitorï¼‰"></a>18 è®¿é—®è€…æ¨¡å¼ï¼ˆVisitorï¼‰</h3><blockquote>
<p>è®¿é—®è€…æ¨¡å¼è¡¨ç¤ºä¸€ä¸ªä½œç”¨äºæŸå¯¹è±¡ç»“æ„ä¸­å„å…ƒç´ çš„æ“ä½œï¼Œå®ƒä½¿æˆ‘ä»¬å¯ä»¥åœ¨ä¸æ”¹å˜å„å…ƒç´ çš„ç±»çš„å‰æä¸‹ï¼Œå®šä¹‰ä½œç”¨äºè¿™äº›å…ƒç´ çš„æ–°æ“ä½œã€‚</p>
</blockquote>
<ul>
<li><p>åº”ç”¨åœºæ™¯ï¼š</p>
<p>æŸå¯¹è±¡ç»“æ„ä¸­ï¼Œå„å…ƒç´ çš„ç±»å‹å¯èƒ½ä¸ä¸€è‡´ï¼Œè€Œä¸Šå±‚éœ€è¦ä¸€ä¸ªå¯¹å„å…ƒç´ å…·ä½“æ“ä½œçš„ç»Ÿä¸€æ¥å£ã€‚</p>
</li>
</ul>
<p><img src="/design_pattern-image/image_MkjMugjdg_.png"></p>
<ul>
<li><p>Visitorï¼šæŠ½è±¡è®¿é—®è€…ï¼Œä¸ºObjectStructureç±»ä¸­æ¯ä¸€ä¸ªå…ƒç´ å£°æ˜ä¸€ä¸ªè®¿é—®æ“ä½œã€‚</p>
</li>
<li><p>ConcreteVisitorï¼šå…·ä½“è®¿é—®è€…ï¼Œé’ˆå¯¹é›†åˆä¸­çš„å„å…·ä½“ç±»å‹ï¼Œå®šä¹‰å…·ä½“è®¿é—®æ“ä½œã€‚</p>
</li>
<li><p>Elementï¼šæŠ½è±¡å…ƒç´ ï¼Œå³é›†åˆä¸­çš„æ‰€æœ‰å…·ä½“å…ƒç´ å‡ç»§æ‰¿è‡ªè¯¥æŠ½è±¡å…ƒç´ ç±»ï¼Œå®šä¹‰äº†ä¸€ä¸ªaccpet( )æ–¹æ³•ï¼Œæ–¹æ³•ä»¥ä¸€ä¸ªæŠ½è±¡è®¿é—®è€…ä½œä¸ºå‚æ•°ã€‚</p>
</li>
<li><p>ConcreteElementï¼šå…·ä½“å…ƒç´ ï¼Œå®ç°äº†Accpet( )æ–¹æ³•ã€‚æ¥æ”¶ä¸åŒçš„ConcreteVisitorå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå°±è¡¨ç¤ºåœ¨ä½¿ç”¨ä¸åŒçš„é›†åˆå…ƒç´ æ“ä½œæ–¹å¼ã€‚</p>
</li>
<li><p>ObjectStructureï¼šå…ƒç´ çš„é›†åˆï¼Œå„å…ƒç´ å¯èƒ½å±äºä¸åŒç±»å‹ï¼Œç±»æä¾›äº†éå†å…¶å†…éƒ¨å…ƒç´ çš„æ–¹æ³•ã€‚</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteElementA</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteElementB</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*æŠ½è±¡è®¿é—®è€…  å£°æ˜äº†è®¿é—®å…ƒç´ å¯¹è±¡çš„æ–¹æ³•ï¼Œé€šå¸¸ä¸ºæ¯ä¸€ç§ç±»å‹çš„å…ƒç´ å¯¹è±¡éƒ½æä¾›ä¸€ä¸ªè®¿é—®æ–¹æ³•*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Visitor</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">     <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">VisitConcreteElementA</span><span class="params">(ConcreteElementA *pElementA)</span> </span>= <span class="number">0</span>;</span><br><span class="line">     <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">VisitConcreteElementB</span><span class="params">(ConcreteElementB *pElementB)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*å…·ä½“è®¿é—®è€… ç”¨äºå®šä¹‰å¯¹ä¸åŒç±»å‹å…ƒç´ å¯¹è±¡çš„æ“ä½œ*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteVisitor1</span> : <span class="keyword">public</span> Visitor</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">     <span class="function"><span class="type">void</span> <span class="title">VisitConcreteElementA</span><span class="params">(ConcreteElementA *pElementA)</span></span>&#123;</span><br><span class="line">        <span class="comment">// ç°åœ¨æ ¹æ®ä¼ è¿›æ¥çš„pElementAï¼Œå¯ä»¥å¯¹ConcreteElementAä¸­çš„elementè¿›è¡Œæ“ä½œ</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="type">void</span> <span class="title">VisitConcreteElementB</span><span class="params">(ConcreteElementB *pElementB)</span></span>&#123;</span><br><span class="line">         <span class="comment">// ç°åœ¨æ ¹æ®ä¼ è¿›æ¥çš„pElementBï¼Œå¯ä»¥å¯¹ConcreteElementBä¸­çš„elementè¿›è¡Œæ“ä½œ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*å…·ä½“è®¿é—®è€…2*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteVisitor2</span> : <span class="keyword">public</span> Visitor</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">     <span class="function"><span class="type">void</span> <span class="title">VisitConcreteElementA</span><span class="params">(ConcreteElementA *pElementA)</span></span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="function"><span class="type">void</span> <span class="title">VisitConcreteElementB</span><span class="params">(ConcreteElementB *pElementB)</span></span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*æŠ½è±¡å…ƒç´ ç±» å£°æ˜accept()æ–¹æ³•ï¼Œç”¨äºæ¥å—è®¿é—®è€…çš„è®¿é—®*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Element</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">     <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Accept</span><span class="params">(Visitor *pVisitor)</span> </span>= <span class="number">0</span>;<span class="comment">//acceptç”¨äºæ¥å—è®¿é—®è€…çš„è®¿é—®</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*å…·ä½“å…ƒç´ ç±» é€šè¿‡è°ƒç”¨Visitorç±»çš„visit()æ–¹æ³•å®ç°å¯¹å…ƒç´ çš„è®¿é—®*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteElementA</span> : <span class="keyword">public</span> Element</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">     <span class="function"><span class="type">void</span> <span class="title">Accept</span><span class="params">(Visitor *pVisitor)</span><span class="comment">//é€šè¿‡è°ƒç”¨visitorå¯¹è±¡çš„ visit()æ–¹æ³•å®ç°å¯¹å…ƒç´ å¯¹è±¡çš„è®¿é—®</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        pVisitor-&gt;<span class="built_in">VisitConcreteElementA</span>(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*å…·ä½“å…ƒç´ ç±» */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteElementB</span> : <span class="keyword">public</span> Element</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">     <span class="function"><span class="type">void</span> <span class="title">Accept</span><span class="params">(Visitor *pVisitor)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">     pVisitor-&gt;<span class="built_in">VisitConcreteElementB</span>(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ObjectStructureç±»(å¯¹è±¡ç»“æ„ç±»)ï¼Œèƒ½æšä¸¾å®ƒçš„å…ƒç´ ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªé«˜å±‚çš„æ¥å£ä»¥å…è®¸è®¿é—®è€…è®¿é—®å®ƒçš„å…ƒç´ </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ObjectStructure</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">     <span class="function"><span class="type">void</span> <span class="title">Attach</span><span class="params">(Element *pElement)</span></span>&#123;</span><br><span class="line">         elements.<span class="built_in">push_back</span>(pElement);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="type">void</span> <span class="title">Detach</span><span class="params">(Element *pElement)</span>   </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">         vector&lt;Element *&gt;::iterator it = <span class="built_in">find</span>(elements.<span class="built_in">begin</span>(), elements.<span class="built_in">end</span>(), pElement);</span><br><span class="line">         <span class="keyword">if</span> (it != elements.<span class="built_in">end</span>())</span><br><span class="line">         &#123;</span><br><span class="line">              elements.<span class="built_in">erase</span>(it);</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="type">void</span> <span class="title">Accept</span><span class="params">(Visitor *pVisitor)</span></span>&#123;</span><br><span class="line">     <span class="comment">// ä¸ºæ¯ä¸€ä¸ªelementè®¾ç½®visitorï¼Œè¿›è¡Œå¯¹åº”çš„æ“ä½œ</span></span><br><span class="line">         <span class="keyword">for</span> (vector&lt;Element *&gt;::const_iterator it = elements.<span class="built_in">begin</span>(); it != elements.<span class="built_in">end</span>(); ++it)</span><br><span class="line">         &#123;</span><br><span class="line">              (*it)-&gt;<span class="built_in">Accept</span>(pVisitor);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     <span class="comment">//å®ä¾‹åŒ–å¯¹è±¡ç»“æ„ï¼Œç”¨äºå­˜æ”¾å…ƒç´ å¯¹è±¡ï¼Œæä¾›éå†å…¶å†…éƒ¨å…ƒç´ çš„æ–¹æ³•</span></span><br><span class="line">     ObjectStructure *pObject = <span class="keyword">new</span> ObjectStructure;</span><br><span class="line">      <span class="comment">//å®ä¾‹åŒ–å…·ä½“å…ƒç´  å¹¶å°†åˆ›å»ºå¥½çš„å…ƒç´ æ”¾å…¥å¯¹è±¡ç»“æ„ä¸­</span></span><br><span class="line">     ConcreteElementA *pElementA = <span class="keyword">new</span> ConcreteElementA;</span><br><span class="line">     ConcreteElementB *pElementB = <span class="keyword">new</span> ConcreteElementB;</span><br><span class="line">     pObject-&gt;<span class="built_in">Attach</span>(pElementA);</span><br><span class="line">     pObject-&gt;<span class="built_in">Attach</span>(pElementB);</span><br><span class="line">     <span class="comment">//å®ä¾‹åŒ–è®¿é—®è€…</span></span><br><span class="line">     ConcreteVisitor1 *pVisitor1 = <span class="keyword">new</span> ConcreteVisitor1;</span><br><span class="line">     ConcreteVisitor2 *pVisitor2 = <span class="keyword">new</span> ConcreteVisitor2;</span><br><span class="line">     <span class="comment">//è°ƒç”¨acceptæ–¹æ³• æ¥æ¥å—è®¿é—®è€…å¯¹è±¡çš„è®¿é—®</span></span><br><span class="line">     pObject-&gt;<span class="built_in">Accept</span>(pVisitor1);</span><br><span class="line">     pObject-&gt;<span class="built_in">Accept</span>(pVisitor2);</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (pVisitor2) <span class="keyword">delete</span> pVisitor2;</span><br><span class="line">     <span class="keyword">if</span> (pVisitor1) <span class="keyword">delete</span> pVisitor1;</span><br><span class="line">     <span class="keyword">if</span> (pElementB) <span class="keyword">delete</span> pElementB;</span><br><span class="line">     <span class="keyword">if</span> (pElementA) <span class="keyword">delete</span> pElementA;</span><br><span class="line">     <span class="keyword">if</span> (pObject) <span class="keyword">delete</span> pObject;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ä¼˜ç‚¹ï¼š</p>
<p>å°†æ•°æ®ç»“æ„å’Œä½œç”¨äºæ•°æ®ç»“æ„ä¹‹ä¸Šçš„æ“ä½œä¹‹é—´çš„è€¦åˆè§£å¼€ï¼Œä½¿å¾—æ“ä½œæ•°æ®ç»“æ„é›†åˆå¯ä»¥ç›¸å¯¹è‡ªç”±çš„æ¼”åŒ–ã€‚æ¢è¨€ä¹‹ï¼Œå¦‚æœç³»ç»Ÿçš„æ•°æ®ç»“æ„ç¨³å®šçš„è¯ï¼Œä½¿ç”¨è®¿é—®è€…æ¨¡å¼ä½¿å¾—ç®—æ³•æ›´æ”¹æˆ–è€…å¢åŠ å˜å¾—å¾ˆå®¹æ˜“ï¼Œåªéœ€æ·»åŠ æ–°çš„å…·ä½“è®¿é—®è€…ç±»å³å¯ã€‚</p>
<p>ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ï¼Œè®¿é—®è€…æ¨¡å¼æŠŠç›¸å…³çš„è¡Œä¸ºå°è£…åœ¨ä¸€èµ·ï¼Œä½¿æ¯ä¸€ä¸ªè®¿é—®è€…çš„åŠŸèƒ½éƒ½æ¯”è¾ƒå•ä¸€ã€‚</p>
</li>
<li><p>ç¼ºç‚¹ï¼š</p>
<p>è™½ç„¶æ‰©å±•é¢å‘æ•°æ®ç»“æ„çš„ç®—æ³•ä¼šæ¯”è¾ƒå®¹æ˜“ï¼Œä½†æ˜¯å¢åŠ æ–°çš„å…ƒç´ ç±»ä¼šå˜å¾—å›°éš¾ã€‚æ¯å¢åŠ ä¸€ä¸ªæ–°çš„å…ƒç´ ç±»éƒ½æ„å‘³ç€è¦åœ¨æŠ½è±¡è®¿é—®è€…è§’è‰²ä¸­å¢åŠ ä¸€ä¸ªæ–°çš„æŠ½è±¡æ“ä½œï¼Œå¹¶åœ¨æ¯ä¸€ä¸ªå…·ä½“è®¿é—®è€…ä¸­å¢åŠ ç›¸åº”çš„å…·ä½“æ“ä½œï¼Œè¿èƒŒäº†å¼€é—­åŸåˆ™ã€‚</p>
<p>è¿åäº†ä¾èµ–å€’ç½®åŸåˆ™ï¼Œè®¿é—®è€…æ¨¡å¼ä¾èµ–äº†å…·ä½“ç±»ï¼Œè€Œæ²¡æœ‰ä¾èµ–æŠ½è±¡ç±»ã€‚</p>
</li>
</ul>
<h3 id="19-å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMementoï¼‰"><a href="#19-å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMementoï¼‰" class="headerlink" title="19 å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMementoï¼‰"></a>19 å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMementoï¼‰</h3><blockquote>
<p><code>Memento</code> åœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œè·å–å¹¶ä¿å­˜ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œä»¥ä¾¿ä»¥åæ¢å¤å®ƒ</p>
</blockquote>
<p>ä»¥æ‰“æ¸¸æˆä¸ºä¾‹ï¼Œå½“é€šè¿‡ä¸€å…³æ—¶å¾€å¾€ä¼šé€‰æ‹©å­˜æ¡£ï¼Œä¸‹æ¬¡å†ç©æ—¶å°±å¯ä»¥ä»å­˜æ¡£çš„åœ°æ–¹å¼€å§‹ï¼Œè€Œä¸éœ€è¦ä»å¤´å¼€ç©ã€‚è¿™é‡Œå°±ç”¨åˆ°äº†å¤‡å¿˜å½•æ¨¡å¼ï¼Œé€šè¿‡è®°å½•çŠ¶æ€ï¼Œè€Œé¿å…ä¸å¿…è¦çš„é‡å¤åŠ³åŠ¨ã€‚</p>
<p>å¾ˆå¤šåº”ç”¨è½¯ä»¶éƒ½æä¾›äº†è¿™é¡¹åŠŸèƒ½ï¼Œå¦‚ Wordã€è®°äº‹æœ¬ã€Photoshopã€Eclipse ç­‰è½¯ä»¶åœ¨ç¼–è¾‘æ—¶æŒ‰ Ctrl+Z ç»„åˆé”®æ—¶èƒ½æ’¤é”€å½“å‰æ“ä½œï¼Œä½¿æ–‡æ¡£æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ï¼›è¿˜æœ‰åœ¨ IE ä¸­çš„åé€€é”®ã€æ•°æ®åº“äº‹åŠ¡ç®¡ç†ä¸­çš„å›æ»šæ“ä½œã€ç©æ¸¸æˆæ—¶çš„ä¸­é—´ç»“æœå­˜æ¡£åŠŸèƒ½ã€æ•°æ®åº“ä¸æ“ä½œç³»ç»Ÿçš„å¤‡ä»½æ“ä½œã€æ£‹ç±»æ¸¸æˆä¸­çš„æ‚”æ£‹åŠŸèƒ½ç­‰éƒ½å±äºè¿™ç±»ã€‚</p>
<p><img src="/design_pattern-image/image_E09UNJ-ffJ.png"></p>
<ul>
<li>å®ç°ä»£ç ï¼š</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Memento</span> &#123; <span class="comment">// å¤‡å¿˜å½•</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    string state;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Memento</span>(string s) &#123; state = s; &#125;</span><br><span class="line">    <span class="function">string <span class="title">GetState</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> state; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">SetState</span><span class="params">(string s)</span> </span>&#123; state = s; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Caretaker</span> &#123; <span class="comment">// ç®¡ç†è€…</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Memento* menento;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// Caretaker(Memento* m) &#123; menento = m; &#125;</span></span><br><span class="line">    <span class="function">Memento* <span class="title">GetMemento</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> menento; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">SetMemento</span><span class="params">(Memento* m)</span> </span>&#123; menento = m; &#125;</span><br><span class="line">    ~<span class="built_in">Caretaker</span>() &#123; <span class="keyword">delete</span> menento; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Originator</span> &#123; <span class="comment">// å‘èµ·äºº</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    string state; <span class="comment">// éœ€è¦ä¿å­˜çš„å±æ€§</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">GetState</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> state; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">SetState</span><span class="params">(string s)</span> </span>&#123; state = s; &#125;</span><br><span class="line">    <span class="function">Memento* <span class="title">CreateMemento</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Memento</span>(state); &#125; <span class="comment">// åˆ›å»ºå¤‡å¿˜å½•å¯¹è±¡ï¼Œä¿å­˜ä¿¡æ¯</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">SetMemento</span><span class="params">(Memento* m)</span> </span>&#123; state = m-&gt;<span class="built_in">GetState</span>(); &#125;  <span class="comment">// æ¢å¤å¤‡å¿˜å½•</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Show</span><span class="params">()</span> </span>&#123; cout &lt;&lt; <span class="string">&quot;state: &quot;</span> &lt;&lt; state &lt;&lt; endl; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Originator* o = <span class="keyword">new</span> <span class="built_in">Originator</span>();</span><br><span class="line">    o-&gt;<span class="built_in">SetState</span>(<span class="string">&quot;On&quot;</span>);</span><br><span class="line">    o-&gt;<span class="built_in">Show</span>();   <span class="comment">// state: On</span></span><br><span class="line"></span><br><span class="line">    Caretaker* c = <span class="keyword">new</span> <span class="built_in">Caretaker</span>();</span><br><span class="line">    c-&gt;<span class="built_in">SetMemento</span>(o-&gt;<span class="built_in">CreateMemento</span>());   <span class="comment">// ä¿å­˜çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line">    o-&gt;<span class="built_in">SetState</span>(<span class="string">&quot;Off&quot;</span>);</span><br><span class="line">    o-&gt;<span class="built_in">Show</span>();   <span class="comment">// state: Off</span></span><br><span class="line"></span><br><span class="line">    o-&gt;<span class="built_in">SetMemento</span>(c-&gt;<span class="built_in">GetMemento</span>()); <span class="comment">// æ¢å¤åˆå§‹çŠ¶æ€</span></span><br><span class="line">    o-&gt;<span class="built_in">Show</span>();   <span class="comment">// state: On</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> o;</span><br><span class="line">    <span class="keyword">delete</span> c;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li><p>æä¾›äº†ä¸€ç§å¯ä»¥æ¢å¤çŠ¶æ€çš„æœºåˆ¶ã€‚<strong>å½“ç”¨æˆ·éœ€è¦æ—¶èƒ½å¤Ÿæ¯”è¾ƒæ–¹ä¾¿åœ°å°†æ•°æ®æ¢å¤åˆ°æŸä¸ªå†å²çš„çŠ¶æ€</strong>ã€‚</p>
</li>
<li><p>å®ç°äº†å†…éƒ¨çŠ¶æ€çš„å°è£…ã€‚<strong>é™¤äº†åˆ›å»ºå®ƒçš„å‘èµ·äººä¹‹å¤–ï¼Œå…¶ä»–å¯¹è±¡éƒ½ä¸èƒ½å¤Ÿè®¿é—®è¿™äº›çŠ¶æ€ä¿¡æ¯</strong>ã€‚</p>
</li>
<li><p><strong>å‘èµ·äººä¸éœ€è¦ç®¡ç†å’Œä¿å­˜å…¶å†…éƒ¨çŠ¶æ€çš„å„ä¸ªå¤‡ä»½ï¼Œæ‰€æœ‰çŠ¶æ€ä¿¡æ¯éƒ½ä¿å­˜åœ¨å¤‡å¿˜å½•ä¸­ï¼Œå¹¶ç”±ç®¡ç†è€…è¿›è¡Œç®¡ç†ï¼Œè¿™ç¬¦åˆ</strong>ã€‚</p>
</li>
</ul>
</li>
<li><p>ç¼ºç‚¹ï¼š</p>
<p>èµ„æºæ¶ˆè€—å¤§ã€‚å¦‚æœè¦ä¿å­˜çš„å†…éƒ¨çŠ¶æ€ä¿¡æ¯è¿‡å¤šæˆ–è€…ç‰¹åˆ«é¢‘ç¹ï¼Œå°†ä¼šå ç”¨æ¯”è¾ƒå¤§çš„å†…å­˜èµ„æºã€‚</p>
</li>
</ul>
<h3 id="20-å‘½ä»¤æ¨¡å¼ï¼ˆCommandï¼‰"><a href="#20-å‘½ä»¤æ¨¡å¼ï¼ˆCommandï¼‰" class="headerlink" title="20 å‘½ä»¤æ¨¡å¼ï¼ˆCommandï¼‰"></a>20 å‘½ä»¤æ¨¡å¼ï¼ˆCommandï¼‰</h3><blockquote>
<p>å°†ä¸€ä¸ªè¯·æ±‚å°è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œä½¿<strong>å‘å‡ºè¯·æ±‚çš„è´£ä»»å’Œæ‰§è¡Œè¯·æ±‚çš„è´£ä»»åˆ†å‰²å¼€</strong>ã€‚</p>
</blockquote>
<p>ä»¥12306åº”ç”¨ä¸ºä¾‹ï¼š</p>
<ul>
<li><p>ç´§è€¦åˆï¼šè€ç‰ˆæœ¬çš„12306ç½‘ç«™ï¼Œä¹°ç¥¨æ—¶å¯ä»¥ä¸åœåœ°ç”¨é¼ æ ‡ç‚¹å‡»12306ç½‘ç«™ä¸Šçš„è´­ç¥¨æŒ‰é’®æ¥æŠ¢ç¥¨ã€‚å¯¹äºæ¯ä¸€æ¬¡ç‚¹å‡»ï¼ŒæœåŠ¡å™¨éƒ½è¦è¿›è¡Œå¤„ç†ï¼Œåšå‡ºå“åº”ï¼Œæ¥å‘Šè¯‰ç”¨æˆ·æœ‰æ²¡æœ‰ä¹°åˆ°ç¥¨ï¼Œè¿™æ ·çš„è¯ä¼šå‡ºç°å¾ˆå¤šæ¬¡æ— æ•ˆçš„ç‚¹å‡»ï¼Œå¢åŠ äº†æœåŠ¡å™¨çš„è´Ÿæ‹…ã€‚</p>
<p>æ­¤æ—¶ï¼Œå‘å‡ºè¯·æ±‚å’Œæ‰§è¡Œè¯·æ±‚ï¼ŒäºŒè€…è¿›å…¥äº†ç´§è€¦åˆçš„çŠ¶æ€ã€‚ç”¨æˆ·ï¼ˆå‘½ä»¤å‘é€è€…ï¼‰é€šè¿‡æŒ‰é’®ï¼ˆå…·ä½“å‘½ä»¤ï¼‰æ¥ä¹°ç¥¨ï¼ˆ12306ç½‘ç«™æœåŠ¡å™¨æˆä¸ºå‘½ä»¤æ¥æ”¶è€…ï¼‰ã€‚</p>
</li>
<li><p>æ¾è€¦åˆï¼šæ–°ç‰ˆæœ¬çš„12306ç½‘ç«™å¼•å…¥äº†è´­ç¥¨é˜Ÿåˆ—æœºåˆ¶ã€‚å½“ç‚¹å‡»è´­ç¥¨æŒ‰é’®åï¼Œè´­ç¥¨è¯·æ±‚å°±è¿›å…¥äº†ç›¸åº”çš„è´­ç¥¨é˜Ÿåˆ—ï¼Œè¿›å…¥åå†æ¬¡é¼ æ ‡ç‚¹å‡»è´­ç¥¨æ—¶ï¼Œ12306ä¼šæ‹’ç»æ–°çš„è´­ç¥¨è¯·æ±‚ï¼Œå¹¶ä¸”å‘Šè¯‰ç”¨æˆ·å·²ç»è¿›å…¥äº†è´­ç¥¨é˜Ÿåˆ—ã€‚å¤„äºè´­ç¥¨é˜Ÿåˆ—çš„ç”¨æˆ·ä¹Ÿå¯ä»¥é€‰æ‹©é€€å‡ºè´­ç¥¨é˜Ÿåˆ—å»è´­ä¹°å…¶ä»–è½¦æ¬¡çš„è½¦ç¥¨ã€‚è¿™æ ·å°±å¯ä»¥æœ‰æ•ˆåœ°å‡å°‘è´­ç¥¨è€…å‘é€å¤šæ¬¡æ— æ•ˆè´­ç¥¨è¯·æ±‚çš„æƒ…å†µã€‚</p>
<p>è§‚å¯Ÿè¿™æ ·çš„æ”¹è¿›æ–¹æ¡ˆï¼Œå¯ä»¥å‘ç°ï¼Œå°†å‰é¢çš„å‘å‡ºè¯·æ±‚å’Œæ‰§è¡Œè¯·æ±‚è§£è€¦äº†ã€‚ç”¨æˆ·ç‚¹å‡»æŒ‰é’®åå‘å‡ºè¯·æ±‚ï¼Œè¯·æ±‚è¿›å…¥äº†é˜Ÿåˆ—ä¸­ï¼Œæ­¤æ—¶<strong>é˜Ÿåˆ—æˆä¸ºäº†åé¢æµç¨‹ä¸‹å…·ä½“çš„è¯·æ±‚å‘é€è€…</strong>ï¼Œä¸åŒçš„è¯·æ±‚å¯¹åº”äº†ä¸åŒçš„å‘½ä»¤ã€‚ä¸åŒå‘½ä»¤éœ€è¦é‡‡å–ä¸åŒçš„åŠ¨ä½œï¼ŒåŠ¨ä½œæ˜¯ç”±æ¥æ”¶è€…ï¼ˆæœåŠ¡å™¨ï¼‰åšå‡ºçš„ï¼Œå› æ­¤å°†è¿™äº›åŠ¨ä½œéƒ½å°è£…æˆç±»ä¹‹åï¼Œå°±å¯ä»¥ä¸ç›¸åº”çš„å‘½ä»¤ç±»ç»‘å®šã€‚è€Œé˜Ÿåˆ—å‘å‡ºè¯·æ±‚åï¼Œå…ˆæ‰¾åˆ°ç›¸åº”çš„å‘½ä»¤ï¼Œå†ç”±å‘½ä»¤æ‰§è¡Œç»‘å®šçš„æ¥æ”¶è€…çš„åŠ¨ä½œã€‚å‘½ä»¤ä¸­å¯ä»¥ç»“åˆå¤‡å¿˜å½•æ¨¡å¼è®°å½•çŠ¶æ€ï¼Œè€Œé˜Ÿåˆ—é‡Œå¯ä»¥å®ç°æ¶ˆé™¤æ— æ•ˆç‚¹å‡»çš„ä»£ç ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ ¸å¿ƒåœ¨è¯·æ±‚çš„å‘é€è€…å’Œè¯·æ±‚çš„æ‰§è¡Œè€…ä¹‹é—´å¢åŠ äº†â€œå‘½ä»¤â€å’Œæ–°çš„â€œè¯·æ±‚ç®¡ç†è€…â€ï¼Œä»¥è§£è€¦äºŒè€…ã€‚å‘½ä»¤ä¾¿äºå¯¹åŠŸèƒ½è¿›è¡Œæ‰©å±•ã€‚å¦‚æœæƒ³æœ‰æ–°çš„æŒ‰é’®åŠŸèƒ½ï¼Œå®ç°æ–°çš„å…·ä½“å‘½ä»¤ç±»å³å¯ï¼ŒåŒæ—¶å…·ä½“å‘½ä»¤ç±»ä¸­å¯ä»¥è®°å½•çŠ¶æ€ï¼Œè¿™æ ·è¯·æ±‚ç®¡ç†è€…å°±æ–¹ä¾¿åšæ’¤é”€ã€é‡åšç­‰æ“ä½œã€‚</p>
</li>
</ul>
<p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p>
<p>è½¯ä»¶å¼€å‘ç³»ç»Ÿä¸­ï¼Œå¸¸å¸¸å‡ºç°â€œæ–¹æ³•çš„è¯·æ±‚è€…â€ä¸â€œæ–¹æ³•çš„å®ç°è€…â€ä¹‹é—´å­˜åœ¨ç´§å¯†çš„è€¦åˆå…³ç³»ï¼Œä¸åˆ©äºè½¯ä»¶åŠŸèƒ½çš„æ‰©å±•ä¸ç»´æŠ¤ã€‚æ¯”å¦‚ï¼Œæƒ³å¯¹è¡Œä¸ºè¿›è¡Œâ€œæ’¤é”€ã€é‡åšã€è®°å½•â€ç­‰å¤„ç†éƒ½ä¸æ–¹ä¾¿ã€‚</p>
<p>å‘½ä»¤æ¨¡å¼æ—¨åœ¨å°†â€œè¯·æ±‚è€…â€å’Œâ€œå®ç°è€…â€è§£è€¦ï¼Œé€šè¿‡åœ¨äºŒè€…ä¹‹é—´å¢åŠ â€œå‘½ä»¤â€ã€‚å‘½ä»¤ä¸­å¯ä»¥è®°å½•çŠ¶æ€ï¼Œè¿›è¡Œæ’¤é”€ç­‰æ“ä½œã€‚æƒ³è¦æ‰©å±•åŠŸèƒ½ï¼Œä¹Ÿå°±å¯ä»¥å®ç°æ–°çš„å…·ä½“å‘½ä»¤ç±»æˆ–æ–°çš„å…·ä½“æ¥æ”¶è€…ç±»ã€‚</p>
<p><img src="/design_pattern-image/image_FzbBrhJfAw.png"></p>
<ul>
<li><p>Commandï¼šæŠ½è±¡å‘½ä»¤ç±»ï¼Œå£°æ˜å“åº”è¯·æ±‚æ—¶å¾…æ‰§è¡Œæ“ä½œçš„æ¥å£ã€‚</p>
</li>
<li><p>ConcreteCommandï¼šå…·ä½“å‘½ä»¤ç±»ï¼Œç»‘å®šä¸€ä¸ªæ¥æ”¶è€…ï¼Œé€šè¿‡è®©æ¥æ”¶è€…åšå‡ºåŠ¨ä½œæ¥æ‰§è¡Œå‘½ä»¤ã€‚</p>
<p>&amp;#x20;Executeæ–¹æ³•æ¥è°ƒç”¨ç›¸åº”çš„Receiverå¯¹è±¡ï¼Œä»è€Œå“åº”è¯·æ±‚ã€‚ä¹Ÿå¯ä»¥å®ç°å…¶ä»–æ–¹æ³•æ¥æ‰©å±•æ­¤å‘½ä»¤ä¸‹çš„å¯é€‰æ“ä½œã€‚</p>
</li>
<li><p>Invokerï¼šä¸å®¢æˆ·ç«¯ç›´æ¥ç›¸å…³ï¼Œè¯·æ±‚çš„å‘é€è€…æˆ–è€…è¯·æ±‚çš„ç®¡ç†è€…ã€‚</p>
</li>
<li><p>Receiverï¼šçœŸæ­£çš„æ¥æ”¶è€…ï¼Œå®ç°å“åº”è¯·æ±‚éœ€è¦åšçš„åŠ¨ä½œã€‚</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// @brief æŠ½è±¡å‘½ä»¤ç±», å£°æ˜æ‰§è¡Œå‘½ä»¤çš„æ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractCommand</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">AbstractCommand</span>() &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Execute</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief å‘½ä»¤æ¥æ”¶è€…, æ‰§è¡Œå‘½ä»¤åŠŸèƒ½çš„ç›¸å…³æ“ä½œï¼Œæ˜¯å…·ä½“å‘½ä»¤å¯¹è±¡ä¸šåŠ¡çš„çœŸæ­£å®ç°è€…</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Receiver</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Action</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;this is Receiver::Action!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief å…·ä½“å‘½ä»¤ç±», å®ƒæ‹¥æœ‰æ¥æ”¶è€…å¯¹è±¡ï¼Œå¹¶é€šè¿‡è°ƒç”¨æ¥æ”¶è€…çš„åŠŸèƒ½æ¥å®Œæˆå‘½ä»¤è¦æ‰§è¡Œçš„æ“ä½œ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteCommand</span> : <span class="keyword">public</span> AbstractCommand &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ConcreteCommand</span>() &#123;</span><br><span class="line">        receiver_.<span class="built_in">reset</span>(<span class="keyword">new</span> <span class="built_in">Receiver</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        receiver_-&gt;<span class="built_in">Action</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::shared_ptr&lt;Receiver&gt; receiver_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief å‘½ä»¤è¯·æ±‚è€…, è¯·æ±‚çš„å‘é€è€…ï¼Œå®ƒé€šå¸¸æ‹¥æœ‰å¾ˆå¤šçš„å‘½ä»¤å¯¹è±¡ï¼Œå¹¶é€šè¿‡è®¿é—®å‘½ä»¤å¯¹è±¡æ¥æ‰§è¡Œç›¸å…³è¯·æ±‚ï¼Œå®ƒä¸ç›´æ¥è®¿é—®æ¥æ”¶è€…</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Invoker</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Invoker</span>(AbstractCommand* cmd) : <span class="built_in">cmd_</span>(cmd) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">SetCommand</span><span class="params">(AbstractCommand* cmd)</span> </span>&#123;</span><br><span class="line">        cmd_ = cmd;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cmd_-&gt;<span class="built_in">Execute</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    AbstractCommand* cmd_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>mainå‡½æ•°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="function">std::shared_ptr&lt;AbstractCommand&gt; <span class="title">cmd</span><span class="params">(<span class="keyword">new</span> ConcreteCommand())</span></span>;</span><br><span class="line">  <span class="function">Invoker <span class="title">client</span><span class="params">(cmd.get())</span></span>;</span><br><span class="line">  client.<span class="built_in">Request</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li><p><strong>é™ä½ç³»ç»Ÿçš„è€¦åˆåº¦</strong>ï¼Œå°†è°ƒç”¨æ“ä½œçš„å¯¹è±¡ä¸å®ç°è¯¥æ“ä½œçš„å¯¹è±¡è§£è€¦ã€‚</p>
</li>
<li><p><strong>å¢åŠ æˆ–åˆ é™¤å‘½ä»¤éå¸¸æ–¹ä¾¿</strong>ã€‚å¢åŠ æˆ–åˆ é™¤æ“ä½œä¸ä¼šå½±å“å…¶ä»–ç±»ï¼Œæ»¡è¶³å¼€é—­åŸåˆ™ã€‚</p>
</li>
<li><p>å¯ä»¥å®ç°å®å‘½ä»¤ã€‚å‘½ä»¤æ¨¡å¼å¯ä»¥ä¸ç»„åˆæ¨¡å¼ç»“åˆï¼Œ<strong>å°†å¤šä¸ªå‘½ä»¤è£…é…æˆä¸€ä¸ªç»„åˆå‘½ä»¤ï¼Œå³å®å‘½ä»¤</strong>ã€‚</p>
</li>
<li><p><strong>æ–¹ä¾¿å®ç°Undoå’ŒRedoæ“ä½œ</strong>ã€‚å‘½ä»¤æ¨¡å¼å¯ä»¥ä¸å¤‡å¿˜å½•æ¨¡å¼ç»“åˆï¼Œå®ç°å‘½ä»¤çš„æ’¤é”€ä¸æ¢å¤ã€‚</p>
</li>
</ul>
</li>
</ul>
<h4 id="å®å‘½ä»¤"><a href="#å®å‘½ä»¤" class="headerlink" title="å®å‘½ä»¤"></a>å®å‘½ä»¤</h4><p>å‰é¢æåˆ°ï¼Œå‘½ä»¤æ¨¡å¼å¯ä»¥ä¸ç»„åˆæ¨¡å¼ç›¸ç»“åˆï¼Œä»è€Œè®©å¤šä¸ªå‘½ä»¤å…±åŒç»„è£…ä¸ºä¸€ä¸ªç»„åˆå‘½ä»¤ï¼Œå³å®å‘½ä»¤ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// @brief æŠ½è±¡å‘½ä»¤ç±», å£°æ˜æ‰§è¡Œå‘½ä»¤çš„æ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractMacroCommand</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">AbstractMacroCommand</span>() &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Execute</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief å‘½ä»¤æ¥æ”¶è€…, æ‰§è¡Œå‘½ä»¤åŠŸèƒ½çš„ç›¸å…³æ“ä½œï¼Œæ˜¯å…·ä½“å‘½ä»¤å¯¹è±¡ä¸šåŠ¡çš„çœŸæ­£å®ç°è€…</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CompositeReceiver</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">ActionA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;this is CompositeReceiver::ActionA!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">ActionB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;this is CompositeReceiver::ActionB!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief å…·ä½“å‘½ä»¤ç±», å®ƒæ‹¥æœ‰æ¥æ”¶è€…å¯¹è±¡ï¼Œå¹¶é€šè¿‡è°ƒç”¨æ¥æ”¶è€…çš„åŠŸèƒ½æ¥å®Œæˆå‘½ä»¤è¦æ‰§è¡Œçš„æ“ä½œ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteCommandA</span> : <span class="keyword">public</span> AbstractMacroCommand &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ConcreteCommandA</span>() &#123;</span><br><span class="line">        receiver_.<span class="built_in">reset</span>(<span class="keyword">new</span> <span class="built_in">CompositeReceiver</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        receiver_-&gt;<span class="built_in">ActionA</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::shared_ptr&lt;CompositeReceiver&gt; receiver_;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteCommandB</span> : <span class="keyword">public</span> AbstractMacroCommand &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ConcreteCommandB</span>() &#123;</span><br><span class="line">        receiver_.<span class="built_in">reset</span>(<span class="keyword">new</span> <span class="built_in">CompositeReceiver</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        receiver_-&gt;<span class="built_in">ActionB</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::shared_ptr&lt;CompositeReceiver&gt; receiver_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief å‘½ä»¤è¯·æ±‚è€…, è¯·æ±‚çš„å‘é€è€…ï¼Œå®ƒé€šå¸¸æ‹¥æœ‰å¾ˆå¤šçš„å‘½ä»¤å¯¹è±¡ï¼Œå¹¶é€šè¿‡è®¿é—®å‘½ä»¤å¯¹è±¡æ¥æ‰§è¡Œç›¸å…³è¯·æ±‚ï¼Œå®ƒä¸ç›´æ¥è®¿é—®æ¥æ”¶è€…</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CompositeInvoker</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">AddCommand</span><span class="params">(AbstractMacroCommand* cmd)</span> </span>&#123;</span><br><span class="line">        cmds_.<span class="built_in">emplace_back</span>(cmd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">RemoveCommand</span><span class="params">(AbstractMacroCommand* cmd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> it = cmds_.<span class="built_in">begin</span>(); it != cmds_.<span class="built_in">end</span>(); it++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (cmd == (*it)) &#123;</span><br><span class="line">                cmds_.<span class="built_in">erase</span>(it++);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span>* cmd : cmds_) &#123;</span><br><span class="line">            cmd-&gt;<span class="built_in">Execute</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;AbstractMacroCommand*&gt; cmds_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">std::shared_ptr&lt;AbstractMacroCommand&gt; <span class="title">cmd_A</span><span class="params">(<span class="keyword">new</span> ConcreteCommandA())</span></span>;</span><br><span class="line">    <span class="function">std::shared_ptr&lt;AbstractMacroCommand&gt; <span class="title">cmd_B</span><span class="params">(<span class="keyword">new</span> ConcreteCommandB())</span></span>;</span><br><span class="line"></span><br><span class="line">    CompositeInvoker client;</span><br><span class="line">    client.<span class="built_in">AddCommand</span>(cmd_A.<span class="built_in">get</span>());</span><br><span class="line">    client.<span class="built_in">AddCommand</span>(cmd_B.<span class="built_in">get</span>());</span><br><span class="line"></span><br><span class="line">    client.<span class="built_in">Request</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="21-è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreterï¼‰"><a href="#21-è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreterï¼‰" class="headerlink" title="21 è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreterï¼‰"></a>21 è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreterï¼‰</h3><p>ä»¥å¤§æ•°æ®ç»Ÿè®¡ä¸ºä¾‹ï¼šåœ¨å¤§æ•°æ®ç»Ÿè®¡ä¸­ï¼Œé€šå¸¸éœ€è¦æŒ‰ç…§è®¡ç®—æ¨¡å‹å¯¹ç°æœ‰æ•°æ®ç»Ÿè®¡ã€åˆ†æã€é¢„æµ‹ã€‚ç”±äºè®¡ç®—æ¨¡å‹æœ‰å¾ˆå¤šï¼Œè€Œä¸”æ€»æ˜¯åœ¨æ›´æ–°ï¼Œå› æ­¤ç³»ç»Ÿè®¾è®¡æ—¶éœ€è¦å…·å¤‡é«˜æ‰©å±•æ€§ã€‚</p>
<p>ä¸€èˆ¬è®¡ç®—æ¨¡å‹ä¸­åŒ…å«ä¸¤ç±»ç¬¦å·ï¼šæ•°æ®å’Œè®¡ç®—ç¬¦ï¼Œå¯ä»¥å°†äºŒè€…è§£è€¦ï¼ŒåŒæ—¶è®©å„ä¸ªè®¡ç®—ç¬¦å‡ä¸ºä¸€ä¸ªç±»ï¼Œç»§æ‰¿è‡ªæŠ½è±¡è¿ç®—ç¬¦ç±»ã€‚è¿™æ ·ï¼Œå½“éœ€è¦æ›´æ”¹ä¸€ä¸ªè¿ç®—ç¬¦çš„è¡Œä¸ºæ—¶ï¼Œä»…æ›´æ”¹è¯¥ç±»çš„å®ç°å³å¯ã€‚è€Œä¸”æƒ³è¦æ‰©å±•è®¡ç®—æ¨¡å‹ï¼Œå¢åŠ æ–°çš„å…·ä½“è®¡ç®—ç¬¦ç±»å³å¯ã€‚</p>
<blockquote>
<p>è§£é‡Šå™¨æ¨¡å¼ï¼šå®šä¹‰ä¸€ä¸ªè¯­æ³•ï¼Œå®šä¹‰ä¸€ä¸ªè§£é‡Šå™¨ï¼Œè¯¥è§£é‡Šå™¨å¤„ç†è¯¥è¯­æ³•å¥å­ã€‚</p>
</blockquote>
<p>ç±»æ¯”åˆ°ä¸Šé¢çš„ä¾‹å­ï¼Œä¼—å¤šè¿ç®—ç¬¦æ“ä½œçš„é›†åˆå°±æ˜¯è§£é‡Šå™¨ï¼Œè€Œè¯­æ³•å°±æ˜¯åœ¨è¿ç®—ç¬¦ç±»ä¸­å®ç°çš„ã€‚è§£é‡Šå™¨æ¨¡å¼çš„ç»“æ„å¦‚ä¸‹ï¼šå®¢æˆ·ç«¯ç»™å‡ºè¡¨è¾¾å¼ï¼ˆç®—æ³•æ¨¡å‹ï¼‰ï¼ŒContextç±»å°†è¡¨è¾¾å¼åˆ†è§£ä¸ºå„ç§ç¬¦å·çš„ç»„åˆã€‚è€ŒæŠ½è±¡è¡¨è¾¾å¼ç±»æä¾›interpretçš„ç»Ÿä¸€æ¥å£ï¼Œå…¶ä¸‹åˆ†ä¸ºç»ˆç»“ç¬¦å·å’Œéç»ˆç»“ç¬¦å·ä¸¤ç§ã€‚ç»ˆç»“ç¬¦å·ä¸€èˆ¬æ˜¯æ•°å€¼ã€æ•°æ®ï¼Œè€Œéç»ˆç»“ç¬¦å·ä¸€èˆ¬ä¸ºè¿ç®—ç¬¦ï¼Œæ¯”å¦‚åŠ å‡ä¹˜é™¤å››åˆ™è¿ç®—ã€‚</p>
<p>å½“ç„¶ï¼Œç»ˆç»“ç¬¦å·ä¹Ÿå¯ä»¥æ‰©å±•ï¼Œæ¯”å¦‚ä»å®æ•°æ”¹ä¸ºå¤æ•°ï¼Œé‚£ä¹ˆä»…éœ€è¯¥TerminalExpressionçš„å…·ä½“å®ç°å³å¯ï¼Œç”±äºè°ƒç”¨è¯¥ç±»å¯¹è±¡æ—¶ä¼šä½¿ç”¨â†’interpretæ–¹æ³•ï¼Œå› æ­¤NonterminalExpressionå¯ä»¥æ”¹åŠ¨å¾ˆå°ç”šè‡³ä¸æ”¹ã€‚</p>
<p><img src="/design_pattern-image/image_Vfisq6ZU80.png"></p>
<p>ä¸¾ä¸€ä¸ªæ›´å…·ä½“çš„ä¾‹å­â€”â€”è®¡ç®—å™¨ã€‚è®¡ç®—å™¨çš„ç®—æ³•æ¨¡å‹æ˜¯é€†æ³¢å…°å¼ï¼ŒCalculatorå°±ç›¸å½“äºContextï¼Œåœ¨è¿ç®—ç¬¦å®ç°æ—¶ä»…éœ€é’ˆå¯¹æ•°æ®ç±»å‹å®ç°å››åˆ™è¿ç®—å³å¯ã€‚</p>
<p><img src="/design_pattern-image/image_vFZ9_EcmBy.png"></p>
<p>ï¼ˆä¸‹é¢çš„ä»£ç å®ç°å¹¶ä¸å¥½ï¼Œå¯ç”¨èŒè´£é“¾æ¨¡å¼è¿›ä¸€æ­¥ä¼˜åŒ–ï¼‰</p>
<p><strong>æŠ½è±¡è¡¨è¾¾å¼ç±»Nodeï¼ˆæŠ½è±¡èŠ‚ç‚¹ï¼‰</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æŠ½è±¡è¡¨è¾¾å¼ç±»Nodeï¼ˆæŠ½è±¡èŠ‚ç‚¹ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">interpret</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ç»ˆç»“ç¬¦è¡¨è¾¾å¼ç±»ValueNodeï¼ˆå€¼èŠ‚ç‚¹ç±»ï¼‰</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç»ˆç»“ç¬¦è¡¨è¾¾å¼ç±»ValueNodeï¼ˆå€¼èŠ‚ç‚¹ç±»ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ValueNode</span> : <span class="keyword">public</span> Node &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ValueNode</span>(<span class="type">int</span> value) &#123;</span><br><span class="line">      <span class="keyword">this</span>-&gt;value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">interpret</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>-&gt;value;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> value = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>æŠ½è±¡éç»ˆç»“ç¬¦è¡¨è¾¾å¼ç±»SymbolNodeï¼ˆç¬¦å·èŠ‚ç‚¹ç±»ï¼‰</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æŠ½è±¡éç»ˆç»“ç¬¦è¡¨è¾¾å¼ç±»SymbolNodeï¼ˆç¬¦å·èŠ‚ç‚¹ç±»ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SymbolNode</span> : <span class="keyword">public</span> Node &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">SymbolNode</span>(shared_ptr&lt;Node&gt; left,shared_ptr&lt;Node&gt; right) &#123;</span><br><span class="line">      <span class="keyword">this</span>-&gt;left = left;</span><br><span class="line">      <span class="keyword">this</span>-&gt;right = right;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">protected</span>:</span><br><span class="line">    shared_ptr&lt;Node&gt; left;</span><br><span class="line">    shared_ptr&lt;Node&gt; right;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>éç»ˆç»“ç¬¦è¡¨è¾¾å¼ç±»MulNodeï¼ˆä¹˜æ³•èŠ‚ç‚¹ç±»ï¼‰</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//éç»ˆç»“ç¬¦è¡¨è¾¾å¼ç±»MulNodeï¼ˆä¹˜æ³•èŠ‚ç‚¹ç±»ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MulNode</span> : <span class="keyword">public</span> SymbolNode &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MulNode</span>(shared_ptr&lt;Node&gt; left,shared_ptr&lt;Node&gt; right) : <span class="built_in">SymbolNode</span>(left,right) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">interpret</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> left-&gt;<span class="built_in">interpret</span>()*right-&gt;<span class="built_in">interpret</span>();</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure>

<p>&amp;#x20;<strong>éç»ˆç»“ç¬¦è¡¨è¾¾å¼ç±»DivNodeï¼ˆé™¤æ³•èŠ‚ç‚¹ç±»ï¼‰</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//éç»ˆç»“ç¬¦è¡¨è¾¾å¼ç±»DivNodeï¼ˆé™¤æ³•èŠ‚ç‚¹ç±»ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DivNode</span> : <span class="keyword">public</span> SymbolNode &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">DivNode</span>(shared_ptr&lt;Node&gt; left,shared_ptr&lt;Node&gt; right) : <span class="built_in">SymbolNode</span>(left,right) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">interpret</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> left-&gt;<span class="built_in">interpret</span>()/right-&gt;<span class="built_in">interpret</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>éç»ˆç»“ç¬¦è¡¨è¾¾å¼ç±»ModNodeï¼ˆæ±‚æ¨¡èŠ‚ç‚¹ç±»ï¼‰</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//éç»ˆç»“ç¬¦è¡¨è¾¾å¼ç±»ModNodeï¼ˆæ±‚æ¨¡èŠ‚ç‚¹ç±»ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModNode</span> : <span class="keyword">public</span> SymbolNode &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ModNode</span>(shared_ptr&lt;Node&gt; left,shared_ptr&lt;Node&gt; right) : <span class="built_in">SymbolNode</span>(left,right) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">interpret</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> left-&gt;<span class="built_in">interpret</span>()%right-&gt;<span class="built_in">interpret</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>è§£æå™¨å°è£…ç±»Calculatorï¼ˆè®¡ç®—å™¨ç±»ï¼‰</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è§£æå™¨å°è£…ç±»Calculatorï¼ˆè®¡ç®—å™¨ç±»ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">bulid</span><span class="params">(string statement)</span> </span>&#123;</span><br><span class="line">      shared_ptr&lt;Node&gt; left,right;</span><br><span class="line">      stack&lt;shared_ptr&lt;Node&gt; &gt; s;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//åˆ†å‰²è¯­ä¹‰ </span></span><br><span class="line">      vector&lt;string&gt; statementArr = <span class="built_in">split</span>(statement,<span class="string">&#x27; &#x27;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//å¤„ç†è¯­ä¹‰</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; i &lt; statementArr.<span class="built_in">size</span>() ; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(statementArr[i] == <span class="string">&quot;*&quot;</span>)&#123;</span><br><span class="line">          left = s.<span class="built_in">top</span>(); s.<span class="built_in">pop</span>();</span><br><span class="line">          <span class="type">int</span> val = <span class="built_in">atoi</span>(statementArr[++i].<span class="built_in">c_str</span>());</span><br><span class="line">          right = <span class="built_in">make_shared</span>&lt;ValueNode&gt;(val);</span><br><span class="line">          s.<span class="built_in">push</span>(<span class="built_in">make_shared</span>&lt;MulNode&gt;(left,right));</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(statementArr[i] == <span class="string">&quot;/&quot;</span>)&#123;</span><br><span class="line">          left = s.<span class="built_in">top</span>(); s.<span class="built_in">pop</span>();</span><br><span class="line">          <span class="type">int</span> val = <span class="built_in">atoi</span>(statementArr[++i].<span class="built_in">c_str</span>());</span><br><span class="line">          right = <span class="built_in">make_shared</span>&lt;ValueNode&gt;(val);</span><br><span class="line">          s.<span class="built_in">push</span>(<span class="built_in">make_shared</span>&lt;DivNode&gt;(left,right));</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(statementArr[i] == <span class="string">&quot;%&quot;</span>)&#123;</span><br><span class="line">          left = s.<span class="built_in">top</span>(); s.<span class="built_in">pop</span>();</span><br><span class="line">          <span class="type">int</span> val = <span class="built_in">atoi</span>(statementArr[++i].<span class="built_in">c_str</span>());</span><br><span class="line">          right = <span class="built_in">make_shared</span>&lt;ValueNode&gt;(val);</span><br><span class="line">          s.<span class="built_in">push</span>(<span class="built_in">make_shared</span>&lt;ModNode&gt;(left,right));</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          s.<span class="built_in">push</span>(<span class="built_in">make_shared</span>&lt;ValueNode&gt;(<span class="built_in">atoi</span>(statementArr[i].<span class="built_in">c_str</span>())));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>-&gt;node = s.<span class="built_in">top</span>(); s.<span class="built_in">pop</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">compute</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> node-&gt;<span class="built_in">interpret</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    string statement;</span><br><span class="line">    shared_ptr&lt;Node&gt; node;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å®¢æˆ·ç«¯æµ‹è¯•&amp;#x20;</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å®¢æˆ·ç«¯æµ‹è¯• </span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//éœ€è¦è§£æçš„è¯­å¥ </span></span><br><span class="line">  string statement = <span class="string">&quot;3 * 4 / 2 % 4&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//è§£æå™¨ </span></span><br><span class="line">  Calculator calculator;</span><br><span class="line">  calculator.<span class="built_in">bulid</span>(statement);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//è®¡ç®—ç»“æœ </span></span><br><span class="line">  <span class="type">int</span> result = calculator.<span class="built_in">compute</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//è¾“å‡º </span></span><br><span class="line">  cout &lt;&lt; statement &lt;&lt; <span class="string">&quot; = &quot;</span> &lt;&lt; result &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li><p>æ‰©å±•æ€§å¥½ï¼šç”±äºåœ¨è§£é‡Šå™¨æ¨¡å¼ä¸­ä½¿ç”¨ç±»æ¥è¡¨ç¤ºè¯­è¨€çš„æ–‡æ³•è§„åˆ™ï¼Œå› æ­¤å¯ä»¥<strong>é€šè¿‡ç»§æ‰¿ç­‰æœºåˆ¶æ¥æ”¹å˜æˆ–æ‰©å±•æ–‡æ³•</strong>ã€‚</p>
</li>
<li><p>å®¹æ˜“å®ç°ï¼š åœ¨è¯­æ³•æ ‘ä¸­çš„<strong>æ¯ä¸ªè¡¨è¾¾å¼èŠ‚ç‚¹ç±»éƒ½æ˜¯ç›¸ä¼¼çš„</strong>ï¼Œæ‰€ä»¥å®ç°å…¶æ–‡æ³•è¾ƒä¸ºå®¹æ˜“ã€‚</p>
</li>
</ul>
</li>
<li><p>ç¼ºç‚¹ï¼š</p>
<ul>
<li><p>æ‰§è¡Œæ•ˆç‡è¾ƒä½ï¼šè§£é‡Šå™¨æ¨¡å¼ä¸­<strong>é€šå¸¸ä½¿ç”¨å¤§é‡çš„å¾ªç¯å’Œé€’å½’è°ƒç”¨</strong>ï¼Œå½“è¦è§£é‡Šçš„å¥å­è¾ƒå¤æ‚æ—¶ï¼Œå…¶è¿è¡Œé€Ÿåº¦å¾ˆæ…¢ï¼Œä¸”ä»£ç çš„è°ƒè¯•è¿‡ç¨‹ä¹Ÿæ¯”è¾ƒéº»çƒ¦ã€‚</p>
</li>
<li><p>å¯åº”ç”¨çš„åœºæ™¯æ¯”è¾ƒå°‘ï¼š<strong>åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œéœ€è¦å®šä¹‰è¯­è¨€æ–‡æ³•çš„åº”ç”¨å®ä¾‹éå¸¸å°‘</strong>ï¼Œæ‰€ä»¥è¿™ç§æ¨¡å¼å¾ˆå°‘è¢«ä½¿ç”¨åˆ°ã€‚</p>
</li>
</ul>
</li>
</ul>
<h3 id="22-ä¸­ä»‹æ¨¡å¼ï¼ˆMediatorï¼‰"><a href="#22-ä¸­ä»‹æ¨¡å¼ï¼ˆMediatorï¼‰" class="headerlink" title="22 ä¸­ä»‹æ¨¡å¼ï¼ˆMediatorï¼‰"></a>22 ä¸­ä»‹æ¨¡å¼ï¼ˆMediatorï¼‰</h3><p>ä¸€ä¸ªç”±å¾ˆå¤šå¯¹è±¡ç»„æˆçš„æ¨¡å—ï¼Œå…¶å¯¹è±¡é—´å¯èƒ½å­˜åœ¨é”™ç»¼å¤æ‚çš„å…³è”æ€§ã€‚ä»¥P2PèŠå¤©ä¸ºä¾‹ï¼Œç”¨æˆ·å¯¹è±¡ä¹‹é—´æ„æˆäº†ç½‘çŠ¶ç»“æ„ï¼Œå°†ä¼šå¯¼è‡´å¦‚ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li><p>ç³»ç»Ÿç»“æ„å¤æ‚ï¼šå¯¹è±¡ä¹‹é—´å­˜åœ¨å¤§é‡çš„ç›¸äº’å…³è”å’Œè°ƒç”¨ï¼Œè‹¥æœ‰ä¸€ä¸ªå¯¹è±¡å‘ç”Ÿå˜åŒ–ï¼Œåˆ™éœ€è¦è·Ÿè¸ªå’Œè¯¥å¯¹è±¡å…³è”çš„å…¶ä»–æ‰€æœ‰å¯¹è±¡ï¼Œå¹¶è¿›è¡Œé€‚å½“å¤„ç†ã€‚</p>
</li>
<li><p>å¯¹è±¡å¯é‡ç”¨æ€§å·®ï¼šç”±äºä¸€ä¸ªå¯¹è±¡å’Œå…¶ä»–å¯¹è±¡å…·æœ‰å¾ˆå¼ºçš„å…³è”ï¼Œè‹¥æ²¡æœ‰å…¶ä»–å¯¹è±¡çš„æ”¯æŒï¼Œä¸€ä¸ªå¯¹è±¡å¾ˆéš¾è¢«å¦ä¸€ä¸ªç³»ç»Ÿæˆ–æ¨¡å—é‡ç”¨ï¼Œè¿™äº›å¯¹è±¡è¡¨ç°å‡ºæ¥æ›´åƒä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ•´ä½“ï¼ŒèŒè´£è¾ƒä¸ºæ··ä¹±ã€‚</p>
</li>
<li><p>ç³»ç»Ÿæ‰©å±•æ€§ä½ï¼šå¢åŠ ä¸€ä¸ªæ–°çš„å¯¹è±¡éœ€è¦åœ¨åŸæœ‰ç›¸å…³å¯¹è±¡ä¸Šå¢åŠ å¼•ç”¨ï¼Œå¢åŠ æ–°çš„å¼•ç”¨å…³ç³»ä¹Ÿéœ€è¦è°ƒæ•´åŸæœ‰å¯¹è±¡ï¼Œç³»ç»Ÿè€¦åˆåº¦å¾ˆé«˜ï¼Œå¯¹è±¡æ“ä½œå¾ˆä¸çµæ´»ï¼Œæ‰©å±•æ€§å·®ã€‚</p>
</li>
</ul>
<p>ä¸­ä»‹è€…æ¨¡å¼æ—¨åœ¨<strong>åˆ©ç”¨ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥å°è£…ä¸€ç³»åˆ—çš„å¯¹è±¡äº¤äº’</strong>ï¼Œä½¿å¾—å„å¯¹è±¡é—´ä¸éœ€è¦æ˜¾å¼åœ°ç›¸äº’å¼•ç”¨ï¼Œä»è€Œå°†è€¦åˆæ¾æ•£ã€‚</p>
<p><img src="/design_pattern-image/image_BJw7swbIke.png"></p>
<ol>
<li><p>Mediatorï¼šæŠ½è±¡ä¸­ä»‹è€…</p>
</li>
<li><p>ConcreteMediatorï¼šå…·ä½“ä¸­ä»‹è€…</p>
</li>
<li><p>Colleagueï¼šæŠ½è±¡åŒäº‹ç±»ï¼Œä¹Ÿå°±æ˜¯é‚£äº›ç›¸äº’å…³è”çš„å¯¹è±¡çš„çˆ¶ç±»</p>
</li>
<li><p>ConcreteColleagueï¼šå…·ä½“åŒäº‹ç±»ï¼Œç›¸äº’å…³è”çš„å¯¹è±¡</p>
</li>
</ol>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// @brief æŠ½è±¡åŒäº‹ç±», å®šä¹‰åŒäº‹ç±»çš„æ¥å£ï¼Œä¿å­˜ä¸­ä»‹è€…å¯¹è±¡ï¼Œæä¾›åŒäº‹å¯¹è±¡äº¤äº’çš„æŠ½è±¡æ–¹æ³•ï¼Œå®ç°æ‰€æœ‰ç›¸äº’å½±å“çš„åŒäº‹ç±»çš„å…¬å…±åŠŸèƒ½</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractMediator</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractColleague</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">AbstractColleague</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// @brief æŠ½è±¡æ¥å£</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Receive</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Send</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// @brief è®¾ç½®ä¸­ä»‹å¯¹è±¡</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">SetMedium</span><span class="params">(AbstractMediator* mediator)</span> </span>&#123;</span><br><span class="line">        mediator_ = mediator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    AbstractMediator* mediator_ = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief å…·ä½“åŒäº‹ç±», æŠ½è±¡åŒäº‹ç±»çš„å®ç°è€…ï¼Œå½“éœ€è¦ä¸å…¶ä»–åŒäº‹å¯¹è±¡äº¤äº’æ—¶ï¼Œç”±ä¸­ä»‹è€…å¯¹è±¡è´Ÿè´£åç»­çš„äº¤äº’</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteColleagueA</span> : <span class="keyword">public</span> AbstractColleague &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Receive</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Send</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteColleagueB</span> : <span class="keyword">public</span> AbstractColleague &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Receive</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Send</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief æŠ½è±¡ä¸­ä»‹ç±», ä¸­ä»‹è€…çš„æ¥å£ï¼Œæä¾›äº†åŒäº‹å¯¹è±¡æ³¨å†Œä¸è½¬å‘åŒäº‹å¯¹è±¡ä¿¡æ¯çš„æŠ½è±¡æ–¹æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractMediator</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">AbstractMediator</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// @brief æ³¨å†Œ</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Register</span><span class="params">(AbstractColleague* colleague)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/// @brief è½¬å‘</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Relay</span><span class="params">(AbstractColleague* colleague)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// @brief å…·ä½“ä¸­ä»‹ç±», å®ç°ä¸­ä»‹è€…æ¥å£. ç®¡ç†åŒäº‹å¯¹è±¡ï¼Œåè°ƒå„ä¸ªåŒäº‹è§’è‰²ä¹‹é—´çš„äº¤äº’å…³ç³»ï¼Œä¾èµ–äºåŒäº‹è§’è‰²</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteMediator</span> : <span class="keyword">public</span> AbstractMediator &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Register</span><span class="params">(AbstractColleague* colleague)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span>* c : colleagues_) &#123;</span><br><span class="line">            <span class="keyword">if</span> (c == colleague) <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        colleagues_.<span class="built_in">emplace_back</span>(colleague);</span><br><span class="line">        colleague-&gt;<span class="built_in">SetMedium</span>(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Relay</span><span class="params">(AbstractColleague* colleague)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span>* c : colleagues_) &#123;</span><br><span class="line">            <span class="comment">// è½¬å‘ç»™é™¤è‡ªå·±å¤–çš„åŒäº‹</span></span><br><span class="line">            <span class="keyword">if</span> (c != colleague) c-&gt;<span class="built_in">Receive</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::list&lt;AbstractColleague*&gt; colleagues_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">///////////////////////////////////////////////////////// åŒäº‹ç±»å®ç°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ConcreteColleagueA::Receive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;this is ConcreteColleagueA::Receive!\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ConcreteColleagueA::Send</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;this is ConcreteColleagueA::Send!\n&quot;</span>);</span><br><span class="line">    <span class="comment">// è¯·ä¸­ä»‹è€…è½¬å‘</span></span><br><span class="line">    mediator_-&gt;<span class="built_in">Relay</span>(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ConcreteColleagueB::Receive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;this is ConcreteColleagueB::Receive!\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ConcreteColleagueB::Send</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;this is ConcreteColleagueB::Send!\n&quot;</span>);</span><br><span class="line">    <span class="comment">// è¯·ä¸­ä»‹è€…è½¬å‘</span></span><br><span class="line">    mediator_-&gt;<span class="built_in">Relay</span>(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>mainå‡½æ•°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;-------------------- %s --------------------\n&quot;</span>, __FUNCTION__);</span><br><span class="line">    <span class="function">std::shared_ptr&lt;AbstractMediator&gt; <span class="title">ptr_md</span><span class="params">(<span class="keyword">new</span> ConcreteMediator())</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::shared_ptr&lt;AbstractColleague&gt; <span class="title">ptr_c1</span><span class="params">(<span class="keyword">new</span> ConcreteColleagueA())</span></span>;</span><br><span class="line">    <span class="function">std::shared_ptr&lt;AbstractColleague&gt; <span class="title">ptr_c2</span><span class="params">(<span class="keyword">new</span> ConcreteColleagueB())</span></span>;</span><br><span class="line"></span><br><span class="line">    ptr_md-&gt;<span class="built_in">Register</span>(ptr_c1.<span class="built_in">get</span>());</span><br><span class="line">    ptr_md-&gt;<span class="built_in">Register</span>(ptr_c2.<span class="built_in">get</span>());</span><br><span class="line"></span><br><span class="line">    ptr_c1-&gt;<span class="built_in">Send</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;-----------\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    ptr_c2-&gt;<span class="built_in">Send</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li><p>ç®€åŒ–äº†å¯¹è±¡ä¹‹é—´çš„äº¤äº’ï¼›</p>
</li>
<li><p>å°†å„åŒäº‹è§£è€¦ã€‚</p>
</li>
</ul>
</li>
<li><p>ç¼ºç‚¹ï¼š</p>
<p>å…·ä½“ä¸­ä»‹è€…ç±»ä¸­åŒ…å«äº†åŒäº‹ä¹‹é—´çš„äº¤äº’ç»†èŠ‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…·ä½“ä¸­ä»‹è€…ç±»éå¸¸å¤æ‚ï¼Œè®©ç³»ç»Ÿéš¾ç»´æŠ¤ã€‚</p>
</li>
</ul>
<h2 id="è®¾è®¡æ¨¡å¼æ€ç»´å¯¼å›¾"><a href="#è®¾è®¡æ¨¡å¼æ€ç»´å¯¼å›¾" class="headerlink" title="è®¾è®¡æ¨¡å¼æ€ç»´å¯¼å›¾"></a>è®¾è®¡æ¨¡å¼æ€ç»´å¯¼å›¾</h2><p><img src="/design_pattern-image/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F_bWnBly4dT4.jpg"></p>
]]></content>
      <categories>
        <category>è®¡ç®—æœºåŸºç¡€çŸ¥è¯†</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockerä½¿ç”¨æ–¹æ³•è¯¦è§£</title>
    <url>/2020/04/05/Docker/Docker/</url>
    <content><![CDATA[<h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><p><a href="https://docs.docker.com/reference/" title="å®˜æ–¹æ‰‹å†Œ">å®˜æ–¹æ‰‹å†Œ</a></p>
<p><a href="https://yeasy.gitbook.io/docker_practice/" title="ç”µå­ä¹¦ï¼šdockerä»å…¥é—¨åˆ°å®è·µ">ç”µå­ä¹¦ï¼šdockerä»å…¥é—¨åˆ°å®è·µ</a></p>
<h2 id="1-dockerç®€ä»‹"><a href="#1-dockerç®€ä»‹" class="headerlink" title="1 dockerç®€ä»‹"></a>1 dockerç®€ä»‹</h2><h3 id="1-1-dockerä¸è™šæ‹Ÿæœº"><a href="#1-1-dockerä¸è™šæ‹Ÿæœº" class="headerlink" title="1.1 dockerä¸è™šæ‹Ÿæœº"></a>1.1 dockerä¸è™šæ‹Ÿæœº</h3><h3 id="1-2-é•œåƒ"><a href="#1-2-é•œåƒ" class="headerlink" title="1.2 é•œåƒ"></a>1.2 é•œåƒ</h3><h2 id="2-dockeråŸºæœ¬å‘½ä»¤"><a href="#2-dockeråŸºæœ¬å‘½ä»¤" class="headerlink" title="2 dockeråŸºæœ¬å‘½ä»¤"></a>2 dockeråŸºæœ¬å‘½ä»¤</h2><h3 id="2-1-dockeråŸºæœ¬å‘½ä»¤æ¦‚è§ˆ"><a href="#2-1-dockeråŸºæœ¬å‘½ä»¤æ¦‚è§ˆ" class="headerlink" title="2.1 dockeråŸºæœ¬å‘½ä»¤æ¦‚è§ˆ"></a>2.1 dockeråŸºæœ¬å‘½ä»¤æ¦‚è§ˆ</h3><p><img src="/image/docker%E5%91%BD%E4%BB%A4_mHG9nKYq_l.png"></p>
<h3 id="2-2-docker-runè¯¦è§£"><a href="#2-2-docker-runè¯¦è§£" class="headerlink" title="2.2 docker runè¯¦è§£"></a>2.2 docker runè¯¦è§£</h3><blockquote>
<p>ğŸ“Œè‹¥ä¹‹å‰æœªä¸‹è½½å¯¹åº”é•œåƒï¼Œä¼šä»docker hubæ‹‰å–ï¼›è‹¥ä¸‹è½½è¿‡ï¼Œç›´æ¥ç”¨é•œåƒåˆ›å»º</p>
</blockquote>
<ul>
<li><p>è‹¥ç›´æ¥è¾“å…¥docker run ubuntuï¼Œä¼šå‘ç°åˆ›å»ºäº†å®¹å™¨ä¹‹åä¾¿é€€å‡ºäº†ï¼Œå¹¶æ²¡æœ‰è¿è¡Œ</p>
<p>è¿™æ˜¯å› ä¸ºdockeræ˜¯ç”¨æ¥è¿è¡Œè¿›ç¨‹æˆ–ä»»åŠ¡çš„ï¼Œè¿›ç¨‹ä¸€æ—¦å®Œæˆï¼Œå®¹å™¨ä¾¿ä¼šé€€å‡ºã€‚è€Œubuntuåªæ˜¯ä¸€ä¸ªå…¶å®ƒæœåŠ¡ä¾æ‰˜çš„åŸºç¡€é•œåƒï¼Œæœ¬èº«å¹¶æ²¡æœ‰è¿›ç¨‹ï¼Œæ‰€ä»¥åˆ›å»ºæ–°å®¹å™¨åå°±ä¼šé€€å‡ºã€‚</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#----------------- è§£å†³è¿™ç§é—®é¢˜çš„å‡ ç§æ–¹å¼ ---------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼ä¸€ï¼šå¯åŠ¨å®¹å™¨æ—¶æŒ‡å®šè¿è¡Œå‘½ä»¤</span></span><br><span class="line">docker run ubuntu <span class="built_in">sleep</span> 5 <span class="comment"># æ­¤å‘½ä»¤ä¼šå¯åŠ¨å®¹å™¨æ—¶æ‰§è¡Œsleep 5ï¼Œç¡çœ 5ç§’ååº”ç”¨åœæ­¢ï¼Œå®¹å™¨é€€å‡º</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼äºŒï¼šäº¤äº’æ¨¡å¼ï¼Œè¿æ¥åˆ°ç»ˆç«¯</span></span><br><span class="line">docker run -it kodekloud/simple-prompt-docker </span><br></pre></td></tr></table></figure>

<p>è‹¥å®¹å™¨åŒ–åº”ç”¨æ—¢åŒ…æ‹¬æ ‡å‡†è¾“å…¥åˆæœ‰æ ‡å‡†è¾“å‡ºï¼Œé‚£runå®¹å™¨æ—¶é»˜è®¤åªä¼šè¾“å‡ºï¼Œå¹¶ä¸ä¼šç›‘å¬æ ‡å‡†è¾“å…¥</p>
<p>-i ï¼šäº¤äº’æ¨¡å¼ï¼Œå¯ä»¥ç›‘å¬æ ‡å‡†è¾“å…¥</p>
<p>-tï¼šå³ä½¿æ˜¯äº¤äº’æ¨¡å¼ï¼Œç”±äºç»ˆç«¯ä¸ä¸€è‡´ï¼Œæœ‰æ ‡å‡†è¾“å…¥çš„appä»ä¸ä¼šå®Œæ•´å®ç°ï¼Œæ‰€ä»¥ç”¨-té€‰é¡¹è¿æ¥ç»ˆç«¯</p>
<ul>
<li>docker runè¿˜æœ‰attachå’Œdetachçš„é€‰é¡¹</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -dé€‰é¡¹ï¼Œä½¿å®¹å™¨åœ¨åå°è¿è¡Œ</span></span><br><span class="line">docker run -d kodekloud/simple-webapp</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæƒ³é‡æ–°è¿æ¥åˆ°æ­£åœ¨åå°è¿è¡Œçš„å®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨attachå‘½ä»¤</span></span><br><span class="line">docker attach å®¹å™¨ID/å®¹å™¨å</span><br></pre></td></tr></table></figure>

<ul>
<li><p>æ­¤å¤–è¿˜å¯ä»¥ç”¨tagæŒ‡å®šrunçš„ç‰ˆæœ¬ï¼Œå¦‚docker run redis:4.0ï¼ˆé»˜è®¤tagæ˜¯latestï¼‰</p>
</li>
<li><p>ç«¯å£æ˜ å°„ï¼š-pé€‰é¡¹</p>
</li>
</ul>
<p>dockerå®¹å™¨çš„IPåœ°å€ä»¥åŠç«¯å£å‡å±äºå†…éƒ¨ï¼Œå¯ä»¥ä»å®¹å™¨å†…éƒ¨è®¿é—®localhostï¼Œä½†æ˜¯å¤–éƒ¨é»˜è®¤æ— æ³•è®¿é—®</p>
<p>æ­¤æ—¶éœ€è¦å°†å®¹å™¨çš„ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ç«¯å£ï¼Œä¹‹åä¾¿å¯ä»¥é€šè¿‡ä¸»æœºIPè®¿é—®å®¹å™¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># simple-webappç¨‹åºç›‘å¬å®¹å™¨çš„5000ç«¯å£</span></span><br><span class="line">docker run -p 80:5000 kodekloud/simple-webapp <span class="comment">#å®¹å™¨çš„5000ç«¯å£è¢«æ˜ å°„åˆ°ä¸»æœºçš„80ç«¯å£</span></span><br></pre></td></tr></table></figure>

<p><img src="/image/network_XM4cj9dlTB.png"></p>
<p>é€šè¿‡æŠŠä¸åŒå®¹å™¨æ˜ å°„åˆ°ä¸»æœºçš„ä¸åŒç«¯å£ä¸Šï¼Œå¯ä»¥åŒæ—¶å®ç°å¤šä¸ªå®ä¾‹</p>
<ul>
<li>ç›®å½•æ˜ å°„</li>
</ul>
<p>å®¹å™¨æœ‰è‡ªå·±çš„éš”ç¦»çš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»»ä½•å¯¹æ–‡ä»¶çš„ä¿®æ”¹éƒ½å‘ç”Ÿåœ¨å®¹å™¨å†…éƒ¨ï¼Œå¦‚æœç”¨rmå‘½ä»¤åˆ é™¤å®¹å™¨ï¼Œæ•°æ®ä¹Ÿä¼šæ¶ˆå¤±ã€‚å¦‚æœæƒ³åˆ é™¤å®¹å™¨ä½†æ˜¯ä¿ç•™æ•°æ®ï¼Œå¯ä»¥å°†å®¹å™¨å†…çš„å·æŒ‚è½½åˆ°ä¸»æœºä¸­ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -vé€‰é¡¹è´Ÿè´£ç›®å½•æ˜ å°„</span></span><br><span class="line">docker run -v /opt/datadir:/var/lib/mysql mysql</span><br><span class="line"><span class="comment"># å°†ä¸»æœºçš„/opt/datadiræ˜ å°„åˆ°mysqlå®¹å™¨å†…çš„/var/lib/mysqlç›®å½•</span></span><br><span class="line"><span class="comment"># mysqlå®¹å™¨åˆ é™¤å/opt/datadirä¸­çš„å†…å®¹ä»åœ¨</span></span><br></pre></td></tr></table></figure>

<ul>
<li>è®¾ç½®å¹¶æŸ¥çœ‹ç¯å¢ƒå˜é‡</li>
</ul>
<p>å¯ä»¥åœ¨runçš„æ—¶å€™æŒ‡å®šå®¹å™¨çš„ç¯å¢ƒå˜é‡ï¼Œä»è€Œä½¿è°ƒç”¨è¯¥ç¯å¢ƒå˜é‡çš„ç¨‹åºå¾—åˆ°è‡ªå®šä¹‰æ•°å€¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨-eé€‰é¡¹ï¼Œå°†simple-webapp-colorå®¹å™¨ä¸­çš„APP_COLORç¯å¢ƒå˜é‡èµ‹å€¼ä¸ºblue</span></span><br><span class="line">docker run -e APP_COLOR=blue simple-webapp-color</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨inspectå¯ä»¥æŸ¥çœ‹ç¯å¢ƒå˜é‡çš„å€¼</span></span><br><span class="line">docker inspect simple-webapp-color</span><br><span class="line"><span class="comment"># è¾“å‡ºä¸­çš„Configä¸­ä¼šæœ‰ç¯å¢ƒå˜é‡åˆ—è¡¨</span></span><br></pre></td></tr></table></figure>

<h2 id="3-dockeræ„å»ºé•œåƒ"><a href="#3-dockeræ„å»ºé•œåƒ" class="headerlink" title="3 dockeræ„å»ºé•œåƒ"></a>3 dockeræ„å»ºé•œåƒ</h2><h3 id="åŸºæœ¬æ­¥éª¤"><a href="#åŸºæœ¬æ­¥éª¤" class="headerlink" title="åŸºæœ¬æ­¥éª¤"></a>åŸºæœ¬æ­¥éª¤</h3><ul>
<li>åˆ›å»ºDockerfileï¼ˆdockerfleä¸­çš„æ¯ä¸€è¡Œéƒ½æ˜¯å‘½ä»¤+å‚æ•°ï¼‰</li>
</ul>
<figure class="highlight docker"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> Ubuntu</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip install flask</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip install flask-mysql</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . /opt/source-code</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> FLASK_APP=/opt/source-code/app.py flask run</span></span><br></pre></td></tr></table></figure>

<pre><code>Layer1. Base Ubuntu Layer

Layer2. Changes in apt packages

Layer3. Changes in pip packages

Layer4. Source Code

Layer5. Update Entrypoint with &quot;flask command&quot;
</code></pre>
<blockquote>
<p>ğŸ“Œå…³äºdockeråˆ†å±‚ç»“æ„ï¼š<br>- æ¯ä¸€å±‚åªå­˜å‚¨ä¸å‰ä¸€å±‚ä¹‹é—´çš„å˜åŒ–ï¼Œæ‰€ä»¥å¾€å¾€å±‚æ•°å¾ˆé«˜æ—¶ï¼Œè¯¥å±‚å¤§å°ä¹Ÿå¾ˆå°<br>- docker history+é•œåƒåï¼šå¯æŸ¥çœ‹æ¯ä¸€å±‚æ‰§è¡Œçš„å‘½ä»¤å’Œå¤§å°<br>- docker buildä¼šåœ¨æ„å»ºæœŸé—´ç¼“å­˜å·²ç»æˆåŠŸçš„å±‚ï¼Œè¿™æ ·å¦‚æœæ„å»ºå¤±è´¥æˆ–è€…éœ€è¦ä¿®æ”¹é•œåƒæ—¶ï¼Œå¯ä»¥ä»ä¸­é—´çš„æŸä¸€å±‚å¼€å§‹é‡æ–°æ„å»ºï¼ŒèŠ‚çœæ—¶é—´</p>
</blockquote>
<pre><code># dockerfileåŸºæœ¬æŒ‡ä»¤
FROM :       æŒ‡å®šåŸºç¡€é•œåƒï¼Œåœ¨å…¶ä¸Šæ„å»ºå½“å‰é•œåƒ
RUN :        åœ¨åŸºç¡€é•œåƒå®¹å™¨ä¸­è¿è¡Œå‘½ä»¤
COPY :       ä»æœ¬åœ°æŒ‡å®šç›®å½•å¤åˆ¶å†…å®¹åˆ°å®¹å™¨çš„æŒ‡å®šç›®å½•
CMD :        æŒ‡å®šåœ¨å®¹å™¨åˆå§‹é˜¶æ®µè¿è¡Œçš„é»˜è®¤ç¨‹åºï¼ˆæœ‰å‚æ•°ï¼‰
             å¦‚Ubuntué•œåƒçš„dockerfileä¸­æœ‰CMD &#123;&quot;bash&quot;&#125;
             å¦‚æœåœ¨docker runåè¿½åŠ å‘½ä»¤ï¼Œè¯¥å‘½ä»¤ä¼šè¦†ç›–é»˜è®¤CMD
             æœ‰ä¸¤ç§ä¹¦å†™æ ¼å¼ï¼š CMD command param1   |  CMD [&quot;command&quot;,&quot;param1&quot;]
                             CMD sleep 5             CMD [&quot;sleep&quot;,&quot;5&quot;] 
ENTRYPOINT : æŒ‡å®šåœ¨å®¹å™¨åˆå§‹é˜¶æ®µè¿è¡Œçš„é»˜è®¤ç¨‹åºï¼ˆå¯ä»¥æ— å‚æ•°ï¼‰
             docker runåè¿½åŠ å‚æ•°ï¼Œç›¸å½“äºæ‰§è¡ŒENTRYPOINTä¸­çš„å‘½ä»¤+å‚æ•°

ENTRYPOINT+CMDç»„åˆ : 
             é»˜è®¤æ‰§è¡ŒENTRYPOINTå‘½ä»¤+CMDå‚æ•°ï¼Œæ­¤æ—¶äºŒè€…å¿…é¡»æ˜¯JSONæ ¼å¼
             ENTRYPOINT [&quot;sleep&quot;]
             CMD [&quot;5&quot;]
ADD :        ç›¸å½“äºCOPYï¼Œæœ‰è‡ªåŠ¨è§£å‹ç¼©åŠŸèƒ½ï¼Œä½†ä¼šä»¤é•œåƒæ„å»ºç¼“å­˜å¤±æ•ˆï¼Œä½¿é•œåƒæ„å»ºç¼“æ…¢
ENV :        è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæ ¼å¼æœ‰ä¸¤ç§
             ENV &lt;key&gt; &lt;value&gt;
             ENV &lt;key1&gt;=&lt;value1&gt; &lt;key2&gt;=&lt;value2&gt;
ARG :        è®¾ç½®æ„å»ºé•œåƒæ—¶çš„ç¯å¢ƒå˜é‡ï¼Œå®¹å™¨è¿è¡Œæ—¶ç¯å¢ƒå˜é‡ä¸å¤å­˜åœ¨ï¼Œå³ç›¸å½“äºdockerfileçš„å®
             æœ‰ä½œç”¨åŸŸï¼Œè‹¥åœ¨FROMæŒ‡ä»¤ä¹‹å‰æŒ‡å®šï¼Œé‚£ä¹ˆåªèƒ½ç”¨äºè¯¥FROMæŒ‡ä»¤ä¸­ï¼Œåç»­æŒ‡ä»¤æ— æ³•å†ç”¨
             å‚æ•°å€¼åœ¨docker buildä¸­å¯ç”¨--build-arg &lt;å‚æ•°å&gt;=&lt;å€¼&gt;æ¥è¦†ç›–
WORKDIR :    ç›¸å½“äºdockerfileä¸­çš„cd
</code></pre>
<blockquote>
<p>ğŸ“Œæ³¨ï¼šè‹¥è¦åœ¨å®¹å™¨è¿è¡Œæ—¶æ”¹å˜å…¥å£ç‚¹ï¼Œå¦‚ä»sleepæ”¹æˆbashï¼Œå¯ä»¥docker run - - entrypoint bash  ubuntu-sleeper 10</p>
</blockquote>
<p>æ›´å¤šdockerfileæŒ‡ä»¤å¯æŸ¥çœ‹<a href="https://vuepress.mirror.docker-practice.com/image/dockerfile/" title="https://vuepress.mirror.docker-practice.com/image/dockerfile/">https://vuepress.mirror.docker-practice.com/image/dockerfile/</a></p>
<ul>
<li>ä½¿ç”¨docker buildæ„å»ºé•œåƒ</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨URL github.com/creack/docker-firefox çš„ Dockerfile åˆ›å»ºé•œåƒ</span></span><br><span class="line">docker build github.com/creack/docker-firefox</span><br><span class="line"><span class="comment"># é€šè¿‡-fé€‰é¡¹æŒ‡å®šDockerfileçš„ä½ç½®</span></span><br><span class="line">docker build -f /path/to/Dockerfile</span><br><span class="line"><span class="comment"># ä½¿ç”¨å½“å‰ç›®å½•çš„ Dockerfile åˆ›å»ºé•œåƒï¼ˆæ³¨æ„æœ€åé‚£ä¸ªç‚¹ï¼‰ï¼Œæ ‡ç­¾ä¸º runoob/ubuntu:v1</span></span><br><span class="line">docker build -t runoob/ubuntu:v1 .</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨docker pushå°†é•œåƒæ¨åˆ°docker hub</li>
</ul>
<h2 id="4-docker-registry"><a href="#4-docker-registry" class="headerlink" title="4 docker registry"></a>4 docker registry</h2><blockquote>
<p>docker registryæ˜¯é•œåƒå­˜å‚¨çš„åœ°æ–¹ï¼Œä¸­å¤®ä»“åº“</p>
</blockquote>
<p>å¦‚nginxé•œåƒåå…¨ç§°ä¸ºnginx&#x2F;nginxï¼Œå‰è€…æ˜¯ç”¨æˆ·åï¼Œè‹¥ä¸æä¾›åˆ™é»˜è®¤ç”¨æˆ·åä¸é•œåƒåç›¸åŒ</p>
<p>é»˜è®¤çš„docker registryæ˜¯dockerhubï¼Œå…¶å®ƒçš„è¿˜æœ‰è°·æ­Œgcr(æä¾›k8sé•œåƒ)ç­‰ç­‰ï¼ŒAWSç­‰å…¬å¸ä¹Ÿæä¾›ç§æœ‰registryæ–¹ä¾¿äºä¸æƒ³å…±äº«é•œåƒçš„æ—¶å€™</p>
<ul>
<li><p>dockerhubæä¾›çš„ç§æœ‰ä»“åº“ï¼šdocker login <a href="http://private-registry.io/" title="private-registry.io">private-registry.io</a></p>
<p>ä½¿ç”¨ç§æœ‰ä»“åº“éœ€è¦ä¿è¯åœ¨ç™»å½•çŠ¶æ€</p>
</li>
</ul>
<h3 id="æœ¬åœ°Registryåˆ›å»ºä¸ä½¿ç”¨"><a href="#æœ¬åœ°Registryåˆ›å»ºä¸ä½¿ç”¨" class="headerlink" title="æœ¬åœ°Registryåˆ›å»ºä¸ä½¿ç”¨"></a>æœ¬åœ°Registryåˆ›å»ºä¸ä½¿ç”¨</h3><p>Registryæœ¬èº«å°±æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œä¸”å·²ç»ssè¢«åšæˆäº†é•œåƒï¼Œå…¶å®¹å™¨å¼€æ”¾ç«¯å£5000ï¼Œåˆ©ç”¨è¯¥å®¹å™¨å¯ä»¥åœ¨å±€åŸŸç½‘å†…ä¸å›¢é˜Ÿå…±äº«æ‰€åˆ›å»ºçš„é•œåƒ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿è¡Œregistryå®¹å™¨ï¼Œä¹Ÿå¯ä»¥åŠ ä¸Š-vé€‰é¡¹å°†é•œåƒå­˜äºæœ¬åœ°</span></span><br><span class="line">docker run -d -p 5000:5000 --name registry registry:2</span><br><span class="line"><span class="comment"># ä½¿ç”¨tagå°†é•œåƒæ ‡è®°ä¸ºå¯è¢«æœ¬åœ°Registryæ¥å—çš„é•œåƒå</span></span><br><span class="line">docker image tag my-image localhost:5000/my-image</span><br><span class="line"><span class="comment"># å‘æœ¬åœ°registryæ¨é€é•œåƒ</span></span><br><span class="line">docker push localhost:5000/my-image</span><br><span class="line"><span class="comment"># ä»æœ¬åœ°registryæ‹‰å–é•œåƒ</span></span><br><span class="line">docker pull localhost:5000/my-image</span><br><span class="line"><span class="comment"># ä»å±€åŸŸç½‘å†…å…¶å®ƒä¸»æœºçš„registryæ‹‰å–é•œåƒ</span></span><br><span class="line">docker pull 192.168.56.100:5000/my-image</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ“Œæ³¨ï¼šå¯ä»¥é€šè¿‡curl localhost:5000&#x2F;v2&#x2F;_catalogå‘½ä»¤æŸ¥çœ‹é•œåƒæ˜¯å¦ä¸Šä¼ æˆåŠŸ</p>
</blockquote>
<p>ä¸Šè¿°æ–¹æ³•é€‚ç”¨äºdocker 1.3.xä¹‹å‰çš„ç‰ˆæœ¬ï¼Œäº¤äº’å…¨éƒ¨ä½¿ç”¨httpæœåŠ¡ã€‚ç„¶è€Œè¯¥ç‰ˆæœ¬ä¹‹åï¼Œdockeræ­å»ºç§æœ‰é•œåƒé»˜è®¤ä½¿ç”¨httpsï¼Œè‹¥ä»registryé‡Œpullé•œåƒä¼šæŠ¥é”™ã€‚</p>
<p><strong>è§£å†³åŠæ³•ä¸€</strong>ï¼šé…ç½®SSLè¯ä¹¦</p>
<ul>
<li>å®˜æ–¹æ–‡æ¡£ï¼ˆéš¾ï¼Œå› ä¸ºå¾ˆéš¾å»ºç«‹è¯ä¹¦ï¼‰</li>
</ul>
<ol>
<li>åˆ›å»ºcertsæ–‡ä»¶å¤¹</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p certs</span><br></pre></td></tr></table></figure>

<p>ä»CAæ‹·è´.crtå’Œ.keyæ–‡ä»¶åˆ°certsæ–‡ä»¶å¤¹ï¼ˆä¾‹ä¸­é‡‡ç”¨åå­—domain.crtå’Œdomain.keyï¼‰</p>
<p>å‡è®¾åŸŸåä¸ºhttps:&#x2F;&#x2F;myregistry.domain.com&#x2F;</p>
<p>&amp;#x20;2. å¯åŠ¨registryå®¹å™¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --restart=always \</span><br><span class="line">  --name registry \</span><br><span class="line">  -v <span class="string">&quot;<span class="subst">$(pwd)</span>&quot;</span>/certs:/certs \</span><br><span class="line">  -e REGISTRY_HTTP_ADDR=0.0.0.0:443 \</span><br><span class="line">  -e REGISTRY_HTTP_TLS_CERTIFICATE=/certs/domain.crt \</span><br><span class="line">  -e REGISTRY_HTTP_TLS_KEY=/certs/domain.key \</span><br><span class="line">  -p 443:443 \</span><br><span class="line">  registry:2</span><br></pre></td></tr></table></figure>

<p>æ­¤å‘½ä»¤å°†å®¹å™¨ä¸­çš„certsæ–‡ä»¶å¤¹æŒ‚è½½åˆ°å®¿ä¸»æœºçš„certsæ–‡ä»¶å¤¹ï¼Œé€šè¿‡ç¯å¢ƒå˜é‡å‘ŠçŸ¥å®¹å™¨è¯¥åˆ°å“ªé‡Œæ‰¾domain.crtå’Œdomain.keyã€‚registryå°†åœ¨443ç«¯å£ï¼ˆé»˜è®¤HTTPSç«¯å£ï¼‰è¿è¡Œã€‚</p>
<p>æ–°registryé€šè¿‡myregistry.domain.comè®¿é—®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull ubuntu:16.04</span><br><span class="line">docker tag ubuntu:16.04 myregistry.domain.com/my-ubuntu</span><br><span class="line">docker push myregistry.domain.com/my-ubuntu</span><br><span class="line">docker pull myregistry.domain.com/my-ubuntu</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨ä¸­é—´è¯ä¹¦(intermediate certificate)</li>
</ul>
<p>è¯ä¹¦å‘æ”¾è€…å¾€å¾€ä¼šæä¾›çš„æ˜¯ä¸­é—´è¯ä¹¦ï¼Œéœ€è¦åˆ©ç”¨è¯¥è¯ä¹¦åˆ›å»ºdomain.crt</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> domain.crt intermediate-certificates.pem &gt; certs/domain.crt</span><br></pre></td></tr></table></figure>

<p><strong>è§£å†³æ–¹æ³•2</strong>ï¼šéœ€è¦pullçš„æœºå™¨æ·»åŠ ä¿¡ä»»registryåˆ—è¡¨</p>
<p>æ‰“å¼€&#x2F;etc&#x2F;docker&#x2F;daemon.json</p>
<p>æ·»åŠ ç§æœ‰registry</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;insecure-registries&quot;</span>:[<span class="string">&quot;myregistry.example.com:5000&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>æˆ–</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;insecure-registries&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;registry:5000&quot;</span>, </span><br><span class="line">    <span class="string">&quot;registry2:5000&quot;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="5-dockerå­˜å‚¨"><a href="#5-dockerå­˜å‚¨" class="headerlink" title="5 dockerå­˜å‚¨"></a>5 dockerå­˜å‚¨</h2><p>dockerå®¹å™¨è¢«åˆ›å»ºåï¼Œå°±ä¼šåˆ›å»ºä»¥ä¸‹ç›®å½•</p>
<pre><code>dockeræ–‡ä»¶ç³»ç»Ÿ
/var/lib/docker
         -- aufs
         -- containers
         -- image
         -- volumes
</code></pre>
<p>ä¸€èˆ¬å®¹å™¨å†…çš„æ•°æ®åœ¨å®¹å™¨åˆ é™¤åä¾¿è¢«åˆ é™¤ï¼Œè¦æƒ³é¿å…è¿™ç§æƒ…å†µå¯ä»¥é‡‡ç”¨å¤–éƒ¨å­˜å‚¨æŒ‚è½½åˆ°å®¹å™¨å†…çš„æ–¹æ³•</p>
<p>ä¸»è¦æœ‰ä¸¤ç§æŒ‚è½½æ–¹å¼ï¼Œå·æŒ‚è½½(volume)å’Œç»‘å®šæŒ‚è½½(binding)</p>
<h3 id="5-1-å·æŒ‚è½½"><a href="#5-1-å·æŒ‚è½½" class="headerlink" title="5.1 å·æŒ‚è½½"></a>5.1 å·æŒ‚è½½</h3><p>å·æŒ‚è½½æ˜¯åœ¨dockerä¸»æœºå†…åˆ›å»ºä¸€ä¸ªç‹¬ç«‹äºå®¹å™¨çš„å·ï¼Œå·å†…çš„å†…å®¹ä¸å®¿ä¸»æœºæ— å…³</p>
<ul>
<li>åˆ›å»ºå·</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker volume create my-vol       <span class="comment"># åˆ›å»ºå·</span></span><br><span class="line">$ docker volume <span class="built_in">ls</span>                  <span class="comment"># åˆ—å‡ºæ‰€æœ‰å·</span></span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line"><span class="built_in">local</span>               my-vol</span><br><span class="line">$ docker volume inspect my-vol      <span class="comment"># æŸ¥çœ‹å·çš„ä¿¡æ¯</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;Mountpoint&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/my-vol/_data&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;my-vol&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ul>
<li>æŒ‚è½½å·</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">æ—§å†™æ³•ï¼š-v my-vol:/usr/share/nginx/html <span class="comment">#åè€…æ˜¯å®¹å™¨å†…ç›®å½•</span></span><br><span class="line">æ–°å†™æ³•ï¼š--mount <span class="built_in">source</span>=my-vol,target=/usr/share/nginx/html</span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ é™¤å·</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker volume <span class="built_in">rm</span> my-vol</span><br><span class="line">docker volume prune        <span class="comment">#åˆ é™¤æ— ä¸»å·</span></span><br></pre></td></tr></table></figure>

<h3 id="5-2-ç»‘å®šæŒ‚è½½"><a href="#5-2-ç»‘å®šæŒ‚è½½" class="headerlink" title="5.2 ç»‘å®šæŒ‚è½½"></a>5.2 ç»‘å®šæŒ‚è½½</h3><p>ç»‘å®šæŒ‚è½½æ˜¯å°†å®¿ä¸»æœºçš„ç›®å½•æŒ‡å®šä¸ºå®¹å™¨å†…çš„ç›®å½•ï¼Œå³è¯¥ç›®å½•çš„ä¿®æ”¹æ˜¯å¯¹å®¿ä¸»æœºç›®å½•çš„ç›´æ¥ä¿®æ”¹</p>
<ul>
<li><p>æ—§å†™æ³•ï¼š-vé€‰é¡¹</p>
</li>
<li><p>æ–°å†™æ³•ï¼š- - mounté€‰é¡¹</p>
</li>
</ul>
<h2 id="6-dockerç½‘ç»œ"><a href="#6-dockerç½‘ç»œ" class="headerlink" title="6 dockerç½‘ç»œ"></a>6 dockerç½‘ç»œ</h2><blockquote>
<p>dockerè‡ªåŠ¨åˆ›å»ºBridgeã€ noneã€ hostä¸‰ç§ç½‘ç»œ<br>å¯é€šè¿‡networké€‰é¡¹ä¿®æ”¹å½“å‰æ¨¡å¼ï¼šdocker run Ubuntu - -network&#x3D;host</p>
</blockquote>
<ul>
<li><p>noneæ¨¡å¼ï¼šå®Œå…¨æ²¡æœ‰ç½‘ç»œï¼Œå®¹å™¨å½¼æ­¤éš”ç»ï¼Œå®¹å™¨ä¸ä¸»æœºéš”ç»</p>
</li>
<li><p>hostæ¨¡å¼ï¼šå®¹å™¨ä½¿ç”¨ä¸»æœºçš„ç½‘ç»œï¼Œå®¹å™¨çš„ç«¯å£å°±æ˜¯ä¸»æœºçš„ç«¯å£ï¼Œæ³¨æ„æ­¤æ—¶ï¼Œä¸åŒå®¹å™¨å†ä¸èƒ½åœ¨å†…éƒ¨ä½¿ç”¨ç›¸åŒçš„ç«¯å£è¿è¡Œç¨‹åº</p>
</li>
</ul>
<h3 id="Bridgeæ¨¡å¼è¯¦è§£"><a href="#Bridgeæ¨¡å¼è¯¦è§£" class="headerlink" title="Bridgeæ¨¡å¼è¯¦è§£"></a>Bridgeæ¨¡å¼è¯¦è§£</h3><h2 id="7-docker-compose"><a href="#7-docker-compose" class="headerlink" title="7 docker compose"></a>7 docker compose</h2><p><a href="https://docs.docker.com/compose/compose-file/compose-file-v3/" title="Compose-fileå®˜æ–¹æ–‡æ¡£">Compose-fileå®˜æ–¹æ–‡æ¡£</a></p>
<h2 id="8-docker-swarm"><a href="#8-docker-swarm" class="headerlink" title="8 docker swarm"></a>8 docker swarm</h2><p><a href="https://docs.docker.com/engine/swarm/" title="å®˜æ–¹æ–‡æ¡£">å®˜æ–¹æ–‡æ¡£</a></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.7&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">minio1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">minio/minio:RELEASE.2020-11-19T23-48-16Z</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">minio1</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">minio1-data:/export</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9001:9000&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">minio_distributed</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">restart_policy:</span></span><br><span class="line">        <span class="attr">delay:</span> <span class="string">10s</span></span><br><span class="line">        <span class="attr">max_attempts:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">window:</span> <span class="string">60s</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">node.labels.minio1==true</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">server</span> <span class="string">http://minio&#123;1...4&#125;/export</span></span><br><span class="line">    <span class="attr">secrets:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">secret_key</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">access_key</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-f&quot;</span>, <span class="string">&quot;http://localhost:9000/minio/health/live&quot;</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">20s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">minio2:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">minio/minio:RELEASE.2020-11-19T23-48-16Z</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">minio2</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">minio2-data:/export</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9002:9000&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">minio_distributed</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">restart_policy:</span></span><br><span class="line">        <span class="attr">delay:</span> <span class="string">10s</span></span><br><span class="line">        <span class="attr">max_attempts:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">window:</span> <span class="string">60s</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">node.labels.minio2==true</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">server</span> <span class="string">http://minio&#123;1...4&#125;/export</span></span><br><span class="line">    <span class="attr">secrets:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">secret_key</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">access_key</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-f&quot;</span>, <span class="string">&quot;http://localhost:9000/minio/health/live&quot;</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">20s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">minio3:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">minio/minio:RELEASE.2020-11-19T23-48-16Z</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">minio3</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">minio3-data:/export</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9003:9000&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">minio_distributed</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">restart_policy:</span></span><br><span class="line">        <span class="attr">delay:</span> <span class="string">10s</span></span><br><span class="line">        <span class="attr">max_attempts:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">window:</span> <span class="string">60s</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">node.labels.minio3==true</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">server</span> <span class="string">http://minio&#123;1...4&#125;/export</span></span><br><span class="line">    <span class="attr">secrets:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">secret_key</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">access_key</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-f&quot;</span>, <span class="string">&quot;http://localhost:9000/minio/health/live&quot;</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">20s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">minio4:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">minio/minio:RELEASE.2020-11-19T23-48-16Z</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">minio4</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">minio4-data:/export</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9004:9000&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">minio_distributed</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">restart_policy:</span></span><br><span class="line">        <span class="attr">delay:</span> <span class="string">10s</span></span><br><span class="line">        <span class="attr">max_attempts:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">window:</span> <span class="string">60s</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">node.labels.minio4==true</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">server</span> <span class="string">http://minio&#123;1...4&#125;/export</span></span><br><span class="line">    <span class="attr">secrets:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">secret_key</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">access_key</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-f&quot;</span>, <span class="string">&quot;http://localhost:9000/minio/health/live&quot;</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">20s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">minio1-data:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">minio2-data:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">minio3-data:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">minio4-data:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">minio_distributed:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">overlay</span></span><br><span class="line"></span><br><span class="line"><span class="attr">secrets:</span></span><br><span class="line">  <span class="attr">secret_key:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">minio_secret_key</span></span><br><span class="line">  <span class="attr">access_key:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">minio_access_key</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>å·¥å…·</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ†å¼ä¼˜åŒ–æ±‚è§£åˆ©å™¨â€”â€”Dinkelbach</title>
    <url>/2022/01/03/Dinkelbach%20Approach/Dinkelbach%20Approach/</url>
    <content><![CDATA[<h1 id="Dinkelbach-Approach"><a href="#Dinkelbach-Approach" class="headerlink" title="Dinkelbach Approach"></a>Dinkelbach Approach</h1><blockquote>
<p>é—®é¢˜æè¿°ï¼š<br>ç»™å®šä¸¤ä¸ªè¿ç»­å‡½æ•°$ f:\mathbf R^n\rightarrow\mathbf R  $å’Œ$g:\mathbf R^n\rightarrow \mathbf R$ã€‚äºŒè€…å®šä¹‰åŸŸä¸ºå¤šé¢ä½“(polyhedral)é›†åˆ$S\subset\mathbf R^n$ä½¿å¾—å¯¹äºæ‰€æœ‰$x\in S$éƒ½æœ‰$g(x)&gt;0$ã€‚éœ€è¦æ‰¾åˆ°ä¸€ä¸ªåˆ†å¼è§„åˆ’é—®é¢˜çš„æœ€ä¼˜è§£$x^*$æ»¡è¶³$\frac{f(x^*)}{g(x^*)}&#x3D;\max\limits_{x\in S}\frac{f(x)}{g(x)}$ (P)ã€‚</p>
</blockquote>
<p>Dinkelbachæ–¹æ³•ï¼Œç®€è¨€ä¹‹ï¼Œå°†åŸé—®é¢˜Pç®€åŒ–ä¸ºä¸€ä¸ªå…¨å±€ä¼˜åŒ–é—®é¢˜(GP)ï¼š$\max\limits_{x\in S}(f(x)-\lambda g(x))$ã€‚</p>
<h2 id="æœ´ç´ Dinkelbach"><a href="#æœ´ç´ Dinkelbach" class="headerlink" title="æœ´ç´ Dinkelbach"></a>æœ´ç´ Dinkelbach</h2><blockquote>
<p>ğŸ“Œå®šç†1ï¼š<br>$ x^*  $æ˜¯åˆ†å¼è§„åˆ’é—®é¢˜(P)çš„è§£ï¼Œå½“ä¸”ä»…å½“å…¶æ˜¯å…¨å±€ä¼˜åŒ–é—®é¢˜(GP)æœ‰çº¦æŸ$\lambda^*&#x3D;\frac{f(x^*)}{g(x^*)}$æ—¶çš„è§£ã€‚</p>
</blockquote>
<ul>
<li><p>æœ´ç´ Dinkelbachç®—æ³•æµç¨‹ï¼š</p>
<ol>
<li><p>é€‰å–$x^{(0)}\in S$ã€‚è®¾ç½®$\lambda^{(0)}:&#x3D;f(x^{(0)})&#x2F;g(x^{(0)}),\ k:&#x3D;0$ï¼›</p>
</li>
<li><p>æ±‚è§£å…¨å±€ä¼˜åŒ–é—®é¢˜ï¼š$\max\limits_{x\in S}(f(x)-\lambda^{(k)}g(x))$ï¼Œå¾—åˆ°å½“å‰è§£$x^{(k+1)}$ï¼›</p>
</li>
<li><p>è‹¥$f(x^{(k+1)})-\lambda^{(k)}g(x^{(k+1)})&#x3D;0$ï¼Œé‚£ä¹ˆæœ€ä¼˜è§£äº§ç”Ÿ$ x^*&#x3D;x^{(k+1)},\ \lambda^*:&#x3D;\lambda^{(k)}  $ï¼Œç®—æ³•åœæ­¢ï¼›</p>
</li>
<li><p>è‹¥$f(x^{(k+1)})-\lambda^{(k)}g(x^{(k+1)})&gt;0$ï¼Œé‚£ä¹ˆè®¾ç½®$\lambda^{(k+1)}:&#x3D;f(x^{(k+1)})&#x2F;g(x^{(k+1)}),\ k:k+1$åï¼Œå›åˆ°æ­¥éª¤2ã€‚</p>
</li>
</ol>
</li>
</ul>
<p>æ³¨ï¼šä¸éœ€è¦éªŒè¯$f(x^{(k+1)})-\lambda^{(k)}g(x^{(k+1)})&lt;0$çš„æƒ…å†µã€‚ï¼ˆå¯ä»¥ç”¨åè¯æ³•è¯æ˜ï¼‰å¯¹æ‰€æœ‰$k$éƒ½æœ‰</p>
<p>$$<br>f(x^{(k+1)})-\lambda^{(k)}g(x^{(k+1)})&#x3D;\max\limits_{x\in S}f((x)-\lambda^{(k)}g(x))\ge f(x^{(k)})-\lambda^{(k)}g(x^{(k)})&#x3D;0<br>$$</p>
<h3 id="ç®—æ³•æœ‰æ•ˆæ€§åˆ†æ"><a href="#ç®—æ³•æœ‰æ•ˆæ€§åˆ†æ" class="headerlink" title="ç®—æ³•æœ‰æ•ˆæ€§åˆ†æ"></a>ç®—æ³•æœ‰æ•ˆæ€§åˆ†æ</h3><p>è€ƒè™‘å‡½æ•°$M(\lambda)&#x3D;\max\limits_{x\in S}(f(x)-\lambda g(x))$ã€‚å¯ä»¥çŸ¥é“å…¶ç¬¦åˆä»¥ä¸‹æ€§è´¨ï¼š</p>
<ol>
<li><p>å¯¹äºæ‰€æœ‰$\lambda&lt;\lambda^*$æœ‰$M(\lambda)&gt;0$ä¸”å¯¹äºæ‰€æœ‰$\lambda&gt;\lambda^*$æœ‰$M(\lambda)&lt;0$ï¼›</p>
</li>
<li><p>$M(\lambda)$æ˜¯å‡¸å‡½æ•°ã€‚</p>
</li>
</ol>
<blockquote>
<p>è¶…çº¿æ€§æ”¶æ•›(converge superlinearly)ï¼š<br>è‹¥åºåˆ—$\alpha^{(0)},\alpha^{(1)},\cdots$æ»¡è¶³$\lim\limits_{n\rightarrow\infty}\frac{|\alpha^*-\alpha^{(n+1)}|}{\theta^{n+1}}&#x3D;0$ï¼Œå…¶ä¸­$\theta\in(0,1]$ï¼Œåˆ™ç§°è¯¥åºåˆ—è¶…çº¿æ€§æ”¶æ•›äº$\alpha^*$ã€‚</p>
</blockquote>
<p>ï¼ˆè¶…çº¿æ€§æ”¶æ•›æ„å‘³ç€ï¼Œåºåˆ—ä¼šæ”¶æ•›ï¼Œè€Œä¸”ä»¥è¶Šæ¥è¶Šå¿«çš„é€Ÿåº¦æ”¶æ•›ï¼‰</p>
<blockquote>
<p>ğŸ“Œå¼•ç†1ï¼š<br>$x^<em>\in S$æ˜¯é—®é¢˜(P)çš„æœ€ä¼˜è§£ï¼Œä¸”$xâ€™$æ˜¯$M(\lambdaâ€™)$çš„è§£æ»¡è¶³$\lambdaâ€™&lt;\lambda^</em>$ï¼Œé‚£ä¹ˆï¼š<br>$\lambda^*-\frac{f(xâ€™)}{g(xâ€™)}\le(\lambda^*-\lambdaâ€™)(1-\frac{g(x^*)}{g(xâ€™)})$<br>å…¶ä¸­$0\le1-g(x^*)&#x2F;g(xâ€™)&lt;1$ã€‚</p>
<p>Schaible S. Fractional programming: applications and algorithms[J]. European Journal of Operational Research, 1981, 7(2): 111-120.</p>
</blockquote>
<p>å¯¹äºå¼•ç†1ï¼Œä»¤$\lambdaâ€™&#x3D;\lambda^{(n)}$ä¸”$xâ€™&#x3D;x^{(n+1)}$ï¼Œåˆ™$x^{(n+1)}$æ˜¯$M(\lambda^{(n)})$çš„è§£ï¼Œé‚£ä¹ˆå¯ä»¥å¾—åˆ°æ¯æ¬¡è¿­ä»£çš„è¯¯å·®æ»¡è¶³ï¼š</p>
<p>$$<br>(\lambda^*-\lambda^{(n+1)})\le(\lambda^*-\lambda^{(n)})(1-\frac{g(x^*)}{g(x^{(n+1)})})<br>$$</p>
<p>ä»¤$\epsilon_i&#x3D;(1-g(x^*)&#x2F;g(x^{(i)})),\ i&#x3D;1,2,\cdots$ï¼ŒSchaibleçš„ç†è®ºè¡¨æ˜$\epsilon_1\ge\epsilon_2\ge\cdots\ge0$ã€‚åºåˆ—è¯¯å·®çš„çº§è”å…³ç³»å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p>
<p>$$<br>(\lambda^*-\lambda^{(n+1)})\le(\lambda^*-\lambda^{(0)})\prod_{i&#x3D;1}^{n+1}(1-\frac{g(x^*)}{g(x^{(i)})})&#x3D;(\lambda^*-\lambda^{(0)})\prod_{i&#x3D;1}^{n+1}\epsilon_i<br>$$</p>
<p>æ­¤æ—¶å¯ä»¥ä½¿ç”¨ç¬¬äºŒä¸ªå¼•ç†ã€‚</p>
<blockquote>
<p>ğŸ“Œå¼•ç†2ï¼š<br>å­˜åœ¨ä¸€ä¸ª$x^*\in S$ä½œä¸ºé—®é¢˜Pçš„æœ€ä¼˜è§£ï¼Œä½¿å¾—$\lim\limits_{n\rightarrow\infty}\epsilon_n&#x3D;0$</p>
<p>Schaible S. Fractional Programming: Transformations, Duality and Algorithmic Aspects[R]. STANFORD UNIV CALIF DEPT OF OPERATIONS RESEARCH, 1973.</p>
</blockquote>
<p>å› æ­¤ï¼Œå¯¹äºä»»æ„$\theta\in(0,1]$ï¼Œå­˜åœ¨ä¸€ä¸ªæ•´æ•°$n_{\theta}\ge0$ä½¿å¾—å¯¹äºæ‰€æœ‰çš„$i \ge n_{\theta}$ï¼Œæœ‰$\epsilon_i&lt;\theta$ã€‚</p>
<p>å®šä¹‰å¸¸æ•°$\beta_\theta&#x3D;\prod_{i&#x3D;1}^{n_\theta-1}(\frac{\epsilon_i}{\theta})$ï¼Œå¯ä»¥æœ‰</p>
<p>$$<br>\frac{\lambda^*-\lambda^{(n+1)}}{\theta^{n+1}}\le(\lambda^*-\lambda^{(0)})\beta_\theta\prod_{i&#x3D;n_\theta}^{n+1}(\frac{\epsilon_i}\theta)<br>$$</p>
<p>å› æ­¤$\lim_{n\rightarrow\infty}\frac{\lambda^*-\lambda^{(n+1)}}{\theta^{n+1}}&#x3D;0$ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œåºåˆ—çš„ä¸‹ç•Œ$\lambda^{(n+1)}$å°†ä¼šä»¥ä¸€ä¸ªè¶…çº¿æ€§çš„é€Ÿç‡æ”¶æ•›åˆ°$\lambda^*&#x3D;f(x^*)&#x2F;g(x^*)$ã€‚</p>
<h2 id="æœ‰ä¸Šç•Œè®ºè¯çš„æ”¹è¿›Dinkelbach"><a href="#æœ‰ä¸Šç•Œè®ºè¯çš„æ”¹è¿›Dinkelbach" class="headerlink" title="æœ‰ä¸Šç•Œè®ºè¯çš„æ”¹è¿›Dinkelbach"></a>æœ‰ä¸Šç•Œè®ºè¯çš„æ”¹è¿›Dinkelbach</h2><p>ä»ä¸Šé¢çš„æ¨å¯¼å¯çœ‹å‡ºï¼Œæœ´ç´ çš„Dinkelbachæä¾›äº†ä¸‹ç•Œçš„é€¼è¿‘ï¼Œå¹¶æ²¡æœ‰æä¾›ä¸Šç•Œçš„è®ºè¯ã€‚è¿™æ ·å¯èƒ½ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="/image/image_rjrcmXIOqK.png"></p>
<p>ç›´çº¿æ˜¯$M(\lambda)$ï¼ˆå®é™…æƒ…å†µå¯èƒ½ä¸ä¸€å®šæ˜¯ç›´çº¿å“ˆï¼Œåº”è¯¥æ˜¯ä¸ªå‡¸å‡½æ•°ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼‰ï¼Œç›®æ ‡æ˜¯æœ€åé€¼è¿‘åˆ°$\lambda^*$ã€‚ä½†æ˜¯æœ´ç´ Dinkelbachæ˜¯ç±»ä¼¼äºå·¦è¾¹çš„ä¸‹ç•Œçº¿é€¼è¿‘çš„ï¼Œç°å®æƒ…å†µé‡Œï¼Œå¯èƒ½å¾ˆéš¾è¿­ä»£åˆ°$M(\lambdaâ€™)&#x3D;0$ï¼Œå¾€å¾€éƒ½æ˜¯å°äºä¸€ä¸ª$\delta$å°±è¡¨æ˜æ”¶æ•›ã€‚ä½†æ˜¯å…¶è¶…çº¿æ€§åˆ™ä½¿$\lambda^{(n+1)}$æœ‰å¯èƒ½åœ¨ç¦»$\lambda^*$å¾ˆè¿œæ—¶å°±å·²ç»å¾—åˆ°ä¸€ä¸ªè¶³å¤Ÿå°çš„$M(\lambda^{(n+1)})$ï¼Œå¯¼è‡´æœ€åçš„ç»“æœä¸å¤Ÿå‡†ç¡®ã€‚é‚£ä¹ˆå¦‚æœèƒ½å¤Ÿ<strong>å†æ±‚å¾—ä¸€æ¡ä¸Šç•Œçº¿ä»å³è¾¹é€¼è¿‘ï¼Œä¸¤æ¡çº¿åŒæ—¶é€¼è¿‘</strong>æ—¶ï¼Œå„è‡ªæ±‚çš„$\lambda$ç›¸å·®è¶³å¤Ÿå°ï¼Œå°±å¯ä»¥æ›´åŠ ç²¾ç¡®åœ°æ‰¾åˆ°$\lambda^*$ã€‚</p>
<p>è¿™ä¾¿æ˜¯æ”¹è¿›ç‰ˆDinkelbachçš„æ€è·¯ã€‚</p>
<p>åˆå§‹ä¸Šç•Œï¼šåˆ†åˆ«è§£$\max\limits_{x\in S}f(x)$å’Œ$\min\limits_{x\in S}g(x)$å¾—åˆ°$ xâ€™  $å’Œ$xâ€™â€™$ï¼Œä»è€Œå¾—åˆ°åˆå§‹ä¸Šç•Œ$\gamma^{(-1)}&#x3D;f(xâ€™)&#x2F;g(xâ€™â€™)$ã€‚è¿™å¿…ç„¶æ˜¯ä¸€ä¸ªæ¯”$\lambda^*$å¤§çš„æ•°ï¼Œä¸”ç”±äºä¹‹å‰æ‰€æçš„$M(\lambda)$çš„ä¸¤æ¡æ€§è´¨ï¼Œæ¯æ¬¡è¿­ä»£çš„ä¸Šç•Œéƒ½åº”è¯¥æ»¡è¶³$M(\gamma)&lt;0$ã€‚å®šä¹‰æ¯ä¸€è½®çš„ä¸Šç•Œä¸ºï¼š</p>
<p>$$<br>\gamma^{(k)}:&#x3D;\gamma^{(k-1)}-M(\gamma^{(k-1)})\left(\frac{\gamma^{(k-1)}-\lambda^{(k)}}{M(\gamma^{(k-1)})-M(\lambda^{(k)})}\right)<br>$$</p>
<p><img src="/image/image__Kmw3gOGVl.png"></p>
<p>è¿™ä¸ªå¼å­çš„å«ä¹‰å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚æ¥ç€å°±å¯ä»¥å¾—åˆ°å¦‚ä¸‹æ”¹è¿›ç‰ˆDinkelbachã€‚</p>
<ul>
<li><p>æ”¹è¿›ç‰ˆDinkelbachï¼š</p>
<ol>
<li><p>é€‰å–$x^{(0)}\in S$ã€‚è®¾ç½®$\lambda^{(0)}:&#x3D;f(x^{(0)})&#x2F;g(x^{(0)})$ï¼›</p>
</li>
<li><p>æ±‚è§£é—®é¢˜$\max\limits_{x\in S}f(x)$å¾—åˆ°$xâ€™$ï¼Œæ±‚è§£é—®é¢˜$\min\limits_{x\in S}g(x)$å¾—åˆ°$xâ€™â€™$ã€‚è®¾ç½®$\gamma^{(-1)}:&#x3D;f(xâ€™)&#x2F;g(xâ€™â€™)$ä»¥åŠ$k:&#x3D;0$ã€‚è‹¥$\gamma^{(-1)}-\lambda^{(0)}\le\delta$ï¼Œé‚£ä¹ˆ$\lambda^*:&#x3D;\lambda^{(0)}$ä¸”$x^*:&#x3D;x^{(0)}$ï¼Œç®—æ³•åœæ­¢ï¼›</p>
</li>
<li><p>æ±‚è§£å…¨å±€ä¼˜åŒ–é—®é¢˜$M(\lambda^{(k)})&#x3D;\max\limits_{x\in S}(f(x)-\lambda^{(k)}g(x))$ï¼Œå¾—åˆ°$x^{(k+1)}$ï¼›</p>
</li>
<li><p>è‹¥$M(\lambda^{(k)})&#x3D;0$ï¼Œé‚£ä¹ˆ$ x^*:&#x3D;x^{(k+1)},\quad\lambda^*&#x3D;\lambda^{(k)}  $ï¼Œç®—æ³•åœæ­¢ï¼›</p>
</li>
<li><p>æ±‚è§£å…¨å±€ä¼˜åŒ–é—®é¢˜$M(\gamma^{(k-1)})&#x3D;\max\limits_{x\in S}(f(x)-\gamma^{(k-1)}g(x))$ï¼Œå¾—åˆ°$y^{(k)}$ï¼›</p>
</li>
<li><p>è‹¥$M(\gamma^{(k-1)})&#x3D;0$ï¼Œé‚£ä¹ˆ$x^*:&#x3D;y^{(k)},\quad\lambda^*&#x3D;\gamma^{(k-1)}$ï¼Œç®—æ³•åœæ­¢ï¼›</p>
</li>
<li><p>è®¾ç½®$\gamma^{(k)}:&#x3D;\gamma^{(k-1)}-M(\gamma^{(k-1)})\left(\frac{\gamma^{(k-1)}-\lambda^{(k)}}{M(\gamma^{(k-1)})-M(\lambda^{(k)})}\right)$ï¼›</p>
</li>
<li><p>è‹¥$\gamma^{(k)}-\lambda^{(k)}\le\delta$ï¼Œé‚£ä¹ˆ$ x^*:&#x3D;x^{(k+1)},\quad\lambda^*&#x3D;\lambda^{(k)}  $ï¼Œç®—æ³•åœæ­¢ï¼›</p>
</li>
<li><p>è®¾ç½®$\lambda^{(k+1)}:&#x3D;f(x^{(k+1)})&#x2F;g(x^{(k+1)}),\ k:&#x3D;k+1$ï¼Œè¿”å›æ­¥éª¤3ã€‚</p>
</li>
</ol>
</li>
</ul>
<h3 id="ç®—æ³•æœ‰æ•ˆæ€§åˆ†æ-1"><a href="#ç®—æ³•æœ‰æ•ˆæ€§åˆ†æ-1" class="headerlink" title="ç®—æ³•æœ‰æ•ˆæ€§åˆ†æ"></a>ç®—æ³•æœ‰æ•ˆæ€§åˆ†æ</h3><blockquote>
<p>ğŸ“Œå®šç†2ï¼š<br>$ \lambda^<em>\le\gamma^{(i+1)}&lt;\gamma^{(i)},\quad i&#x3D;-1,0,1,\cdots  $<br>ï¼ˆè¿™ä¸ªå®šç†å¼ºè°ƒçš„æ˜¯æ¯ä¸ªè¿­ä»£çš„$\gamma^{(i)}$éƒ½å¤§äºç­‰äº$\lambda^</em>$ï¼Œä¸ä¼šè¶Šè¿‡$\lambda^*$ï¼‰</p>
</blockquote>
<blockquote>
<p>è¯æ˜ï¼šï¼ˆå…¶å®æˆ–è®¸ä¸éœ€è¦è¯æ˜ï¼Œçœ‹ä¸Šé¢çš„å›¾å³å¯ä½“ä¼šæ­¤å®šç†ï¼Œä½†å†™è®ºæ–‡è¿˜éœ€è¦ä¸¥æ ¼è¯æ˜ä¸€ä¸‹ï¼‰<br>å®šä¹‰è¿æ¥$(\lambda^{(n)},M(\lambda^{(n)}))$å’Œ$(\gamma^{n-1},M(\gamma^{(n-1)}))$çš„ç›´çº¿çš„å‡½æ•°ä¸º$L$ã€‚<br>ç”±ä¸Šé¢å¯çŸ¥$\gamma^{(n)}&#x3D;q\lambda^{(n)}+(1-q)\gamma^{(n-1)},\quad q\in(0,1)$<br>æ‰€ä»¥æœ‰<br>$<br>\begin{aligned}<br>&amp;M\left(\gamma^{(n)}\right)&#x3D;M\left(q \lambda^{(n)}+(1-q) \gamma^{(n-1)}\right) \leqslant q M\left(\lambda^{(n)}\right)+(1-q) M\left(\gamma^{(n-1)}\right) \<br>&amp;\quad&#x3D;q L\left(\lambda^{(n)}\right)+(1-q) L\left(\gamma^{(n-1)}\right) \<br>&amp;\quad&#x3D;L\left(q \lambda^{(n)}+(1-q) \gamma^{(n-1)}\right)&#x3D;L\left(\gamma^{(n)}\right)&#x3D;0<br>\end{aligned}<br> $<br>æ‰€ä»¥$M(\gamma^{(n)})\le0$ï¼Œç”±$M()$å‡½æ•°æ€§è´¨å¯çŸ¥$\lambda^*\le\gamma^{(n)}$</p>
</blockquote>
<p>æ¥ä¸‹æ¥è®ºè¯ä¸Šç•Œåºåˆ—$\gamma^{(n)}$ä¹Ÿæ˜¯ä»¥è¶…çº¿æ€§çš„é€Ÿç‡æ”¶æ•›åˆ°$\lambda^*$çš„ã€‚</p>
<blockquote>
<p><strong>æ‹‰æ ¼æœ—æ—¥ä¸­å€¼å®šç†</strong>ï¼š<br>$f(x)$åœ¨é—­åŒºé—´$[a,b]$å†…è¿ç»­ï¼Œåœ¨å¼€åŒºé—´$(a,b)$å†…å¯å¯¼ï¼Œåˆ™åœ¨$(a,b)$å†…è‡³å°‘æœ‰ä¸€ç‚¹$\epsilon(a&lt;\epsilon&lt;b)$ï¼Œä½¿ç­‰å¼$f(b)-f(a)&#x3D;fâ€™(\epsilon)(b-a)$æˆç«‹ã€‚<br><strong>ç½—å°”ä¸­å€¼å®šç†</strong>ï¼š<br>$f(x)$åœ¨é—­åŒºé—´$[a,b]$ä¸Šè¿ç»­ï¼Œåœ¨å¼€åŒºé—´$(a,b)$å†…å¯å¯¼ï¼Œä¸”åœ¨åŒºé—´ç«¯ç‚¹å¤„çš„å‡½æ•°å€¼ç›¸ç­‰ï¼Œå³$f(a)&#x3D;f(b)$ï¼Œåˆ™åœ¨$(a,b)$å†…è‡³å°‘å­˜åœ¨ä¸€ç‚¹$\epsilon(a&lt;\epsilon&lt;b)$ï¼Œä½¿å¾—$fâ€™(\epsilon)&#x3D;0$ã€‚<br><strong>æŸ¯è¥¿ä¸­å€¼å®šç†</strong>ï¼š<br>å¦‚æœå‡½æ•°$f(x),g(x)$æ»¡è¶³ï¼š<br>(1)åœ¨é—­åŒºé—´$[a,b]$ä¸Šè¿ç»­<br>(2)åœ¨å¼€åŒºé—´$(a,b)$å†…å¯å¯¼<br>(3)å¯¹ä»»æ„$x\in(a,b),\ gâ€™(x)\notin0$<br>é‚£ä¹ˆåœ¨$(a,b)$å†…è‡³å°‘æœ‰ä¸€ç‚¹$\xi\in(a,b)$ï¼Œä½¿å¾—$\frac{f(b)-f(a)}{g(b)-g(a)}&#x3D;\frac{fâ€™(\xi)}{gâ€™(\xi)}$æˆç«‹ã€‚</p>
</blockquote>
<p>è€ƒè™‘ç¬¬$(n+1)$æ¬¡è¿­ä»£æ—¶ï¼Œè¿˜æ²¡æœ‰æ±‚å‡ºç»“æœï¼Œæ ¹æ®å®šä¹‰å¯çŸ¥</p>
<p>$$<br>\begin{equation}<br>\gamma^{(n+1)}&#x3D;\gamma^{(n)}-M\left(\gamma^{(n)}\right)\left(\frac{\gamma^{(n)}-\lambda^{(n+1)}}{M\left(\gamma^{(n)}\right)-M\left(\lambda^{(n+1)}\right)}\right)<br>\end{equation}<br>$$</p>
<p>ç»è¿‡ä¸€äº›ä»£æ•°è¿ç®—ï¼Œå¯å¾—</p>
<p>$$<br>\begin{equation}<br>\begin{aligned}<br>&amp;\left(\lambda^{<em>}-\gamma^{(n+1)}\right)&#x3D;\left(\lambda^{</em>}-\gamma^{(n)}\right)+M\left(\gamma^{(n)}\right)\left(\frac{\gamma^{(n)}-\lambda^{(n+1)}}{M\left(\gamma^{(n)}\right)-M\left(\lambda^{(n+1)}\right)}\right) \<br>&amp;\quad&#x3D;\frac{(\lambda^*-\gamma^{(n)})(M(\gamma^{(n)})-M(\lambda^{(n+1)}))+M(\gamma^{(n)})\gamma^{(n)}-M(\gamma^{(n)})\lambda^{(n+1)}}{M(\gamma^{(n)})-M(\lambda^{(n+1)})}\<br>&amp;\quad&#x3D;\frac{M(\gamma^{(n)})(\lambda^{<em>}-\lambda^{(n+1)})+M(\lambda^{(n+1)})(\gamma^{(n)}-\lambda^{</em>})}{M(\gamma^{(n)})-M(\lambda^{(n+1)})}\<br>&amp;\quad&#x3D;-(\lambda^*-\lambda^{(n+1)})(\lambda^*-\gamma^{(n)})\frac{\frac{M(\gamma^{(n)})-M(\lambda^*)}{\gamma^{(n)}-\lambda^*}-\frac{M(\lambda^{(n+1)})-M(\lambda^*)}{\lambda^{(n+1)}-\lambda^*}}{M(\gamma^{(n)})-M(\lambda^{(n+1)})}\<br>&amp;\quad&#x3D;-(\lambda^*-\lambda^{(n+1)})(\lambda^*-\gamma^{(n)})\frac{Mâ€™(\alpha)-Mâ€™(\beta)}{Mâ€™(\zeta_{n+1})[\gamma^{(n)}-\lambda^{(n+1)}]}\<br>&amp;\quad&#x3D;-(\lambda^*-\lambda^{(n+1)})(\lambda^*-\gamma^{(n)})\frac{Mâ€™â€™(\xi_{n+1})[\alpha-\beta]}{Mâ€™(\zeta_{n+1})[\gamma^{(n)}-\lambda^{(n+1)}]}\<br>&amp;\quad\le-\left(\lambda^{<em>}-\lambda^{(n+1)}\right)\left(\lambda^{</em>}-\gamma^{(n)}\right) \frac{M^{\prime \prime}\left(\xi_{n+1}\right)}{M^{\prime}\left(\zeta_{n+1}\right)}<br>\end{aligned}<br>\end{equation}<br>$$</p>
<p>å…¶ä¸­ï¼Œ$\xi_{n+1},\zeta_{n+1}\in[\lambda^{(n+1)},\gamma^{(n)}]$ï¼Œä»¤$\kappa&#x3D;\frac{\max\limits_{\xi\in I}|Mâ€™â€™(\xi)|}{\min\limits_{\zeta\in I}|Mâ€™(\zeta)|}$ï¼Œ$I&#x3D;[\lambda^{(0)},\gamma^{(-1)}]$ä¸”$I_{n+1}&#x3D;[\lambda^{(n+1)},\gamma^{(n)}]\subset I$ï¼Œä¹Ÿå°±æ˜¯è¯´$ \kappa  $æ˜¯åˆ†å¼$\frac{M^{\prime \prime}\left(\xi_{n+1}\right)}{M^{\prime}\left(\zeta_{n+1}\right)}$çš„ä¸Šç•Œï¼Œå› æ­¤æœ‰</p>
<p>$|\lambda^*-\gamma^{(n+1)}|\le|\lambda^*-\lambda^{(n+1)}||\lambda^*-\gamma^{(n)}|\kappa$ï¼Œé€çº§æ¨å¯¼ï¼Œæœ‰</p>
<p>$$<br>\begin{equation}<br>\left|\lambda^{<em>}-\gamma^{(n+1)}\right| \leqslant \kappa^{n+2}\left|\lambda^{</em>}-\gamma^{(-1)}\right| \prod_{i&#x3D;0}^{n+1}\left|\lambda^{*}-\lambda^{(i)}\right|<br>\end{equation}<br>$$</p>
<p>å‰é¢æåˆ°$(\lambda^*-\lambda^{(n+1)})\le(\lambda^*-\lambda^{(n)})(1-\frac{g(x^*)}{g(x^{(n+1)})})$ï¼Œå› æ­¤å¯ä»¥å°†ä¸ç­‰å¼è¿›ä¸€æ­¥æ‹†è§£æˆ</p>
<p>$$<br>\begin{equation}<br>\left|\lambda^{<em>}-\gamma^{(n+1)}\right| \leqslant \kappa^{n+2}\left|\lambda^{</em>}-\gamma^{(-1)} | \lambda^{*}-\lambda^{(0)}\right|^{n+2} \prod_{i&#x3D;1}^{n+1} \varepsilon_{i}^{n-i+2}<br>\end{equation}<br>$$</p>
<p>å¼•ç†2è¯´æ˜ï¼Œ$\epsilon$æ”¶æ•›åˆ°0ã€‚å› æ­¤å¯¹äºä»»æ„$\theta\in(0,1]$ï¼Œå­˜åœ¨æ•´æ•°$n_{\theta}\ge0$ä½¿å¾—å¯¹äºæ‰€æœ‰$i\ge n_\theta$éƒ½æœ‰$ \kappa|\lambda^*-\lambda^{(0)}|\epsilon_i&lt;\theta  $ï¼Œå› æ­¤å®šä¹‰$<br>\alpha_{\theta}&#x3D;\kappa\left|\lambda^{<em>}-\lambda^{(0)}\right| \prod_{i&#x3D;1}^{n_{\theta}-1}\left(\frac{\kappa\left|\lambda^{</em>}-\lambda^{(0)}\right| \varepsilon_{i}^{n-i+2}}{\theta}\right)<br> $ï¼Œæˆ‘ä»¬æœ‰</p>
<p>$$<br>\begin{equation}<br>\frac{\left|\lambda^{<em>}-\gamma^{(n+1)}\right|}{\theta^{n+1}} \leqslant\left|\lambda^{</em>}-\gamma^{(-1)}\right| \alpha_{\theta} \prod_{i&#x3D;n_{\theta}}^{n+1}\left(\frac{\kappa\left|\lambda^{*}-\lambda^{(0)}\right| \varepsilon_{i}^{n-i+2}}{\theta}\right)<br>\end{equation}<br>$$</p>
<p>å› æ­¤ï¼Œå¯ä»¥å¾—åˆ°$\lim\limits_{n\rightarrow\infty}\frac{|\lambda^*-\gamma^{(-1)}|}{\theta^{n+1}}&#x3D;0$ï¼Œä¹Ÿå°±æ˜¯è¯´åºåˆ—ä¸Šç•Œ$\gamma^{(n+1)}$åŒæ ·å°†ä»¥è¶…çº¿æ€§çš„é€Ÿç‡æ”¶æ•›åˆ°$\lambda^*$ã€‚</p>
]]></content>
      <categories>
        <category>æ•°å­¦</category>
      </categories>
      <tags>
        <tag>æ•°å­¦æ–¹æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>åŠ¨æ€è§„åˆ’ï¼ˆåŸºç¡€ï¼‰</title>
    <url>/2021/10/18/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E5%9F%BA%E7%A1%80/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<h1 id="åŠ¨æ€è§„åˆ’-åŸºç¡€"><a href="#åŠ¨æ€è§„åˆ’-åŸºç¡€" class="headerlink" title="åŠ¨æ€è§„åˆ’-åŸºç¡€"></a>åŠ¨æ€è§„åˆ’-åŸºç¡€</h1><h1 id="1-èƒŒåŒ…æ¨¡å‹"><a href="#1-èƒŒåŒ…æ¨¡å‹" class="headerlink" title="1 èƒŒåŒ…æ¨¡å‹"></a>1 èƒŒåŒ…æ¨¡å‹</h1><p><strong>èƒŒåŒ…æ¨¡å‹å„å­é—®é¢˜ç‰¹å¾</strong></p>
<table>
<thead>
<tr>
<th>é—®é¢˜</th>
<th>ç‰¹å¾</th>
</tr>
</thead>
<tbody><tr>
<td>é›¶ä¸€èƒŒåŒ…</td>
<td>èƒŒåŒ…ä¸­æ¯ä»¶ç‰©å“æœ€å¤šä»…ç”¨ä¸€æ¬¡</td>
</tr>
<tr>
<td>å®Œå…¨èƒŒåŒ…</td>
<td>æ¯ä»¶ç‰©å“æœ‰æ— é™ä¸ª</td>
</tr>
<tr>
<td>å¤šé‡èƒŒåŒ…</td>
<td>æ¯ç§ç‰©å“æœ€å¤šSiä¸ª</td>
</tr>
<tr>
<td>åˆ†ç»„èƒŒåŒ…</td>
<td>Nç»„ï¼Œæ¯ä¸€ç»„é‡Œæœ€å¤šåªèƒ½é€‰ä¸€ä¸ªç‰©å“</td>
</tr>
</tbody></table>
<h2 id="1-1-é›¶ä¸€èƒŒåŒ…é—®é¢˜"><a href="#1-1-é›¶ä¸€èƒŒåŒ…é—®é¢˜" class="headerlink" title="1.1 é›¶ä¸€èƒŒåŒ…é—®é¢˜"></a>1.1 é›¶ä¸€èƒŒåŒ…é—®é¢˜</h2><blockquote>
<p>ğŸ“Œæœ‰Nä¸ªç‰©å“å’Œä¸€ä¸ªå®¹é‡ä¸ºVçš„èƒŒåŒ…ï¼Œæ¯ä¸ªç‰©å“çš„ä½“ç§¯æ˜¯Viï¼Œä»·å€¼æ˜¯Wiï¼Œæ¯ä»¶ç‰©å“ä»…ç”¨ä¸€æ¬¡ã€‚è¦æŒ‘é€‰ä¸€äº›ç‰©å“ï¼Œä½¿æ€»ä½“ç§¯å°äºç­‰äºVï¼Œç›®æ ‡è®©å¡è¿›èƒŒåŒ…çš„ç‰©å“æ€»ä»·å€¼æœ€å¤§ï¼Œæ±‚é—®æœ€å¤§ä»·å€¼</p>
</blockquote>
<ul>
<li><p>é€šè¿‡01èƒŒåŒ…å¯ä»¥å¼•å‡ºæ±‚è§£DPé—®é¢˜çš„ä¸€èˆ¬æ€è·¯</p>
<p><img src="/image/Fig1_xe6xHotGq9.png"></p>
</li>
</ul>
<p>iè¡¨ç¤ºä¸åŒçš„ç‰©å“ï¼Œjè¡¨ç¤ºä¸åŒå®¹é‡çš„èƒŒåŒ…çš„ä½“ç§¯ã€‚f(i,j)å°±è¡¨ç¤ºæ»¡è¶³ï¼šä»å‰iä¸ªç‰©å“ä¸­é€‰ä¸”æ€»ä½“ç§¯å°äºç­‰äºjçš„æ‰€æœ‰é€‰æ³•ä¸­ï¼ˆé›†åˆï¼‰ï¼Œä»·å€¼çš„æœ€å¤§å€¼ï¼ˆå±æ€§ï¼‰ã€‚</p>
<p>çŠ¶æ€è®¡ç®—å°±æ˜¯ä¸€ç§é›†åˆçš„åˆ’åˆ†ï¼Œå°†å½“å‰çš„é›†åˆåˆ’åˆ†æˆè‹¥å¹²ä¸ªæ›´å°çš„é›†åˆï¼Œä½¿å¾—å½“å‰é›†åˆå¯ä»¥é€šè¿‡æ›´å°çš„é›†åˆç®—å‡ºæ¥ã€‚è€Œä¸”æ›´å°çš„é›†åˆæ˜¯ä¹‹å‰å·²ç»ç®—è¿‡çš„ã€‚å¯¹åº”åˆ°01èƒŒåŒ…ï¼Œå°±æ˜¯æŠŠæ‰€æœ‰é€‰æ³•åˆ†æˆä¸¤å¤§ç±»ï¼šä¸åŒ…å«ç¬¬iä¸ªç‰©å“ï¼Œå’ŒåŒ…å«ç¬¬iä¸ªç‰©å“ã€‚</p>
<blockquote>
<p>å­é›†åˆ’åˆ†åŸåˆ™ï¼šä¸é‡å¤ï¼ˆä¸ä¸¥æ ¼è¦æ±‚ï¼‰ &amp; ä¸æ¼æ‰ï¼ˆä¸¥æ ¼è¦æ±‚ï¼‰</p>
</blockquote>
<p>è¿™é‡Œçš„ç¬¬2ç±»ï¼šåŒ…å«ç¬¬iä¸ªç‰©å“ï¼Œç›´æ¥æ±‚å¹¶ä¸å¥½æ±‚ï¼Œå› ä¸ºå¯èƒ½çš„æƒ…å†µå¤ªå¤šäº†ã€‚è¿™é‡Œè¦æ›²çº¿æ•‘å›½ï¼Œå…ˆæŠŠæ¯ç§é€‰æ³•é‡Œçš„ç¬¬iä¸ªç‰©å“éƒ½å»æ‰ï¼Œæ­¤æ—¶å…¨éƒ¨å¯åŒ…å«ç¬¬iç‰©å“çš„é€‰æ³•æ•°æ˜¯ä¸å˜çš„ï¼Œè¿™äº›é€‰æ³•çš„æœ€å¤§ä»·å€¼ä¸ºf(i-1, j-Vi)ï¼Œé‚£ä¹ˆå†åŠ ä¸ŠW_iï¼Œå…¶å®å°±æ˜¯åŒ…å«ç¬¬iä¸ªç‰©å“çš„æ‰€æœ‰é€‰æ³•çš„æœ€å¤§å€¼ã€‚</p>
<p>æœ€ç»ˆï¼Œf(i,j)å°±æ˜¯ä¸¤ä¸ªå­é›†çš„æœ€å¤§å€¼ï¼Œå†å–ä¸€æ¬¡æœ€å¤§å€¼ã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹çš„è¯ï¼šåŠ¨æ€è§„åˆ’çš„çŠ¶æ€å°±æ˜¯<strong>é›†åˆçš„æŸç§å±æ€§</strong>ï¼ˆæ­¤å¤„æ˜¯æ‰€æœ‰é€‰æ³•çš„æœ€å¤§ä»·å€¼ï¼‰ï¼ŒçŠ¶æ€è®¡ç®—çš„æ ¸å¿ƒå°±æ˜¯å¯¹é›†åˆè¿›è¡Œåˆ’åˆ†ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æœ´ç´ ç®—æ³•ä»£ç ï¼šäºŒç»´çŠ¶æ€</span></span><br><span class="line"><span class="comment">//01èƒŒåŒ…çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼šf(i,j) = Max( f(i-1, j), f(i-1, j-Vi)+Wi )</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m;                                 <span class="comment">//nç‰©å“æ•°, mæœ€å¤§ä½“ç§¯</span></span><br><span class="line"><span class="type">int</span> v[N],w[N];</span><br><span class="line"><span class="type">int</span> f[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;           <span class="comment">//iä»1å¼€å§‹ï¼Œå› ä¸ºf[0][...]å¿…ç„¶æ˜¯0</span></span><br><span class="line">    cin &gt;&gt; v[i] &gt;&gt; w[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt;= m; j++)&#123;</span><br><span class="line">      f[i][j] = f[i<span class="number">-1</span>][j];               <span class="comment">//ä¸å«içš„å­é›†æ˜¯å¿…ç„¶å­˜åœ¨çš„</span></span><br><span class="line">      <span class="keyword">if</span>(j &gt;= v[i])                      <span class="comment">//åˆ¤æ–­å«içš„å­é›†æ˜¯å¦å¯ä»¥å­˜åœ¨</span></span><br><span class="line">        f[i][j] = <span class="built_in">max</span>(f[i][j], f[i<span class="number">-1</span>][j-v[i]] + w[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  cout &lt;&lt; f[n][m] &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æœ´ç´ äºŒç»´çŠ¶æ€çš„åŸºç¡€ä¸Šè¿˜å¯ä»¥ä¼˜åŒ–æˆä¸€ç»´çŠ¶æ€ï¼Œæœ‰ä¸¤ä¸ªå‰æï¼š</p>
<ol>
<li><p>f(i)å±‚åªç”¨åˆ°äº†f(i-1)å±‚ â€”&gt; æ»šåŠ¨æ•°ç»„(è¿­ä»£å™¨)</p>
</li>
<li><p>ä¸¤ä¸ªå­é›†çš„å…ƒç´ çš„ä½“ç§¯æ°¸è¿œå°äºç­‰äºjï¼Œè€Œä¸æ˜¯åœ¨jä¸¤ä¾§</p>
</li>
</ol>
<p>æ‰€ä»¥ä½¿ç”¨ä¸€ç»´æ•°ç»„ä¸åŒæ¬¡æ•°çš„å€¼å¯ä»¥æœ‰ç›¸å½“äºäºŒç»´æ•°ç»„ä¸åŒå±‚çš„æ•ˆæœ</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¼˜åŒ–ç®—æ³•ä»£ç ï¼šä¸€ç»´çŠ¶æ€</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m;                                 <span class="comment">//nç‰©å“æ•°, mæœ€å¤§ä½“ç§¯</span></span><br><span class="line"><span class="type">int</span> v[N],w[N];</span><br><span class="line"><span class="type">int</span> f[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;           <span class="comment">//iä»1å¼€å§‹ï¼Œå› ä¸ºf[0][...]å¿…ç„¶æ˜¯0</span></span><br><span class="line">    cin &gt;&gt; v[i] &gt;&gt; w[i];</span><br><span class="line">    <span class="comment">//å¦‚æœä¸‹é¢foréå†ä»å‰å‘åï¼Œç›¸å½“äºä½¿ç”¨äº†f[i][j-v[i]]è€Œéf[i-1][j-v[i]]</span></span><br><span class="line">    <span class="comment">//å› ä¸ºåä¸€ä¸ªæ•°ç”¨åˆ°äº†å‰ä¸€ä¸ªæ•°ï¼Œä½†å‰ä¸€ä¸ªæ•°å·²ç»åœ¨ä¸Šæ¬¡è¿­ä»£ä¸­è¢«ä»i-1æ›´æ–°i</span></span><br><span class="line">    <span class="comment">//å¦‚æœåå‘éå†ï¼Œåä¸€ä¸ªæ•°è¿˜æ˜¯ä¼šç”¨åˆ°å‰ä¸€ä¸ªæ•°ï¼Œä½†æ­¤æ—¶å‰ä¸€ä¸ªæ•°æœªè¢«æ›´æ–°</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j = m; j &gt;= v[i]; j--)       <span class="comment">//æ³¨æ„è¿™é‡Œå’Œæœ´ç´ ç®—æ³•çš„é¡ºåºæ˜¯åçš„</span></span><br><span class="line">        f[j] = <span class="built_in">max</span>(f[j], f[j-v[i]] + w[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  cout &lt;&lt; f[m] &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-2-å®Œå…¨èƒŒåŒ…é—®é¢˜"><a href="#1-2-å®Œå…¨èƒŒåŒ…é—®é¢˜" class="headerlink" title="1.2 å®Œå…¨èƒŒåŒ…é—®é¢˜"></a>1.2 å®Œå…¨èƒŒåŒ…é—®é¢˜</h2><blockquote>
<p>ğŸ“Œæœ‰Nä»¶ç‰©å“å’Œä¸€ä¸ªå®¹é‡ä¸ºVçš„èƒŒåŒ…ï¼Œæ¯ä¸ªç‰©å“çš„ä½“ç§¯æ˜¯Viï¼Œä»·å€¼æ˜¯Wiï¼Œæ¯ä»¶ç‰©å“å¯ç”¨æ— é™æ¬¡ã€‚æŒ‘é€‰ä¸€äº›ç‰©å“ï¼Œä½¿æ€»ä½“ç§¯å°äºç­‰äºVï¼Œè®©å¡è¿›èƒŒåŒ…çš„ç‰©å“æ€»ä»·å€¼æœ€å¤§ï¼Œæ±‚é—®æœ€å¤§ä»·å€¼</p>
</blockquote>
<ul>
<li>å®Œå…¨èƒŒåŒ…å’Œ01èƒŒåŒ…è§£æ³•å¾ˆç›¸ä¼¼ï¼Œé›†åˆçš„åˆ’åˆ†åˆ†ä¸ºä¸¤ç±»ï¼šä¸åŒ…å«ç¬¬iä¸ªç‰©å“ï¼Œå’ŒåŒ…å«ç¬¬iä¸ªç‰©å“ã€‚åªæ˜¯ç¬¬2ä¸ªç±»åˆ«ä¸­çš„æ›²çº¿æ•‘å›½æ”¹æˆäº†f( i-1, j-k*Vi)+k*Wiï¼Œkæ˜¯ç‰©å“içš„ä½¿ç”¨æ¬¡æ•°</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æœ´ç´ ç®—æ³•ä»£ç ï¼šäºŒç»´çŠ¶æ€</span></span><br><span class="line"><span class="comment">//å®Œå…¨èƒŒåŒ…çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼šf(i,j) = Max( f(i-1, j), f(i-1, j-k*Vi)+k*Wi )</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m;                                 <span class="comment">//nç‰©å“æ•°, mæœ€å¤§ä½“ç§¯</span></span><br><span class="line"><span class="type">int</span> v[N],w[N];</span><br><span class="line"><span class="type">int</span> f[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;           <span class="comment">//iä»1å¼€å§‹ï¼Œå› ä¸ºf[0][...]å¿…ç„¶æ˜¯0</span></span><br><span class="line">    cin &gt;&gt; v[i] &gt;&gt; w[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt;= m; j++)</span><br><span class="line">      <span class="keyword">for</span>(<span class="type">int</span> k = <span class="number">0</span>; k*v[i] &lt;= j; k++)   <span class="comment">//kä»0å¼€å§‹ï¼Œæ‰€ä»¥å…¶å®f[i-1][j]æ˜¯ä¸éœ€è¦çš„</span></span><br><span class="line">        f[i][j] = <span class="built_in">max</span>(f[i][j], f[i<span class="number">-1</span>][j-k*v[i]] + k*w[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  cout &lt;&lt; f[n][m] &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”±äºä¸Šè¿°æœ´ç´ ç®—æ³•ç”¨åˆ°ä¸‰ç§å¾ªç¯ï¼Œæ—¶é—´å¤æ‚åº¦è¿˜æ˜¯ç›¸å½“é«˜çš„ï¼Œå¯ä»¥é€šè¿‡çŠ¶æ€è½¬ç§»æ–¹ç¨‹å¯¹å…¶ä¼˜åŒ–</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åŸçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼šf(i,j) = Max( f(i-1,j), f(i-1,j-Vi)+Wi, f(i-1,j-2Vi)+2Wi, ... )</span></span><br><span class="line"><span class="comment">//è€ƒè™‘j-Viï¼š   f(i,j-Vi)= Max(           f(i-1,j-Vi),    f(i-1,j-2Vi)+Wi,  ... )</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬ä¸€æ¬¡ä¼˜åŒ–ï¼šäºŒç»´çŠ¶æ€</span></span><br><span class="line"><span class="comment">//ä¼˜åŒ–åçš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼šf(i,j) = Max( f(i-1,j), f(i,j-Vi)+Wi )</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m;                                 <span class="comment">//nç‰©å“æ•°, mæœ€å¤§ä½“ç§¯</span></span><br><span class="line"><span class="type">int</span> v[N],w[N];</span><br><span class="line"><span class="type">int</span> f[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;           <span class="comment">//iä»1å¼€å§‹ï¼Œå› ä¸ºf[0][...]å¿…ç„¶æ˜¯0</span></span><br><span class="line">    cin &gt;&gt; v[i] &gt;&gt; w[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt;= m; j++)&#123;</span><br><span class="line">      f[i][j] = f[i<span class="number">-1</span>][j];               <span class="comment">//ä¸å«içš„å­é›†æ˜¯å¿…ç„¶å­˜åœ¨çš„</span></span><br><span class="line">      <span class="keyword">if</span>(j &gt;= v[i])                      <span class="comment">//åˆ¤æ–­å«içš„å­é›†æ˜¯å¦å¯ä»¥å­˜åœ¨</span></span><br><span class="line">        f[i][j] = <span class="built_in">max</span>(f[i][j], f[i][j-v[i]] + w[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  cout &lt;&lt; f[n][m] &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨è¿˜å¯ä»¥æŒ‰ç…§01èƒŒåŒ…çš„ä¼˜åŒ–æ–¹å¼ï¼Œè¿›è¡Œè¿›ä¸€æ­¥ä¼˜åŒ–</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æœ€ç»ˆä¼˜åŒ–ï¼šä¸€ç»´çŠ¶æ€</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m;                                 <span class="comment">//nç‰©å“æ•°, mæœ€å¤§ä½“ç§¯</span></span><br><span class="line"><span class="type">int</span> v[N],w[N];</span><br><span class="line"><span class="type">int</span> f[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;           <span class="comment">//iä»1å¼€å§‹ï¼Œå› ä¸ºf[0][...]å¿…ç„¶æ˜¯0</span></span><br><span class="line">    cin &gt;&gt; v[i] &gt;&gt; w[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j = v[i]; j &lt;= m; j++)       <span class="comment">//è¿™é‡Œéå†æ˜¯æ­£å‘çš„ï¼Œå› ä¸ºç¬¦åˆçŠ¶æ€è½¬ç§»æ–¹ç¨‹</span></span><br><span class="line">        f[j] = <span class="built_in">max</span>(f[j], f[j-v[i]] + w[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  cout &lt;&lt; f[m] &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ“ŒTipï¼šåŠ¨æ€è§„åˆ’ä¸­å¦‚æœçŠ¶æ€è½¬ç§»ç”¨åˆ°äº†ä¸Šä¸€å±‚çš„å†…å®¹ï¼Œå°±æŒ‰ä½“ç§¯ä»å°åˆ°å¤§çš„é¡ºåºéå†ï¼›å¦‚æœç”¨åˆ°æœ¬å±‚å†…å®¹ï¼Œåˆ™åè¿‡æ¥ï¼Œä½¿ç”¨ä½“ç§¯ä»å¤§åˆ°å°çš„é¡ºåº</p>
</blockquote>
<h2 id="1-3-å¤šé‡èƒŒåŒ…é—®é¢˜"><a href="#1-3-å¤šé‡èƒŒåŒ…é—®é¢˜" class="headerlink" title="1.3 å¤šé‡èƒŒåŒ…é—®é¢˜"></a>1.3 å¤šé‡èƒŒåŒ…é—®é¢˜</h2><ul>
<li><p>å¤šé‡èƒŒåŒ…æ˜¯æœ‰é™æƒ…æ™¯ä¸‹çš„å®Œå…¨èƒŒåŒ…ï¼ŒäºŒè€…çš„æœ´ç´ å†™æ³•å‡ ä¹æ˜¯ä¸€æ ·çš„</p>
</li>
<li><p>ä¸èƒ½ä½¿ç”¨å®Œå…¨èƒŒåŒ…çš„ä¼˜åŒ–æ–¹æ³•æ¥ä¼˜åŒ–å¤šé‡èƒŒåŒ…</p>
<p>åŸæ–¹ç¨‹ï¼šf(i,j) &#x3D; Max( f(i-1,j), f(i-1,j-Vi)+Wi, f(i-1,j-2Vi)+2Wi, â€¦ , f(i-1,j-Si<em>Vi)+Si</em>Vi )</p>
<p>j-Viï¼š f(i,j-Vi) &#x3D; Max(           f(i-1,j-Vi),        f(i-1,j-2Vi)+Wi, â€¦ ,   f(i-1,j-Si<em>Vi)+(Si-1)</em> Vi,</p>
<p>&amp;#x20;                                       f(i-1,j-(Si+1)*Vi)+Si*Vi  )</p>
<p>å®Œå…¨èƒŒåŒ…é—®é¢˜ä¸­çš„kæ˜¯å—èƒŒåŒ…å®¹é‡é™åˆ¶çš„ï¼Œä¸ä¼šå¤šçº¢å­—é‚£ä¸€é¡¹ï¼Œä½†å¤šé‡èƒŒåŒ…åŒæ—¶å—èƒŒåŒ…å®¹é‡å’ŒSié™åˆ¶ï¼Œå¦‚æœå¯è™‘æ‰€æœ‰æƒ…å†µï¼Œå°±æœ‰å¯èƒ½å‡ºç°çº¢å­—é‚£ä¸€é¡¹ã€‚é‚£ä¹ˆå®Œå…¨èƒŒåŒ…æ‰€ç”¨çš„ä¼˜åŒ–æ–¹æ³•ä¸å†é€‚ç”¨</p>
</li>
</ul>
<blockquote>
<p>ğŸ“Œæœ‰Nç§ç‰©å“å’Œä¸€ä¸ªå®¹é‡ä¸ºVçš„èƒŒåŒ…ï¼Œæ¯ç§ç‰©å“ä¸­ä¸€ä»¶çš„ä½“ç§¯æ˜¯Viï¼Œä»·å€¼æ˜¯Wiï¼Œæ¯ç§ç‰©å“æœ€å¤šå¯ç”¨Siæ¬¡ã€‚æŒ‘é€‰ä¸€äº›ç‰©å“ï¼Œä½¿æ€»ä½“ç§¯å°äºç­‰äºVï¼Œè®©å¡è¿›èƒŒåŒ…çš„ç‰©å“æ€»ä»·å€¼æœ€å¤§ï¼Œæ±‚é—®æœ€å¤§ä»·å€¼</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æœ´ç´ ç®—æ³•ä»£ç ï¼šäºŒç»´çŠ¶æ€</span></span><br><span class="line"><span class="comment">//å¤šé‡èƒŒåŒ…çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼šf(i,j) = Max( f(i-1, j), f(i-1, j-k*Vi)+k*Wi )</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m;                                 <span class="comment">//nç‰©å“æ•°, mæœ€å¤§ä½“ç§¯</span></span><br><span class="line"><span class="type">int</span> v[N],w[N],s[N];</span><br><span class="line"><span class="type">int</span> f[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">    cin &gt;&gt; v[i] &gt;&gt; w[i] &gt;&gt; s[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt;= m; j++)</span><br><span class="line">      <span class="keyword">for</span>(<span class="type">int</span> k = <span class="number">0</span>; k*v[i] &lt;= j &amp;&amp; k &lt;= s[i]; k++)<span class="comment">//å¤šé‡å’Œå®Œå…¨çš„æœ´ç´ å†™æ³•ä¸åŒä¹‹å¤„ä¸ºæ­¤å¤„æ¡ä»¶</span></span><br><span class="line">        <span class="comment">//kä»0å¼€å§‹ï¼Œæ‰€ä»¥å…¶å®f[i-1][j]æ˜¯ä¸éœ€è¦çš„</span></span><br><span class="line">        f[i][j] = <span class="built_in">max</span>(f[i][j], f[i<span class="number">-1</span>][j-k*v[i]] + k*w[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  cout &lt;&lt; f[n][m] &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¼˜åŒ–æ–¹æ³•ï¼šäºŒè¿›åˆ¶ä¼˜åŒ–ï¼ï¼ï¼</li>
</ul>
<p>(å…¶å®è¿˜å¯ä»¥ä½¿ç”¨å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–ï¼Œåé¢çš„å†…å®¹)</p>
<p>å¯¹äºä»»æ„å¤§å°s[i]ï¼Œé‡Œé¢æ‰€æœ‰çš„æ•°éƒ½å¯ä»¥ç”±ä¸€ç³»åˆ—â€œäºŒçš„æ•´æ•°æ¬¡æ–¹â€ç»„æˆï¼Œæ¯”å¦‚s&#x3D;1023</p>
<p>åˆ™æ‰€æœ‰æ¯”1023å°çš„æ•°éƒ½å¯ä»¥ç”¨{1,2,4,8,â€¦,512}ç»„åˆå‡ºæ¥ã€‚</p>
<p>åˆæ¯”å¦‚200ï¼š1,2,4,8,16,32,64,73</p>
<p>é‚£ä¹ˆkçš„éå†é‚£ä¸€ç¯å…¶å®å°±å˜æˆäº†01èƒŒåŒ…é—®é¢˜ï¼Œä¸å†éœ€è¦éå†å…¨éƒ¨Siæ¬¡ï¼Œåªéœ€è®¾ç½®log2Siä¸ªèƒŒåŒ…</p>
<p>æ—¶é—´å¤æ‚åº¦ä»NVSåˆ°NVlog2S</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">25000</span>, M = <span class="number">2010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m;</span><br><span class="line"><span class="type">int</span> v[N],w[N];</span><br><span class="line"><span class="type">int</span> f[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;<span class="comment">//å»ºç«‹æ–°èƒŒåŒ…</span></span><br><span class="line">    <span class="type">int</span> a,b,s;</span><br><span class="line">    cin &gt;&gt; a &gt;&gt; b &gt;&gt; s;</span><br><span class="line">    <span class="type">int</span> k = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(k &lt;= s)&#123;</span><br><span class="line">      cnt++;</span><br><span class="line">      v[cnt] = a * k;</span><br><span class="line">      w[cnt] = b * k;</span><br><span class="line">      s -= k;</span><br><span class="line">      k *= <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(s &gt; <span class="number">0</span>)&#123;</span><br><span class="line">      cnt ++;</span><br><span class="line">      v[cnt] = a * s;</span><br><span class="line">      w[cnt] = b * s;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  n = cnt;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j = m; j &gt;= v[i]; j-- )</span><br><span class="line">      f[j] = <span class="built_in">max</span>(f[j],f[j-v[i]]+w[i]);</span><br><span class="line"></span><br><span class="line">  cout &lt;&lt; f[m] &lt;&lt;endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-4-åˆ†ç»„èƒŒåŒ…é—®é¢˜"><a href="#1-4-åˆ†ç»„èƒŒåŒ…é—®é¢˜" class="headerlink" title="1.4 åˆ†ç»„èƒŒåŒ…é—®é¢˜"></a>1.4 åˆ†ç»„èƒŒåŒ…é—®é¢˜</h2><blockquote>
<p>ğŸ“Œæœ‰Nç»„ç‰©å“å’Œä¸€ä¸ªå®¹é‡ä¸ºVçš„èƒŒåŒ…ï¼Œæ¯ä»¶ç‰©å“çš„ä½“ç§¯æ˜¯Vijï¼Œä»·å€¼æ˜¯Wijï¼Œiæ˜¯ç»„å·ï¼Œjæ˜¯ç»„å†…ç¼–å·ï¼ŒåŒä¸€ç»„å†…çš„ç‰©å“æœ€å¤šé€‰ä¸€ä¸ªã€‚æŒ‘é€‰ä¸€äº›ç‰©å“ï¼Œä½¿æ€»ä½“ç§¯å°äºç­‰äºVï¼Œè®©å¡è¿›èƒŒåŒ…çš„ç‰©å“æ€»ä»·å€¼æœ€å¤§ï¼Œæ±‚é—®æœ€å¤§ä»·å€¼</p>
</blockquote>
<ul>
<li>çƒ­ç‹—åˆ’åˆ†æ³•(çŠ¶æ€è®¡ç®—)ï¼š</li>
</ul>
<p><img src="/image/Fig2_Kc0B6M3H-a.png"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">110</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m;</span><br><span class="line"><span class="type">int</span> v[N][N],w[N][N],s[N];                 <span class="comment">//s[i]è¡¨ç¤ºç¬¬iç»„æœ‰å¤šå°‘ç‰©å“</span></span><br><span class="line"><span class="type">int</span> f[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ;i &lt;= n; i++)&#123;</span><br><span class="line">    cin &gt;&gt; s[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; s[i]; j++ )</span><br><span class="line">      cin&gt;&gt;v[i][j]&gt;&gt;w[i][j];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123; </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j = m; j &gt;= <span class="number">0</span>; j--)           <span class="comment">//å› ä¸ºè¦ç”¨åˆ°i-1ï¼Œæ‰€ä»¥é€†åºéå†</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="type">int</span> k = <span class="number">0</span>; k &lt; s[i]; k++ )</span><br><span class="line">        <span class="keyword">if</span>(v[i][k] &lt;= j)</span><br><span class="line">          f[j] = <span class="built_in">max</span>(f[j],f[j-v[i][k]]+w[i][k]);</span><br><span class="line">  &#125;</span><br><span class="line">  cout &lt;&lt; f[m] &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="2-çº¿æ€§DP"><a href="#2-çº¿æ€§DP" class="headerlink" title="2 çº¿æ€§DP"></a>2 çº¿æ€§DP</h1><blockquote>
<p>çº¿æ€§DPå°±æ˜¯åœ¨çº¿æ€§ç»“æ„ä¸Šè½¬ç§»çŠ¶æ€ï¼Œå®Œæˆçº¿æ€§ç©ºé—´ä¸Šçš„é€’æ¨</p>
</blockquote>
<h2 id="2-1-ä¾‹é¢˜1ï¼šæ•°å­—ä¸‰è§’å½¢"><a href="#2-1-ä¾‹é¢˜1ï¼šæ•°å­—ä¸‰è§’å½¢" class="headerlink" title="2.1 ä¾‹é¢˜1ï¼šæ•°å­—ä¸‰è§’å½¢"></a>2.1 ä¾‹é¢˜1ï¼šæ•°å­—ä¸‰è§’å½¢</h2><blockquote>
<p>ğŸ“Œç»™å®šä¸€ä¸ªå¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ•°å­—ä¸‰è§’å½¢ï¼Œä»é¡¶éƒ¨å‡ºå‘ï¼Œåœ¨æ¯ä¸€ç»“ç‚¹å¯ä»¥é€‰æ‹©ç§»åŠ¨è‡³å…¶å·¦ä¸‹æ–¹çš„ç»“ç‚¹æˆ–ç§»åŠ¨è‡³å…¶å³ä¸‹æ–¹çš„ç»“ç‚¹ï¼Œä¸€ç›´èµ°åˆ°åº•å±‚ï¼Œè¦æ±‚æ‰¾å‡ºä¸€æ¡è·¯å¾„ï¼Œä½¿è·¯å¾„ä¸Šçš„æ•°å­—çš„å’Œæœ€å¤§<br>&amp;#x20;           7<br>&amp;#x20;        3    8<br>&amp;#x20;     8    1    0<br>&amp;#x20;  2    7    4    4<br>4    5    2    6    5</p>
</blockquote>
<ul>
<li>æ±‚è§£æ€è·¯ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">- çŠ¶æ€è¡¨ç¤ºï¼š</span><br><span class="line">f(i,j)ï¼šèµ°åˆ°(i,j)ä½ç½®çš„æ‰€æœ‰è·¯å¾„çš„é›†åˆçš„max</span><br><span class="line">                  é›†åˆ              å±æ€§</span><br><span class="line">               ç¬¬ä¸€åˆ—</span><br><span class="line">ç¬¬ä¸€è¡Œ         7  ç¬¬äºŒåˆ—</span><br><span class="line">ç¬¬äºŒè¡Œ       3   8  ç¬¬ä¸‰åˆ—</span><br><span class="line">ç¬¬ä¸‰è¡Œ     8   1   0  ç¬¬å››åˆ—</span><br><span class="line">ç¬¬å››è¡Œ   2   7   4   4  ç¬¬äº”åˆ—</span><br><span class="line">ç¬¬äº”è¡Œ 4   5   2   6   5</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">- çŠ¶æ€è®¡ç®—(ä»¤a(i,j)è¡¨ç¤º(i,j)ä½ç½®å…ƒç´ çš„å€¼)</span><br><span class="line">åˆ†ç±»ï¼šå·¦ä¸Šæ¥çš„è·¯å¾„    å’Œ   å³ä¸Šæ¥çš„è·¯å¾„ </span><br><span class="line">   f(i-1,j-1)+a(i,j)    f(i-1,j)+a(i,j)</span><br><span class="line"></span><br><span class="line">â‡’çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</span><br><span class="line">f(i,j) = Max( f(i-1,j-1)+a(i,j) , </span><br><span class="line">              f(i-1,j)+a(i,j)) )</span><br></pre></td></tr></table></figure>

<ul>
<li>ä»£ç ï¼š</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">512</span>, INF = <span class="number">1e9</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> a[N][N];</span><br><span class="line"><span class="type">int</span> f[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);                    <span class="comment">//ä¸€å…±æœ‰å‡ è¡Œå‡ åˆ—</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)         <span class="comment">//è·å–ä¸‰è§’å½¢</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= i; j++)</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i][j]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt;= i + <span class="number">1</span>; j++)   <span class="comment">//è¿™é‡Œçš„åˆ—éœ€è¦ä»0å¼€å§‹ï¼Œåˆ°i+1ç»“æŸï¼Œè¡¥å…¨è¾¹ç¼˜æ•°å­—ä¸¤ä¾§</span></span><br><span class="line">      f[i][j] = -INF;                 <span class="comment">//é˜²æ­¢æ±‚å’Œä¸ºè´Ÿæ•°æ—¶ï¼Œåˆå€¼ä¸º0çš„è¯¯åˆ¤</span></span><br><span class="line"></span><br><span class="line">  f[<span class="number">1</span>][<span class="number">1</span>] = a[<span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= i; j++)</span><br><span class="line">      f[i][j] = <span class="built_in">max</span>(f[i<span class="number">-1</span>][j<span class="number">-1</span>]+a[i][j], f[i<span class="number">-1</span>][j]+a[i][j]);</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> res = -INF;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)res = <span class="built_in">max</span>(res,f[n][i]);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, res);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-ä¾‹é¢˜2ï¼šæœ€å¤§ä¸Šå‡å­åºåˆ—"><a href="#2-2-ä¾‹é¢˜2ï¼šæœ€å¤§ä¸Šå‡å­åºåˆ—" class="headerlink" title="2.2 ä¾‹é¢˜2ï¼šæœ€å¤§ä¸Šå‡å­åºåˆ—"></a>2.2 ä¾‹é¢˜2ï¼šæœ€å¤§ä¸Šå‡å­åºåˆ—</h2><blockquote>
<p>ğŸ“Œç»™å®šä¸€ä¸ªé•¿åº¦ä¸ºNçš„æ•°åˆ—ï¼Œæ±‚æ•°å€¼ä¸¥æ ¼å•è°ƒé€’å¢çš„å­åºåˆ—çš„é•¿åº¦æœ€é•¿æ˜¯å¤šå°‘ï¼Œå¹¶è®°å½•å­åºåˆ—<br>è¾“å…¥æ ·ä¾‹ï¼š<br>7&amp;#x20;<br>3 1 2 1 8 5 6<br>ç»“æœï¼š<br>4<br>1 2 5 6</p>
</blockquote>
<ul>
<li>æœ´ç´ æ–¹æ³•æ±‚è§£æ€è·¯ï¼š</li>
</ul>
<!---->

<pre><code>- çŠ¶æ€è¡¨ç¤ºï¼š
f[i]ï¼šåˆ°ç¬¬iä¸ªä½ç½®çš„å­åºåˆ—é›†åˆçš„max
</code></pre>
<!---->

<pre><code>- çŠ¶æ€è®¡ç®—ï¼š
f[i] = f[j]+1, j = 1,2,...,i-1 &amp;&amp; a[j]&lt;a[i]
</code></pre>
<ul>
<li>æœ´ç´ æ–¹æ³•ä»£ç ï¼š</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> a[N], f[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ ) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        f[i] = <span class="number">1</span>; <span class="comment">// åªæœ‰a[i]ä¸€ä¸ªæ•°</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; i; j ++ )</span><br><span class="line">            <span class="keyword">if</span> (a[j] &lt; a[i])</span><br><span class="line">                f[i] = <span class="built_in">max</span>(f[i], f[j] + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ ) res = <span class="built_in">max</span>(res, f[i]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, res);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>ä¼˜åŒ–</strong></li>
</ul>
<p><strong>æ±‚è§£æ€è·¯ï¼š</strong></p>
<p>å¯¹äºåƒ</p>
<pre><code>7
3 1 2 1 8 5 6
</code></pre>
<p>è¿™æ ·çš„åºåˆ—ï¼Œåœ¨èµ°åˆ°iæ—¶ï¼Œå¯ä»¥å­˜å‚¨iä¹‹å‰çš„å„ä¸ªé•¿åº¦é‡Œçš„ä¸Šå‡å­åºåˆ—ä¸­æœ«å°¾æœ€å°å€¼ï¼Œæ¯”å¦‚8ä¹‹å‰ï¼Œé•¿åº¦ä¸º1çš„ä¸Šå‡å­åºåˆ—çš„æœ«å°¾å€¼å¯ä»¥æœ‰3å’Œ1ï¼Œä½†æ˜¯3æ˜¯æ²¡å¿…è¦å­˜çš„ï¼Œèƒ½æ¥åœ¨3åä¹Ÿå¿…ç„¶èƒ½æ¥åœ¨1å</p>
<p>è€Œä¸”å„ä¸ªé•¿åº¦çš„ä¸Šå‡å­åºåˆ—çš„æœ«å°¾æœ€å°å€¼å¿…ç„¶ä¸¥æ ¼å•è°ƒé€’å¢</p>
<p><img src="/image/Fig3_tLiUPdQcXh.png"></p>
<p>å¯ä»¥ç”¨åè¯æ³•è¯æ˜è¿™ä¸€æ€§è´¨ï¼š</p>
<p>è‹¥q6æ¯”q5å°ï¼Œé‚£ä¹ˆq6æ‰€åœ¨å­åºåˆ—çš„ç¬¬5ä¸ªå€¼ä¹Ÿæ¯”q5å°ï¼Œé‚£ä¹ˆq5å°±ä¸æ˜¯é•¿åº¦ä¸º5çš„å­åºåˆ—ä¸­çš„æœ€å°æœ«å°¾å€¼ï¼ŒçŸ›ç›¾</p>
<p>äºæ˜¯å½“èµ°åˆ°ç¬¬iä¸ªå­—ç¬¦a[i]æ—¶ï¼Œå¯ä»¥æŸ¥æ‰¾a[i]ä¹‹å‰æ‰€æœ‰é•¿åº¦å­åºåˆ—ä¸­ï¼Œå°äºa[i]çš„æœ€å¤§çš„æœ«å°¾æœ€å°å€¼ã€‚</p>
<p>æ¯”å¦‚è¯´ï¼Œq4&lt;a[i]ï¼Œè€Œq5&gt;a[i]ï¼Œé‚£ä¹ˆq4å°±æ˜¯é‚£ä¸ªæœ€å¤§çš„æœ«å°¾æœ€å°å€¼ï¼Œè€Œä¸”q5å°†è¢«æ›¿æ¢æˆa[i]</p>
<p>æŸ¥æ‰¾æœ€å¤§çš„æœ«å°¾æœ€å°å€¼æ—¶å¯ä»¥ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ã€‚æ—¶é—´å¤æ‚åº¦è¾ƒä¹‹å‰å¤§å¤§å‡å°‘ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> a[N];</span><br><span class="line"><span class="type">int</span> q[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ ) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i]);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> l = <span class="number">0</span>, r = len;</span><br><span class="line">        <span class="keyword">while</span> (l &lt; r)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> mid = l + r + <span class="number">1</span> &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (q[mid] &lt; a[i]) l = mid;</span><br><span class="line">            <span class="keyword">else</span> r = mid - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        len = <span class="built_in">max</span>(len, r + <span class="number">1</span>);</span><br><span class="line">        q[r + <span class="number">1</span>] = a[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, len);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-ä¾‹é¢˜3ï¼š-æœ€é•¿å…¬å…±å­åºåˆ—"><a href="#2-3-ä¾‹é¢˜3ï¼š-æœ€é•¿å…¬å…±å­åºåˆ—" class="headerlink" title="2.3 ä¾‹é¢˜3ï¼š æœ€é•¿å…¬å…±å­åºåˆ—"></a>2.3 ä¾‹é¢˜3ï¼š æœ€é•¿å…¬å…±å­åºåˆ—</h2><blockquote>
<p>ğŸ“Œç»™å®šä¸¤ä¸ªé•¿åº¦åˆ†åˆ«ä¸ºNå’ŒMçš„å­—ç¬¦ä¸²Aå’ŒBï¼Œæ±‚æ—¢æ˜¯Açš„å­åºåˆ—åˆæ˜¯Bçš„å­åºåˆ—çš„å­—ç¬¦ä¸²é•¿åº¦æœ€é•¿æ˜¯å¤šå°‘<br>è¾“å…¥æ¡ˆä¾‹ï¼š<br>4 5<br>acbd<br>abedc<br>è¾“å‡ºï¼š3(abd)</p>
</blockquote>
<ul>
<li>æ±‚è§£æ€è·¯ï¼š</li>
</ul>
<p><strong>çŠ¶æ€è¡¨ç¤º</strong>ï¼š</p>
<p>f(i,j)ï¼šæ‰€æœ‰åœ¨Aåºåˆ—çš„å‰iä¸ªå­—æ¯ä¸­å‡ºç°ï¼Œå¹¶åœ¨Båºåˆ—çš„å‰jä¸ªå­—æ¯ä¸­å‡ºç°çš„å­åºåˆ—çš„é›†åˆä¸­çš„Max</p>
<p><strong>çŠ¶æ€è®¡ç®—ï¼š</strong></p>
<p><img src="/image/Fig4_ujvYujEOup.png"></p>
<p>ä¸Šè¿°å››è€…åˆ†åˆ«æ˜¯ f(i-1, j-1) ã€f(i-1, j) ã€f(i, j-1) ã€f(i-1, j-1)+1</p>
<p>éœ€è¦æ³¨æ„ä¸­é—´äºŒè€…ï¼Œf(i-1, j)å¹¶ä¸æ˜¯ä¸¥æ ¼çš„01æƒ…å†µï¼Œf(i, j-1)ä¹Ÿä¸æ˜¯ä¸¥æ ¼çš„10æƒ…å†µ</p>
<pre><code>f(i-1,j)æ˜¯ï¼š
æ‰€æœ‰åœ¨Aåºåˆ—çš„å‰i-1ä¸ªå­—æ¯ä¸­å‡ºç°
å¹¶åœ¨Båºåˆ—çš„å‰jä¸ªå­—æ¯ä¸­å‡ºç°çš„å­åºåˆ—é›†åˆ

01æ˜¯ï¼š
ä¸åŒ…å«Aåºåˆ—çš„ç¬¬iä¸ªå­—æ¯ï¼Œ
ä½†æ˜¯åŒ…å«Båºåˆ—çš„ç¬¬jä¸ªå­—æ¯çš„å­åºåˆ—çš„é›†åˆ

å‰è€…åŒ…å«åè€…ï¼ŒäºŒè€…å¹¶ä¸ç›¸ç­‰
</code></pre>
<!---->

<pre><code>f(i,j-1)æ˜¯ï¼š
æ‰€æœ‰åœ¨Aåºåˆ—çš„å‰iä¸ªå­—æ¯ä¸­å‡ºç°
å¹¶åœ¨Båºåˆ—çš„å‰j-1ä¸ªå­—æ¯ä¸­å‡ºç°çš„å­åºåˆ—é›†åˆ

10æ˜¯ï¼š
åŒ…å«Aåºåˆ—çš„ç¬¬iä¸ªå­—æ¯ï¼Œ
ä½†æ˜¯ä¸åŒ…å«Båºåˆ—çš„ç¬¬jä¸ªå­—æ¯çš„å­åºåˆ—çš„é›†åˆ

å‰è€…åŒ…å«åè€…ï¼ŒäºŒè€…å¹¶ä¸ç›¸ç­‰
</code></pre>
<p>æ±‚æœ€å¤§å€¼æ—¶é‡å¤æ˜¯æ²¡æœ‰å…³ç³»çš„ï¼Œåªè¦ä¿è¯ä¸æ¼å°±è¡Œ</p>
<p>äº‹å®ä¸Šç¬¬ä¸€é¡¹f(i-1, j-1)ä¹Ÿæ²¡æœ‰å¿…è¦å†™ï¼Œå› ä¸ºå®ƒè¢«f(i-1, j)å’Œf(i, j-1)åŒ…å«äº†</p>
<ul>
<li>ä»£ç ï¼š</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">char</span> a[N], b[N];</span><br><span class="line"><span class="type">int</span> f[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s%s&quot;</span>, a + <span class="number">1</span>, b + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j ++ )</span><br><span class="line">        &#123;</span><br><span class="line">            f[i][j] = <span class="built_in">max</span>(f[i - <span class="number">1</span>][j], f[i][j - <span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">if</span> (a[i] == b[j]) f[i][j] = <span class="built_in">max</span>(f[i][j], f[i - <span class="number">1</span>][j - <span class="number">1</span>] + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, f[n][m]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-4-ä¾‹é¢˜4ï¼šæœ€çŸ­ç¼–è¾‘è·ç¦»"><a href="#2-4-ä¾‹é¢˜4ï¼šæœ€çŸ­ç¼–è¾‘è·ç¦»" class="headerlink" title="2.4 ä¾‹é¢˜4ï¼šæœ€çŸ­ç¼–è¾‘è·ç¦»"></a>2.4 ä¾‹é¢˜4ï¼šæœ€çŸ­ç¼–è¾‘è·ç¦»</h2><blockquote>
<p>ğŸ“Œç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸²Aå’ŒBï¼Œç°åœ¨è¦å°†Aç»è¿‡è‹¥å¹²æ“ä½œå˜ä¸ºBï¼Œå¯è¿›è¡Œçš„æ“ä½œæœ‰ï¼š<br>- åˆ é™¤ï¼šå°†å­—ç¬¦ä¸²Aä¸­çš„æŸä¸ªå­—ç¬¦åˆ é™¤ã€‚<br>- æ’å…¥ï¼šåœ¨å­—ç¬¦ä¸²Açš„æŸä¸ªä½ç½®æ’å…¥æŸä¸ªå­—ç¬¦ã€‚<br>- æ›¿æ¢ï¼šå°†å­—ç¬¦ä¸²Aä¸­çš„æŸä¸ªå­—ç¬¦æ›¿æ¢ä¸ºå¦ä¸€ä¸ªå­—ç¬¦ã€‚<br>ç°åœ¨è¯·ä½ æ±‚å‡ºï¼Œå°†Aå˜ä¸ºBè‡³å°‘éœ€è¦è¿›è¡Œå¤šå°‘æ¬¡æ“ä½œã€‚</p>
</blockquote>
<ul>
<li>æ±‚è§£æ€è·¯ï¼š</li>
</ul>
<p><strong>çŠ¶æ€è¡¨ç¤ºï¼š</strong></p>
<p>f(i,j)ï¼šæ‰€æœ‰ä»A[1~i]å˜åˆ°B[1~j]çš„æ“ä½œæ–¹å¼çš„é›†åˆçš„min</p>
<p><strong>çŠ¶æ€è®¡ç®—ï¼š</strong></p>
<p><img src="/image/Fig5_7BHn4a-NxW.png"></p>
<p>â†’ çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</p>
<p>f(i, j) &#x3D; min( f(i-1, j) + 1, f(i, j-1) + 1, f(i-1, j-1) + 1&#x2F;0 )</p>
<p>åˆ çš„å‰ææ˜¯A[1~i-1]&#x3D;&#x3D;B[1~j]</p>
<p>å¢çš„å‰ææ˜¯A[1~i]&#x3D;&#x3D;B[1~j-1]</p>
<p>æ”¹çš„å‰ææ˜¯A[1~i-1]&#x3D;&#x3D;B[1~j-1]ï¼Œå¦‚æœA[i]&#x3D;&#x3D;B[j]ï¼ŒåŠ 0ï¼Œå¦åˆ™åŠ 1</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">char</span> a[N], b[N];</span><br><span class="line"><span class="type">int</span> f[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d%s&quot;</span>, &amp;n, a+<span class="number">1</span>);<span class="comment">//æ¥æ”¶aå­—ç¬¦ä¸²</span></span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d%s&quot;</span>, &amp;m, b+<span class="number">1</span>);<span class="comment">//æ¥æ”¶bå­—ç¬¦ä¸²</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt;= m; j++) f[<span class="number">0</span>][j] = j;<span class="comment">//aä¸ºç©ºæ—¶ï¼Œåªèƒ½å¢ï¼Œå¢åŠ bçš„é•¿åº¦</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; i++) f[i][<span class="number">0</span>] = i;<span class="comment">//bä¸ºç©ºæ—¶ï¼Œåªèƒ½åˆ ï¼Œåˆ é™¤açš„é•¿åº¦</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j++)&#123;</span><br><span class="line">      f[i][j] = <span class="built_in">min</span>(f[i<span class="number">-1</span>][j]+<span class="number">1</span>, f[i][j<span class="number">-1</span>]+<span class="number">1</span>);<span class="comment">//å‰ä¸¤ç§æƒ…å†µç›´æ¥æ¯”è¾ƒ</span></span><br><span class="line">      <span class="keyword">if</span>(a[i] == b[j])f[i][j] = <span class="built_in">min</span>(f[i][j], f[i<span class="number">-1</span>][j<span class="number">-1</span>]);</span><br><span class="line">      <span class="keyword">else</span> f[i][j] = <span class="built_in">min</span>(f[i][j], f[i<span class="number">-1</span>][j<span class="number">-1</span>] + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;  </span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, f[n][m]);  </span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>ä¾‹é¢˜å˜å½¢ï¼š</strong></p>
</li>
<li></li>
</ul>
<blockquote>
<p>ğŸ“Œç»™å®šnä¸ªé•¿åº¦ä¸è¶…è¿‡10çš„å­—ç¬¦ä¸²ä»¥åŠmæ¬¡è¯¢é—®ï¼Œæ¯æ¬¡è¯¢é—®ç»™å‡ºä¸€ä¸ªå­—ç¬¦ä¸²å’Œä¸€ä¸ªæ“ä½œæ¬¡æ•°ä¸Šé™ã€‚<br>å¯¹äºæ¯æ¬¡è¯¢é—®ï¼Œè¯·ä½ æ±‚å‡ºç»™å®šçš„nä¸ªå­—ç¬¦ä¸²ä¸­æœ‰å¤šå°‘ä¸ªå­—ç¬¦ä¸²å¯ä»¥åœ¨ä¸Šé™æ“ä½œæ¬¡æ•°å†…ç»è¿‡æ“ä½œå˜æˆè¯¢é—®ç»™å‡ºçš„å­—ç¬¦ä¸²ã€‚<br>æ¯ä¸ªå¯¹å­—ç¬¦ä¸²è¿›è¡Œçš„å•ä¸ªå­—ç¬¦çš„æ’å…¥ã€åˆ é™¤æˆ–æ›¿æ¢ç®—ä½œä¸€æ¬¡æ“ä½œã€‚</p>
</blockquote>
<p>å…¶å®å°±æ˜¯å°†åˆšåˆšçš„è¿‡ç¨‹æ“ä½œn*mæ¬¡</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">15</span>, M = <span class="number">1010</span>;</span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> f[N][N];</span><br><span class="line"><span class="type">char</span> str[M][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">edit_distance</span><span class="params">(<span class="type">char</span> a[], <span class="type">char</span> b[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> la = <span class="built_in">strlen</span>(a + <span class="number">1</span>), lb = <span class="built_in">strlen</span>(b + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= lb; i ++ ) f[<span class="number">0</span>][i] = i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= la; i ++ ) f[i][<span class="number">0</span>] = i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= la; i ++ )</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= lb; j ++ )</span><br><span class="line">        &#123;</span><br><span class="line">            f[i][j] = <span class="built_in">min</span>(f[i - <span class="number">1</span>][j] + <span class="number">1</span>, f[i][j - <span class="number">1</span>] + <span class="number">1</span>);</span><br><span class="line">            f[i][j] = <span class="built_in">min</span>(f[i][j], f[i - <span class="number">1</span>][j - <span class="number">1</span>] + (a[i] != b[j]));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> f[la][lb];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);                                     <span class="comment">//nä¸ªå­—ç¬¦ä¸²ï¼Œmæ¬¡è¯¢é—®</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ ) <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, str[i] + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (m -- )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">char</span> s[N];</span><br><span class="line">        <span class="type">int</span> limit;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s%d&quot;</span>, s + <span class="number">1</span>, &amp;limit);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ )</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">edit_distance</span>(str[i], s) &lt;= limit)</span><br><span class="line">                res ++ ;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3-åŒºé—´DP"><a href="#3-åŒºé—´DP" class="headerlink" title="3 åŒºé—´DP"></a>3 åŒºé—´DP</h1><blockquote>
<p>åŒºé—´dpå°±æ˜¯åœ¨åŒºé—´ä¸Šè¿›è¡ŒåŠ¨æ€è§„åˆ’ï¼Œæ±‚è§£ä¸€æ®µåŒºé—´ä¸Šçš„æœ€ä¼˜è§£ã€‚<br>ä¸»è¦æ˜¯é€šè¿‡åˆå¹¶å°åŒºé—´çš„æœ€ä¼˜è§£ï¼Œè¿›è€Œå¾—å‡ºæ•´ä¸ªå¤§åŒºé—´ä¸Šæœ€ä¼˜è§£çš„dpç®—æ³•</p>
</blockquote>
<h2 id="3-1-ä¾‹é¢˜1ï¼šçŸ³å­åˆå¹¶"><a href="#3-1-ä¾‹é¢˜1ï¼šçŸ³å­åˆå¹¶" class="headerlink" title="3.1 ä¾‹é¢˜1ï¼šçŸ³å­åˆå¹¶"></a>3.1 ä¾‹é¢˜1ï¼šçŸ³å­åˆå¹¶</h2><blockquote>
<p>ğŸ“Œè®¾æœ‰Nå †çŸ³å­æ’æˆä¸€æ’ï¼Œå…¶ç¼–å·ä¸º1ï¼Œ2ï¼Œ3ï¼Œâ€¦ï¼ŒNã€‚<br>æ¯å †çŸ³å­æœ‰ä¸€å®šçš„è´¨é‡ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªæ•´æ•°æ¥æè¿°ï¼Œç°åœ¨è¦å°†è¿™Nå †çŸ³å­åˆå¹¶æˆä¸ºä¸€å †ã€‚</p>
<p>æ¯æ¬¡åªèƒ½åˆå¹¶ç›¸é‚»çš„ä¸¤å †ï¼Œåˆå¹¶çš„ä»£ä»·ä¸ºè¿™ä¸¤å †çŸ³å­çš„è´¨é‡ä¹‹å’Œï¼Œåˆå¹¶åä¸è¿™ä¸¤å †çŸ³å­ç›¸é‚»çš„çŸ³å­å°†å’Œæ–°å †ç›¸é‚»ï¼Œåˆå¹¶æ—¶ç”±äºé€‰æ‹©çš„é¡ºåºä¸åŒï¼Œåˆå¹¶çš„æ€»ä»£ä»·ä¹Ÿä¸ç›¸åŒã€‚</p>
<p>ä¾‹å¦‚æœ‰4å †çŸ³å­åˆ†åˆ«ä¸º 1 3 5 2ï¼Œ æˆ‘ä»¬å¯ä»¥å…ˆåˆå¹¶1ã€2å †ï¼Œä»£ä»·ä¸º4ï¼Œå¾—åˆ°4 5 2ï¼Œ åˆåˆå¹¶ 1ï¼Œ2å †ï¼Œä»£ä»·ä¸º9ï¼Œå¾—åˆ°9 2 ï¼Œå†åˆå¹¶å¾—åˆ°11ï¼Œæ€»ä»£ä»·ä¸º4+9+11&#x3D;24ï¼›</p>
<p>å¦‚æœç¬¬äºŒæ­¥æ˜¯å…ˆåˆå¹¶2ï¼Œ3å †ï¼Œåˆ™ä»£ä»·ä¸º7ï¼Œå¾—åˆ°4 7ï¼Œæœ€åä¸€æ¬¡åˆå¹¶ä»£ä»·ä¸º11ï¼Œæ€»ä»£ä»·ä¸º4+7+11&#x3D;22ã€‚</p>
<p>é—®é¢˜æ˜¯ï¼šæ‰¾å‡ºä¸€ç§åˆç†çš„æ–¹æ³•ï¼Œä½¿æ€»çš„ä»£ä»·æœ€å°ï¼Œè¾“å‡ºæœ€å°ä»£ä»·ã€‚</p>
</blockquote>
<ul>
<li>æ±‚è§£æ€è·¯ï¼š</li>
</ul>
<p><strong>çŠ¶æ€è¡¨ç¤º</strong>ï¼š</p>
<p>f(i,j)ï¼šæ‰€æœ‰å°†ç¬¬iå †çŸ³å­~ç¬¬jå †çŸ³å­åˆå¹¶æˆä¸€å †çŸ³å­çš„åˆå¹¶æ–¹å¼çš„é›†åˆä¸­çš„Min</p>
<p><strong>çŠ¶æ€è®¡ç®—</strong>ï¼š</p>
<ol>
<li>çŠ¶æ€åˆ’åˆ†ï¼š</li>
</ol>
<p><img src="/image/Fig6_txs_Inikl4.png"></p>
<p>&amp;#x20;2.  çŠ¶æ€è½¬ç§»ï¼šf(i, j) &#x3D; Min( f(i, m) + f(m+1, j) + sum(j)-sum(i-1) ), m &#x3D; i,i+1,â€¦,j-1</p>
<p>è“å­—æ˜¯å‰ç¼€å’Œï¼Œç”¨äºè®¡ç®—å½“å‰ä¸¤å †çš„ä»£ä»·</p>
<p>æœ€ç»ˆçŠ¶æ€å°±æ˜¯f(1,n)</p>
<p>çŠ¶æ€è½¬ç§»çš„å›¾è§£ï¼š</p>
<p><img src="/image/Fig7_XQbN7O-acE.png"></p>
<ul>
<li>ä»£ç ï¼š</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">310</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;<span class="comment">//ä¸€å…±å¤šå°‘çŸ³å †</span></span><br><span class="line"><span class="type">int</span> s[N];<span class="comment">//æ¯å †çš„é‡é‡</span></span><br><span class="line"><span class="type">int</span> f[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ ) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;s[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ ) s[i] += s[i - <span class="number">1</span>];<span class="comment">//æ±‚å‰ç¼€å’Œ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> len = <span class="number">2</span>; len &lt;= n; len ++ )</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i + len - <span class="number">1</span> &lt;= n; i ++ )&#123;</span><br><span class="line">            <span class="type">int</span> l = i, r = i + len - <span class="number">1</span>;</span><br><span class="line">            f[l][r] = <span class="number">1e8</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = l; k &lt; r; k ++ )</span><br><span class="line">                f[l][r] = <span class="built_in">min</span>(f[l][r], f[l][k] + f[k + <span class="number">1</span>][r] + s[r] - s[l - <span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, f[<span class="number">1</span>][n]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="4-è®¡æ•°ç±»DP"><a href="#4-è®¡æ•°ç±»DP" class="headerlink" title="4 è®¡æ•°ç±»DP"></a>4 è®¡æ•°ç±»DP</h1><blockquote>
<p>å°†DPç®—æ³•åº”ç”¨åœ¨è®¡æ•°ç±»é—®é¢˜</p>
</blockquote>
<h2 id="4-1-ä¾‹é¢˜1ï¼šæ•´æ•°åˆ’åˆ†"><a href="#4-1-ä¾‹é¢˜1ï¼šæ•´æ•°åˆ’åˆ†" class="headerlink" title="4.1 ä¾‹é¢˜1ï¼šæ•´æ•°åˆ’åˆ†"></a>4.1 ä¾‹é¢˜1ï¼šæ•´æ•°åˆ’åˆ†</h2><blockquote>
<p>ğŸ“Œä¸€ä¸ªæ­£æ•´æ•°nå¯ä»¥è¡¨ç¤ºæˆè‹¥å¹²ä¸ªæ­£æ•´æ•°ä¹‹å’Œï¼Œå½¢å¦‚ï¼šn&#x3D;n1+n2+â€¦+nkï¼Œå…¶ä¸­n1â‰¥n2â‰¥â€¦â‰¥nk,kâ‰¥1ã€‚</p>
<p>æˆ‘ä»¬å°†è¿™æ ·çš„ä¸€ç§è¡¨ç¤ºç§°ä¸ºæ­£æ•´æ•°nçš„ä¸€ç§åˆ’åˆ†ã€‚</p>
<p>ç°åœ¨ç»™å®šä¸€ä¸ªæ­£æ•´æ•°nï¼Œè¯·ä½ æ±‚å‡ºnå…±æœ‰å¤šå°‘ç§ä¸åŒçš„åˆ’åˆ†æ–¹æ³•ã€‚<br>ç”±äºç­”æ¡ˆå¯èƒ½å¾ˆå¤§ï¼Œè¾“å‡ºç»“æœè¯·å¯¹109+7å–æ¨¡ã€‚</p>
</blockquote>
<ul>
<li><strong>æ€è·¯ä¸€ï¼šèƒŒåŒ…é—®é¢˜</strong></li>
</ul>
<p><strong>çŠ¶æ€è¡¨ç¤ºï¼š</strong></p>
<p>f(i, j)ï¼šä»1~iä¸­é€‰å–æ•°å€¼åï¼Œæ±‚å’Œæ­£å¥½æ˜¯jçš„é›†åˆä¸­çš„æ•°å€¼æ•°é‡</p>
<p><strong>çŠ¶æ€è®¡ç®—ï¼š</strong></p>
<p><img src="/image/Fig8_WIbazbZy8S.png"></p>
<p><strong>ä¼˜åŒ–ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å½“å‰çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼šf(i,j) = f(i-1,j) + f(i-1,j-i) + f(i-1,j-2*i)+...+f(i-1,j-s*i)</span><br><span class="line">               f(i,j-i)=           f(i-1,j-i) + f(i-1,j-2*i)+...+f(i-1,j-s*i)</span><br><span class="line">ä¼˜åŒ–åè½¬ç§»æ–¹ç¨‹ï¼š  f(i,j) = f(i-1,j) + f(i,j-i)</span><br><span class="line">ä¼˜åŒ–åˆ°ä¸€ç»´ï¼š     f(j) = f(j) + f(j-i)       </span><br></pre></td></tr></table></figure>

<p><strong>ä»£ç ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>, mod = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> f[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line"></span><br><span class="line">    f[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt;= n; j ++ )</span><br><span class="line">            f[j] = (f[j] + f[j - i]) % mod;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; f[n] &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>æ€è·¯äºŒï¼š</strong></li>
</ul>
<!---->

<pre><code>- çŠ¶æ€è¡¨ç¤ºï¼š
æ‰€æœ‰æ€»å’Œä¸ºiï¼Œå¹¶ä¸”æ°å¥½è¡¨ç¤ºæˆjä¸ªæ•°çš„å’Œçš„æ–¹æ¡ˆ
çš„é›†åˆä¸­çš„
æ•°å€¼æ•°é‡(ä¹Ÿå°±æ˜¯j)
</code></pre>
<!---->

<pre><code>- çŠ¶æ€è®¡ç®—ï¼š
f(i,j) = f(i-1,j-1) + f(i-j,j)
æ›²çº¿æ•‘å›½
f(i-1,j-1)æ˜¯f(i,j)ä¸­åŒ…å«æœ€å°å€¼1çš„æ–¹æ¡ˆ
f(i-j,j)æ˜¯f(i,j)ä¸­ä¸åŒ…å«æœ€å°å€¼1çš„æ–¹æ¡ˆ
                  (jä¸ªæ•°éƒ½å‡1)
</code></pre>
<p>æ³¨æ„ï¼šè¿™ç§æ€è·¯æœ€åç»“æœæ˜¯f(n,1)+f(n,2)+f(n,3)â€¦â€¦</p>
<p><strong>ä»£ç ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>, mod = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> f[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line"></span><br><span class="line">    f[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i ++ )</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= i; j ++ )</span><br><span class="line">            f[i][j] = (f[i - <span class="number">1</span>][j - <span class="number">1</span>] + f[i - j][j]) % mod;</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ ) res = (res + f[n][i]) % mod;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; res &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="5-æ•°ä½ç»Ÿè®¡DP"><a href="#5-æ•°ä½ç»Ÿè®¡DP" class="headerlink" title="5 æ•°ä½ç»Ÿè®¡DP"></a>5 æ•°ä½ç»Ÿè®¡DP</h1><blockquote>
<p>ç«èµ›ä¸­æœ‰è¿™æ ·ä¸€ç±»é—®é¢˜ï¼šæ±‚ç»™å®šåŒºé—´ä¸­ï¼Œæ»¡è¶³ç»™å®šæ¡ä»¶çš„æŸä¸ªDè¿›åˆ¶æ•°æˆ–æ­¤ç±»æ•°çš„æ•°é‡ã€‚æ‰€æ±‚çš„é™å®šæ¡ä»¶å¾€å¾€ä¸æ•°ä½æœ‰å…³ï¼Œä¾‹å¦‚æ•°ä½ä¹‹å’Œã€æŒ‡å®šæ•°ç ä¸ªæ•°ã€æ•°çš„å¤§å°é¡ºåºåˆ†ç»„ç­‰ç­‰ã€‚é¢˜ç›®ç»™å®šçš„åŒºé—´å¾€å¾€å¾ˆå¤§ï¼Œæ— æ³•é‡‡ç”¨æœ´ç´ çš„æ–¹æ³•æ±‚è§£ã€‚</p>
</blockquote>
<h1 id="6-çŠ¶æ€å‹ç¼©DP"><a href="#6-çŠ¶æ€å‹ç¼©DP" class="headerlink" title="6 çŠ¶æ€å‹ç¼©DP"></a>6 çŠ¶æ€å‹ç¼©DP</h1><blockquote>
<p>å°†çŠ¶æ€è¡¨ç¤ºæˆäºŒè¿›åˆ¶æ•°ï¼Œæ¯ä¸€ä½éƒ½ä¸çŠ¶æ€ä¸€ä¸€å¯¹åº”</p>
</blockquote>
<h2 id="6-1-ä¾‹é¢˜1ï¼šè’™å¾·é‡Œå®‰çš„æ¢¦æƒ³"><a href="#6-1-ä¾‹é¢˜1ï¼šè’™å¾·é‡Œå®‰çš„æ¢¦æƒ³" class="headerlink" title="6.1 ä¾‹é¢˜1ï¼šè’™å¾·é‡Œå®‰çš„æ¢¦æƒ³"></a>6.1 ä¾‹é¢˜1ï¼šè’™å¾·é‡Œå®‰çš„æ¢¦æƒ³</h2><blockquote>
<p>ğŸ“Œæ±‚æŠŠN*Mçš„æ£‹ç›˜åˆ†å‰²æˆè‹¥å¹²ä¸ª1*2çš„çš„é•¿æ–¹å½¢ï¼Œæœ‰å¤šå°‘ç§æ–¹æ¡ˆã€‚<br>ä¾‹å¦‚å½“N&#x3D;2ï¼ŒM&#x3D;4æ—¶ï¼Œå…±æœ‰5ç§æ–¹æ¡ˆã€‚<br>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
</blockquote>
<p><img src="/image/Fig9_6Qdw3BuZTK.png"></p>
<ul>
<li><p><strong>æ€è·¯ï¼š</strong></p>
<p><img src="/image/Fig10_UIwbppcb7E.png"></p>
</li>
</ul>
<p>ä¸¾ä¾‹è¯´æ˜ï¼Œä¸€æ—¦æŸä¸€ä¸ªæ–¹æ¡ˆæ‰€æœ‰æ¨ªå‘1*2çš„é•¿æ–¹å½¢æ”¾å®Œäº†ï¼Œé‚£ä¹ˆè¯¥æ–¹æ¡ˆçš„æ‰€æœ‰çºµå‘2*1ä¹Ÿå°±åªèƒ½å¡«å……ï¼Œæ— æ³•å†åšæ”¹å˜ã€‚æ‰€ä»¥åªéœ€è¦æ’åˆ—æ¨ªå‘1*2é•¿æ–¹å½¢å³å¯ï¼Œè€Œé€šè¿‡åˆ—æ¥æ£€æŸ¥æ’åˆ—æ˜¯å¦å¯è¡Œï¼š</p>
<ol>
<li><p>æ’å®Œæ¨ªå‘åï¼Œç¬¬iåˆ—ä¸å¯ä»¥æœ‰è¿ç»­å¥‡æ•°ä¸ªç©ºæ ¼</p>
</li>
<li><p>ä»ç¬¬i-2åˆ°ç¬¬i-1åˆ—çš„æ¨ªå‘é•¿æ–¹å½¢å’Œä»ç¬¬i-1åˆ—åˆ°ç¬¬iåˆ—çš„æ¨ªå‘é•¿æ–¹å½¢ä¸èƒ½æœ‰é‡åˆ</p>
</li>
</ol>
<ul>
<li><strong>çŠ¶æ€è¡¨ç¤ºï¼š</strong></li>
</ul>
<p>f(i, j)ï¼šiè¡¨ç¤ºç›®å‰æ’åˆ°ç¬¬iåˆ—ï¼Œjè¡¨ç¤ºä»ç¬¬i-1åˆ—ä¼¸è¿‡æ¥çš„æ¨ªå‘é•¿æ–¹å½¢çš„çŠ¶æ€</p>
<p>&amp;#x20;     f(i, j)è¡¨ç¤ºæ’åˆ°ç¬¬iåˆ—çš„(æ»¡è¶³çº¦æŸçš„)æ–¹æ¡ˆçš„ä¸ªæ•°</p>
<p>ä¸¾ä¾‹æ¥è¯´ï¼Œä¸Šå›¾ä¸­ï¼Œç›®å‰ç¬¬iåˆ—çš„ j1 &#x3D; 0010(äºŒè¿›åˆ¶)</p>
<p>ç›®å‰ç¬¬i-1åˆ—çš„ j2 &#x3D; 1001(äºŒè¿›åˆ¶)</p>
<p>ä¸€å…±æœ‰måˆ—ï¼Œä»0åˆ°m-1</p>
<p>é‚£ä¹ˆä¸Šè¿°ä¸¤ä¸ªçº¦æŸæ¡ä»¶å˜æˆäº†ï¼š</p>
<ol>
<li><p>(j1&amp;j2) å¿…é¡»ç­‰äº0</p>
</li>
<li><p>j1ä¸­ä¸å¯ä»¥æœ‰è¿ç»­å¥‡æ•°ä¸ª0</p>
</li>
</ol>
<ul>
<li><strong>çŠ¶æ€è®¡ç®—ï¼š</strong></li>
</ul>
<p>f(i, j) &#x3D; f(i-1, k1) + f(i-1, k2)+ â€¦â€¦.</p>
<p>å…¶ä¸­k1,k2â€¦â€¦æ˜¯æ’åˆ°ç¬¬i-1åˆ—æ—¶æ»¡è¶³çº¦æŸçš„æ–¹æ¡ˆçš„ j</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*------æœ€ç»ˆç»“æœæ˜¯f(m,0)ï¼Œä¹Ÿå°±æ˜¯ç¬¬måˆ—ï¼Œæ²¡æœ‰æ…å‡ºæ¥çš„æ¨ªæ ¼æ—¶çš„æ‰€æœ‰æ–¹æ¡ˆ-------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">12</span>, M = <span class="number">1</span> &lt;&lt; N;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> f[N][M];</span><br><span class="line"><span class="type">bool</span> st[M];<span class="comment">//æ ‡å¿—ç¬¬iåˆ—çš„jæ˜¯å¦å¯è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//é€—å·è¿ç®—ç¬¦åˆ†éš”ä¸¤ä¸ªè¡¨è¾¾å¼ï¼Œä½†æ˜¯æœ€ç»ˆç»“æœæ˜¯åä¸€ä¸ªè¡¨è¾¾å¼çš„ç»“æœ</span></span><br><span class="line">    <span class="keyword">while</span> (cin &gt;&gt; n &gt;&gt; m, n || m)<span class="comment">//å½“næˆ–mæœ‰ä¸€ä¸ªæ•°ä¸º0æ„å‘³ç€ç»ˆæ­¢æµ‹è¯•</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//åšçº¦æŸæ¡ä»¶2çš„æ£€æŸ¥ï¼Œæ£€æŸ¥ä¸€ä¸‹ï¼Œä¸€åˆ—çš„æ‰€æœ‰æ¨ªå‘æ’æ³•ä¸­ï¼Œæœ‰å“ªäº›æ’æ³•ä¼šæœ‰è¿ç»­å¥‡æ•°ä¸ª0ï¼Œç”¨stè®°å½•</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1</span> &lt;&lt; n; i ++ )<span class="comment">//æœ‰nè¡Œï¼Œjå°±æœ‰nä½</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">            st[i] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j ++ )</span><br><span class="line">                <span class="keyword">if</span> (i &gt;&gt; j &amp; <span class="number">1</span>)<span class="comment">//å…ˆå³ç§»å†ä¸ï¼Œåˆ¤æ–­ç¬¬jä½æ˜¯ä¸æ˜¯1</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (cnt &amp; <span class="number">1</span>) st[i] = <span class="literal">false</span>;</span><br><span class="line">                    cnt = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> cnt ++ ;</span><br><span class="line">            <span class="keyword">if</span> (cnt &amp; <span class="number">1</span>) st[i] = <span class="literal">false</span>;<span class="comment">//cntç”¨æ¥è®°å½•è¿ç»­0çš„ä¸ªæ•°ï¼Œå¦‚æœæ˜¯å¥‡æ•°ä¸ªåˆ™æ­¤æ–¹æ¡ˆä¸å¯è¡Œ</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">memset</span>(f, <span class="number">0</span>, <span class="keyword">sizeof</span> f);</span><br><span class="line">        f[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;<span class="comment">//å•¥éƒ½æ²¡æ”¾æ˜¯ä¸€ç§åˆæ³•çš„åˆå§‹çŠ¶æ€ï¼Œæ–¹æ¡ˆæ•°ä¸º1</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i ++ )</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">1</span> &lt;&lt; n; j ++ )</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; <span class="number">1</span> &lt;&lt; n; k ++ )</span><br><span class="line">                    <span class="comment">//st[j | k]è€Œä¸æ˜¯st[j]&amp;st[k],ä¸ºä»€ä¹ˆï¼Ÿ</span></span><br><span class="line">                    <span class="keyword">if</span> ((j &amp; k) == <span class="number">0</span> &amp;&amp; st[j | k])<span class="comment">//åˆ¤æ–­ä¸¤ä¸ªçº¦æŸ</span></span><br><span class="line">                        f[i][j] += f[i - <span class="number">1</span>][k];</span><br><span class="line">        cout &lt;&lt; f[m][<span class="number">0</span>] &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-2-ä¾‹é¢˜2ï¼šæœ€çŸ­Hamiltonè·¯å¾„"><a href="#6-2-ä¾‹é¢˜2ï¼šæœ€çŸ­Hamiltonè·¯å¾„" class="headerlink" title="6.2 ä¾‹é¢˜2ï¼šæœ€çŸ­Hamiltonè·¯å¾„"></a>6.2 ä¾‹é¢˜2ï¼šæœ€çŸ­Hamiltonè·¯å¾„</h2><blockquote>
<p>ğŸ“Œç»™å®šä¸€å¼  n ä¸ªç‚¹çš„å¸¦æƒæ— å‘å›¾ï¼Œç‚¹ä» 0~n-1 æ ‡å·ï¼Œæ±‚èµ·ç‚¹ 0 åˆ°ç»ˆç‚¹ n-1 çš„æœ€çŸ­Hamiltonè·¯å¾„ã€‚ Hamiltonè·¯å¾„çš„å®šä¹‰æ˜¯ä» 0 åˆ° n-1 ä¸é‡ä¸æ¼åœ°ç»è¿‡æ¯ä¸ªç‚¹æ°å¥½ä¸€æ¬¡ã€‚<br>(æ­¤é—®é¢˜å°±æ˜¯å¤§åé¼é¼çš„æ—…è¡Œå•†é—®é¢˜)</p>
<p><strong>è¾“å…¥æ ¼å¼</strong><br>ç¬¬ä¸€è¡Œè¾“å…¥æ•´æ•°nã€‚<br>æ¥ä¸‹æ¥nè¡Œæ¯è¡Œnä¸ªæ•´æ•°ï¼Œå…¶ä¸­ç¬¬iè¡Œç¬¬jä¸ªæ•´æ•°è¡¨ç¤ºç‚¹iåˆ°jçš„è·ç¦»ï¼ˆè®°ä¸ºa[i,j]ï¼‰ã€‚<br>å¯¹äºä»»æ„çš„x,y,zï¼Œæ•°æ®ä¿è¯ a[x,x]&#x3D;0ï¼Œa[x,y]&#x3D;a[y,x] å¹¶ä¸” a[x,y]+a[y,z]&gt;&#x3D;a[x,z]ã€‚</p>
<p><strong>è¾“å‡ºæ ¼å¼</strong><br>è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€çŸ­Hamiltonè·¯å¾„çš„é•¿åº¦ã€‚</p>
</blockquote>
<ul>
<li><strong>æ€è·¯ï¼š</strong></li>
</ul>
<p><strong>çŠ¶æ€è¡¨ç¤º</strong>ï¼šf(i, j)è¡¨ç¤ºä¸ºä»0èµ°åˆ° jçš„æ‰€æœ‰è·¯å¾„æ˜¯ içš„åŠ æƒå’Œé›†åˆçš„Min</p>
<p>æ¯”å¦‚i &#x3D; 110001 è¡¨ç¤ºä¸ºä»0åˆ° jï¼Œèµ°äº†ç‚¹1ã€5ã€6ï¼Œæ²¡èµ°2ã€3ã€4</p>
<p><strong>çŠ¶æ€è®¡ç®—</strong>ï¼š</p>
<p>é€šè¿‡çœ‹èµ°åˆ° jä¹‹å‰çš„å€’æ•°ç¬¬äºŒä¸ªç‚¹æ¥åšçŠ¶æ€è½¬ç§»</p>
<p>å¦‚æœå€’æ•°ç¬¬äºŒä¸ªç‚¹æ˜¯kï¼Œåˆ™ f(i, j) &#x3D; f(i-{j}, k) + a[k, j]</p>
<p>æ‰€ä»¥ä¹Ÿå°±æ˜¯f(i, j) &#x3D; min( f(i-{j}, k) + a[k, j] )ï¼Œkæ˜¯æ‰€æœ‰ä»0åˆ° jæ‰€ç»è¿‡çš„å€’æ•°ç¬¬äºŒä¸ªç‚¹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">20</span>, M = <span class="number">1</span> &lt;&lt; N;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> w[N][N];</span><br><span class="line"><span class="type">int</span> f[M][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ )</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j ++ )</span><br><span class="line">            cin &gt;&gt; w[i][j];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memset</span>(f, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> f);</span><br><span class="line">    f[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1</span> &lt;&lt; n; i ++ )</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j ++ )</span><br><span class="line">            <span class="keyword">if</span> (i &gt;&gt; j &amp; <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; n; k ++ )</span><br><span class="line">                    <span class="keyword">if</span> (i &gt;&gt; k &amp; <span class="number">1</span>)</span><br><span class="line">                        f[i][j] = <span class="built_in">min</span>(f[i][j], f[i - (<span class="number">1</span> &lt;&lt; j)][k] + w[k][j]);</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; f[(<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span>][n - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="7-æ ‘å½¢DP"><a href="#7-æ ‘å½¢DP" class="headerlink" title="7 æ ‘å½¢DP"></a>7 æ ‘å½¢DP</h1><blockquote>
<p>ä¸€èˆ¬æ¥è¯´æ ‘å½¢dpåœ¨è®¾çŠ¶æ€è½¬ç§»æ–¹ç¨‹æ—¶éƒ½å¯ä»¥ç”¨f[i][]è¡¨ç¤ºiè¿™é¢—å­æ ‘æ€ä¹ˆæ€ä¹ˆæ ·çš„æœ€ä¼˜è§£ï¼Œå®ç°æ—¶ä¸€èˆ¬éƒ½æ˜¯ç”¨å­æ ‘æ›´æ–°çˆ¶äº²ï¼ˆå³ä»ä¸‹å‘ä¸Šæ›´æ–°ï¼‰</p>
</blockquote>
<h2 id="7-1-ä¾‹é¢˜1ï¼šæ²¡æœ‰ä¸Šå¸çš„èˆä¼š"><a href="#7-1-ä¾‹é¢˜1ï¼šæ²¡æœ‰ä¸Šå¸çš„èˆä¼š" class="headerlink" title="7.1 ä¾‹é¢˜1ï¼šæ²¡æœ‰ä¸Šå¸çš„èˆä¼š"></a>7.1 ä¾‹é¢˜1ï¼šæ²¡æœ‰ä¸Šå¸çš„èˆä¼š</h2><blockquote>
<p>ğŸ“Œ(æ ‘å½¢DPæœ€ç»å…¸é—®é¢˜)<br>Uralå¤§å­¦æœ‰NåèŒå‘˜ï¼Œç¼–å·ä¸º1~Nã€‚<br>ä»–ä»¬çš„å…³ç³»å°±åƒä¸€æ£µä»¥æ ¡é•¿ä¸ºæ ¹çš„æ ‘ï¼Œçˆ¶èŠ‚ç‚¹å°±æ˜¯å­èŠ‚ç‚¹çš„ç›´æ¥ä¸Šå¸ã€‚<br>æ¯ä¸ªèŒå‘˜æœ‰ä¸€ä¸ªå¿«ä¹æŒ‡æ•°ï¼Œç”¨æ•´æ•° Hi ç»™å‡ºï¼Œå…¶ä¸­ 1â‰¤iâ‰¤Nã€‚<br>ç°åœ¨è¦å¬å¼€ä¸€åœºå‘¨å¹´åº†å®´ä¼šï¼Œä¸è¿‡ï¼Œæ²¡æœ‰èŒå‘˜æ„¿æ„å’Œç›´æ¥ä¸Šå¸ä¸€èµ·å‚ä¼šã€‚<br>åœ¨æ»¡è¶³è¿™ä¸ªæ¡ä»¶çš„å‰æä¸‹ï¼Œä¸»åŠæ–¹å¸Œæœ›é‚€è¯·ä¸€éƒ¨åˆ†èŒå‘˜å‚ä¼šï¼Œä½¿å¾—æ‰€æœ‰å‚ä¼šèŒå‘˜çš„å¿«ä¹æŒ‡æ•°æ€»å’Œæœ€å¤§ï¼Œæ±‚è¿™ä¸ªæœ€å¤§å€¼ã€‚</p>
<p><strong>è¾“å…¥æ ¼å¼</strong><br>ç¬¬ä¸€è¡Œä¸€ä¸ªæ•´æ•°Nã€‚<br>æ¥ä¸‹æ¥Nè¡Œï¼Œç¬¬ i è¡Œè¡¨ç¤º i å·èŒå‘˜çš„å¿«ä¹æŒ‡æ•°Hiã€‚<br>æ¥ä¸‹æ¥N-1è¡Œï¼Œæ¯è¡Œè¾“å…¥ä¸€å¯¹æ•´æ•°L, K,è¡¨ç¤ºKæ˜¯Lçš„ç›´æ¥ä¸Šå¸ã€‚</p>
<p><strong>è¾“å‡ºæ ¼å¼</strong><br>è¾“å‡ºæœ€å¤§çš„å¿«ä¹æŒ‡æ•°ã€‚</p>
</blockquote>
<ul>
<li>æ€è·¯ï¼š</li>
</ul>
<p><strong>çŠ¶æ€è¡¨ç¤º</strong>ï¼š</p>
<p>æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸¤ç§çŠ¶æ€ï¼š</p>
<p>f(u, 0)ï¼šä»¥uä¸ºæ ¹èŠ‚ç‚¹ï¼Œä½†æ˜¯ä¸é€‰æ‹©uçš„æ‰€æœ‰æ–¹æ¡ˆçš„é›†åˆä¸­çš„æœ€å¤§å¿«ä¹æŒ‡æ•°</p>
<p>f(u, 1)ï¼šä»¥uä¸ºæ ¹èŠ‚ç‚¹ï¼ŒåŒæ—¶é€‰æ‹©uçš„æ‰€æœ‰æ–¹æ¡ˆçš„é›†åˆä¸­çš„æœ€å¤§å¿«ä¹æŒ‡æ•°</p>
<p><strong>çŠ¶æ€è®¡ç®—</strong>ï¼š</p>
<p><img src="/image/Fig11_KKKIaBvA7b.png"></p>
<p>å¯¹äºf(u, 0)ï¼šç”±äºuæœªè¢«é€‰æ‹©ï¼Œæ‰€ä»¥uçš„å­èŠ‚ç‚¹å¯æœ‰å¯æ— ï¼Œå³å¯¹äºæ¯ä¸ªuçš„å­èŠ‚ç‚¹Siï¼Œf(Si, 0)å’Œf(Si, 1)éƒ½å¯ä»¥é€‰æ‹©ï¼Œå–å…¶ä¸­æœ‰æœ€å¤§å¿«ä¹æŒ‡æ•°çš„æ–¹æ¡ˆã€‚</p>
<p>å¯¹äºf(u, 1)ï¼šç”±äºuå·²é€‰ï¼Œuçš„å­èŠ‚ç‚¹ä¸èƒ½å†é€‰ï¼Œæ‰€ä»¥å¯¹äºæ¯ä¸ªuçš„å­èŠ‚ç‚¹Siï¼Œåªèƒ½æœ‰ f(Si, 0)ã€‚</p>
<ol>
<li><p>f(u, 0) &#x3D; $\sum_i{max(f(Si,0),f(S_i,1))}$</p>
</li>
<li><p>f(u, 1) &#x3D; $\sum_i{f(S_i,0)}+A[u]$</p>
</li>
</ol>
<p><strong>ä»£ç </strong>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">6010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> h[N], e[N], ne[N], idx;<span class="comment">//é‚»æ¥è¡¨</span></span><br><span class="line"><span class="type">int</span> happy[N];</span><br><span class="line"><span class="type">int</span> f[N][<span class="number">2</span>];</span><br><span class="line"><span class="type">bool</span> has_fa[N];<span class="comment">//åˆ¤æ–­å„ä¸ªèŠ‚ç‚¹æ˜¯å¦æœ‰çˆ¶èŠ‚ç‚¹ï¼Œæ²¡æœ‰çˆ¶èŠ‚ç‚¹çš„èŠ‚ç‚¹å°±æ˜¯æ ¹èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span><span class="comment">//é‚»æ¥è¡¨ä¸­æ’å…¥ä¸€æ¡è¾¹ï¼Œæ¨¡æ¿</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    e[idx] = b, ne[idx] = h[a], h[a] = idx ++ ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    f[u][<span class="number">1</span>] = happy[u];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = h[u]; ~i; i = ne[i])<span class="comment">//~iå³ä¸ºåˆ¤æ–­ i!=-1ï¼ŒæŒ‰ä½å–åï¼Œæ¨¡æ¿</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="built_in">dfs</span>(j);</span><br><span class="line"></span><br><span class="line">        f[u][<span class="number">1</span>] += f[j][<span class="number">0</span>];</span><br><span class="line">        f[u][<span class="number">0</span>] += <span class="built_in">max</span>(f[j][<span class="number">0</span>], f[j][<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ ) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;happy[i]);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memset</span>(h, <span class="number">-1</span>, <span class="keyword">sizeof</span> h);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n - <span class="number">1</span>; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> a, b;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;a, &amp;b);</span><br><span class="line">        <span class="built_in">add</span>(b, a);</span><br><span class="line">        has_fa[a] = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> root = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (has_fa[root]) root ++ ;<span class="comment">//æ‰¾åˆ°æ ¹èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">dfs</span>(root);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">max</span>(f[root][<span class="number">0</span>], f[root][<span class="number">1</span>]));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="8-è®°å¿†åŒ–æœç´¢"><a href="#8-è®°å¿†åŒ–æœç´¢" class="headerlink" title="8 è®°å¿†åŒ–æœç´¢"></a>8 è®°å¿†åŒ–æœç´¢</h1><blockquote>
<p>è®°å¿†åŒ–æœç´¢  &#x3D; æœç´¢çš„å½¢å¼ + åŠ¨æ€è§„åˆ’çš„æ€æƒ³<br>æœç´¢ï¼šåŠ¨æ€è§„åˆ’æ•°ç»„è®°å½•ä¸Šä¸€å±‚è®¡ç®—ç»“æœï¼Œå½“è¦ä½¿ç”¨æ—¶ç›´æ¥ä»æ•°ç»„ä¸­è·å–<br>é¿å…è¿‡å¤šçš„é‡å¤è®¡ç®—ï¼Œå¾€å¾€å…·æœ‰è¾ƒä½çš„ç©ºé—´å¤æ‚åº¦</p>
</blockquote>
<h2 id="8-1-ä¾‹é¢˜1ï¼šæ»‘é›ª"><a href="#8-1-ä¾‹é¢˜1ï¼šæ»‘é›ª" class="headerlink" title="8.1 ä¾‹é¢˜1ï¼šæ»‘é›ª"></a>8.1 ä¾‹é¢˜1ï¼šæ»‘é›ª</h2><blockquote>
<p>ğŸ“Œç»™å®šä¸€ä¸ªRè¡ŒCåˆ—çš„çŸ©é˜µï¼Œè¡¨ç¤ºä¸€ä¸ªçŸ©å½¢ç½‘æ ¼æ»‘é›ªåœºã€‚<br>çŸ©é˜µä¸­ç¬¬ i è¡Œç¬¬ j åˆ—çš„ç‚¹è¡¨ç¤ºæ»‘é›ªåœºçš„ç¬¬ i è¡Œç¬¬ j åˆ—åŒºåŸŸçš„é«˜åº¦ã€‚<br>ä¸€ä¸ªäººä»æ»‘é›ªåœºä¸­çš„æŸä¸ªåŒºåŸŸå†…å‡ºå‘ï¼Œæ¯æ¬¡å¯ä»¥å‘ä¸Šä¸‹å·¦å³ä»»æ„ä¸€ä¸ªæ–¹å‘æ»‘åŠ¨ä¸€ä¸ªå•ä½è·ç¦»ã€‚<br>å½“ç„¶ï¼Œä¸€ä¸ªäººèƒ½å¤Ÿæ»‘åŠ¨åˆ°æŸç›¸é‚»åŒºåŸŸçš„å‰ææ˜¯è¯¥åŒºåŸŸçš„é«˜åº¦ä½äºè‡ªå·±ç›®å‰æ‰€åœ¨åŒºåŸŸçš„é«˜åº¦ã€‚<br>ä¸‹é¢ç»™å‡ºä¸€ä¸ªçŸ©é˜µä½œä¸ºä¾‹å­ï¼š<br>&amp;#x20;1   2   3   4  5<br>16 17 18 19 6<br>15 24 25 20 7<br>14 23 22 21 8<br>13 12 11 10 9<br>åœ¨ç»™å®šçŸ©é˜µä¸­ï¼Œä¸€æ¡å¯è¡Œçš„æ»‘è¡Œè½¨è¿¹ä¸º24-17-2-1ã€‚<br>åœ¨ç»™å®šçŸ©é˜µä¸­ï¼Œæœ€é•¿çš„æ»‘è¡Œè½¨è¿¹ä¸º25-24-23-â€¦-3-2-1ï¼Œæ²¿é€”å…±ç»è¿‡25ä¸ªåŒºåŸŸã€‚<br>ç°åœ¨ç»™å®šä½ ä¸€ä¸ªäºŒç»´çŸ©é˜µè¡¨ç¤ºæ»‘é›ªåœºå„åŒºåŸŸçš„é«˜åº¦ï¼Œè¯·ä½ æ‰¾å‡ºåœ¨è¯¥æ»‘é›ªåœºä¸­èƒ½å¤Ÿå®Œæˆçš„æœ€é•¿æ»‘é›ªè½¨è¿¹ï¼Œå¹¶è¾“å‡ºå…¶é•¿åº¦(å¯ç»è¿‡æœ€å¤§åŒºåŸŸæ•°)ã€‚</p>
</blockquote>
<ul>
<li>æ€è·¯ï¼š<strong>é€’å½’</strong></li>
</ul>
<p><strong>çŠ¶æ€è¡¨ç¤º</strong>ï¼š</p>
<p>f(i, j)ï¼šä»¥ç¬¬iè¡Œç¬¬jåˆ—ä¸ºèµ·ç‚¹çš„æ‰€æœ‰è½¨è¿¹çš„é›†åˆä¸­çš„æœ€å¤§é•¿åº¦</p>
<p><strong>çŠ¶æ€è®¡ç®—</strong>ï¼š</p>
<p><img src="/image/Fig12_RDU4u9SWDq.png"></p>
<p>f(i, j)å³ä¸ºè¿™å››ç§çŠ¶æ€åœ¨ä¸å‡ºç•Œä¸”ä¸¥æ ¼ä½äº(i, j)ä½ç½®çš„é«˜åº¦æ—¶ï¼Œå–maxçš„ç»“æœ</p>
<p>ç”±äºçŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸­ï¼Œä¸­å¿ƒåŒºåŸŸçš„çŠ¶æ€ä¾æ‰˜äºå¤–åœˆçš„çŠ¶æ€ï¼Œç›´è‡³è¾¹ç¼˜ï¼Œæ‰€ä»¥å¯ç”¨é€’å½’çš„å½¢å¼æ¥å†™ã€‚</p>
<p><strong>ä»£ç </strong>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">310</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> g[N][N];<span class="comment">//çŸ©é˜µ</span></span><br><span class="line"><span class="type">int</span> f[N][N];<span class="comment">//çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> dx[<span class="number">4</span>] = &#123;<span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>&#125;, dy[<span class="number">4</span>] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>&#125;;<span class="comment">//ä¸Šä¸‹å·¦å³</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dp</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> &amp;v = f[x][y];                       <span class="comment">//åœ¨è¿”å›å€¼çš„åŒæ—¶ï¼Œæ›´æ–°fæ•°ç»„</span></span><br><span class="line">    <span class="keyword">if</span> (v != <span class="number">-1</span>) <span class="keyword">return</span> v;                  <span class="comment">//å¦‚æœç®—è¿‡äº†ï¼Œç›´æ¥è¿”å›å€¼</span></span><br><span class="line"></span><br><span class="line">    v = <span class="number">1</span>;                                  <span class="comment">//åˆå§‹åŒ–ï¼Œæœ€å·®æƒ…å†µæ˜¯åªèµ°äº†è‡ªå·±æœ¬èº«è¿™ä¸€æ­¥</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> a = x + dx[i], b = y + dy[i];</span><br><span class="line">        <span class="keyword">if</span> (a &gt;= <span class="number">1</span> &amp;&amp; a &lt;= n &amp;&amp; b &gt;= <span class="number">1</span> &amp;&amp; b &lt;= m &amp;&amp; g[x][y] &gt; g[a][b])</span><br><span class="line">            v = <span class="built_in">max</span>(v, <span class="built_in">dp</span>(a, b) + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);                  <span class="comment">//nè¡Œmåˆ—</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j ++ )</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;g[i][j]);          <span class="comment">//è·å–çŸ©é˜µ</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">memset</span>(f, <span class="number">-1</span>, <span class="keyword">sizeof</span> f);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j ++ )</span><br><span class="line">            res = <span class="built_in">max</span>(res, <span class="built_in">dp</span>(i, j));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, res);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>Goè¯­è¨€åŸºç¡€</title>
    <url>/2019/12/21/Golang/Golang/</url>
    <content><![CDATA[<h1 id="Golang"><a href="#Golang" class="headerlink" title="Golang"></a>Golang</h1><h1 id="åŸºç¡€è¯­æ³•"><a href="#åŸºç¡€è¯­æ³•" class="headerlink" title="åŸºç¡€è¯­æ³•"></a>åŸºç¡€è¯­æ³•</h1><h2 id="1-Workspace"><a href="#1-Workspace" class="headerlink" title="1. Workspace"></a>1. Workspace</h2><ul>
<li><p>go(workspace)</p>
<p>-bin        å­˜æ”¾äºŒè¿›åˆ¶</p>
<p>-src         å­˜æ”¾æºæ–‡ä»¶</p>
<p><a href="http://github.com/" title="github.com">github.com</a></p>
<p>username</p>
<p>go_project_1</p>
<p>file_1</p>
<p>â€¦â€¦</p>
<p>go_project_2</p>
<p>file_1</p>
<p>â€¦â€¦</p>
<p>-pkg       å­˜æ”¾å®‰è£…çš„åŒ…</p>
</li>
<li><p>å»ºç«‹goè¯­è¨€çš„workspaceå‰ææ˜¯å°†GOPATHè®¾ç½®æˆäº†ç¯å¢ƒå˜é‡ï¼Œå¯ç”¨go envæŸ¥çœ‹GOPATH</p>
</li>
<li><p>goè¯­è¨€çš„å·¥ç¨‹ç»“æ„æ¯”è¾ƒä¸¥æ ¼ï¼Œå‚è§ä¸Šé¢çš„æ–‡ä»¶æ ‘</p>
</li>
<li><p>å¯é€šè¿‡<a href="http://godoc.org/" title="godoc.org">godoc.org</a>æŸ¥çœ‹å¯å®‰è£…åŒ…ï¼Œåˆ©ç”¨go getå®‰è£…</p>
</li>
</ul>
<h2 id="2-Hello-World"><a href="#2-Hello-World" class="headerlink" title="2. Hello World !"></a>2. Hello World !</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;Hello World!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–‡ä»¶ç»“æ„ï¼šåŒ…å£°æ˜ â†’ å¯¼å…¥åŒ… â†’ å‡½æ•°</p>
<ul>
<li><p>åŒ…å£°æ˜ï¼šæŒ‡æ˜æ–‡ä»¶å±äºå“ªä¸ªåŒ…ï¼Œpackage mainæ‰§è¡Œå…¥å£ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½æœ‰package main</p>
</li>
<li><p>å¯¼å…¥åŒ…éœ€åŒå¼•å·ï¼Œå•å¼•å·ä¼šæŠ¥é”™</p>
</li>
<li><p>æ— éœ€åˆ†å·</p>
</li>
</ul>
<h2 id="3-å˜é‡ä¸æ•°æ®ç±»å‹"><a href="#3-å˜é‡ä¸æ•°æ®ç±»å‹" class="headerlink" title="3. å˜é‡ä¸æ•°æ®ç±»å‹"></a>3. å˜é‡ä¸æ•°æ®ç±»å‹</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="comment">//MAIN TYPES</span></span><br><span class="line">  <span class="comment">//string</span></span><br><span class="line">  <span class="comment">//bool</span></span><br><span class="line">  <span class="comment">//int(å¯¹åº”CPUå¹³å°å­—é•¿) int8 int16 int32 int64</span></span><br><span class="line">  <span class="comment">//uint(å¯¹åº”CPUå¹³å°å­—é•¿) uint8 uint16 uint32 uint64 uintptr</span></span><br><span class="line">  <span class="comment">//byte - alias for uint8</span></span><br><span class="line">  <span class="comment">//rune - alias for int32</span></span><br><span class="line">  <span class="comment">//float32 float64</span></span><br><span class="line">  <span class="comment">//complex64 complex128</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/*---------å®šä¹‰å˜é‡ ç¬¬ä¸€ç§æ–¹æ³•ï¼švarå…³é”®å­—---------*/</span></span><br><span class="line">  <span class="comment">/*æ ¼å¼ï¼švar + å˜é‡å + æ•°æ®ç±»å‹ = èµ‹å€¼*/</span></span><br><span class="line">  <span class="keyword">var</span> name_1 <span class="type">string</span> = <span class="string">&quot;oliver&quot;</span><span class="comment">//è¿™é‡Œçš„stringå¯çœç•¥ï¼Œç¼–è¯‘å™¨å¯æ¨æ–­å‡ºå®ƒæ˜¯stringç±»å‹</span></span><br><span class="line">  <span class="keyword">var</span> age = <span class="number">32</span><span class="comment">//ç¼–è¯‘å™¨æ¨æ–­å‡ºæ˜¯intç±»å‹</span></span><br><span class="line">  name_1 = <span class="string">&quot;Peter&quot;</span><span class="comment">//ä½¿ç”¨varå…³é”®å­—å®šä¹‰åå¯ä¿®æ”¹å˜é‡å€¼</span></span><br><span class="line">  <span class="comment">/*ä½¿ç”¨constå…³é”®å­—*/</span></span><br><span class="line">  <span class="keyword">const</span> isCool = <span class="literal">true</span><span class="comment">//çœç•¥bool</span></span><br><span class="line">  <span class="comment">//isCool = false ä¸æ³¨é‡Šä¼šæŠ¥é”™</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/*---------å®šä¹‰å˜é‡ ç¬¬äºŒç§æ–¹æ³•ï¼šå†’å·---------*/</span></span><br><span class="line">  <span class="comment">/*æ ¼å¼ï¼šå˜é‡å := èµ‹å€¼*/</span></span><br><span class="line">  name_2 := <span class="string">&quot;Pai&quot;</span></span><br><span class="line">  <span class="comment">/*å¤šå˜é‡å®šä¹‰çš„ç®€ä¾¿å†™æ³•*/</span></span><br><span class="line">  name_3,email := <span class="string">&quot;oliverPai&quot;</span>,<span class="string">&quot;oliver@gmail.com&quot;</span></span><br><span class="line"></span><br><span class="line">  fmt.Println(name_1,name_2,name_3,age,isCool,email)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>goè¯­è¨€ä¸­ï¼Œå˜é‡å£°æ˜ä¸ä½¿ç”¨ä¼šæŠ¥é”™</p>
</li>
<li><p>è·å–ç±»å‹æ–¹æ³•ï¼šfmt.Printf(â€œ%Tâ€,variables)</p>
</li>
<li><p>ç¬¬ä¸€ç§æ–¹æ³•å¯ä»¥åœ¨å‡½æ•°å¤–å£°æ˜å˜é‡ï¼Œç¬¬äºŒç§æ–¹æ³•åªèƒ½ç”¨äºå‡½æ•°å†…ï¼Œä¸”æ— æ³•æŒ‡å®šç±»å‹</p>
</li>
<li><p>goè¯­è¨€ä¸­æ²¡æœ‰ä¸“é—¨çš„å­—ç¬¦ç±»å‹ï¼Œå­—ç¬¦ä¸²ç”±ä¸€ä¸ªä¸ªå­—èŠ‚æ„æˆ</p>
</li>
<li><p>æ³¨æ„ï¼Œgoè¯­è¨€ä¸æ”¯æŒéšå¼åšintå’Œboolç±»å‹é—´çš„è½¬æ¢ï¼Œéœ€è¦è‡ªå·±å†™btoiæˆ–itobå‡½æ•°</p>
</li>
<li><p>goã€stringä¸float64ä¹‹é—´çš„è½¬æ¢</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//-------------------------- intè½¬string ------------------------------</span></span><br><span class="line">i := <span class="built_in">int64</span>(<span class="number">123</span>)</span><br><span class="line">s := strconv.<span class="built_in">Itoa</span>(i)</span><br><span class="line">s := strconv.<span class="built_in">FormatInt</span>(i, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//-------------------------- stringè½¬int ------------------------------</span></span><br><span class="line">i, err := strconv.<span class="built_in">Atoi</span>(s)</span><br><span class="line">i, err := strconv.<span class="built_in">ParseInt</span>(s, <span class="number">10</span>, <span class="number">64</span>)<span class="comment">//è½¬int64</span></span><br><span class="line"><span class="comment">//ç¬¬äºŒä¸ªå‚æ•°ä¸ºåŸºæ•°ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä½å¤§å°è¡¨ç¤ºæœŸæœ›è½¬æ¢çš„ç»“æœç±»å‹ï¼Œå…¶å€¼å¯ä»¥ä¸º0, 8, 16, 32å’Œ64</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//floatè½¬string</span></span><br><span class="line">v := <span class="number">3.1415926535</span></span><br><span class="line">s1 := strconv.<span class="built_in">FormatFloat</span>(v, <span class="string">&#x27;E&#x27;</span>, <span class="number">-1</span>, <span class="number">32</span>)</span><br><span class="line"><span class="comment">//&#x27;e&#x27;&amp;&#x27;E&#x27;: è¡¨ç¤º10è¿›åˆ¶æŒ‡æ•°</span></span><br><span class="line"><span class="comment">//&#x27;b&#x27;: è¡¨ç¤º2è¿›åˆ¶æŒ‡æ•°</span></span><br><span class="line"><span class="comment">//&#x27;f&#x27;: æ— æŒ‡æ•°ï¼Œæ­£å¸¸å½¢å¼</span></span><br><span class="line"><span class="comment">//&#x27;g&#x27;&amp;&#x27;G&#x27;: å¤§æ•°ç”¨&#x27;e&#x27;è¡¨ç¤ºï¼Œå¦åˆ™ç”¨&#x27;f&#x27;</span></span><br><span class="line"><span class="comment">//&#x27;x&#x27;&amp;&#x27;X&#x27;: 16è¿›åˆ¶è¡¨ç¤ºçš„äºŒè¿›åˆ¶æŒ‡æ•°</span></span><br><span class="line"><span class="comment">//-1æ˜¯ç²¾åº¦</span></span><br><span class="line">float32s2 := strconv.<span class="built_in">FormatFloat</span>(v, <span class="string">&#x27;E&#x27;</span>, <span class="number">-1</span>, <span class="number">64</span>)<span class="comment">//float64</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//stringè½¬float</span></span><br><span class="line">s := <span class="string">&quot;3.1415926535&quot;</span></span><br><span class="line">v1, err := strconv.<span class="built_in">ParseFloat</span>(v, <span class="number">32</span>)</span><br><span class="line">v2, err := strconv.<span class="built_in">ParseFloat</span>(v, <span class="number">64</span>)</span><br></pre></td></tr></table></figure>

<h2 id="4-åŒ…package"><a href="#4-åŒ…package" class="headerlink" title="4. åŒ…package"></a>4. åŒ…package</h2><ul>
<li>å¯¼å…¥å¤šä¸ªåŒ…ï¼šåŒ…ä¹‹é—´æ— éœ€é€—å·ï¼Œç©ºæ ¼é—´éš”å³å¯ã€‚ä¸åŒåŒ…éœ€å†™åœ¨ä¸åŒè¡Œï¼Œéœ€è¦åœ†æ‹¬å·</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>æ–°å»ºè‡ªå·±çš„åŒ…</p>
<ol>
<li><p>æ–°å»ºæ–‡ä»¶å¤¹ï¼Œæ–°å»ºå‡½æ•°çš„æ–‡ä»¶</p>
</li>
<li><p>åœ¨æ–‡ä»¶é¡¶éƒ¨å£°æ˜åŒ…åï¼ˆä¸éœ€è¦ä¸æ–‡ä»¶å¤¹åŒåï¼‰</p>
</li>
<li><p>åœ¨æ–‡ä»¶å†…å†™å‡½æ•°</p>
</li>
</ol>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºstrutilæ–‡ä»¶å¤¹ï¼Œæ–°å»ºreverse.goæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">package</span> strutil</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverse</span><span class="params">(s <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">  runes := []<span class="type">rune</span>(s)</span><br><span class="line">  <span class="keyword">for</span> i,j := <span class="number">0</span>,<span class="built_in">len</span>(runes)<span class="number">-1</span> ; i&lt;j ; i,j = i+<span class="number">1</span>, j<span class="number">-1</span>&#123;</span><br><span class="line">    runes[i],runes[j] = runes[j],runes[i]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="type">string</span>(runes)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–°å»ºåï¼Œå¯¼å…¥åŒ…è·¯å¾„éœ€ä»srcå¼€å§‹ï¼Œå¦‚reverse.goå­˜åœ¨&#x2F;src&#x2F;github.com&#x2F;oliverPai&#x2F;strutil&#x2F;reverse.goï¼Œåˆ™å¯¼å…¥åŒ…æ—¶ä¸ºimport â€œ<a href="http://github.com/oliverPai/strutil" title="github.com/oliverPai/strutil">github.com&#x2F;oliverPai&#x2F;strutil</a>â€œ</p>
<ul>
<li><p>å¯¼å…¥go getè·å–çš„åŒ…ï¼Œä¸å¯¼å…¥è‡ªå·±çš„åŒ…ä¸€æ ·æ“ä½œï¼Œå¦‚awsåŒ…</p>
<p>import â€œ<a href="http://github.com/aws" title="github.com/aws">github.com&#x2F;aws</a>â€œ</p>
</li>
</ul>
<h2 id="5-æ•°ç»„array-amp-slice"><a href="#5-æ•°ç»„array-amp-slice" class="headerlink" title="5 æ•°ç»„array&amp;slice"></a>5 æ•°ç»„array&amp;slice</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*------Array å®šé•¿æ•°ç»„------*/</span></span><br><span class="line"><span class="comment">/*å…ˆå£°æ˜åèµ‹å€¼*/</span></span><br><span class="line"><span class="keyword">var</span> fruitArr [<span class="number">2</span>] <span class="type">string</span></span><br><span class="line">fruitArr[<span class="number">0</span>] = <span class="string">&quot;Apple&quot;</span></span><br><span class="line">fruitArr[<span class="number">1</span>] = <span class="string">&quot;Orange&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*å£°æ˜å¹¶èµ‹å€¼*/</span></span><br><span class="line">fruitArr_1 := [<span class="number">2</span>]<span class="type">string</span>&#123;<span class="string">&quot;Apple&quot;</span>,<span class="string">&quot;Orange&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*------Slice ä¸å®šé•¿æ•°ç»„------*/</span></span><br><span class="line">fruitSlice := []<span class="type">string</span>&#123;<span class="string">&quot;Apple&quot;</span>,<span class="string">&quot;Orange&quot;</span>,<span class="string">&quot;Grape&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ç»Ÿè®¡æ•°ç»„å…ƒç´ ä¸ªæ•°å¯ç”¨lenå‡½æ•°</p>
</li>
<li><p>æ•°ç»„æ”¯æŒåˆ‡ç‰‡æ“ä½œï¼Œå¦‚fmt.Println(fruitSlice[1:2])è¾“å‡ºOrangeï¼Œä»ç´¢å¼•1å¼€å§‹ï¼Œåœ¨ç´¢å¼•2ä¹‹å‰ç»“æŸ</p>
</li>
<li><p>makeå‡½æ•°æ„é€ slice</p>
</li>
</ul>
<p>sliceæœ¬è´¨ä¸Šæ˜¯å¼•ç”¨ç±»å‹ï¼Œå¯ç”¨makeæ„é€ </p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ ¼å¼ï¼šmake([]T, size, cap)</span></span><br><span class="line"><span class="comment">//T:åˆ‡ç‰‡çš„å…ƒç´ ç±»å‹</span></span><br><span class="line"><span class="comment">//size:åˆ‡ç‰‡ä¸­å…ƒç´ çš„æ•°é‡</span></span><br><span class="line"><span class="comment">//cap:åˆ‡ç‰‡çš„å®¹é‡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  a := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">2</span>, <span class="number">10</span>)</span><br><span class="line">  fmt.Println(a)      <span class="comment">//[0 0]</span></span><br><span class="line">  fmt.Println(<span class="built_in">len</span>(a)) <span class="comment">//2</span></span><br><span class="line">  fmt.Println(<span class="built_in">cap</span>(a)) <span class="comment">//10</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¦‚æœæ˜¯make([]int,2),åˆ™lenä¸º2</span></span><br></pre></td></tr></table></figure>

<ul>
<li>sliceå…ƒç´ çš„å¢åˆ </li>
</ul>
<p>appendå‡½æ•°å¯ä»¥ç”¨æ¥åœ¨sliceæœ«å°¾è¿½åŠ å…ƒç´ </p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> s []<span class="type">int</span></span><br><span class="line">  s = <span class="built_in">append</span>(s, <span class="number">1</span>)        <span class="comment">// [1]</span></span><br><span class="line">  s = <span class="built_in">append</span>(s, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)  <span class="comment">// [1 2 3 4]</span></span><br><span class="line">  s2 := []<span class="type">int</span>&#123;<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>&#125;  </span><br><span class="line">  <span class="comment">//å¯¹ä¸€ä¸ªsliceæ·»åŠ å¦ä¸€ä¸ªsliceçš„å…ƒç´ æ—¶ï¼Œéœ€è¦åŠ ä¸Š...</span></span><br><span class="line">  s = <span class="built_in">append</span>(s, s2...)    <span class="comment">// [1 2 3 4 5 6 7]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>goè¯­è¨€ä¸­æ²¡æœ‰ä¸“é—¨çš„åˆ å‡sliceå…ƒç´ çš„å‡½æ•°ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡èµ‹å€¼å®Œæˆè¿™ä¸€ç›®æ ‡</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¯¹aä¸­åˆ æ‰ç´¢å¼•ä¸ºindexçš„å…ƒç´ </span></span><br><span class="line">a = <span class="built_in">append</span>(a[:index], a[index+<span class="number">1</span>:]...)</span><br></pre></td></tr></table></figure>

<ul>
<li>sliceçš„æ‹·è´</li>
</ul>
<p>sliceçš„æ‹·è´åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯ä¸¤ä¸ªsliceå…±äº«ä¸€ç‰‡å†…å­˜åŒºåŸŸï¼ŒäºŒè€…å®Œå…¨ç›¸åŒï¼Œä¿®æ”¹ä¸€ä¸ªä¼šæ›´æ”¹å¦ä¸€ä¸ªçš„å€¼ï¼›å¦ä¸€ç§æƒ…å†µæ˜¯äºŒè€…åªæ˜¯æ•°å€¼ç›¸åŒè€Œå·²ï¼Œä¿®æ”¹ä¸€ä¸ªä¸ä¼šå¯¹å¦ä¸€ä¸ªé€ æˆå½±å“</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç¬¬ä¸€ç§æƒ…å†µï¼Œç›´æ¥èµ‹å€¼æ‹·è´ï¼ŒäºŒè€…å…±äº«å†…å­˜</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  s1 := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">3</span>) <span class="comment">//[0 0 0]</span></span><br><span class="line">  s2 := s1             <span class="comment">//å°†s1ç›´æ¥èµ‹å€¼ç»™s2ï¼Œs1å’Œs2å…±ç”¨ä¸€ä¸ªåº•å±‚æ•°ç»„</span></span><br><span class="line">  s2[<span class="number">0</span>] = <span class="number">100</span></span><br><span class="line">  fmt.Println(s1) <span class="comment">//[100 0 0]</span></span><br><span class="line">  fmt.Println(s2) <span class="comment">//[100 0 0]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç¬¬äºŒç§æƒ…å†µï¼Œä½¿ç”¨copyå‡½æ•°ï¼Œä¸å…±äº«å†…å­˜</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// copy()å¤åˆ¶åˆ‡ç‰‡</span></span><br><span class="line">  a := []<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line">  c := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">5</span>, <span class="number">5</span>)</span><br><span class="line">  <span class="built_in">copy</span>(c, a)     <span class="comment">//ä½¿ç”¨copy()å‡½æ•°å°†åˆ‡ç‰‡aä¸­çš„å…ƒç´ å¤åˆ¶åˆ°åˆ‡ç‰‡c</span></span><br><span class="line">  fmt.Println(a) <span class="comment">//[1 2 3 4 5]</span></span><br><span class="line">  fmt.Println(c) <span class="comment">//[1 2 3 4 5]</span></span><br><span class="line">  c[<span class="number">0</span>] = <span class="number">1000</span></span><br><span class="line">  fmt.Println(a) <span class="comment">//[1 2 3 4 5]</span></span><br><span class="line">  fmt.Println(c) <span class="comment">//[1000 2 3 4 5]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ¤æ–­sliceä¸ºç©ºåº”è¯¥é€šè¿‡len(slice)&#x3D;&#x3D;0åˆ¤æ–­ï¼Œè€Œä¸æ˜¯slice&#x3D;&#x3D;nil</li>
</ul>
<h2 id="6-å‡½æ•°-å¼‚å¸¸"><a href="#6-å‡½æ•°-å¼‚å¸¸" class="headerlink" title="6 å‡½æ•°+å¼‚å¸¸"></a>6 å‡½æ•°+å¼‚å¸¸</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*æ ¼å¼ï¼šfunc å‡½æ•°å(å‚æ•°1 å‚æ•°1ç±»å‹, å‚æ•°2 å‚æ•°2ç±»å‹,...)(è¿”å›å€¼1ç±»å‹, è¿”å›å€¼2ç±»å‹ ,...)&#123;&#125;*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">greeting</span><span class="params">(name <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;Hello&quot;</span>+name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*æŸäº›å‚æ•°è‹¥åŒç±»å‹ï¼Œå¯å†™åœ¨ä¸€èµ·ï¼Œåªä¿ç•™ä¸€ä¸ªæ•°æ®ç±»å‹*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">plus</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*å¯ç»™è¿”å›å€¼å‘½åï¼Œä¹Ÿå¯ä¸å‘½å*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SumAndProduct</span><span class="params">(A, B <span class="type">int</span>)</span></span> (<span class="type">int</span>, <span class="type">int</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> A+B, A*B</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">change</span><span class="params">(a, b <span class="type">int</span>)</span></span> (x, y <span class="type">int</span>) &#123;<span class="comment">//å‘½åå¯ä½¿ä»£ç é˜…è¯»å’Œä¹¦å†™æ›´æ¸…æ™°</span></span><br><span class="line">  x = a + <span class="number">100</span><span class="comment">//101</span></span><br><span class="line">  y = b + <span class="number">100</span><span class="comment">//102</span></span><br><span class="line">  <span class="keyword">return</span><span class="comment">//101 102</span></span><br><span class="line">  <span class="comment">//return x, y  //åŒä¸Š</span></span><br><span class="line">  <span class="comment">//return y, x  //102 101</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*åŒ¿åå‡½æ•°*/</span></span><br><span class="line">f := <span class="function"><span class="keyword">func</span><span class="params">(a,b <span class="type">int</span>)</span></span> <span class="type">int</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a+b</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç›´æ¥æ‰§è¡ŒåŒ¿åå‡½æ•°â€”â€”åŠ æ‹¬å·</span></span><br><span class="line"><span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;Anonymous&quot;</span>)</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>

<ul>
<li>åŒ¿åå‡½æ•°å¯ä»¥ç”¨æ¥åšå¼‚å¸¸å¤„ç†ï¼Œé€šè¿‡defer+recover</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">a</span><span class="params">()</span></span>&#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;function a\n&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä»…ç”¨panicåšå¼‚å¸¸å¤„ç†</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">b</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="built_in">panic</span>(<span class="string">&quot;panic in b&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">c</span><span class="params">()</span></span>&#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;function c\n&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  a()</span><br><span class="line">  b()</span><br><span class="line">  c()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¾“å‡º function a</span></span><br><span class="line"><span class="comment">//     panic: panic in b</span></span><br><span class="line"><span class="comment">//ç”±äºåœ¨bå‡½æ•°ç»ˆæ­¢ï¼Œå› æ­¤æœªå…¨éƒ¨æ‰§è¡Œå®Œ</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨åŒ¿åå‡½æ•°+defer+recoverçš„å¼‚å¸¸å¤„ç†</span></span><br><span class="line"><span class="comment">//defer+recoverå¯æš‚æ—¶è·³è¿‡å‡ºé”™åœ°æ–¹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">b</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">    err := <span class="built_in">recover</span>()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span>&#123;<span class="comment">//æ£€æµ‹åˆ°é”™è¯¯</span></span><br><span class="line">      fmt.Println(<span class="string">&quot;function b error&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;()</span><br><span class="line">  <span class="built_in">panic</span>(<span class="string">&quot;panic in b&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¾“å‡º function a</span></span><br><span class="line"><span class="comment">//     function b error</span></span><br><span class="line"><span class="comment">//     function c</span></span><br><span class="line"><span class="comment">//deferä¼šåœ¨å‡½æ•°è¦é€€å‡ºå‰æ‰§è¡Œï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œåˆ°</span></span><br><span class="line"><span class="comment">//panicæ—¶ï¼Œç”±äºå‡ºé”™å³å°†é€€å‡ºï¼Œè§¦å‘åŒ¿åå‡½æ•°</span></span><br><span class="line"><span class="comment">//æ‰§è¡ŒåŒ¿åå‡½æ•°åï¼Œä¸å†æ‰§è¡Œpanicã€</span></span><br><span class="line"><span class="comment">//deferå¿…é¡»å†™åœ¨å¯èƒ½å¼•å‘panicçš„è¯­å¥ä¹‹å‰,</span></span><br><span class="line"><span class="comment">//å¦åˆ™æœªæ³¨å†Œdeferï¼Œæ— æ³•æ‰§è¡ŒåŒ¿åå‡½æ•°</span></span><br><span class="line"><span class="comment">//å¦‚æœå¤šä¸ªdeferå‡½æ•°ï¼Œå®ƒä»¬ä¼šé€†åºæ‰§è¡Œ</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ“Œé™¤äº†åŒ¿åå‡½æ•°+defer+recoveråšå¼‚å¸¸å¤„ç†ï¼Œè¿˜å¯ä»¥ä½¿ç”¨goå†…ç½®çš„errorç±»å‹</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//errorç±»å‹å®šä¹‰</span></span><br><span class="line"><span class="keyword">type</span> <span class="type">error</span> <span class="keyword">interface</span>&#123;</span><br><span class="line">  Error() <span class="type">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨errors.Newå¯è¿”å›ä¸€ä¸ªé”™è¯¯ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sqrt</span><span class="params">(f <span class="type">float64</span>)</span></span> (<span class="type">float64</span>,<span class="type">error</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span> f &lt; <span class="number">0</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>, errors.New(<span class="string">&quot;math: square root of negative number&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-æ¡ä»¶"><a href="#7-æ¡ä»¶" class="headerlink" title="7 æ¡ä»¶"></a>7 æ¡ä»¶</h2><ul>
<li>ifè¯­å¥</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//goé‡Œé¢çš„ifä¸éœ€è¦åœ†æ‹¬å·</span></span><br><span class="line"><span class="keyword">if</span> color == <span class="string">&quot;red&quot;</span>&#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;color is red&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> color == <span class="string">&quot;blue&quot;</span>&#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;color is blue&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;color is not red or blue&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>switchè¯­å¥</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//goè¯­è¨€åœ¨æ¯ä¸ªcaseä¼šè‡ªåŠ¨åŠ ä¸Šä¸€ä¸ªbreakï¼Œå³goé‡Œswitchä¸éœ€è¦breakï¼ŒåŒæ—¶æ— æ³•æ§åˆ¶æ‰§è¡Œcaseçš„æ•°é‡</span></span><br><span class="line"><span class="keyword">switch</span> color&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;red&quot;</span>:</span><br><span class="line">  fmt.Println(<span class="string">&quot;color is red&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;blue&quot;</span>:</span><br><span class="line">  fmt.Println(<span class="string">&quot;color is blue&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">  fmt.Println(<span class="string">&quot;color is not red or blue&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-å¾ªç¯"><a href="#8-å¾ªç¯" class="headerlink" title="8 å¾ªç¯"></a>8 å¾ªç¯</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å†™æ³•1</span></span><br><span class="line">i := <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i &lt;= <span class="number">10</span> &#123;</span><br><span class="line">  fmt.Println(i)</span><br><span class="line">  i++</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å†™æ³•2</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++&#123;</span><br><span class="line">  fmt.Println(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ— é™å¾ªç¯</span></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"> <span class="comment">//content</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>foræ˜¯goè¯­è¨€æä¾›çš„å”¯ä¸€å¾ªç¯æ–¹å¼</p>
</li>
<li><p>goè¯­è¨€ä¹Ÿå¯ä»¥åœ¨å¾ªç¯ä¸­ç”¨continueå’Œbreak</p>
</li>
</ul>
<h2 id="9-Map"><a href="#9-Map" class="headerlink" title="9 Map"></a>9 Map</h2><p>goè¯­è¨€çš„Mapæ˜¯é”®-å€¼å¯¹ï¼Œç±»ä¼¼äºpythonçš„å­—å…¸</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*-------å…ˆå£°æ˜åèµ‹å€¼-------*/</span></span><br><span class="line"><span class="comment">/*æ ¼å¼ï¼šmake(map[é”®æ•°æ®ç±»å‹][å€¼æ•°æ®ç±»å‹])*/</span></span><br><span class="line">emails := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>)</span><br><span class="line"><span class="comment">//èµ‹å€¼</span></span><br><span class="line">emails[<span class="string">&quot;Bob&quot;</span>] = <span class="string">&quot;bob@gmail.com&quot;</span></span><br><span class="line">emails[<span class="string">&quot;Sharon&quot;</span>] = <span class="string">&quot;sharon@gmail.com&quot;</span></span><br><span class="line">emails[<span class="string">&quot;Mike&quot;</span>] = <span class="string">&quot;mike@gmail.com&quot;</span></span><br><span class="line"><span class="comment">//ä»mapä¸­åˆ é™¤</span></span><br><span class="line"><span class="built_in">delete</span>(emails,<span class="string">&quot;Bob&quot;</span>)<span class="comment">//æ ¼å¼ï¼šdelete(mapåï¼Œé”®å)</span></span><br><span class="line"><span class="comment">//ç´¢å¼•</span></span><br><span class="line">fmt.Println(emails[<span class="string">&quot;Sharon&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">/*-------å£°æ˜çš„åŒæ—¶èµ‹å€¼-------*/</span></span><br><span class="line"><span class="comment">/*æ ¼å¼ï¼š:=map[é”®æ•°æ®ç±»å‹]å€¼æ•°æ®ç±»å‹&#123;é”®1:å€¼1,é”®2:å€¼2,...&#125;*/</span></span><br><span class="line">emails := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>&#123;<span class="string">&quot;Bob&quot;</span>:<span class="string">&quot;bob@gmail.com&quot;</span>,<span class="string">&quot;Sharon&quot;</span>:<span class="string">&quot;sharon@gmail.com&quot;</span>&#125;</span><br><span class="line"><span class="comment">//ä¾ç„¶å¯ä»¥æ·»åŠ ä¸œè¥¿</span></span><br><span class="line">emails[<span class="string">&quot;Mike&quot;</span>] = <span class="string">&quot;mike@gmail.com&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="10-èŒƒå›´range"><a href="#10-èŒƒå›´range" class="headerlink" title="10 èŒƒå›´range"></a>10 èŒƒå›´range</h2><p>rangeç”¨äºéå†æ•°ç»„ã€mapã€channelç­‰ï¼Œèƒ½å¤Ÿä½¿forå¾ªç¯æˆä¸ºforeach</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*-------éå†æ•°ç»„-------*/</span></span><br><span class="line">ids := []<span class="type">int</span>&#123;<span class="number">33</span>,<span class="number">76</span>,<span class="number">25</span>,<span class="number">89</span>,<span class="number">14</span>,<span class="number">71</span>&#125;</span><br><span class="line"><span class="comment">//rangeéœ€è¦ä¼ å…¥ä¸¤ä¸ªå˜é‡ï¼Œç¬¬ä¸€é¡¹æ˜¯indexï¼Œç¬¬äºŒé¡¹æ˜¯indexå¯¹åº”çš„å…ƒç´ </span></span><br><span class="line"><span class="keyword">for</span> i,id := <span class="keyword">range</span> ids &#123;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;%d - ID: %d&quot;</span>, i, id)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å½“ä¸æƒ³è¦indexæ—¶ï¼Œå¯ç”¨_ä»£æ›¿</span></span><br><span class="line"><span class="keyword">for</span> _,id := <span class="keyword">range</span> ids &#123;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;ID: %d&quot;</span>, id)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*-------éå†Map-------*/</span></span><br><span class="line">emails := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>&#123;<span class="string">&quot;Bob&quot;</span>:<span class="string">&quot;bob@gmail.com&quot;</span>,<span class="string">&quot;Sharon&quot;</span>:<span class="string">&quot;sharon@gmail.com&quot;</span>&#125;</span><br><span class="line"><span class="comment">//rangeéœ€è¦ä¼ å…¥ä¸¤ä¸ªå˜é‡ï¼Œç¬¬ä¸€é¡¹æ˜¯é”®ï¼Œç¬¬äºŒé¡¹æ˜¯å€¼</span></span><br><span class="line"><span class="keyword">for</span> k,v := <span class="keyword">range</span> emails&#123;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;%s: %s&quot;</span>,k,v)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å½“åªæƒ³è¦é”®ä¸æƒ³è¦å€¼æ—¶ï¼Œå¯ä»¥çœç•¥ç¬¬äºŒé¡¹</span></span><br><span class="line"><span class="keyword">for</span> k := <span class="keyword">range</span> emails&#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;Name: &quot;</span> + k)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>rangeå¯¹æ•°ç»„çš„æ“ä½œåŒæ ·å¯ä»¥åº”ç”¨åˆ°å­—ç¬¦ä¸²ä¸Šï¼Œç¬¬ä¸€é¡¹indexï¼Œç¬¬äºŒé¡¹å­—ç¬¦</li>
</ul>
<h2 id="11-æŒ‡é’ˆ"><a href="#11-æŒ‡é’ˆ" class="headerlink" title="11 æŒ‡é’ˆ"></a>11 æŒ‡é’ˆ</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  a := <span class="number">5</span></span><br><span class="line">  b := &amp;a<span class="comment">//bæ˜¯æŒ‡å‘açš„æŒ‡é’ˆ</span></span><br><span class="line">  fmt.Printf(<span class="string">&quot;%T&quot;</span>,b)<span class="comment">//è¾“å‡º*int</span></span><br><span class="line">  <span class="comment">//å–å€¼</span></span><br><span class="line">  fmt.Println(*b)<span class="comment">//è¾“å‡º5</span></span><br><span class="line">  <span class="comment">//æ”¹å€¼</span></span><br><span class="line">  *b = <span class="number">10</span></span><br><span class="line">  fmt.Println(a)<span class="comment">//è¾“å‡º10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>goè¯­è¨€ä¸­æŒ‡é’ˆçš„å¥½å¤„åœ¨äºï¼Œå¯¹äºæ“ä½œæŸè¿ç»­åœ°å€çš„ä¸€å¤§ç‰‡æ•°æ®ï¼Œä½¿ç”¨æŒ‡é’ˆå¯ä»¥æé«˜æ‰§è¡Œæ•ˆç‡</p>
</li>
<li><p>å¯ä»¥åˆ©ç”¨æŒ‡é’ˆå¯¹ç‰¹æ®Šåœ°å€ä¿®æ”¹æ•°å€¼</p>
</li>
</ul>
<h2 id="12-é—­åŒ…closure"><a href="#12-é—­åŒ…closure" class="headerlink" title="12 é—­åŒ…closure"></a>12 é—­åŒ…closure</h2><p>é—­åŒ…æ˜¯å‡½æ•°ä½œä¸ºè¿”å›å€¼æ—¶ï¼ŒåŒ¿åå‡½æ•°å†…éƒ¨è®¿é—®å¤–å±‚å˜é‡çš„è¡Œä¸º</p>
<ul>
<li>æ ¸å¿ƒåœ¨äºï¼Œè¢«è®¿é—®çš„å¤–å±‚å˜é‡ç›¸å½“äºè¢«è®¿é—®äº†å¼•ç”¨ï¼Œå…¶ä¿®æ”¹åçš„å€¼è¢«ä¸€ç›´ä¿ç•™</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*------ä¾‹1------*/</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="comment">//..(..1...).(....2.......)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">adder</span><span class="params">()</span></span> <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">  sum := <span class="number">0</span><span class="comment">//è¢«è®¿é—®çš„å¤–å±‚å˜é‡</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(x <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    sum += x</span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="comment">//å°†å‡½æ•°èµ‹ç»™å˜é‡æ—¶ï¼Œéœ€å’Œ1å¤„ä¸€è‡´</span></span><br><span class="line">  sum := adder()</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">0</span>; i&lt; <span class="number">10</span>; i++&#123;</span><br><span class="line">    <span class="comment">//è°ƒç”¨å‡½æ•°å˜é‡æ—¶ï¼Œéœ€å’Œ2å¤„ä¸€è‡´</span></span><br><span class="line">    fmt.Println(sum(i))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¾“å‡ºç»“æœï¼š</span></span><br><span class="line"><span class="comment">//0 1 3 6 10 15 21 28 36 45</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*------ä¾‹2------*/</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calc</span><span class="params">(base <span class="type">int</span>)</span></span>(<span class="function"><span class="keyword">func</span><span class="params">(<span class="type">int</span>)</span></span><span class="type">int</span>,</span><br><span class="line">                    <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">int</span>)</span></span><span class="type">int</span>)&#123;</span><br><span class="line">  add := <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">int</span>)</span></span><span class="type">int</span>&#123;</span><br><span class="line">    base += i</span><br><span class="line">    <span class="keyword">return</span> base</span><br><span class="line">  &#125;</span><br><span class="line">  sub := <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">int</span>)</span></span><span class="type">int</span>&#123;</span><br><span class="line">    base -= i</span><br><span class="line">    <span class="keyword">return</span> base</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  x,y := calc(<span class="number">100</span>)</span><br><span class="line">  ret1 := x(<span class="number">200</span>)</span><br><span class="line">  <span class="comment">//baseå·²è¢«æ”¹æˆ300</span></span><br><span class="line">  fmt.Println(ret1)<span class="comment">//è¾“å‡º100+200=300</span></span><br><span class="line">  <span class="comment">//ç”±äºbaseå¾—ä»¥ä¿ç•™ï¼Œæ­¤å¤„baseæ˜¯300</span></span><br><span class="line">  ret2 := y(<span class="number">200</span>)</span><br><span class="line">  fmt.Println(ret2)<span class="comment">//è¾“å‡º300-200=100</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>é—­åŒ…çš„ç”¨å¤„</li>
</ul>
<blockquote>
<p>ğŸ“ŒAä»£ç ï¼š func (o *Once) Do2(f func()) {}<br>Bä»£ç ï¼š func Do1ï¼ˆå‚æ•°ï¼‰<br>éœ€æ±‚ï¼š   Bè¦è°ƒç”¨Aå†™çš„oå¯¹è±¡é‡Œçš„æ–¹æ³•Do2ï¼Œå¹¶æŠŠè‡ªå·±çš„Do1å½“ä½œå‚æ•°ä¼ åˆ°Do2   ä¸­ï¼Œä½†æ˜¯Bå†™çš„Do1æœ‰ä¼ å‚ï¼Œè€ŒAå†™çš„Do2ä¸­ä¼ å…¥çš„æ–¹æ³•å‚æ•°æ˜¯ä¸èƒ½å¸¦å‚æ•°çš„<br>è§£å†³åŠæ³•ï¼šé—­åŒ…<br>ç¼–å†™ä¸€ä¸ªfunc Do3ï¼ˆå‚æ•°ï¼‰ï¼ˆfunc (o *Once) Do2(f func())ï¼‰ï¼Œä¹Ÿå°±æ˜¯æ–°çš„Do3å‡½æ•°ä¸­çš„å‚æ•°æ˜¯Do1ä¸­è¦ä¼ å…¥çš„å‚æ•°ï¼Œè¿”å›å€¼æ˜¯Do2ï¼Œé‚£ä¹ˆåœ¨Do2ä¸­å°±èƒ½è°ƒç”¨Do3ä¸­ä¼ å…¥çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯Do1ä¸­æœŸæœ›çš„å‚æ•°ï¼ŒDo3è¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£è¿™ä¸ªå‡½æ•°è°ƒç”¨äº†è¿™ä¸ªå‡½æ•°ä¹‹å¤–çš„ä¸€ä¸ªå˜é‡ï¼Œæ‰€ä»¥å½¢æˆäº†ä¸€ä¸ªé—­åŒ…ã€‚</p>
</blockquote>
<h2 id="13-ç»“æ„ä½“"><a href="#13-ç»“æ„ä½“" class="headerlink" title="13 ç»“æ„ä½“"></a>13 ç»“æ„ä½“</h2><p>goé‡Œæ²¡æœ‰ç±»ï¼Œç»“æ„ä½“å¯ä»¥æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œç»“æ„ä½“å°±æ˜¯ç±»</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span>&#123;</span><br><span class="line">  firstName <span class="type">string</span></span><br><span class="line">  lastName <span class="type">string</span></span><br><span class="line">  city <span class="type">string</span></span><br><span class="line">  gender <span class="type">string</span></span><br><span class="line">  age <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="comment">//åˆå§‹åŒ–ç»“æ„ä½“</span></span><br><span class="line">  person1:=Person&#123;firstName:<span class="string">&quot;Samantha&quot;</span>,</span><br><span class="line">  lastName:<span class="string">&quot;Smith&quot;</span>,</span><br><span class="line">  city:<span class="string">&quot;Boston&quot;</span>,</span><br><span class="line">  gender:<span class="string">&quot;f&quot;</span>,</span><br><span class="line">  age:<span class="number">25</span>&#125;</span><br><span class="line">  fmt.Println(person1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å·¦è¾¹ä»£ç çš„ç®€ä¾¿å†™æ³•</span></span><br><span class="line"><span class="comment">//åŒç±»å‹å¯ä»¥å†™ä¸€èµ·</span></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span>&#123;</span><br><span class="line">  firstName,lastName,city,gender <span class="type">string</span></span><br><span class="line">  age <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="comment">//ä¸éœ€è¦æŒ‡å®šå±æ€§å</span></span><br><span class="line">  person1 := Person&#123;<span class="string">&quot;Samantha&quot;</span>,<span class="string">&quot;Smith&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Boston&quot;</span>,<span class="string">&quot;f&quot;</span>,<span class="number">25</span>&#125;</span><br><span class="line">  fmt.Println(person1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è·å–å±æ€§</span></span><br><span class="line">fmt.Println(person1.firstName)</span><br><span class="line"><span class="comment">//æ”¹å˜å±æ€§\</span></span><br><span class="line">person1.age++</span><br><span class="line">fmt.Println(person1.age)</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*-------value receiveræ–¹æ³•ï¼šä¸æ”¹å˜ä»»ä½•æ•°å€¼-------*/</span></span><br><span class="line"><span class="comment">//æ ¼å¼ï¼šfunc (identifier ç»“æ„ä½“å) å‡½æ•°å è¿”å›å€¼ç±»å‹&#123;&#125;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Person)</span></span> greet() <span class="type">string</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;Hello, my name is &quot;</span>+p.firstName+<span class="string">&quot; &quot;</span>+p.lastName+<span class="string">&quot; and I am &quot;</span>+strconv.Itoa(p.age)</span><br><span class="line">  <span class="comment">//è¿™é‡Œçš„strconv.Itoaç”¨æ¥intè½¬å­—ç¬¦ä¸²ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œéœ€äº‹å…ˆå¯¼å…¥strconvåŒ…</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*-------pointer receiveræ–¹æ³•ï¼šæ”¹å˜æ•°å€¼-------*/</span></span><br><span class="line"><span class="comment">//æ ¼å¼ï¼šfunc (identifier *ç»“æ„ä½“å) å‡½æ•°å è¿”å›å€¼ç±»å‹&#123;&#125;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Person)</span></span> hasBirthday() &#123;</span><br><span class="line">  p.age++</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>identifierç›¸å½“äºthisæŒ‡é’ˆï¼Œgoè¯­è¨€æ²¡æœ‰- &gt;</p>
</li>
<li><p>ç»“æ„ä½“çš„æ–¹æ³•ä¸èƒ½å†™åœ¨ç»“æ„ä½“å†…ï¼Œè¦å†™åœ¨å¤–é¢</p>
</li>
<li><p>åŒ¿åå­—æ®µâ€”â€”å®ç°ç»“æ„ä½“çš„â€œç»§æ‰¿â€</p>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Address åœ°å€ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">type</span> Address <span class="keyword">struct</span> &#123;</span><br><span class="line">  Province <span class="type">string</span></span><br><span class="line">  City     <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//User ç”¨æˆ·ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name    <span class="type">string</span></span><br><span class="line">  Gender  <span class="type">string</span></span><br><span class="line">  Address <span class="comment">//åŒ¿åå­—æ®µ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å½“éœ€è¦è®¿é—®Userä¸­çš„Addressä¸­çš„Provinceæ—¶å¯æœ‰ä¸¤ç§æ–¹å¼</span></span><br><span class="line"><span class="keyword">var</span> user1 User</span><br><span class="line"><span class="comment">//æ–¹å¼1ï¼šåŒ¿åå­—æ®µé»˜è®¤æŒ‰ç±»å‹åç´¢å¼•</span></span><br><span class="line">user1.Address.Province = Hubei</span><br><span class="line"><span class="comment">//æ–¹å¼2ï¼šç»§æ‰¿ï¼Œç›´æ¥ç´¢å¼•ï¼Œgoçš„structæŸ¥æ‰¾å±æ€§é¡ºåºï¼šè‡ªèº«å±æ€§-&gt;åŒ¿åå­—æ®µå±æ€§</span></span><br><span class="line">user1.Province = Hubei</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ä¸€ä¸ªç»“æ„ä½“åŒ…å«å¤šä¸ªåŒ¿åå­—æ®µæ—¶ï¼Œè‹¥è¿™äº›åŒ¿åå­—æ®µåŒ…å«åŒåå±æ€§ï¼Œä¼šå¯¼è‡´è®¿é—®æŠ¥é”™</p>
</li>
<li><p>æ–¹æ³•ä¹Ÿå¯ä»¥è¢«ç»§æ‰¿ï¼ŒåŒ…å«åŒ¿åå­—æ®µç»“æ„ä½“æ—¶ï¼Œå¯é€‰ç±»å‹ä¸ºæŒ‡é’ˆ</p>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">/Animal åŠ¨ç‰©</span><br><span class="line"><span class="keyword">type</span> Animal <span class="keyword">struct</span> &#123;</span><br><span class="line">  name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *Animal)</span></span> move() &#123;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;%sä¼šåŠ¨ï¼\n&quot;</span>, a.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Dog ç‹—</span></span><br><span class="line"><span class="keyword">type</span> Dog <span class="keyword">struct</span> &#123;</span><br><span class="line">  Feet    <span class="type">int8</span></span><br><span class="line">  *Animal <span class="comment">//é€šè¿‡åµŒå¥—åŒ¿åç»“æ„ä½“å®ç°ç»§æ‰¿</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *Dog)</span></span> wang() &#123;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;%sä¼šæ±ªæ±ªæ±ª~\n&quot;</span>, d.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  d1 := &amp;Dog&#123;</span><br><span class="line">    Feet: <span class="number">4</span>,</span><br><span class="line">    Animal: &amp;Animal&#123; <span class="comment">//æ³¨æ„åµŒå¥—çš„æ˜¯ç»“æ„ä½“æŒ‡é’ˆ</span></span><br><span class="line">      name: <span class="string">&quot;ä¹ä¹&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">  d1.wang() <span class="comment">//ä¹ä¹ä¼šæ±ªæ±ªæ±ª~</span></span><br><span class="line">  d1.move() <span class="comment">//ä¹ä¹ä¼šåŠ¨ï¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ç»“æ„ä½“å†…çš„æ ‡è¯†ç¬¦ï¼ˆå˜é‡åã€å‡½æ•°åï¼‰é¦–å­—æ¯å¤§å†™ï¼Œåˆ™å¯¹å¤–å¯è§ï¼ˆåˆ«çš„åŒ…å¯ä»¥æ‹¿åˆ°ï¼‰ï¼Œå¦åˆ™åªèƒ½åœ¨å½“å‰åŒ…ä½¿ç”¨</p>
</li>
<li><p>å¯¹ç»“æ„ä½“ä¸­çš„sliceèµ‹å€¼</p>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">  name   <span class="type">string</span></span><br><span class="line">  age    <span class="type">int8</span></span><br><span class="line">  act []<span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  p1 := Person&#123;name: <span class="string">&quot;å°ç‹å­&quot;</span>, age: <span class="number">18</span>&#125;</span><br><span class="line">  data := []<span class="type">string</span>&#123;<span class="string">&quot;åƒé¥­&quot;</span>, <span class="string">&quot;ç¡è§‰&quot;</span>&#125;</span><br><span class="line">  p1.SetAct(data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ–¹å¼1ï¼šæŒ‡é’ˆèµ‹å€¼</span></span><br><span class="line"><span class="comment">//mainä¸­dataå’Œp.actå…±åŒå˜åŒ–</span></span><br><span class="line"><span class="function"><span class="keyword">func</span><span class="params">(p *Person)</span></span>SetAct(dreams[]<span class="type">string</span>)&#123;</span><br><span class="line">  p.act = dreams</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ–¹å¼2ï¼šæ‹·è´èµ‹å€¼</span></span><br><span class="line"><span class="comment">//æ”¹å˜dataä¸ä¼šæ”¹å˜p.act</span></span><br><span class="line"><span class="function"><span class="keyword">func</span><span class="params">(p *Person)</span></span>SetAct(dreams[]<span class="type">string</span>)&#123;</span><br><span class="line">  p.dreams = <span class="built_in">make</span>([]<span class="type">string</span>,<span class="built_in">len</span>(dreams))</span><br><span class="line">  <span class="built_in">copy</span>(p.act, dreams)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="14-æ¥å£interface"><a href="#14-æ¥å£interface" class="headerlink" title="14 æ¥å£interface"></a>14 æ¥å£interface</h2><p>interfaceæ˜¯å¤šç§ç»“æ„ä½“å…±æ€§æ–¹æ³•çš„é›†åˆ</p>
<p>interfaceå®šä¹‰å‘½åä¸€ä¸ªç±»å‹ï¼Œä½¿å¾—ä¸ç®¡æœ€åˆæ˜¯ä»€ä¹ˆç±»å‹çš„structï¼Œåªè¦å®ç°äº†interfaceä¸­çš„æ–¹æ³•ï¼Œéƒ½å¯ä»¥è¢«ç®—ä½œè¢«interfaceå‘½åçš„ç±»å‹</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ ¼å¼</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  type æ¥å£å interface&#123;</span></span><br><span class="line"><span class="comment">    æ–¹æ³•å1(å‚æ•°åˆ—è¡¨1)è¿”å›å€¼åˆ—è¡¨1</span></span><br><span class="line"><span class="comment">    ......</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰interface</span></span><br><span class="line"><span class="keyword">type</span> Shape <span class="keyword">interface</span> &#123;</span><br><span class="line">  area() <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°Circleç»“æ„ä½“çš„areaæ–¹æ³•</span></span><br><span class="line"><span class="keyword">type</span> Circle <span class="keyword">struct</span> &#123;</span><br><span class="line">  x, y, radius <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Circle)</span></span> area() <span class="type">float64</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> math.Pi * c.radius * c.radius</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°Rectangleç»“æ„ä½“çš„areaæ–¹æ³•</span></span><br><span class="line"><span class="keyword">type</span> Rectangle <span class="keyword">struct</span> &#123;</span><br><span class="line">  width, height <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r Rectangle)</span></span> area() <span class="type">float64</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> r.width * r.height</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å› ä¸ºå®ç°äº†areaæ–¹æ³•ï¼ŒRectangleå’ŒCircleéƒ½æ˜¯Shapeç±»å‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getArea</span><span class="params">(s Shape)</span></span> <span class="type">float64</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> s.area()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  circle := Circle&#123;x: <span class="number">0</span>, y: <span class="number">0</span>, radius: <span class="number">5</span>&#125;</span><br><span class="line">  rectangle := Rectangle&#123;width: <span class="number">10</span>, height: <span class="number">5</span>&#125;</span><br><span class="line"></span><br><span class="line">  fmt.Printf(<span class="string">&quot;Circle Area: %f\n&quot;</span>, getArea(circle))</span><br><span class="line">  fmt.Printf(<span class="string">&quot;Rectangle Area: %f\n&quot;</span>, getArea(rectangle))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>interfaceæ˜¯ä¸€ç§ç±»å‹ï¼Œä¸€ç§æŠ½è±¡çš„ç±»å‹</p>
</li>
<li><p>åˆ©ç”¨sliceå’Œinterfaceå¯ä»¥å®ç°å‡½æ•°å‚æ•°å¯å˜ï¼Œæ ¼å¼ï¼šå˜é‡åâ€¦ç±»å‹</p>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åŒç±»å‹å¯å˜å‚æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">functest1</span><span class="params">(values ...<span class="type">int</span>)</span></span>(sum <span class="type">int</span>)&#123;</span><br><span class="line">  sum = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> _,i:=<span class="keyword">range</span> values&#123;</span><br><span class="line">    fmt.Println(i)</span><br><span class="line">    sum += i</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å‚æ•°ä¼ å…¥æ–¹å¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="comment">//å‚æ•°å¯ä»¥ä¸ºç©º</span></span><br><span class="line">  fmt.Println(functest1())</span><br><span class="line">  <span class="comment">//å‚æ•°å¯ä»¥æ˜¯1ä¸ª</span></span><br><span class="line">  fmt.Println(functest1(<span class="number">1</span>))</span><br><span class="line">  <span class="comment">//å‚æ•°å¯ä»¥æ˜¯å¤šä¸ª</span></span><br><span class="line">  fmt.Println(functest1(<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line">  <span class="comment">//å‚æ•°å¯ä»¥æ˜¯sliceï¼Œå¿…é¡»æœ‰...</span></span><br><span class="line">  <span class="keyword">var</span> tmp []<span class="type">int</span> = []<span class="type">int</span>&#123;<span class="number">2</span>,<span class="number">4</span>,<span class="number">5</span>&#125;</span><br><span class="line">  fmt.Println(functest1(tmp...))</span><br><span class="line">  <span class="comment">//**å¯å˜å‚å‡½æ•°å’Œä»¥sliceä¸ºå‚æ•°çš„å‡½æ•°ä¸ä¸€æ ·**</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸åŒç±»å‹å¯å˜å‚æ•°</span></span><br><span class="line"><span class="comment">//ç±»å‹å¿…é¡»æ˜¯ç©ºçš„interface</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">functest2</span><span class="params">(values ... <span class="keyword">interface</span>&#123;&#125;)</span></span>&#123;</span><br><span class="line">  <span class="keyword">for</span> _,i := <span class="keyword">range</span> values&#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;function test2:Type %T,</span></span><br><span class="line"><span class="string">    i %v\n&quot;</span>,i,i)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‚æ•°ä¼ å…¥æ–¹å¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="comment">//**æ–¹å¼1ï¼šä¼ å…¥interfaceçš„slice**</span></span><br><span class="line">  <span class="keyword">var</span> d[] <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">  d = <span class="built_in">append</span>(d,<span class="number">1</span>)</span><br><span class="line">  d = <span class="built_in">append</span>(d,<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">  d = <span class="built_in">append</span>(d,<span class="number">3.14</span>)</span><br><span class="line">  functest2(d...)<span class="comment">//ä¸€å®šè¦æœ‰...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//**æ–¹å¼2ï¼šç›´æ¥ä¼ ä¸åŒç±»å‹å‚æ•°**</span></span><br><span class="line">  functest2(<span class="string">&quot;hello&quot;</span>,<span class="number">10</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>goè®¤ä¸ºï¼Œä»»ä½•ç±»å‹éƒ½å®ç°äº†ç©ºæ¥å£ï¼Œæ‰€ä»¥ç©ºæ¥å£å¯æ¥å—ä»»ä½•ç±»å‹å€¼ï¼Œä¹Ÿå¯ç”¨äºå‡½æ•°å‚æ•°ï¼Œæ¥æ”¶ä»»ä½•ç±»å‹ã€‚åŒæ—¶å¯ç”¨äºmapçš„valueï¼Œæ‰©å±•mapåŠŸèƒ½</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">var m = make(map[string]interface&#123;&#125;)</span><br><span class="line">m[&#x27;name&#x27;] = &#x27;oliver&#x27;</span><br><span class="line">m[&#x27;age&#x27;] = age</span><br><span class="line">m[&#x27;hobby&#x27;] = []string&#123;&quot;ç¯®çƒ&quot;,&quot;ç¾½æ¯›çƒ&quot;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>æ•°å€¼æ¥æ”¶ä¸æŒ‡é’ˆæ¥æ”¶å®ç°æ¥å£çš„åŒºåˆ«</li>
</ul>
<p>å€¼æ¥æ”¶å®ç°çš„æ¥å£ï¼Œå³å¯ç”¨å®ç°æ¥å£çš„ç»“æ„ä½“ï¼Œä¹Ÿå¯ä»¥ç”¨è¯¥ç»“æ„ä½“çš„æŒ‡é’ˆè°ƒç”¨æ¥å£æ–¹æ³•</p>
<p>æŒ‡é’ˆæ¥æ”¶å®ç°çš„æ¥å£ï¼Œåªèƒ½ç”¨ç»“æ„ä½“çš„æŒ‡é’ˆè°ƒç”¨æ¥å£æ–¹æ³•</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å®ç°Moveræ¥å£</span></span><br><span class="line"><span class="keyword">type</span> Mover <span class="keyword">interface</span> &#123;</span><br><span class="line">  move()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç»“æ„ä½“dogï¼Œå°†ä¼šä½¿ç”¨dogå®ç°å€¼æ¥æ”¶æ¥å£ï¼Œä¹Ÿå°†ä½¿ç”¨&amp;dogå®ç°æŒ‡é’ˆæ¥æ”¶æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> dog <span class="keyword">struct</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å€¼å®ç°çš„æ¥å£</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d dog)</span></span> move() &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;ç‹—ä¼šåŠ¨&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> x Mover</span><br><span class="line">  <span class="keyword">var</span> val_rec = dog&#123;&#125; <span class="comment">// dogç±»å‹</span></span><br><span class="line">  x = val_rec         </span><br><span class="line">  <span class="comment">// xå¯ä»¥æ¥æ”¶dogç±»å‹</span></span><br><span class="line">  <span class="keyword">var</span> poi_rec = &amp;dog&#123;&#125;<span class="comment">// *dogç±»å‹</span></span><br><span class="line">  x = poi_rec         </span><br><span class="line">  <span class="comment">// xå¯ä»¥æ¥æ”¶*dogç±»å‹</span></span><br><span class="line">  x.move()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æŒ‡é’ˆå®ç°çš„æ¥å£</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *dog)</span></span> move() &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;ç‹—ä¼šåŠ¨&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> x Mover</span><br><span class="line">  <span class="keyword">var</span> poi_rec = &amp;dog&#123;&#125; <span class="comment">// *dogç±»å‹</span></span><br><span class="line">  x = poi_rec         </span><br><span class="line">  <span class="comment">// xåªèƒ½æ¥æ”¶*dogç±»å‹</span></span><br><span class="line">  x.move()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>æ¥å£ç±»å‹å˜é‡</li>
</ul>
<p>æ¥å£ç±»å‹å˜é‡å¯ä»¥æ¥æ”¶ä»»ä½•å®ç°äº†è¯¥æ¥å£çš„ç±»å‹</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¦‚æœæœ‰ä¸€ä¸ªSayeræ¥å£ï¼Œå…¶å†…éƒ¨æœ‰sayæ–¹æ³•</span></span><br><span class="line"><span class="comment">//catç»“æ„ä½“å’Œdogç»“æ„ä½“éƒ½å®ç°äº†sayæ–¹æ³•</span></span><br><span class="line"><span class="keyword">var</span> x Sayer</span><br><span class="line">a := cat&#123;&#125; </span><br><span class="line">b := dog&#123;&#125;</span><br><span class="line">x = a       <span class="comment">// å¯ä»¥æŠŠcatå®ä¾‹ç›´æ¥èµ‹å€¼ç»™x</span></span><br><span class="line">x.say()   </span><br><span class="line">x = b       <span class="comment">// å¯ä»¥æŠŠdogå®ä¾‹ç›´æ¥èµ‹å€¼ç»™x</span></span><br><span class="line">x.say()    </span><br></pre></td></tr></table></figure>

<ul>
<li>æ¥å£åµŒå¥—</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Sayer æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> Sayer <span class="keyword">interface</span> &#123;</span><br><span class="line">  say()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Mover æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> Mover <span class="keyword">interface</span> &#123;</span><br><span class="line">  move()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥å£åµŒå¥—ï¼Œç”Ÿæˆæ–°çš„animalæ¥å£</span></span><br><span class="line"><span class="keyword">type</span> animal <span class="keyword">interface</span> &#123;</span><br><span class="line">  Sayer</span><br><span class="line">  Mover</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è®©ä¸€ä¸ªç»“æ„ä½“åŒæ—¶å®ç°say()æ–¹æ³•å’Œmove()æ–¹æ³•ï¼Œå³ä¸ºå®ç°animalæ¥å£</p>
<ul>
<li>æ¥å£ç±»å‹æ–­è¨€</li>
</ul>
<p>æ¥å£ç±»å‹æ–­è¨€ç”¨äºç©ºæ¥å£å­˜å‚¨å˜é‡æ—¶ï¼Œæ¨æ–­å‡ºå˜é‡çš„ç±»å‹ï¼Œæ ¼å¼x.(T)ï¼šxæ˜¯ç©ºæ¥å£å˜é‡ï¼ŒTæ˜¯æ¨æ–­ç±»å‹</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//x.(T)è¿”å›ä¸¤ä¸ªå˜é‡ï¼Œç¬¬ä¸€ä¸ªæ˜¯xè½¬æ¢ä¸ºTç±»å‹åçš„å€¼ï¼Œç¬¬äºŒä¸ªæ˜¯boolå€¼ï¼Œåæ˜ æ˜¯å¦æ¨æ–­æ­£ç¡®</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> x <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">  x = <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  v, ok := x.(<span class="type">string</span>)</span><br><span class="line">  <span class="keyword">if</span> ok &#123;</span><br><span class="line">    fmt.Println(v)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;ç±»å‹æ–­è¨€å¤±è´¥&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="15-åå°„"><a href="#15-åå°„" class="headerlink" title="15 åå°„"></a>15 åå°„</h2><blockquote>
<p>ğŸ“Œè¡¥å……çŸ¥è¯†ï¼šç»“æ„ä½“æ ‡ç­¾(tag)ï¼Œåªç”¨äºåå°„æœºåˆ¶ï¼Œæ ¼å¼ä¸º <code>key1:&quot;value1&quot; key2:&quot;value2&quot;</code></p>
</blockquote>
<ul>
<li>é™æ€ç¼–è¯‘è¯­è¨€åœ¨ç¼–è¯‘æ—¶ï¼Œä¼šå°†å˜é‡è½¬æ¢æˆå†…å­˜åœ°å€ï¼Œå…³äºå˜é‡çš„ä¿¡æ¯å°†æ¶ˆå¤±ä¸è§ï¼Œä¹Ÿæ— ä»è·å–ï¼›</li>
</ul>
<p>ä½†æ˜¯goè¯­è¨€å¼•å…¥äº†åå°„æœºåˆ¶ï¼Œå¯ä»¥å°†å˜é‡çš„ä¿¡æ¯(å˜é‡åã€å˜é‡ç±»å‹ç­‰)æ•´åˆåˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œä»è€Œèƒ½å¤Ÿå®ç°åœ¨ç¨‹åºè¿è¡Œæ—¶å¯¹å˜é‡ä¿¡æ¯çš„è®¿é—®ã€‚é‡‡ç”¨reflectåŒ…çš„APIè¿›è¡Œåå°„æ“ä½œï¼</p>
<p><img src="/image/image_-v0q2QWlX3.png"></p>
<ul>
<li>reflect.TypeOf()ï¼šè·å–å˜é‡ç±»å‹</li>
</ul>
<p>è¿”å›çš„å˜é‡æ˜¯reflect.Typeå®ä¾‹ï¼Œè¯¥å®ä¾‹å«æœ‰ä¸¤ä¸ªé‡è¦æ–¹æ³•Nameå’ŒKindï¼Œå‰è€…è¿”å›ç±»å‹å(åŒ…æ‹¬è‡ªå®šä¹‰ç±»å‹å)ï¼Œåè€…æ˜¯æ›´åŠ åº•å±‚çš„ç±»å‹ï¼Œæ¯”å¦‚Nameä¼šè¿”å›ç»“æ„ä½“åï¼Œè€ŒKindåˆ™æ˜¯struct</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> myInt <span class="type">int64</span></span><br><span class="line"><span class="comment">//è·å–ç±»å‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reflectType</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">  t := reflect.TypeOf(x)</span><br><span class="line">  fmt.Printf(<span class="string">&quot;type:%v kind:%v\n&quot;</span>, t.Name(), t.Kind())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> a *<span class="type">float32</span> <span class="comment">// æŒ‡é’ˆ</span></span><br><span class="line">  <span class="keyword">var</span> b myInt    <span class="comment">// è‡ªå®šä¹‰ç±»å‹</span></span><br><span class="line">  <span class="keyword">var</span> c <span class="type">rune</span>     <span class="comment">// ç±»å‹åˆ«å</span></span><br><span class="line">  reflectType(a) <span class="comment">// type:      kind:ptr</span></span><br><span class="line">  reflectType(b) <span class="comment">// type:myInt kind:int64</span></span><br><span class="line">  reflectType(c) <span class="comment">// type:int32 kind:int32</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="type">string</span></span><br><span class="line">    age  <span class="type">int</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> d = person&#123;</span><br><span class="line">    name: <span class="string">&quot;Oliver&quot;</span>,</span><br><span class="line">    age:  <span class="number">18</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  reflectType(d) <span class="comment">// type:person kind:struct</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ•°ç»„ã€åˆ‡ç‰‡ã€Mapã€æŒ‡é’ˆç­‰ç±»å‹çš„å˜é‡ï¼ŒNameéƒ½æ˜¯è¿”å›ç©º</p>
<ul>
<li>reflect.ValueOf()ï¼šè·å–å€¼ä¿¡æ¯ï¼Œå³å¯è¯»å€¼ï¼Œåˆå¯æ”¹å€¼</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¯»å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reflectValue</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">  v := reflect.ValueOf(x)</span><br><span class="line">  k := v.Kind()</span><br><span class="line">  <span class="keyword">switch</span> k &#123;</span><br><span class="line">  <span class="keyword">case</span> reflect.Int64:</span><br><span class="line">    <span class="comment">// v.Int()ä»åå°„ä¸­è·å–æ•´å‹çš„åŸå§‹å€¼ï¼Œç„¶åé€šè¿‡int64()å¼ºåˆ¶ç±»å‹è½¬æ¢</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;type is int64, value is %d\n&quot;</span>, <span class="type">int64</span>(v.Int()))</span><br><span class="line">  <span class="keyword">case</span> reflect.Float32:</span><br><span class="line">    <span class="comment">// v.Float()ä»åå°„ä¸­è·å–æµ®ç‚¹å‹çš„åŸå§‹å€¼ï¼Œç„¶åé€šè¿‡float32()å¼ºåˆ¶ç±»å‹è½¬æ¢</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;type is float32, value is %f\n&quot;</span>, <span class="type">float32</span>(v.Float()))</span><br><span class="line">  <span class="keyword">case</span> reflect.Float64:</span><br><span class="line">    <span class="comment">// v.Float()ä»åå°„ä¸­è·å–æµ®ç‚¹å‹çš„åŸå§‹å€¼ï¼Œç„¶åé€šè¿‡float64()å¼ºåˆ¶ç±»å‹è½¬æ¢</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;type is float64, value is %f\n&quot;</span>, <span class="type">float64</span>(v.Float()))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> a <span class="type">float32</span> = <span class="number">3.14</span></span><br><span class="line">  <span class="keyword">var</span> b <span class="type">int64</span> = <span class="number">100</span></span><br><span class="line">  reflectValue(a) <span class="comment">// type is float32, value is 3.140000</span></span><br><span class="line">  reflectValue(b) <span class="comment">// type is int64, value is 100</span></span><br><span class="line">  <span class="comment">// å°†intç±»å‹çš„åŸå§‹å€¼è½¬æ¢ä¸ºreflect.Valueç±»å‹</span></span><br><span class="line">  c := reflect.ValueOf(<span class="number">10</span>)</span><br><span class="line">  fmt.Printf(<span class="string">&quot;type c :%T\n&quot;</span>, c) <span class="comment">// type c :reflect.Value</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>reflect.Valueå¯ç”¨è½¬æ¢ç±»å‹æ–¹æ³•ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>Int() int64</td>
<td>å°†å€¼ä»¥ int ç±»å‹è¿”å›ï¼Œæ‰€æœ‰æœ‰ç¬¦å·æ•´å‹å‡å¯ä»¥æ­¤æ–¹å¼è¿”å›</td>
</tr>
<tr>
<td>Uint() uint64</td>
<td>å°†å€¼ä»¥ uint ç±»å‹è¿”å›ï¼Œæ‰€æœ‰æ— ç¬¦å·æ•´å‹å‡å¯ä»¥æ­¤æ–¹å¼è¿”å›</td>
</tr>
<tr>
<td>Float() float64</td>
<td>å°†å€¼ä»¥åŒç²¾åº¦ï¼ˆfloat64ï¼‰ç±»å‹è¿”å›ï¼Œæ‰€æœ‰æµ®ç‚¹æ•°ï¼ˆfloat32ã€float64ï¼‰å‡å¯ä»¥æ­¤æ–¹å¼è¿”å›</td>
</tr>
<tr>
<td>Bool() bool</td>
<td>å°†å€¼ä»¥ bool ç±»å‹è¿”å›</td>
</tr>
<tr>
<td>Bytes() []byts</td>
<td>å°†å€¼ä»¥å­—èŠ‚æ•°ç»„ []bytes ç±»å‹è¿”å›</td>
</tr>
<tr>
<td>String() string</td>
<td>å°†å€¼ä»¥å­—ç¬¦ä¸²ç±»å‹è¿”å›</td>
</tr>
<tr>
<td>Interface() interface{}</td>
<td>å°†å€¼ä»¥ interface{} ç±»å‹è¿”å›ï¼Œå¯ä»¥é€šè¿‡ç±»å‹æ–­è¨€è½¬æ¢ä¸ºæŒ‡å®šç±»å‹</td>
</tr>
</tbody></table>
<p>ä¿®æ”¹å€¼çš„æ—¶å€™éœ€è¦æ³¨æ„ï¼</p>
<p>å¿…é¡»ç”¨Elemæ‰èƒ½ä¿®æ”¹åœ°å€å¯¹åº”çš„å€¼ï¼Œä¸ç”¨Elemæœ€ååªèƒ½ä¿®æ”¹æ‹·è´å€¼ï¼Œä¼šå¼•èµ·panicï¼</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ”¹å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reflectSetValue1</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">  v := reflect.ValueOf(x)</span><br><span class="line">  <span class="keyword">if</span> v.Kind() == reflect.Int64 &#123;</span><br><span class="line">    v.SetInt(<span class="number">200</span>) <span class="comment">//ä¿®æ”¹çš„æ˜¯å‰¯æœ¬ï¼ŒreflectåŒ…ä¼šå¼•å‘panic</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reflectSetValue2</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">  v := reflect.ValueOf(x)</span><br><span class="line">  <span class="comment">// åå°„ä¸­ä½¿ç”¨ Elem()æ–¹æ³•è·å–æŒ‡é’ˆå¯¹åº”çš„å€¼</span></span><br><span class="line">  <span class="keyword">if</span> v.Elem().Kind() == reflect.Int64 &#123;</span><br><span class="line">    v.Elem().SetInt(<span class="number">200</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> a <span class="type">int64</span> = <span class="number">100</span></span><br><span class="line">  <span class="comment">// reflectSetValue1(a) //panic: reflect: reflect.Value.SetInt using unaddressable value</span></span><br><span class="line">  reflectSetValue2(&amp;a)</span><br><span class="line">  fmt.Println(a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ç»“æ„ä½“åå°„</li>
</ul>
<p>ç»“æ„ä½“åå°„å¯ä»¥ç”¨æ¥åœ¨è¿è¡Œæ—¶è·å–ç»“æ„ä½“çš„å±æ€§å’Œæ–¹æ³•</p>
<p>reflect.Typeå¯ç”¨ç»“æ„ä½“åå°„æ–¹æ³•ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>NumField() int</td>
<td>è¿”å›ç»“æ„ä½“æˆå‘˜å­—æ®µæ•°é‡ã€‚</td>
</tr>
<tr>
<td>FieldByName(name string) (StructField, bool)</td>
<td>æ ¹æ®ç»™å®šå­—ç¬¦ä¸²è¿”å›å­—ç¬¦ä¸²å¯¹åº”çš„ç»“æ„ä½“å­—æ®µçš„ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td>FieldByIndex(index []int) StructField</td>
<td>å¤šå±‚æˆå‘˜è®¿é—®æ—¶ï¼Œæ ¹æ® []int æä¾›çš„æ¯ä¸ªç»“æ„ä½“çš„å­—æ®µç´¢å¼•ï¼Œè¿”å›å­—æ®µçš„ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td>FieldByNameFunc(match func(string) bool) (StructField,bool)</td>
<td>æ ¹æ®ä¼ å…¥çš„åŒ¹é…å‡½æ•°åŒ¹é…éœ€è¦çš„å­—æ®µã€‚</td>
</tr>
<tr>
<td>NumMethod() int</td>
<td>è¿”å›è¯¥ç±»å‹çš„æ–¹æ³•é›†ä¸­æ–¹æ³•çš„æ•°ç›®</td>
</tr>
<tr>
<td>Method(int) Method</td>
<td>è¿”å›è¯¥ç±»å‹æ–¹æ³•é›†ä¸­çš„ç¬¬iä¸ªæ–¹æ³•</td>
</tr>
</tbody></table>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ©ç”¨Fieldæ–¹æ³•è·å–çš„æ˜¯ä¸€ä¸ªStructFieldå®ä¾‹ï¼Œè¯¥ç»“æ„ä½“ç»“æ„ä¸º</span></span><br><span class="line"><span class="keyword">type</span> StructField <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// Nameæ˜¯å­—æ®µçš„åå­—ã€‚PkgPathæ˜¯éå¯¼å‡ºå­—æ®µçš„åŒ…è·¯å¾„ï¼Œå¯¹å¯¼å‡ºå­—æ®µè¯¥å­—æ®µä¸º&quot;&quot;ã€‚</span></span><br><span class="line">    <span class="comment">// å‚è§http://golang.org/ref/spec#Uniqueness_of_identifiers</span></span><br><span class="line">    Name    <span class="type">string</span></span><br><span class="line">    PkgPath <span class="type">string</span></span><br><span class="line">    Type      Type      <span class="comment">// å­—æ®µçš„ç±»å‹</span></span><br><span class="line">    Tag       StructTag <span class="comment">// å­—æ®µçš„æ ‡ç­¾</span></span><br><span class="line">    Offset    <span class="type">uintptr</span>   <span class="comment">// å­—æ®µåœ¨ç»“æ„ä½“ä¸­çš„å­—èŠ‚åç§»é‡</span></span><br><span class="line">    Index     []<span class="type">int</span>     <span class="comment">// ç”¨äºType.FieldByIndexæ—¶çš„ç´¢å¼•åˆ‡ç‰‡</span></span><br><span class="line">    Anonymous <span class="type">bool</span>      <span class="comment">// æ˜¯å¦åŒ¿åå­—æ®µ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è·å–æ–¹æ³•</span></span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name  <span class="type">string</span> <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">  Score <span class="type">int</span>    <span class="string">`json:&quot;score&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  stu1 := student&#123;</span><br><span class="line">    Name:  <span class="string">&quot;å°ç‹å­&quot;</span>,</span><br><span class="line">    Score: <span class="number">90</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  t := reflect.TypeOf(stu1)</span><br><span class="line">  fmt.Println(t.Name(), t.Kind()) <span class="comment">// student struct</span></span><br><span class="line">  <span class="comment">// é€šè¿‡forå¾ªç¯éå†ç»“æ„ä½“çš„æ‰€æœ‰å­—æ®µä¿¡æ¯</span></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; t.NumField(); i++ &#123;</span><br><span class="line">    field := t.Field(i)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;name:%s index:%d type:%v json tag:%v\n&quot;</span>, field.Name, field.Index, field.Type, field.Tag.Get(<span class="string">&quot;json&quot;</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é€šè¿‡å­—æ®µåè·å–æŒ‡å®šç»“æ„ä½“å­—æ®µä¿¡æ¯</span></span><br><span class="line">  <span class="keyword">if</span> scoreField, ok := t.FieldByName(<span class="string">&quot;Score&quot;</span>); ok &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;name:%s index:%d type:%v json tag:%v\n&quot;</span>, scoreField.Name, scoreField.Index, scoreField.Type, scoreField.Tag.Get(<span class="string">&quot;json&quot;</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è·å–æ–¹æ³•</span></span><br><span class="line"><span class="comment">// ç»™studentæ·»åŠ ä¸¤ä¸ªæ–¹æ³• Studyå’ŒSleep(æ³¨æ„é¦–å­—æ¯å¤§å†™)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s student)</span></span> Study() <span class="type">string</span> &#123;</span><br><span class="line">  msg := <span class="string">&quot;å¥½å¥½å­¦ä¹ ï¼Œå¤©å¤©å‘ä¸Šã€‚&quot;</span></span><br><span class="line">  fmt.Println(msg)</span><br><span class="line">  <span class="keyword">return</span> msg</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s student)</span></span> Sleep() <span class="type">string</span> &#123;</span><br><span class="line">  msg := <span class="string">&quot;å¥½å¥½ç¡è§‰ï¼Œå¿«å¿«é•¿å¤§ã€‚&quot;</span></span><br><span class="line">  fmt.Println(msg)</span><br><span class="line">  <span class="keyword">return</span> msg</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printMethod</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">  t := reflect.TypeOf(x)</span><br><span class="line">  v := reflect.ValueOf(x)</span><br><span class="line"></span><br><span class="line">  fmt.Println(t.NumMethod())</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; v.NumMethod(); i++ &#123;</span><br><span class="line">    methodType := v.Method(i).Type()</span><br><span class="line">    fmt.Printf(<span class="string">&quot;method name:%s\n&quot;</span>, t.Method(i).Name)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;method:%s\n&quot;</span>, methodType)</span><br><span class="line">    <span class="comment">// é€šè¿‡åå°„è°ƒç”¨æ–¹æ³•ä¼ é€’çš„å‚æ•°å¿…é¡»æ˜¯ []reflect.Value ç±»å‹</span></span><br><span class="line">    <span class="keyword">var</span> args = []reflect.Value&#123;&#125;</span><br><span class="line">    v.Method(i).Call(args)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ä¸Šé¢å³è¾¹çš„ä»£ç è™½ç„¶è·å–äº†æ–¹æ³•çš„ä¿¡æ¯ï¼Œä½†ä¹Ÿæœ‰é™Œç”Ÿçš„è°ƒç”¨æ–¹æ³•çš„æ“ä½œmethod.Call()</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ©ç”¨åå°„è°ƒç”¨å‡½æ•°æˆ–æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn</span><span class="params">(p1, p2 <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> p1 + p2</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  valueFunc := reflect.ValueOf(fn)<span class="comment">//reflect.Valueå®ä¾‹æ˜¯å‡½æ•°ï¼Œè¾“å…¥å€¼å’Œè¿”å›å€¼éƒ½æ˜¯[]reflect.Valueç±»å‹</span></span><br><span class="line">  paramList := []reflect.Value&#123;</span><br><span class="line">    reflect.ValueOf(<span class="number">22</span>),<span class="comment">//è®¾ç½®ç¬¬ä¸€ä¸ªå‚æ•°</span></span><br><span class="line">    reflect.ValueOf(<span class="number">20</span>),<span class="comment">//è®¾ç½®ç¬¬äºŒä¸ªå‚æ•°</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åå°„è°ƒç”¨å‡½æ•°</span></span><br><span class="line">  resultList := valueFunc.Call(paramList)</span><br><span class="line">  <span class="comment">// è·å–ç¬¬ä¸€ä¸ªè¿”å›å€¼, å–æ•´æ•°å€¼</span></span><br><span class="line">  fmt.Println(resultList[<span class="number">0</span>].Int()) <span class="comment">// 42</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ“Œåå°„çš„ä¼˜åŠ£<br>ä¼˜ç‚¹ï¼šæ­é…æ¥å£å®ç°æ³›å‹ï¼Œä»£ç æ›´çµæ´»<br>ç¼ºç‚¹ï¼šæ€§èƒ½ä½ä¸‹ï¼Œä½¿ç”¨åå°„çš„ä»£ç é€šå¸¸æ¯”æ­£å¸¸ä»£ç æ…¢ä¸€ä¸¤ä¸ªæ•°é‡çº§<br>&amp;#x20;         ä»£ç è„†å¼±ï¼Œå¼•èµ·panicæ˜¯çœŸæ­£è¿è¡Œæ—¶ï¼Œä»£ç å†™å®Œå¾ˆé•¿æ—¶é—´å</p>
</blockquote>
<h2 id="16-å¹¶å‘"><a href="#16-å¹¶å‘" class="headerlink" title="16 å¹¶å‘"></a>16 å¹¶å‘</h2><ul>
<li>goroutineåç¨‹</li>
</ul>
<p>goè°ƒç”¨åç¨‹åªéœ€è¦åœ¨è¢«è°ƒç”¨çš„å‡½æ•°å‰åŠ ä¸Šgoå³å¯</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span>&#123;</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;sync&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup                 <span class="comment">//ä¿¡å·é‡ï¼Œè®¡æ•°å™¨</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(i <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;Hello Goroutine!&quot;</span>, i)</span><br><span class="line">  wg.Done()                           <span class="comment">//æ¯å½“ä¸€ä¸ªåç¨‹æ‰§è¡Œå®Œï¼Œéœ€è¦è®¡æ•°å™¨å‡ä¸€</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  wg.Add(<span class="number">10000</span>)                       <span class="comment">//å› ä¸ºæœ‰10000ä¸ªåç¨‹ï¼Œæ‰€ä»¥è¦ç»™è®¡æ•°å™¨åŠ 10000</span></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++ &#123;</span><br><span class="line">    <span class="keyword">go</span> hello(i)                       <span class="comment">//æ‰§è¡Œ10000ä¸ªåç¨‹</span></span><br><span class="line">  &#125;</span><br><span class="line">  wg.Wait()                           <span class="comment">// ç­‰å¾…æ‰€æœ‰ç™»è®°çš„goroutineéƒ½ç»“æŸ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>goroutineè°ƒç”¨åŒ¿åå‡½æ•°ï¼Œéœ€è¦æ³¨æ„é—­åŒ…æƒ…å½¢</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*é”™è¯¯å†™æ³•*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  wg.Add(<span class="number">10000</span>)                       </span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++ &#123;</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span> <span class="params">()</span></span>&#123;<span class="comment">//åŒ¿åå‡½æ•°</span></span><br><span class="line">      fmt.Println(<span class="string">&quot;Hello Goroutine!&quot;</span>,i)</span><br><span class="line">      wg.Done()                  </span><br><span class="line">    &#125;()<span class="comment">//æ­¤æ—¶å½¢æˆäº†é—­åŒ…</span></span><br><span class="line">  &#125;</span><br><span class="line">  wg.Wait()                </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*æ­£ç¡®å†™æ³•*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  wg.Add(<span class="number">10000</span>)                       </span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++ &#123;</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span> <span class="params">(i <span class="type">int</span>)</span></span>&#123;<span class="comment">//åŒ¿åå‡½æ•°</span></span><br><span class="line">      fmt.Println(<span class="string">&quot;Hello Goroutine!&quot;</span>,i)</span><br><span class="line">      wg.Done()                  </span><br><span class="line">    &#125;(i)<span class="comment">//å°†å‚æ•°ç›´æ¥ä¼ å…¥çº¿ç¨‹ï¼Œé¿å…é—­åŒ…</span></span><br><span class="line">  &#125;</span><br><span class="line">  wg.Wait()                </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢å·¦è¾¹çš„å†™æ³•æ„æˆäº†é—­åŒ…ï¼Œä¹Ÿå°±æ˜¯iè‡ªå¢æ—¶ï¼Œå‚æ•°å¹¶æœªä¼ å…¥å¯¹åº”åç¨‹ï¼Œè€Œå¯¹åº”åç¨‹å°†è¦æ‰§è¡Œæ—¶ æ‰ä»å¤–éƒ¨è·å–içš„å€¼ï¼Œè€Œæ­¤æ—¶iå¯èƒ½å·²ç»è‡ªå¢å¾ˆå¤šã€‚æ‰€ä»¥å·¦è¾¹çš„ä»£ç æœ€åä¼šè¾“å‡ºå¤§é‡çš„10000</p>
<p>æ­¤å¤–ï¼Œå¯ä»¥é€šè¿‡GOMAXPROCSå‚æ•°è®¾ç½®è¦å°†åç¨‹åˆ†é…ç»™å¤šå°‘ä¸ªOSçº¿ç¨‹ï¼Œé»˜è®¤ä½¿ç”¨å…¨éƒ¨ç‰©ç†çº¿ç¨‹</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span>&#123;</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;sync&quot;</span></span><br><span class="line">  <span class="string">&quot;runtime&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">a</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;A:&quot;</span>, i)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">b</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;B:&quot;</span>, i)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  runtime.GOMAXPROCS(<span class="number">1</span>)<span class="comment">//åªæœ‰ä¸€ä¸ªç‰©ç†æ ¸å¿ƒï¼Œå¹¶è¡Œä¹Ÿä¸²è¡Œ</span></span><br><span class="line">  <span class="keyword">go</span> a()</span><br><span class="line">  <span class="keyword">go</span> b()</span><br><span class="line">  time.Sleep(time.Second)<span class="comment">//ç­‰å¾…æ‰€æœ‰çº¿ç¨‹ç»“æŸ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>channel</li>
</ul>
<p>channelå°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—(å…ˆå…¥å…ˆå‡º)ï¼Œç”¨äºåç¨‹ä¹‹é—´çš„é€šä¿¡ï¼Œæ ¼å¼ä¸ºï¼švar å˜é‡ chan æ•°æ®ç±»å‹</p>
<p>æˆ–ï¼šmake(chan å…ƒç´ ç±»å‹, [ç¼“å†²å¤§å°])</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ–°å»ºchannel</span></span><br><span class="line"><span class="keyword">var</span> ch1 <span class="keyword">chan</span> <span class="type">int</span>   <span class="comment">// å£°æ˜ä¸€ä¸ªä¼ é€’æ•´å‹çš„é€šé“</span></span><br><span class="line"><span class="keyword">var</span> ch2 <span class="keyword">chan</span> <span class="type">bool</span>  <span class="comment">// å£°æ˜ä¸€ä¸ªä¼ é€’å¸ƒå°”å‹çš„é€šé“</span></span><br><span class="line"><span class="keyword">var</span> ch3 <span class="keyword">chan</span> []<span class="type">int</span> <span class="comment">// å£°æ˜ä¸€ä¸ªä¼ é€’intåˆ‡ç‰‡çš„é€šé“</span></span><br><span class="line">ch4 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">ch5 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>)</span><br><span class="line">ch6 := <span class="built_in">make</span>(<span class="keyword">chan</span> []<span class="type">int</span>)</span><br></pre></td></tr></table></figure>

<p>å¯¹äºchannelï¼Œæœ‰å‘é€ã€æ¥æ”¶ã€å…³é—­ä¸‰ç§æ“ä½œï¼Œå‰ä¸¤è€…ä½¿ç”¨&lt; - ç¬¦å·ä¼ é€’æ•°æ®</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å‘é€</span></span><br><span class="line">ch &lt;- <span class="number">10</span>   <span class="comment">// æŠŠ10å‘é€åˆ°chä¸­</span></span><br><span class="line"><span class="comment">//æ¥æ”¶</span></span><br><span class="line">x := &lt;- ch <span class="comment">// ä»chä¸­æ¥æ”¶å€¼å¹¶èµ‹å€¼ç»™å˜é‡x</span></span><br><span class="line">&lt;-ch       <span class="comment">// ä»chä¸­æ¥æ”¶å€¼ï¼Œå¿½ç•¥ç»“æœ</span></span><br><span class="line"><span class="comment">//å…³é—­</span></span><br><span class="line"><span class="built_in">close</span>(ch)</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“channelå…³é—­åï¼Œä¸å¯å†å‘channelå…³é—­å€¼ï¼Œå¯ä»¥æ¥æ”¶ï¼Œå¦‚æœå…¨éƒ¨æ¥æ”¶å®Œï¼Œå†æ¥æ”¶å°±æ˜¯è¯¥ç±»å‹çš„é›¶å€¼ã€‚channelä¸èƒ½é‡å¤å…³é—­ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ— ç¼“å†²channel</span></span><br><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line"><span class="comment">//æ— ç¼“å†²channelå¦‚æœæ²¡æœ‰æ¥æ”¶æ“ä½œæ—¶å°±æ‰§è¡Œå‘é€ï¼Œæœ€åç¨‹åºä¼šè¿›å…¥æ­»é”ï¼Œæ‰€ä»¥å¯¹äºæ— ç¼“å†²å¿…é¡»è¦æœ‰æ¥æ”¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æœ‰ç¼“å†²channel</span></span><br><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)<span class="comment">//æŒ‡å®šç¼“å†²åŒºå¤§å°ä¸º1</span></span><br><span class="line"><span class="comment">//å‘é€åæ— æ¥æ”¶ä¼šé˜»å¡ä¸‹ä¸€æ¬¡å‘é€ï¼Œç›´è‡³æ¥æ”¶å®Œ</span></span><br></pre></td></tr></table></figure>

<p>æ— ç¼“å†²å¯ä»¥å®ç°goroutineåŒæ­¥</p>
<ul>
<li>channelè¢«å…³é—­åï¼Œè‹¥ä¸€ç›´æ¥æ”¶æœ€åä¼šæ— é™æ¥æ”¶é›¶å€¼ï¼Œæ‰€ä»¥éœ€è¦æœºåˆ¶åˆ¤æ–­channelä¸ºç©º</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*******æœºåˆ¶1ï¼šåˆ©ç”¨æ¥æ”¶æ“ä½œæ—¶è¿”å›çš„å¸ƒå°”å€¼*******/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">  <span class="comment">// å¼€å¯goroutineå°†0~100çš„æ•°å‘é€åˆ°ch1ä¸­</span></span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">      ch1 &lt;- i</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(ch1)</span><br><span class="line">  &#125;()</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    i, ok := &lt;-ch1 <span class="comment">// é€šé“å…³é—­åå†å–å€¼æ—¶ï¼Œok=false</span></span><br><span class="line">    <span class="keyword">if</span> !ok &#123;</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*******æœºåˆ¶2ï¼šä½¿ç”¨for range*******/</span></span><br><span class="line"><span class="comment">// channel ç»ƒä¹ </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">  <span class="comment">// å¼€å¯goroutineå°†0~100çš„æ•°å‘é€åˆ°ch1ä¸­</span></span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">      ch1 &lt;- i</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(ch1)</span><br><span class="line">  &#125;()</span><br><span class="line">  <span class="comment">// åœ¨ä¸»goroutineä¸­ä»ch1ä¸­æ¥æ”¶å€¼æ‰“å°</span></span><br><span class="line">  <span class="keyword">for</span> i := <span class="keyword">range</span> ch1 &#123; <span class="comment">// é€šé“å…³é—­åä¼šé€€å‡ºfor rangeå¾ªç¯</span></span><br><span class="line">    fmt.Println(i)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>å•å‘é€šé“</li>
</ul>
<p>å•å‘é€šé“å°±æ˜¯åªèƒ½å‘é€æˆ–æ¥æ”¶ï¼Œåªæœ‰å•é¡¹æ“ä½œçš„é€šé“ï¼Œæ¯”å¦‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">chan</span>&lt;- <span class="type">int</span> <span class="comment">//åªå†™é€šé“ï¼Œåªèƒ½å‘è¯¥é€šé“è¾“å…¥intå€¼</span></span><br><span class="line">&lt;-<span class="keyword">chan</span> <span class="type">int</span> <span class="comment">//åªè¯»é€šé“ï¼Œåªèƒ½ä»è¯¥é€šé“è¯»å–intå€¼</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¾‹ç¨‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">counter</span><span class="params">(out <span class="keyword">chan</span>&lt;- <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">    out &lt;- i</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">close</span>(out)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">squarer</span><span class="params">(out <span class="keyword">chan</span>&lt;- <span class="type">int</span>, in &lt;-<span class="keyword">chan</span> <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="keyword">range</span> in &#123;</span><br><span class="line">    out &lt;- i * i</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">close</span>(out)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printer</span><span class="params">(in &lt;-<span class="keyword">chan</span> <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="keyword">range</span> in &#123;</span><br><span class="line">    fmt.Println(i)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">  ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">  <span class="keyword">go</span> counter(ch1)</span><br><span class="line">  <span class="keyword">go</span> squarer(ch2, ch1)</span><br><span class="line">  printer(ch2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Selectè¯­å¥</li>
</ul>
<p>selectç±»ä¼¼äºswitchï¼Œæœ‰å¾ˆå¤šcaseå’Œä¸€ä¸ªdefaultï¼Œç”¨æ¥åœ¨ä¸€ä¸ªè¯­å¥å—å¯¹å¤šä¸ªchannelè¿›è¡Œæ”¶å‘æ“ä½œï¼Œæ¯ä¸ªcaseå¯¹åº”ä¸€ä¸ªæ”¶å’Œå‘</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">1</span>)</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> x := &lt;-ch:</span><br><span class="line">      fmt.Println(x)</span><br><span class="line">    <span class="keyword">case</span> ch &lt;- i:</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¯æ¬¡å¯å¤„ç†ä¸€ä¸ªcaseï¼Œè‹¥æœ‰å¤šä¸ªcaseå¯æ‰§è¡Œæ“ä½œï¼Œä¼šéšæœºé€‰å–ä¸€ä¸ªæ‰§è¡Œ</p>
<p>æ²¡æœ‰caseçš„selectä¼šä¸€ç›´ç­‰å¾…ï¼Œé˜»å¡ç¨‹åº</p>
<ul>
<li>åŒæ­¥</li>
</ul>
<p>å½“å¤šä¸ªgoroutineåŒæ—¶æ“ä½œä¸€ä¸ªèµ„æº(ä¸´ç•ŒåŒº)æ—¶ï¼Œå°±æœ‰ç«æ€é—®é¢˜ï¼Œæ­¤æ—¶éœ€è¦åˆ©ç”¨é”å®ç°åŒæ­¥</p>
<p>äº’æ–¥é”sync.Mutexï¼šå½“ä¸€ä¸ªåç¨‹å°†èµ„æºé”ä½ï¼Œè¿›è¡Œæ“ä½œæ—¶ï¼Œå…¶å®ƒåç¨‹å¿…é¡»ç­‰å¾…è§£é”æ‰èƒ½è®¿é—®èµ„æº</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="type">int64</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> lock sync.Mutex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++ &#123;</span><br><span class="line">    lock.Lock() <span class="comment">// åŠ é”</span></span><br><span class="line">    x = x + <span class="number">1</span></span><br><span class="line">    lock.Unlock() <span class="comment">// è§£é”</span></span><br><span class="line">  &#125;</span><br><span class="line">  wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  wg.Add(<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">go</span> add()</span><br><span class="line">  <span class="keyword">go</span> add()</span><br><span class="line">  wg.Wait()</span><br><span class="line">  fmt.Println(x)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯»å†™äº’æ–¥é”sync.RWMutexï¼šèµ„æºè¢«ä¸€ä¸ªgoroutineä¸Šäº†å†™é”åï¼Œå…¶å®ƒååŒéƒ½å¿…é¡»ç­‰å¾…è§£é”æ‰èƒ½è¿›è¡Œè¯»å†™æ“ä½œï¼›è€Œè¢«ä¸Šäº†è¯»é”æ—¶ï¼Œå…¶å®ƒè¦è¿›è¡Œè¯»æ“ä½œçš„ååŒå¯ä»¥è¯»ï¼Œå†™æ“ä½œçš„åç¨‹éœ€è¦ç­‰å¾…</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">  x      <span class="type">int64</span></span><br><span class="line">  wg     sync.WaitGroup</span><br><span class="line">  lock   sync.Mutex</span><br><span class="line">  rwlock sync.RWMutex</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">write</span><span class="params">()</span></span> &#123;</span><br><span class="line">  rwlock.Lock() <span class="comment">// åŠ å†™é”</span></span><br><span class="line">  x = x + <span class="number">1</span></span><br><span class="line">  time.Sleep(<span class="number">10</span> * time.Millisecond) <span class="comment">// å‡è®¾è¯»æ“ä½œè€—æ—¶10æ¯«ç§’</span></span><br><span class="line">  rwlock.Unlock()                   <span class="comment">// è§£å†™é”</span></span><br><span class="line">  wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">read</span><span class="params">()</span></span> &#123;</span><br><span class="line">  rwlock.RLock()               <span class="comment">// åŠ è¯»é”</span></span><br><span class="line">  time.Sleep(time.Millisecond) <span class="comment">// å‡è®¾è¯»æ“ä½œè€—æ—¶1æ¯«ç§’</span></span><br><span class="line">  rwlock.RUnlock()             <span class="comment">// è§£è¯»é”</span></span><br><span class="line">  wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  start := time.Now()</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">    wg.Add(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">go</span> write()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line">    wg.Add(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">go</span> read()</span><br><span class="line">  &#125;</span><br><span class="line">  wg.Wait()</span><br><span class="line">  end := time.Now()</span><br><span class="line">  fmt.Println(end.Sub(start))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨è¯»å†™äº’æ–¥é”æ‰§è¡Œä¸Šé¢ä»£ç è¦æ¯”ç”¨äº’æ–¥é”å¿«åå€</p>
<ul>
<li>å¹¶å‘ä¸­çš„å•ä¾‹ï¼šsync.Once</li>
</ul>
<p>é’ˆå¯¹é«˜å¹¶å‘æƒ…å½¢ä¸‹åªæ‰§è¡Œä¸€æ¬¡çš„æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨sync.Onceé¿å…ä¸€ç³»åˆ—é—®é¢˜ï¼Œæ¯”å¦‚ä¸‹é¢ä¾‹å­</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> icons <span class="keyword">map</span>[<span class="type">string</span>]image.Image</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadIcons</span><span class="params">()</span></span> &#123;</span><br><span class="line">  icons = <span class="keyword">map</span>[<span class="type">string</span>]image.Image&#123;</span><br><span class="line">    <span class="string">&quot;left&quot;</span>:  loadIcon(<span class="string">&quot;left.png&quot;</span>),</span><br><span class="line">    <span class="string">&quot;up&quot;</span>:    loadIcon(<span class="string">&quot;up.png&quot;</span>),</span><br><span class="line">    <span class="string">&quot;right&quot;</span>: loadIcon(<span class="string">&quot;right.png&quot;</span>),</span><br><span class="line">    <span class="string">&quot;down&quot;</span>:  loadIcon(<span class="string">&quot;down.png&quot;</span>),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Iconè¢«å¤šä¸ªgoroutineè°ƒç”¨ä¸æ˜¯å¹¶å‘å®‰å…¨çš„</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Icon</span><span class="params">(name <span class="type">string</span>)</span></span> image.Image &#123;</span><br><span class="line">  <span class="keyword">if</span> icons == <span class="literal">nil</span> &#123;</span><br><span class="line">    loadIcons()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> icons[name]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadIcons</span><span class="params">()</span></span> &#123;</span><br><span class="line">  icons = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]image.Image)</span><br><span class="line">  icons[<span class="string">&quot;left&quot;</span>] = loadIcon(<span class="string">&quot;left.png&quot;</span>)</span><br><span class="line">  icons[<span class="string">&quot;up&quot;</span>] = loadIcon(<span class="string">&quot;up.png&quot;</span>)</span><br><span class="line">  icons[<span class="string">&quot;right&quot;</span>] = loadIcon(<span class="string">&quot;right.png&quot;</span>)</span><br><span class="line">  icons[<span class="string">&quot;down&quot;</span>] = loadIcon(<span class="string">&quot;down.png&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ç§æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªåç¨‹è°ƒç”¨Iconæ—¶ï¼Œå†™iconsè¿™ä¸ªmapåªå†™åˆ°ä¸€åŠï¼Œè¿˜æ²¡å†™åˆ°rightï¼Œå°±æœ‰å¦ä¸€ä¸ªåç¨‹è°ƒç”¨Iconäº†ã€‚</p>
<p>æ­¤æ—¶iconsä¸æ˜¯nilï¼Œä½†æ˜¯è¦è°ƒç”¨icons[â€œrightâ€]ï¼Œå¯¼è‡´é”™è¯¯ã€‚</p>
<p>ä½¿ç”¨sync.Onceçš„Doæ–¹æ³•æ‰§è¡Œifé‡Œçš„æ“ä½œå¯ä»¥è§£å†³è¿™ä¸€é—®é¢˜</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/****************æ­£ç¡®å†™æ³•*****************/</span></span><br><span class="line"><span class="keyword">var</span> icons <span class="keyword">map</span>[<span class="type">string</span>]image.Image</span><br><span class="line"><span class="keyword">var</span> loadIconsOnce sync.Once</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadIcons</span><span class="params">()</span></span> &#123;</span><br><span class="line">  icons = <span class="keyword">map</span>[<span class="type">string</span>]image.Image&#123;</span><br><span class="line">    <span class="string">&quot;left&quot;</span>:  loadIcon(<span class="string">&quot;left.png&quot;</span>),</span><br><span class="line">    <span class="string">&quot;up&quot;</span>:    loadIcon(<span class="string">&quot;up.png&quot;</span>),</span><br><span class="line">    <span class="string">&quot;right&quot;</span>: loadIcon(<span class="string">&quot;right.png&quot;</span>),</span><br><span class="line">    <span class="string">&quot;down&quot;</span>:  loadIcon(<span class="string">&quot;down.png&quot;</span>),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Icon æ˜¯å¹¶å‘å®‰å…¨çš„</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Icon</span><span class="params">(name <span class="type">string</span>)</span></span> image.Image &#123;</span><br><span class="line">  loadIconsOnce.Do(loadIcons)</span><br><span class="line">  <span class="keyword">return</span> icons[name]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sync.Onceç›¸å½“äºæœ‰ä¸€ä¸ªäº’æ–¥é”å’Œå¸ƒå°”å€¼ï¼Œå‰è€…ä¸Šé”ä¿æŠ¤ä¸´ç•Œèµ„æºå’Œå¸ƒå°”å€¼ï¼Œåè€…æ ‡è®°æ˜¯å¦æ‰§è¡Œè¿‡</p>
<ul>
<li>é¢å‘å¹¶å‘çš„mapï¼šsync.Map</li>
</ul>
<p>å¤šä¸ªåç¨‹åŒæ—¶å†™mapæ˜¯ä¸è¢«å…è®¸ä¹Ÿæ˜¯ä¸å®‰å…¨çš„ï¼Œè‹¥æƒ³ä¸åŠ é”çš„å‰æä¸‹ä½¿ç”¨mapï¼Œå¯ä»¥ç”¨sync.Map</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> m = sync.Map&#123;&#125;</span><br><span class="line"><span class="comment">//sync.Mapçš„è¯»æ“ä½œæ˜¯Loadæ–¹æ³•ï¼Œå†™æ“ä½œæ˜¯Storeæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  wg := sync.WaitGroup&#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">20</span>; i++ &#123;</span><br><span class="line">    wg.Add(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(n <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">      key := strconv.Itoa(n)</span><br><span class="line">      m.Store(key, n)</span><br><span class="line">      value, _ := m.Load(key)<span class="comment">//ç¬¬äºŒä¸ªè¿”å›å€¼æ˜¯å¸ƒå°”ç±»å‹ï¼Œåˆ¤æ–­æ˜¯å¦è¢«æ‰¾åˆ°</span></span><br><span class="line">      fmt.Printf(<span class="string">&quot;k=:%v,v:=%v\n&quot;</span>, key, value)</span><br><span class="line">      wg.Done()</span><br><span class="line">    &#125;(i)</span><br><span class="line">  &#125;</span><br><span class="line">  wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œsync.Mapçš„é”®å€¼éƒ½æ˜¯ç©ºæ¥å£ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥åœ¨åŒä¸€ä¸ªsync.Mapå­˜å‚¨ä»»æ„ç±»å‹çš„é”®-å€¼å¯¹ï¼Œè€Œä¸æ˜¯åƒä¼ ç»Ÿmapè¦æŠŠç±»å‹å†™æ­»</p>
<ul>
<li>åŸå­æ“ä½œ</li>
</ul>
<p>åŸå­æ“ä½œæ“ä½œæ•°æ®æ—¶æ˜¯ä¸å¯è¢«åˆ†å‰²çš„ï¼Œæ‰€ä»¥ä¸ä¼šè¢«å…¶å®ƒåç¨‹æŠ¢å ï¼Œå¹¶å‘å®‰å…¨ï¼Œè€Œä¸”æ€§èƒ½æ¯”äº’æ–¥é”ä¼˜å¼‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;sync&quot;</span></span><br><span class="line">  <span class="string">&quot;sync/atomic&quot;</span></span><br><span class="line">  <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Counter <span class="keyword">interface</span> &#123;</span><br><span class="line">  Inc()</span><br><span class="line">  Load() <span class="type">int64</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åŸå­æ“ä½œç‰ˆ</span></span><br><span class="line"><span class="keyword">type</span> AtomicCounter <span class="keyword">struct</span> &#123;</span><br><span class="line">  counter <span class="type">int64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *AtomicCounter)</span></span> Inc() &#123;</span><br><span class="line">  atomic.AddInt64(&amp;a.counter, <span class="number">1</span>)<span class="comment">//åŸå­æ–¹æ³•</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *AtomicCounter)</span></span> Load() <span class="type">int64</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> atomic.LoadInt64(&amp;a.counter)<span class="comment">//åŸå­æ–¹æ³•</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(c Counter)</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">  start := time.Now()</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line">    wg.Add(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      c.Inc()</span><br><span class="line">      wg.Done()</span><br><span class="line">    &#125;()</span><br><span class="line">  &#125;</span><br><span class="line">  wg.Wait()</span><br><span class="line">  end := time.Now()</span><br><span class="line">  fmt.Println(c.Load(), end.Sub(start))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  c3 := AtomicCounter&#123;&#125; <span class="comment">// å¹¶å‘å®‰å…¨ä¸”æ¯”äº’æ–¥é”æ•ˆç‡æ›´é«˜</span></span><br><span class="line">  test(&amp;c3)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="17-IOç¼–ç¨‹"><a href="#17-IOç¼–ç¨‹" class="headerlink" title="17 IOç¼–ç¨‹"></a>17 IOç¼–ç¨‹</h2><h3 id="17-1-æ–‡ä»¶IO"><a href="#17-1-æ–‡ä»¶IO" class="headerlink" title="17.1 æ–‡ä»¶IO"></a>17.1 æ–‡ä»¶IO</h3><p>æ–‡ä»¶è¯»å’Œå†™åˆ†åˆ«è‡³å°‘æœ‰ä¸‰ç§æ–¹å¼ï¼Œå¹¶ä¸”è¯»æ–‡ä»¶å’Œå†™æ–‡ä»¶æ—¶æ–‡ä»¶çš„æ‰“å¼€æ–¹å¼ä¹Ÿæ˜¯ä¸åŒçš„</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¯»---æ‰“å¼€æ–‡ä»¶:os.Open(æ–‡ä»¶å)</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// åªè¯»æ–¹å¼æ‰“å¼€å½“å‰ç›®å½•ä¸‹çš„main.goæ–‡ä»¶</span></span><br><span class="line">  file, err := os.Open(<span class="string">&quot;./main.go&quot;</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;open file failed!, err:&quot;</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å…³é—­æ–‡ä»¶</span></span><br><span class="line">  <span class="keyword">defer</span> file.Close()<span class="comment">//ç”¨deferä¿è¯æœ€åä¸€å®šä¼šå…³é—­æ–‡ä»¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å†™---æ‰“å¼€æ–‡ä»¶ï¼šos.OpenFile(æ–‡ä»¶å,æ¨¡å¼,æƒé™è®¾ç½®)</span></span><br><span class="line"><span class="comment">//æ¨¡å¼ï¼šos.O_WRONLY(åªå†™)ã€os.O_CREATE(åˆ›å»ºæ–‡ä»¶)ã€</span></span><br><span class="line"><span class="comment">//os.O_RDONLY(åªè¯»)ã€os.O_RDWR(è¯»å†™)ã€os.O_TRUNC(æ¸…ç©º)ã€os.O_APPEND(è¿½åŠ )</span></span><br><span class="line"><span class="comment">//æƒé™ï¼šrï¼ˆè¯»ï¼‰04ï¼Œwï¼ˆå†™ï¼‰02ï¼Œxï¼ˆæ‰§è¡Œï¼‰01</span></span><br><span class="line"><span class="comment">//   owner   group   other</span></span><br><span class="line"><span class="comment">//0 - rwx  -  rwx  -  rwx</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  file, err := os.OpenFile(<span class="string">&quot;xx.txt&quot;</span>, os.O_CREATE|os.O_TRUNC|os.O_WRONLY, <span class="number">0666</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;open file failed, err:&quot;</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">defer</span> file.Close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>è¯»æ–‡ä»¶çš„ä¸‰ç§æ–¹å¼</li>
</ul>
<p>æ–¹å¼ä¸€ï¼šfile.Read()ï¼Œä¼˜åŠ¿ï¼šåŸç”Ÿè¯»æ–‡ä»¶æ–¹å¼ï¼Œå¯ä»¥ç²¾å‡†æŠŠæ§è¯»åˆ°çš„å­—èŠ‚æ•°</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Read()å‡½æ•°ä¼šæ¥æ”¶ä¸€ä¸ªå­—èŠ‚æ•°ç»„åšå‚æ•°</span></span><br><span class="line"><span class="comment">//è¿”å›å­—èŠ‚æ•°å’Œerrorç±»å‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// åªè¯»æ–¹å¼æ‰“å¼€å½“å‰ç›®å½•ä¸‹çš„main.goæ–‡ä»¶</span></span><br><span class="line">  file, err := os.Open(<span class="string">&quot;./main.go&quot;</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Failed!, err:&quot;</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">defer</span> file.Close()</span><br><span class="line">  <span class="comment">// ä½¿ç”¨Readæ–¹æ³•è¯»å–æ•°æ®</span></span><br><span class="line">  <span class="keyword">var</span> tmp = <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">128</span>)</span><br><span class="line">  n, err := file.Read(tmp)</span><br><span class="line">  <span class="keyword">if</span> err == io.EOF &#123;<span class="comment">//è¯»å–å°‘äº128å­—èŠ‚ï¼Œè¯»å®Œäº†</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;æ–‡ä»¶è¯»å®Œäº†&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Failed, err:&quot;</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;è¯»å–äº†%då­—èŠ‚æ•°æ®\n&quot;</span>, n)</span><br><span class="line">  fmt.Println(<span class="type">string</span>(tmp[:n]))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¾ªç¯è¯»å–</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// åªè¯»æ–¹å¼æ‰“å¼€å½“å‰ç›®å½•ä¸‹çš„main.goæ–‡ä»¶</span></span><br><span class="line">  file, err := os.Open(<span class="string">&quot;./main.go&quot;</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;open failed!, err:&quot;</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">defer</span> file.Close()</span><br><span class="line">  <span class="comment">// å¾ªç¯è¯»å–æ–‡ä»¶</span></span><br><span class="line">  <span class="keyword">var</span> content []<span class="type">byte</span></span><br><span class="line">  <span class="keyword">var</span> tmp = <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">128</span>)</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    n, err := file.Read(tmp)</span><br><span class="line">    <span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">      fmt.Println(<span class="string">&quot;æ–‡ä»¶è¯»å®Œäº†&quot;</span>)</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">&quot;read failed, err:&quot;</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    content = <span class="built_in">append</span>(content, tmp[:n]...)</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println(<span class="type">string</span>(content))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–¹å¼äºŒï¼šbufioè¯»å–æ–‡ä»¶ï¼Œä¼˜åŠ¿ï¼šæä¾›å¤§é‡å‡½æ•°ï¼Œè¯»æ–‡ä»¶æ›´åŠ çµæ´»ï¼Œè€Œä¸”ä¼šå…ˆä»ç£ç›˜è¯»åˆ°ç¼“å­˜ï¼Œç„¶åä½¿ç”¨æ—¶å¯ç›´æ¥ä»ç¼“å­˜å–æ•°æ®ï¼Œå‡å°‘äº†ç£ç›˜IOå¸¦æ¥çš„ç“¶é¢ˆæ•ˆåº”ï¼Œé€Ÿåº¦å¿«</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;bufio&quot;</span></span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;io&quot;</span></span><br><span class="line">  <span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// bufioæŒ‰è¡Œè¯»å–ç¤ºä¾‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  file, err := os.Open(<span class="string">&quot;./xx.txt&quot;</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;open file failed, err:&quot;</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">defer</span> file.Close()</span><br><span class="line">  reader := bufio.NewReader(file)<span class="comment">//éœ€è¦newä¸€ä¸ªreaderå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    line, err := reader.ReadString(<span class="string">&#x27;\n&#x27;</span>) <span class="comment">//æ³¨æ„æ˜¯å­—ç¬¦</span></span><br><span class="line">    <span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">      <span class="keyword">if</span> <span class="built_in">len</span>(line) != <span class="number">0</span> &#123;</span><br><span class="line">        fmt.Println(line)</span><br><span class="line">      &#125;</span><br><span class="line">      fmt.Println(<span class="string">&quot;æ–‡ä»¶è¯»å®Œäº†&quot;</span>)</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">&quot;read file failed, err:&quot;</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Print(line)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–¹å¼ä¸‰ï¼šio&#x2F;ioutilåŒ…çš„ReadFileæ–¹æ³•ï¼Œä¼˜åŠ¿ï¼šå¯ä»¥ä¸€æ¬¡è¯»å–å®Œæ•´æ–‡ä»¶å†…å®¹ï¼Œä¸éœ€è¦Openã€Close</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ioutil.ReadFileè¯»å–æ•´ä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  content, err := ioutil.ReadFile(<span class="string">&quot;./main.go&quot;</span>)<span class="comment">//è¿”å›çš„æ˜¯å­—èŠ‚æ•°ç»„</span></span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;read file failed, err:&quot;</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println(<span class="type">string</span>(content))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>å†™æ–‡ä»¶çš„ä¸‰ç§æ–¹å¼</li>
</ul>
<p>æ–¹å¼ä¸€ï¼šosåŒ…çš„writeå’ŒwriteStringå‡½æ•°ï¼Œå‰è€…å†™å­—èŠ‚æ•°ç»„ï¼Œåè€…å†™å­—ç¬¦ä¸²</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  file, err := os.OpenFile(<span class="string">&quot;xx.txt&quot;</span>, os.O_CREATE|os.O_TRUNC|os.O_WRONLY, <span class="number">0666</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;open file failed, err:&quot;</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">defer</span> file.Close()</span><br><span class="line">  str := <span class="string">&quot;hello æ²™æ²³&quot;</span></span><br><span class="line">  file.Write([]<span class="type">byte</span>(str))       <span class="comment">//å†™å…¥å­—èŠ‚åˆ‡ç‰‡æ•°æ®</span></span><br><span class="line">  file.WriteString(<span class="string">&quot;hello å°ç‹å­&quot;</span>) <span class="comment">//ç›´æ¥å†™å…¥å­—ç¬¦ä¸²æ•°æ®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–¹å¼äºŒï¼šbufioçš„writerå¯¹è±¡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§æ–¹å¼å…ˆå†™åˆ°ç¼“å­˜é‡Œï¼Œå†åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼Œæ‰€ä»¥å†™å®Œåï¼Œéœ€è¦æ‰§è¡ŒFlushå‡½æ•°</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  file, err := os.OpenFile(<span class="string">&quot;xx.txt&quot;</span>, os.O_CREATE|os.O_TRUNC|os.O_WRONLY, <span class="number">0666</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;open file failed, err:&quot;</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">defer</span> file.Close()</span><br><span class="line">  writer := bufio.NewWriter(file)</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">    writer.WriteString(<span class="string">&quot;helloæ²™æ²³\n&quot;</span>) <span class="comment">//å°†æ•°æ®å…ˆå†™å…¥ç¼“å­˜</span></span><br><span class="line">  &#125;</span><br><span class="line">  writer.Flush() <span class="comment">//å°†ç¼“å­˜ä¸­çš„å†…å®¹å†™å…¥æ–‡ä»¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–¹å¼ä¸‰ï¼šio&#x2F;ioutilåŒ…çš„WriteFileæ–¹æ³•ï¼Œå…¶æœ€åä¸€ä¸ªå‚æ•°ä¸OpenFileçš„æœ€åä¸€ä¸ªå‚æ•°ä¸€è‡´</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸éœ€è¦OpenFileã€Close</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  str := <span class="string">&quot;hello æ²™æ²³&quot;</span></span><br><span class="line">  err := ioutil.WriteFile(<span class="string">&quot;./xx.txt&quot;</span>, []<span class="type">byte</span>(str), <span class="number">0666</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;write file failed, err:&quot;</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="17-2-logåŒ…è¾“å‡ºæ—¥å¿—"><a href="#17-2-logåŒ…è¾“å‡ºæ—¥å¿—" class="headerlink" title="17.2 logåŒ…è¾“å‡ºæ—¥å¿—"></a>17.2 logåŒ…è¾“å‡ºæ—¥å¿—</h3><p>goè¯­è¨€ä¸­çš„logåŒ…ä¸pythonä¸­çš„loggingéå¸¸ç›¸ä¼¼ï¼Œéƒ½æœ‰loggerï¼Œå¯ä»¥æŒ‡å®šè¾“å‡ºåˆ°æ§åˆ¶å°æˆ–æ–‡ä»¶ï¼Œæœ‰fomatterï¼Œä¸åŒä¿¡æ¯æœ‰ä¸åŒç­‰çº§ã€‚</p>
<p><a href="https://golang.org/pkg/log/" title="https://golang.org/pkg/log/">https://golang.org/pkg/log/</a></p>
<p><a href="https://www.bilibili.com/video/BV1QJ411X7CN?from=search&seid=2882714410354221537" title="https://www.bilibili.com/video/BV1QJ411X7CN?from=search&amp;seid=2882714410354221537">https://www.bilibili.com/video/BV1QJ411X7CN?from=search&amp;seid&#x3D;2882714410354221537</a></p>
<h3 id="17-3-fmtåŒ…"><a href="#17-3-fmtåŒ…" class="headerlink" title="17.3 fmtåŒ…"></a>17.3 fmtåŒ…</h3><h2 id="18-æ­£åˆ™è¡¨è¾¾å¼"><a href="#18-æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="18 æ­£åˆ™è¡¨è¾¾å¼"></a>18 æ­£åˆ™è¡¨è¾¾å¼</h2><p>Goè¯­è¨€çš„æ­£åˆ™è¡¨è¾¾å¼ç”¨åˆ°äº†â€regexpâ€åŒ…ï¼Œæ­£åˆ™æ ¼å¼å’Œpythonä¸­çš„æ— å¼‚ã€‚</p>
<p>æœ‰ä¸¤ç§æ–¹å¼è¿›è¡Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œä¸€ç§æ˜¯æ­£åˆ™å­—ç¬¦ä¸²ç›´æ¥æ‹¿æ¥åŒ¹é…ï¼Œå¦ä¸€ç§æ˜¯å°†æ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²é€šè¿‡å‡½æ•°ä¼˜åŒ–æˆgoè¯­è¨€çš„regexpå¯¹è±¡ï¼Œå†åˆ©ç”¨è¯¥å¯¹è±¡çš„æ–¹æ³•ã€‚åè€…æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç¬¬ä¸€ç§æ–¹å¼ï¼šæ­£åˆ™å­—ç¬¦ä¸²ç›´æ¥åŒ¹é…</span></span><br><span class="line">matched, err := regexp.MatchString(<span class="string">`a.b`</span>, <span class="string">&quot;aaxbb&quot;</span>)<span class="comment">//æ³¨æ„éœ€è¦ç”¨åå¼•å·</span></span><br><span class="line">fmt.Println(matched) <span class="comment">// true</span></span><br><span class="line">fmt.Println(err)     <span class="comment">// nil (regexp is valid)</span></span><br><span class="line"></span><br><span class="line">matched, _ := regexp.MatchString(<span class="string">`^a.b$`</span>, <span class="string">&quot;aaxbb&quot;</span>)</span><br><span class="line">fmt.Println(matched) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç¬¬äºŒç§æ–¹å¼ï¼šæ­£åˆ™å­—ç¬¦ä¸²å…ˆç¼–è¯‘æˆregexpå¯¹è±¡</span></span><br><span class="line"><span class="comment">//ä¸¤ç§ç¼–è¯‘æ–¹å¼</span></span><br><span class="line">re1, err := regexp.Compile(<span class="string">`regexp`</span>) <span class="comment">// error if regexp invalid</span></span><br><span class="line">re2 := regexp.MustCompile(<span class="string">`regexp`</span>)  <span class="comment">// panic if regexp invalid</span></span><br><span class="line"><span class="comment">//åè€…å¯ç›´æ¥é…åˆdefer recover</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Findï¼šfindæœ‰ä¸¤ç§ï¼Œä¸€ç§ç”¨å­—ç¬¦ä¸²ï¼Œä¸€ç§ç”¨å­—èŠ‚æ•°ç»„ï¼Œæ²¡æœ‰Stringå­—æ ·çš„findæ–¹æ³•éƒ½æ˜¯å­—èŠ‚æ•°ç»„</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…çš„å­ä¸²</span></span><br><span class="line"><span class="comment">//æ–¹æ³•çš„å‚æ•°æ˜¯å¾…åŒ¹é…çš„å­—ç¬¦ä¸²</span></span><br><span class="line">re := regexp.MustCompile(<span class="string">`foo.?`</span>)</span><br><span class="line">fmt.Printf(<span class="string">&quot;%q\n&quot;</span>, re.FindString(<span class="string">&quot;seafood fool&quot;</span>)) <span class="comment">// &quot;food&quot;</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%q\n&quot;</span>, re.FindString(<span class="string">&quot;meat&quot;</span>))         <span class="comment">// &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…çš„å­ä¸²çš„ä½ç½®</span></span><br><span class="line">re := regexp.MustCompile(<span class="string">`ab?`</span>)</span><br><span class="line">fmt.Println(re.FindStringIndex(<span class="string">&quot;tablett&quot;</span>))    <span class="comment">// [1 3]</span></span><br><span class="line">fmt.Println(re.FindStringIndex(<span class="string">&quot;foo&quot;</span>) == <span class="literal">nil</span>) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰¾åˆ°æ‰€æœ‰åŒ¹é…çš„å­ä¸²</span></span><br><span class="line">re := regexp.MustCompile(<span class="string">`a.`</span>)</span><br><span class="line">fmt.Printf(<span class="string">&quot;%q\n&quot;</span>, re.FindAllString(<span class="string">&quot;paranormal&quot;</span>, <span class="number">-1</span>)) <span class="comment">// [&quot;ar&quot; &quot;an&quot; &quot;al&quot;]</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%q\n&quot;</span>, re.FindAllString(<span class="string">&quot;paranormal&quot;</span>, <span class="number">2</span>))  <span class="comment">// [&quot;ar&quot; &quot;an&quot;]</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%q\n&quot;</span>, re.FindAllString(<span class="string">&quot;graal&quot;</span>, <span class="number">-1</span>))      <span class="comment">// [&quot;aa&quot;]</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%q\n&quot;</span>, re.FindAllString(<span class="string">&quot;none&quot;</span>, <span class="number">-1</span>))       <span class="comment">// [] (nil slice)</span></span><br><span class="line"><span class="comment">//FindAllStringæ–¹æ³•æœ€åä¸€ä¸ªå‚æŒ‡å®šè¿”å›å¤šå°‘å­ä¸²</span></span><br><span class="line"><span class="comment">//å°äº0ï¼šè¿”å›æ‰€æœ‰ï¼›ç­‰äº0ï¼šä¸è¿”å›ï¼›å¤§äº0ï¼šè¿”å›è¿™ä¸ªæ•°é‡çš„å­ä¸²</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Replaceï¼š</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">re := regexp.MustCompile(<span class="string">`ab*`</span>)</span><br><span class="line">fmt.Printf(<span class="string">&quot;%q\n&quot;</span>, re.ReplaceAllString(<span class="string">&quot;-a-abb-&quot;</span>, <span class="string">&quot;T&quot;</span>)) <span class="comment">// &quot;-T-T-&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Splitï¼š</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">a := regexp.MustCompile(<span class="string">`a`</span>)</span><br><span class="line">fmt.Printf(<span class="string">&quot;%q\n&quot;</span>, a.Split(<span class="string">&quot;banana&quot;</span>, <span class="number">-1</span>)) <span class="comment">// [&quot;b&quot; &quot;n&quot; &quot;n&quot; &quot;&quot;]</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%q\n&quot;</span>, a.Split(<span class="string">&quot;banana&quot;</span>, <span class="number">0</span>))  <span class="comment">// [] (nil slice)</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%q\n&quot;</span>, a.Split(<span class="string">&quot;banana&quot;</span>, <span class="number">1</span>))  <span class="comment">// [&quot;banana&quot;]</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%q\n&quot;</span>, a.Split(<span class="string">&quot;banana&quot;</span>, <span class="number">2</span>))  <span class="comment">// [&quot;b&quot; &quot;nana&quot;]</span></span><br><span class="line"></span><br><span class="line">zp := regexp.MustCompile(<span class="string">`z+`</span>)</span><br><span class="line">fmt.Printf(<span class="string">&quot;%q\n&quot;</span>, zp.Split(<span class="string">&quot;pizza&quot;</span>, <span class="number">-1</span>)) <span class="comment">// [&quot;pi&quot; &quot;a&quot;]</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%q\n&quot;</span>, zp.Split(<span class="string">&quot;pizza&quot;</span>, <span class="number">0</span>))  <span class="comment">// [] (nil slice)</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%q\n&quot;</span>, zp.Split(<span class="string">&quot;pizza&quot;</span>, <span class="number">1</span>))  <span class="comment">// [&quot;pizza&quot;]</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%q\n&quot;</span>, zp.Split(<span class="string">&quot;pizza&quot;</span>, <span class="number">2</span>))  <span class="comment">// [&quot;pi&quot; &quot;a&quot;]</span></span><br><span class="line"><span class="comment">//Splitæ–¹æ³•æœ€åä¸€ä¸ªå‚æ•°æŒ‡å®šè¿”å›å¤šå°‘å­ä¸²</span></span><br><span class="line"><span class="comment">//å°äº0ï¼šè¿”å›æ‰€æœ‰ï¼›ç­‰äº0ï¼šä¸è¿”å›ï¼›å¤§äº0ï¼šè¿”å›è¿™ä¸ªæ•°é‡çš„å­ä¸²</span></span><br></pre></td></tr></table></figure>

<h2 id="19-goè¯­è¨€å¸¸ç”¨æ ‡å‡†åº“"><a href="#19-goè¯­è¨€å¸¸ç”¨æ ‡å‡†åº“" class="headerlink" title="19 goè¯­è¨€å¸¸ç”¨æ ‡å‡†åº“"></a>19 goè¯­è¨€å¸¸ç”¨æ ‡å‡†åº“</h2><h3 id="19-1-time"><a href="#19-1-time" class="headerlink" title="19.1 time"></a>19.1 time</h3><h3 id="19-2-flag"><a href="#19-2-flag" class="headerlink" title="19.2 flag"></a>19.2 flag</h3><h3 id="19-3-strconv"><a href="#19-3-strconv" class="headerlink" title="19.3 strconv"></a>19.3 strconv</h3><h1 id="Goè¯­è¨€åº•å±‚åŸç†"><a href="#Goè¯­è¨€åº•å±‚åŸç†" class="headerlink" title="Goè¯­è¨€åº•å±‚åŸç†"></a>Goè¯­è¨€åº•å±‚åŸç†</h1><p>ã€ŠGoè¯­è¨€åº•å±‚åŸç†å‰–æã€‹</p>
<p>Golangä¿®å…»ä¹‹è·¯ï¼š<a href="https://www.kancloud.cn/aceld/golang" title="https://www.kancloud.cn/aceld/golang">https://www.kancloud.cn/aceld/golang</a></p>
<h2 id="GMPæ¨¡å‹"><a href="#GMPæ¨¡å‹" class="headerlink" title="GMPæ¨¡å‹"></a>GMPæ¨¡å‹</h2><h2 id="é€ƒé€¸ç°è±¡"><a href="#é€ƒé€¸ç°è±¡" class="headerlink" title="é€ƒé€¸ç°è±¡"></a>é€ƒé€¸ç°è±¡</h2><h2 id="makeå’Œnew-çš„åŒºåˆ«"><a href="#makeå’Œnew-çš„åŒºåˆ«" class="headerlink" title="makeå’Œnew çš„åŒºåˆ«"></a>makeå’Œnew çš„åŒºåˆ«</h2><ul>
<li><p>å˜é‡å£°æ˜ï¼š</p>
<p><code>var</code>å…³é”®å­—ï¼Œä¸æŒ‡å®šå˜é‡é»˜è®¤å€¼æ—¶ï¼Œå˜é‡çš„é»˜è®¤å€¼ä¼šæ˜¯é›¶å€¼</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> i <span class="type">int</span>    <span class="comment">//intç±»å‹çš„é›¶å€¼æ˜¯0</span></span><br><span class="line"><span class="keyword">var</span> s <span class="type">string</span> <span class="comment">//stringç±»å‹çš„é›¶å€¼æ˜¯&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>å¼•ç”¨ç±»å‹çš„é›¶å€¼æ˜¯nil</p>
</li>
<li><p>newå†…å­˜åˆ†é…</p>
</li>
</ul>
<p>ä½¿ç”¨newæ—¶å¿…é¡»å…ˆåˆ†é…å†…å­˜</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> i *<span class="type">int</span></span><br><span class="line">   *i=<span class="number">10</span></span><br><span class="line">   fmt.Println(*i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> i *<span class="type">int</span></span><br><span class="line">   i=<span class="built_in">new</span>(<span class="type">int</span>)</span><br><span class="line">   *i=<span class="number">10</span></span><br><span class="line">   fmt.Println(*i)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>new()åªæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯ç±»å‹ã€‚<strong>è¿”å›çš„æ˜¯ç±»å‹æŒ‡é’ˆ</strong>ï¼Œå¹¶ä¸”åˆ†é…å†…å­˜åä¼šé»˜è®¤ç»™æŒ‡é’ˆæŒ‡å‘çš„åœ°å€èµ‹é›¶å€¼ã€‚</p>
<ul>
<li>makeå†…å­˜åˆ†é…</li>
</ul>
<p>makeåªç”¨äºä¸‰ç§ç±»å‹ï¼š<code>chan</code>ï¼Œ<code>map</code>ï¼Œ<code>slice</code>çš„å†…å­˜åˆ›å»ºã€‚è€Œä¸”<strong>è¿”å›çš„</strong>ä¸æ˜¯æŒ‡é’ˆï¼Œè€Œ<strong>å°±æ˜¯è¿™ä¸‰ç§ç±»å‹</strong>ï¼ˆä¸æ˜¯æŒ‡é’ˆï¼Œå› ä¸ºå®ƒä»¬è‡ªèº«å°±æ˜¯å¼•ç”¨ç±»å‹ï¼‰ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">make</span><span class="params">(t Type, size ...IntegerType)</span></span> Type</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>)</span><br><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> []<span class="type">int</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*æ ¼å¼ï¼šmake(map[é”®æ•°æ®ç±»å‹][å€¼æ•°æ®ç±»å‹])*/</span></span><br><span class="line">emails := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//T:åˆ‡ç‰‡çš„å…ƒç´ ç±»å‹</span></span><br><span class="line"><span class="comment">//size:åˆ‡ç‰‡ä¸­å…ƒç´ çš„æ•°é‡</span></span><br><span class="line"><span class="comment">//cap:åˆ‡ç‰‡çš„å®¹é‡</span></span><br><span class="line">a := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">2</span>, <span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>makeä¸newçš„å¼‚åŒï¼š</p>
<ul>
<li><p>ç›¸åŒï¼šå‡ä¸ºå †ç©ºé—´åˆ†é…</p>
</li>
<li><p>ä¸åŒï¼š</p>
<p>makeï¼šåªç”¨äºsliceã€mapå’Œchançš„åˆå§‹åŒ–ï¼Œæ— å¯æ›¿ä»£ï¼›</p>
<p>newï¼šç”¨äºç±»å‹å†…å­˜åˆ†é…ï¼ˆåˆå§‹åŒ–å€¼ä¸º0ï¼‰ï¼Œä¸å¸¸ç”¨</p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>ğŸ“Œnewä¸å¸¸ç”¨ï¼š<br>ç°å®ä»£ç é€šå¸¸é‡‡ç”¨çŸ­è¯­å¥å£°æ˜ä»¥åŠç»“æ„ä½“çš„å­—é¢é‡è¾¾åˆ°åˆ†é…å†…å­˜ç›®çš„ï¼Œå¦‚ï¼š<br>i :&#x3D; 0<br>u :&#x3D; user{}</p>
</blockquote>
<h2 id="å†…å­˜åˆ†é…"><a href="#å†…å­˜åˆ†é…" class="headerlink" title="å†…å­˜åˆ†é…"></a>å†…å­˜åˆ†é…</h2><p><img src="/image/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86_tZ5L5K7RyB.jpg"></p>
<h2 id="åƒåœ¾å›æ”¶"><a href="#åƒåœ¾å›æ”¶" class="headerlink" title="åƒåœ¾å›æ”¶"></a>åƒåœ¾å›æ”¶</h2><blockquote>
<p>ğŸ“Œ<strong>ä¸ºä»€ä¹ˆéœ€è¦åƒåœ¾å›æ”¶ï¼Ÿ</strong><br>1. å‡å°‘é”™è¯¯å’Œå¤æ‚æ€§<br>æ‰‹åŠ¨åˆ†é…ã€é‡Šæ”¾å†…å­˜ç­‰å¯èƒ½ä¼šå¸¦æ¥å†…å­˜æ³„éœ²ã€é‡æŒ‡é’ˆç­‰é—®é¢˜ã€‚è™½ç„¶åƒåœ¾å›æ”¶ä¸ä¿è¯å®Œå…¨ä¸äº§ç”Ÿå†…å­˜æ³„éœ²ï¼Œä½†å…¶æä¾›äº†é‡è¦çš„ä¿éšœï¼Œå³ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡æœ€ç»ˆå°†è¢«æ”¶é›†ã€‚<br>åŒæ—¶ï¼Œå¯ä»¥é¿å…æ‚¬ç©ºæŒ‡é’ˆã€å¤šæ¬¡é‡Šæ”¾ç­‰æ‰‹åŠ¨ç®¡ç†å†…å­˜æ—¶ä¼šå‡ºç°çš„é—®é¢˜ã€‚<br>åƒåœ¾å›æ”¶åŠŸèƒ½å±è”½äº†å†…å­˜ç®¡ç†çš„å¤æ‚æ€§ï¼Œå¼€å‘è€…å¯æ›´å¥½åœ°å…³æ³¨æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€‚<br>2. è§£è€¦<br>ç°ä»£è½¯ä»¶å·¥ç¨‹å´‡å°šæ¨¡å—åŒ–ï¼Œè€Œæ¨¡å—é—´åªæä¾›å°‘é‡æ¥å£ä»¥äº¤äº’ã€‚å½“å¤šä¸ªæ¨¡å—åŒæ—¶ç»´æŠ¤ä¸€ä¸ªå†…å­˜æ—¶ï¼Œé‡Šæ”¾å†…å­˜å°†å˜å¾—éå¸¸å°å¿ƒã€‚<br>æ‰‹åŠ¨åˆ†é…é¢ä¸´è¿™æ ·çš„é—®é¢˜ï¼šç¼ºä¹ä¿¡æ¯ï¼Œéš¾ä»¥åœ¨æœ¬åœ°æ¨¡å—å†…åšå‡ºå…¨å±€çš„å†³å®šã€‚<br>åƒåœ¾å›æ”¶æœºåˆ¶å°†æ­¤å·¥ä½œæ‰˜ç®¡ç»™äº†å…·æœ‰å…¨å±€è§†é‡çš„è¿è¡Œæ—¶ä»£ç ï¼Œä»è€Œä½¿ä¸šåŠ¡æ¨¡å—é—´çœŸæ­£è§£è€¦ï¼Œä»è€Œæœ‰åˆ©äºå¼€å‘ã€è°ƒè¯•ï¼Œå¹¶å¼€å‘å‡ºæ›´å¤§è§„æ¨¡çš„ã€é«˜å¹¶å‘çš„é¡¹ç›®ã€‚</p>
</blockquote>
<blockquote>
<p>ğŸ“Œ<strong>ä»€ä¹ˆåœºæ™¯éœ€è¦åƒåœ¾å›æ”¶ï¼Ÿ</strong><br>åƒåœ¾å›æ”¶å¸¦æ¥äº†é¢å¤–çš„æˆæœ¬ï¼Œéœ€è¦ä¿å­˜å†…å­˜çš„çŠ¶æ€ä¿¡æ¯å¹¶æ‰«æå†…å­˜ï¼Œå¾ˆå¤šæ—¶å€™è¿˜éœ€è¦ä¸­æ–­æ•´ä¸ªç¨‹åºæ¥å¤„ç†åƒåœ¾å›æ”¶ã€‚<br>å› æ­¤ï¼Œåƒåœ¾å›æ”¶<strong>å¯¹äºè¦æ±‚æè‡´çš„é€Ÿåº¦å’Œå†…å­˜è¦æ±‚æå°çš„åœºæ™¯å¹¶ä¸é€‚ç”¨</strong>ï¼ˆåµŒå…¥å¼ã€ç³»ç»Ÿçº§ç¨‹åºï¼‰ï¼›<br>å´æ˜¯å¼€å‘å¤§è§„æ¨¡ã€åˆ†å¸ƒå¼ã€å¾®æœåŠ¡é›†ç¾¤çš„æä½³é€‰æ‹©ã€‚</p>
</blockquote>
<h3 id="Goåƒåœ¾å›æ”¶ä¸­çš„ä¸‰è‰²æ ‡è®°ï¼š"><a href="#Goåƒåœ¾å›æ”¶ä¸­çš„ä¸‰è‰²æ ‡è®°ï¼š" class="headerlink" title="Goåƒåœ¾å›æ”¶ä¸­çš„ä¸‰è‰²æ ‡è®°ï¼š"></a>Goåƒåœ¾å›æ”¶ä¸­çš„ä¸‰è‰²æ ‡è®°ï¼š</h3><h3 id="Goæ‰§è¡Œåƒåœ¾å›æ”¶å…·ä½“æµç¨‹ï¼š"><a href="#Goæ‰§è¡Œåƒåœ¾å›æ”¶å…·ä½“æµç¨‹ï¼š" class="headerlink" title="Goæ‰§è¡Œåƒåœ¾å›æ”¶å…·ä½“æµç¨‹ï¼š"></a>Goæ‰§è¡Œåƒåœ¾å›æ”¶å…·ä½“æµç¨‹ï¼š</h3><h2 id="defer"><a href="#defer" class="headerlink" title="defer"></a>defer</h2><h3 id="deferçš„æ‰§è¡Œé¡ºåº"><a href="#deferçš„æ‰§è¡Œé¡ºåº" class="headerlink" title="deferçš„æ‰§è¡Œé¡ºåº"></a>deferçš„æ‰§è¡Œé¡ºåº</h3><p><img src="/image/image_klHnHNaXk-.png"></p>
<p>æ ˆï¼šå…ˆè¿›åå‡º</p>
<h3 id="å‡½æ•°çš„è¿”å›å€¼åˆå§‹åŒ–"><a href="#å‡½æ•°çš„è¿”å›å€¼åˆå§‹åŒ–" class="headerlink" title="å‡½æ•°çš„è¿”å›å€¼åˆå§‹åŒ–"></a>å‡½æ•°çš„è¿”å›å€¼åˆå§‹åŒ–</h3><p><img src="/image/image_Rjj_29L3So.png"></p>
<p>åªè¦å‡½æ•°è¿”å›å€¼æœ‰åå­—ï¼ˆä¾‹å­ä¸­ä¸ºtï¼‰ï¼Œè¿™ä¸ª<code>t</code>ä¼šåœ¨å‡½æ•°èµ·å§‹å¤„è¢«åˆå§‹åŒ–ä¸ºå¯¹åº”ç±»å‹çš„é›¶å€¼å¹¶ä¸”ä½œç”¨åŸŸä¸ºæ•´ä¸ªå‡½æ•°ã€‚</p>
<h3 id="returnå’Œdeferè°å…ˆè°å-amp-æœ‰åå‡½æ•°è¿”å›å€¼é‡è§deferæƒ…å†µ"><a href="#returnå’Œdeferè°å…ˆè°å-amp-æœ‰åå‡½æ•°è¿”å›å€¼é‡è§deferæƒ…å†µ" class="headerlink" title="returnå’Œdeferè°å…ˆè°å &amp; æœ‰åå‡½æ•°è¿”å›å€¼é‡è§deferæƒ…å†µ"></a>returnå’Œdeferè°å…ˆè°å &amp; æœ‰åå‡½æ•°è¿”å›å€¼é‡è§deferæƒ…å†µ</h3><p><img src="/image/image_xlY7fDYo9I.png"></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">returnButDefer</span><span class="params">()</span></span> (t <span class="type">int</span>) &#123;  <span class="comment">//tåˆå§‹åŒ–0ï¼Œ å¹¶ä¸”ä½œç”¨åŸŸä¸ºè¯¥å‡½æ•°å…¨åŸŸ</span></span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        t = t * <span class="number">10</span></span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(returnButDefer())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">$ go run test.go</span><br><span class="line">10</span><br></pre></td></tr></table></figure>

<p>æœ¬åº”è¿”å›1ï¼Œä½†æ˜¯returnåè¿›å…¥äº†deferï¼Œæ‰€ä»¥<code>t=t*10</code>è¢«æ‰§è¡Œï¼Œå› æ­¤æœ€åè¿”å›ç»™mainçš„ç»“æœä¸º10ã€‚</p>
<h3 id="deferé‡è§panic"><a href="#deferé‡è§panic" class="headerlink" title="deferé‡è§panic"></a>deferé‡è§panic</h3><p><img src="/image/image__3aWsdTgIN.png"></p>
<h3 id="deferä¸­åŒ…å«panic"><a href="#deferä¸­åŒ…å«panic" class="headerlink" title="deferä¸­åŒ…å«panic"></a>deferä¸­åŒ…å«panic</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">       <span class="keyword">if</span> err := <span class="built_in">recover</span>(); err != <span class="literal">nil</span>&#123;</span><br><span class="line">           fmt.Println(err)</span><br><span class="line">       &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">           fmt.Println(<span class="string">&quot;fatal&quot;</span>)</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">&quot;defer panic&quot;</span>)</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">&quot;panic&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">è¾“å‡ºç»“æœï¼š</span><br><span class="line">defer panic</span><br></pre></td></tr></table></figure>

<p>è§¦å‘<code>panic(&quot;panic&quot;)</code>ådeferé¡ºåºå‡ºæ ˆæ‰§è¡Œï¼Œç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œçš„deferä¸­çš„<code>panic(&quot;defer panic&quot;)</code>å¼‚å¸¸ï¼Œä¼šè¦†ç›–æ‰mainä¸­çš„<code>panic(&quot;panic&quot;)</code>ï¼Œæœ€åè¿™ä¸ªå¼‚å¸¸è¢«ç¬¬äºŒä¸ªæ‰§è¡Œçš„deferæ•è·åˆ°ã€‚</p>
<h3 id="deferä¸‹çš„å‡½æ•°å‚æ•°åŒ…å«å­å‡½æ•°"><a href="#deferä¸‹çš„å‡½æ•°å‚æ•°åŒ…å«å­å‡½æ•°" class="headerlink" title="deferä¸‹çš„å‡½æ•°å‚æ•°åŒ…å«å­å‡½æ•°"></a>deferä¸‹çš„å‡½æ•°å‚æ•°åŒ…å«å­å‡½æ•°</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">function</span><span class="params">(index <span class="type">int</span>, value <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    fmt.Println(index)</span><br><span class="line">    <span class="keyword">return</span> index</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> function(<span class="number">1</span>, function(<span class="number">3</span>, <span class="number">0</span>))</span><br><span class="line">    <span class="keyword">defer</span> function(<span class="number">2</span>, function(<span class="number">4</span>, <span class="number">0</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">è¾“å‡ºç»“æœï¼š</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">2</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰å››ä¸ªå‡½æ•°ï¼Œç”¨ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼ç»™å®ƒä»¬æ ‡å·ä¸º1\2\3\4ã€‚éœ€è¦ç ”ç©¶å®ƒä»¬çš„å…ˆåæ‰§è¡Œé¡ºåºï¼š</p>
<p>æœ‰ä¸¤ä¸ªdeferï¼Œæ‰€ä»¥deferä¼šå‹æ ˆä¸¤æ¬¡ï¼Œå…ˆè¿›æ ˆ1ï¼Œåè¿›æ ˆ2ã€‚å‹1æ—¶ï¼Œç”±äºéœ€è¦è¿åŒå‡½æ•°åœ°å€ã€å‡½æ•°å½¢å‚ä¸€åŒè¿›æ ˆï¼Œå› æ­¤ä¸ºäº†å¾—åˆ°ç¬¬äºŒä¸ªå‚æ•°çš„ç»“æœï¼Œéœ€è¦å…ˆæ‰§è¡Œfunction3ã€‚åŒç†åœ¨å‹2æ—¶ï¼Œå°±éœ€è¦å…ˆæ‰§è¡Œfunction4ã€‚</p>
<p>å› æ­¤æ‰§è¡Œé¡ºåºä¸ºï¼š3â†’4â†’2â†’1ã€‚</p>
<h1 id="ç›¸å…³å·¥å…·"><a href="#ç›¸å…³å·¥å…·" class="headerlink" title="ç›¸å…³å·¥å…·"></a>ç›¸å…³å·¥å…·</h1><h2 id="gRPC"><a href="#gRPC" class="headerlink" title="gRPC"></a>gRPC</h2><blockquote>
<p>gRPCå…è®¸</p>
</blockquote>
]]></content>
      <categories>
        <category>ç¼–ç¨‹è¯­è¨€</category>
      </categories>
      <tags>
        <tag>golang</tag>
      </tags>
  </entry>
  <entry>
    <title>C++åŸºç¡€çŸ¥è¯†</title>
    <url>/2022/07/01/C++%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/C++%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</url>
    <content><![CDATA[<h1 id="C-åŸºç¡€çŸ¥è¯†"><a href="#C-åŸºç¡€çŸ¥è¯†" class="headerlink" title="C++åŸºç¡€çŸ¥è¯†"></a>C++åŸºç¡€çŸ¥è¯†</h1><blockquote>
<p>å‚è€ƒèµ„æ–™ï¼š<br>- ã€ŠC++è¯­è¨€å¯¼å­¦ã€‹ï¼ˆç¬¬ä¸€ç‰ˆï¼‰<br>- ã€ŠC++ primerã€‹ï¼ˆç¬¬äº”ç‰ˆï¼‰<br>- ã€ŠC++æ–°ç»å…¸ï¼šå¯¹è±¡æ¨¡å‹ã€‹ï¼ˆç¬¬ä¸€ç‰ˆï¼‰<br>- ã€ŠC++å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹ï¼ˆç¬¬äºŒç‰ˆï¼‰</p>
<p>æ—¶é—´çº¿ï¼š<br>2021&#x2F;10&#x2F;9ï¼šå¼€å§‹æ•´ç†ç¬”è®°ï¼Œä»¥ã€ŠC++è¯­è¨€å¯¼å­¦ã€‹ä¸ºçº¿ç´¢æ¢³ç†<br>2022&#x2F;05&#x2F;24ï¼šåˆæ­¥æ•´ç†å®Œæˆï¼Œæ±‡æ€»ã€ŠC++è¯­è¨€å¯¼å­¦ã€‹ï¼Œéƒ¨åˆ†ã€ŠC++ Primerã€‹å’Œå°‘é‡ã€ŠEffective Modern C++ã€‹<br>2022&#x2F;06&#x2F;20ï¼šå¼€å§‹åœ¨ç¬”è®°ä¸­åŠ å…¥å¹¶å‘ï¼ˆã€ŠC++å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹ç¬¬äºŒç‰ˆï¼‰çŸ¥è¯†<br>2022&#x2F;07&#x2F;07ï¼šå­¦ä¹ æå®¢æ—¶é—´â€œç°ä»£C++å®æˆ˜30è®²â€ï¼Œæ·»åŠ type_traitsç›¸å…³å†…å®¹</p>
</blockquote>
<h2 id="é¢å‘è¿‡ç¨‹"><a href="#é¢å‘è¿‡ç¨‹" class="headerlink" title="é¢å‘è¿‡ç¨‹"></a>é¢å‘è¿‡ç¨‹</h2><h3 id="1-åŸºç¡€çŸ¥è¯†"><a href="#1-åŸºç¡€çŸ¥è¯†" class="headerlink" title="1 åŸºç¡€çŸ¥è¯†"></a>1 åŸºç¡€çŸ¥è¯†</h3><ul>
<li><p><strong>ç¨‹åºç¼–è¯‘ï¼š</strong></p>
<p><img src="/image/image_C-0mU-M0rw.png"></p>
<p>ISOçš„C++æ ‡å‡†å®šä¹‰äº†ä¸¤ç§å®ä½“ï¼š</p>
<p>1.æ ¸å¿ƒè¯­è¨€ç‰¹æ€§</p>
<p>æ¯”å¦‚å†…ç½®ç±»å‹ï¼ˆint, floatï¼‰ä»¥åŠå¾ªç¯ï¼ˆfor, whileï¼‰ï¼›</p>
<p>2.æ ‡å‡†åº“ç»„ä»¶</p>
<p>æ¯”å¦‚å®¹å™¨ï¼ˆvector, mapï¼‰ä»¥åŠI&#x2F;Oæ“ä½œï¼ˆ&lt;&lt;, getlineï¼‰ã€‚</p>
</li>
<li><p><strong>é¢„å¤„ç†æœŸç¼–ç¨‹ï¼š</strong></p>
<p>é¢„å¤„ç†ç¼–ç¨‹çš„æ“ä½œç›®æ ‡æ˜¯â€œæºç â€ï¼Œå„ç§æŒ‡ä»¤æ§åˆ¶é¢„å¤„ç†å™¨ï¼Œå®é™…ä¸Šå°±æ˜¯è®©é¢„å¤„ç†å™¨æ”¹é€ æºç ï¼Œæ”¹é€ æˆå…¶ä»–å½¢å¼ã€‚é¢„å¤„ç†æŒ‡ä»¤ä»¥â€œ#â€å¼€å¤´ï¼Œå•ç‹¬çš„â€œ#â€ä¹Ÿæ˜¯ä¸€ä¸ªé¢„å¤„ç†æŒ‡ä»¤ï¼Œå³ç©ºæŒ‡ä»¤ï¼Œç›¸å½“äºç©ºè¡Œã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">#                              <span class="comment">// é¢„å¤„ç†ç©ºè¡Œ</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> __linux__                  <span class="comment">// é¢„å¤„ç†æ£€æŸ¥å®æ˜¯å¦å­˜åœ¨</span></span></span><br><span class="line"><span class="meta">#   <span class="keyword">define</span> HAS_LINUX    1      <span class="comment">// å®å®šä¹‰ï¼Œæœ‰ç¼©è¿›</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span>                         <span class="comment">// é¢„å¤„ç†æ¡ä»¶è¯­å¥ç»“æŸ</span></span></span><br><span class="line">#                              <span class="comment">// é¢„å¤„ç†ç©ºè¡Œ</span></span><br></pre></td></tr></table></figure>

<p>é¢„å¤„ç†å™¨æ”¹é€ åçš„ä»£ç å¯ä»¥è®©gccç”¨-Eé€‰é¡¹æ¥å±•å¼€ã€‚</p>
<ul>
<li><p>åŒ…å«æ–‡ä»¶ï¼ˆ#includeï¼‰ï¼š</p>
<p>#includeä¸ä»…å¯ä»¥åŒ…å«å¤´æ–‡ä»¶ï¼Œç†è®ºä¸Šï¼Œåªè¦æƒ³ï¼Œæºç ã€æ™®é€šæ–‡æœ¬ã€å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘éƒ½å¯ä»¥å¼•è¿›æ¥ï¼ˆè™½ç„¶å¯èƒ½å‡ºç°æ— æ³•å¤„ç†çš„é”™è¯¯ï¼‰ã€‚æ¯”å¦‚<code>#include &quot;a.out&quot;</code>ã€‚å¼•ç”¨å¤´æ–‡ä»¶æ—¶å¸¸ç”¨çš„æŠ€å·§æ˜¯â€œInclude Guardâ€ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _XXX_H_INCLUDE_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _XXX_H_INCLUDE_</span></span><br><span class="line">... <span class="comment">//å¤´æ–‡ä»¶å†…å®¹</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> _XXX_H_INCLUDE_</span></span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰ä¸€ç§å¸¸ç”¨ç”¨æ³•ï¼Œä½¿ç”¨â€œ *.incâ€æ–‡ä»¶å­˜æ”¾ä¸€äº›ä»£ç ç‰‡æ®µã€‚æ¯”å¦‚æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ç”¨äºæ•°å€¼è®¡ç®—çš„æ•°ç»„ï¼Œç›´æ¥æ”¾åœ¨æºç æ–‡ä»¶é‡Œå¾ˆå åœ°æ–¹ï¼Œä¸æ–¹ä¾¿å¯¹æºç çš„é€»è¾‘éƒ¨åˆ†è¿›è¡Œæ¢³ç†æŸ¥çœ‹ã€‚é‚£ä¹ˆï¼Œä¾¿å¯ä»¥æŠŠæ­¤æ•°ç»„æ”¾åœ¨calc_values.incä¸­ï¼Œé€šè¿‡#includeåŠ è½½å®ƒï¼Œä»è€Œæ›¿æ¢åŸæ¥çš„å¤§æ‰¹æ•°å­—ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//calc_values.incæ–‡ä»¶</span></span><br><span class="line"><span class="type">static</span> <span class="type">uint32_t</span>  calc_table[] = &#123;  <span class="comment">// éå¸¸å¤§çš„ä¸€ä¸ªæ•°ç»„ï¼Œæœ‰å‡ åè¡Œ</span></span><br><span class="line">    <span class="number">0x00000000</span>, <span class="number">0x77073096</span>, <span class="number">0xee0e612c</span>, <span class="number">0x990951ba</span>,</span><br><span class="line">    <span class="number">0x076dc419</span>, <span class="number">0x706af48f</span>, <span class="number">0xe963a535</span>, <span class="number">0x9e6495a3</span>,</span><br><span class="line">    <span class="number">0x0edb8832</span>, <span class="number">0x79dcb8a4</span>, <span class="number">0xe0d5e91e</span>, <span class="number">0x97d2d988</span>,</span><br><span class="line">    <span class="number">0x09b64c2b</span>, <span class="number">0x7eb17cbd</span>, <span class="number">0xe7b82d07</span>, <span class="number">0x90bf1d91</span>,</span><br><span class="line">    ...                          </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æºç æ–‡ä»¶</span></span><br><span class="line"><span class="type">static</span> <span class="type">uint32_t</span>  calc_table[] = &#123;</span><br><span class="line"><span class="meta">#  <span class="keyword">include</span> <span class="string">&quot;calc_values.inc&quot;</span>        <span class="comment">// éå¸¸å¤§çš„ä¸€ä¸ªæ•°ç»„ï¼Œç»†èŠ‚è¢«éšè—</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®å®šä¹‰ï¼ˆ#define&#x2F;#undefï¼‰ï¼š</p>
<ul>
<li><p>å®çš„å±•å¼€ã€æ›¿æ¢å‘ç”Ÿåœ¨é¢„å¤„ç†é˜¶æ®µï¼Œå¯¹äºä¸€äº›è°ƒç”¨é¢‘ç¹çš„å°ä»£ç ç‰‡æ®µï¼Œç”¨å®æ¥å°è£…çš„æ•ˆæœæ¯”inlineå…³é”®å­—è¦å¥½ï¼Œå› ä¸ºå…¶æ˜¯æºç çº§åˆ«çš„æ— æ¡ä»¶å†…è”ï¼Œæ¯”å¦‚Nginxä¸­çš„ä»£ç </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> ngx_tolower(c)      ((c &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;Z&#x27;</span>) ? (c | 0x20) : c)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ngx_toupper(c)      ((c &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;z&#x27;</span>) ? (c &amp; ~0x20) : c)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ngx_memzero(buf, n)       (void) memset(buf, 0, n)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å®æ²¡æœ‰ä½œç”¨åŸŸæ¦‚å¿µï¼Œæ°¸è¿œç”Ÿæ•ˆï¼Œå› æ­¤å¯¹äºä¸€äº›ç”¨äºç®€åŒ–ä»£ç ã€èµ·ä¸´æ—¶ä½œç”¨çš„å®ï¼Œç”¨å®Œåå°½å¿«#undefå–æ¶ˆå®šä¹‰ï¼Œé¿å…å†²çªï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> CUBE(a) (a) * (a) * (a)  <span class="comment">// å®šä¹‰ä¸€ä¸ªç®€å•çš„æ±‚ç«‹æ–¹çš„å®</span></span></span><br><span class="line">cout &lt;&lt; <span class="built_in">CUBE</span>(<span class="number">10</span>) &lt;&lt; endl;        <span class="comment">// ä½¿ç”¨å®ç®€åŒ–ä»£ç </span></span><br><span class="line">cout &lt;&lt; <span class="built_in">CUBE</span>(<span class="number">15</span>) &lt;&lt; endl;        <span class="comment">// ä½¿ç”¨å®ç®€åŒ–ä»£ç </span></span><br><span class="line"><span class="meta">#<span class="keyword">undef</span> CUBE                      <span class="comment">// ä½¿ç”¨å®Œæ¯•åç«‹å³å–æ¶ˆå®šä¹‰</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> AUTH_PWD                  <span class="comment">// æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰å®å®šä¹‰</span></span></span><br><span class="line"><span class="meta">#  <span class="keyword">undef</span> AUTH_PWD                <span class="comment">// å–æ¶ˆå®å®šä¹‰</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span>                           <span class="comment">// å®å®šä¹‰æ£€æŸ¥ç»“æŸ</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AUTH_PWD <span class="string">&quot;xxx&quot;</span>           <span class="comment">// é‡æ–°å®å®šä¹‰</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å®ä¹Ÿè¢«å¸¸ç”¨æ¥åš<strong>æ–‡æœ¬æ›¿æ¢</strong>ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> BEGIN_NAMESPACE(x)  namespace x &#123;</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> END_NAMESPACE(x)    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">BEGIN_NAMESPACE</span>(my_own)</span><br><span class="line"></span><br><span class="line">...      <span class="comment">// functions and classes</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">END_NAMESPACE</span>(my_own)</span><br></pre></td></tr></table></figure>

<p>æ­¤å¤„åªæ˜¯ç®€å•çš„æ–‡æœ¬æ›¿æ¢ï¼Œä½†æ˜¯å…¨å¤§å†™çš„å½¢å¼éå¸¸é†’ç›®ï¼Œå¯ä»¥æ›´å®¹æ˜“è¯†åˆ«å‡ºå‘½åç©ºé—´å¼€å§‹å’Œç»“æŸçš„ä½ç½®ã€‚</p>
</li>
</ul>
</li>
<li><p>æ¡ä»¶ç¼–è¯‘ï¼ˆ#if&#x2F;#else&#x2F;#endifï¼‰ï¼š</p>
<p>åœ¨é¢„å¤„ç†é˜¶æ®µå®ç°åˆ†æ”¯å¤„ç†ï¼Œé€šè¿‡åˆ¤æ–­å®çš„æ•°å€¼æ¥äº§ç”Ÿä¸åŒçš„æºç ï¼Œä»è€Œæ”¹å˜æºæ–‡ä»¶çš„å½¢æ€ã€‚#ifåçš„åˆ¤æ–­ä¾æ®ï¼Œä¹Ÿå°±æ˜¯å®šä¹‰å¥½çš„å„ç§å®ã€‚</p>
<ul>
<li><p>C++ç‰ˆæœ¬å·å®ï¼š<code>__cplusplus</code>ï¼Œåˆ©ç”¨è¯¥å®æ¥åˆ¤æ–­å½“å‰çš„ç¯å¢ƒï¼Œä»è€Œä½¿ç”¨ç›¸åº”çš„å¤„ç†æ–¹å¼ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus                      <span class="comment">// å®šä¹‰äº†è¿™ä¸ªå®å°±æ˜¯åœ¨ç”¨C++ç¼–è¯‘</span></span></span><br><span class="line">    <span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;                        <span class="comment">// å‡½æ•°æŒ‰ç…§Cçš„æ–¹å¼å»å¤„ç†</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">a_c_function</span><span class="params">(<span class="type">int</span> a)</span></span>;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus                      <span class="comment">// æ£€æŸ¥æ˜¯å¦æ˜¯C++ç¼–è¯‘</span></span></span><br><span class="line">    &#125;                                   <span class="comment">// extern &quot;C&quot; ç»“æŸ</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> __cplusplus &gt;= 201402                <span class="comment">// æ£€æŸ¥C++æ ‡å‡†çš„ç‰ˆæœ¬å·</span></span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;c++14 or later&quot;</span> &lt;&lt; endl;    <span class="comment">// 201402å°±æ˜¯C++14</span></span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> __cplusplus &gt;= 201103              <span class="comment">// æ£€æŸ¥C++æ ‡å‡†çš„ç‰ˆæœ¬å·</span></span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;c++11 or before&quot;</span> &lt;&lt; endl;   <span class="comment">// 201103æ˜¯C++11</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span>   <span class="comment">// __cplusplus &lt; 201103          // 199711æ˜¯C++98</span></span></span><br><span class="line"><span class="meta">#   <span class="keyword">error</span> <span class="string">&quot;c++ is too old&quot;</span>               <span class="comment">// å¤ªä½åˆ™é¢„å¤„ç†æŠ¥é”™</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span>  <span class="comment">// __cplusplus &gt;= 201402         // é¢„å¤„ç†è¯­å¥ç»“æŸ</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>C++è¯­è¨€ç‰¹æ€§å®ï¼šå¯ä»¥åœ¨é¢„å¤„ç†é˜¶æ®µåˆ¤æ–­ç³»ç»Ÿæ˜¯å¦æ”¯æŒæŸäº›è¯­æ³•ç‰¹æ€§ï¼Œè‹¥æ”¯æŒå°±ç”¨ç‰¹æ€§ï¼Œä¸æ”¯æŒå°±ç”¨è€å†™æ³•</p>
<ul>
<li><p>C++æ ‡å‡†æä¾›çš„å®ï¼šC++æœ‰å¾ˆå¤šé¢„å®šä¹‰çš„å®ï¼Œå¦‚æºæ–‡ä»¶ä¿¡æ¯çš„â€œFILEâ€â€œLINEâ€â€œDATEâ€ï¼Œä»¥åŠä¸€äº›æµ‹è¯•è¯­è¨€ç‰¹æ€§æ˜¯å¦è¢«æ”¯æŒçš„å®ï¼Œå¦‚â€œ__cpp_decltypeâ€â€œ__cpp_decltype_autoâ€â€œ__cpp_lib_make_uniqueâ€ç­‰ã€‚</p>
</li>
<li><p>ç¼–è¯‘å™¨æä¾›çš„å®ï¼šC++æ ‡å‡†é‡Œå¾ˆå¤šå®æœªå®šä¹‰ï¼Œä½†ç¼–è¯‘å™¨æä¾›ï¼Œå¯ç”¨<code>g++ -E -dM - &lt; /dev/null</code>æŸ¥çœ‹ã€‚</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">if</span> defined(__cpp_decltype_auto)        <span class="comment">//æ£€æŸ¥æ˜¯å¦æ”¯æŒdecltype(auto)</span></span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;decltype(auto) enable&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;decltype(auto) disable&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span>  <span class="comment">//__cpp_decltype_auto</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> __GNUC__ &lt;= 4</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;gcc is too old&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span>   <span class="comment">// __GNUC__ &gt; 4</span></span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;gcc is good enough&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span>  <span class="comment">// __GNUC__ &lt;= 4</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(__SSE4_2__) &amp;&amp; defined(__x86_64)</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;we can do more optimization&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span>  <span class="comment">// defined(__SSE4_2__) &amp;&amp; defined(__x86_64)</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>è‡ªå®šä¹‰çš„å®ï¼šå¯ä»¥ç”¨è‡ªå®šä¹‰çš„å®æ¥å®ç°æ¡ä»¶ç¼–è¯‘ï¼Œæ¯”å¦‚Nginxä½¿ç”¨Shellè„šæœ¬æ£€æµ‹å¤–éƒ¨ç¯å¢ƒï¼Œç”Ÿæˆä¸€ä¸ªåŒ…å«è‹¥å¹²å®çš„æºç é…ç½®æ–‡ä»¶ï¼Œå†æ¡ä»¶ç¼–è¯‘åŒ…å«ä¸åŒçš„å¤´æ–‡ä»¶ï¼Œå®ç°æ“ä½œç³»ç»Ÿå®šåˆ¶åŒ–ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">if</span> (NGX_FREEBSD)</span></span><br><span class="line"><span class="meta">#  <span class="keyword">include</span> </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> (NGX_LINUX)</span></span><br><span class="line"><span class="meta">#  <span class="keyword">include</span> </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> (NGX_SOLARIS)</span></span><br><span class="line"><span class="meta">#  <span class="keyword">include</span> </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> (NGX_DARWIN)</span></span><br><span class="line"><span class="meta">#  <span class="keyword">include</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>ä»£ç ç¦ç”¨å¯ç”¨ï¼š</p>
<p>ä½¿ç”¨<code>#if 1</code>æˆ–<code>#if 0</code>æ¥æ˜¾å¼å¯ç”¨æˆ–è€…ç¦ç”¨å¤§æ®µä»£ç ï¼Œè¦æ¯”<code>/*...*/</code>çš„æ³¨é‡Šæ–¹å¼å®‰å…¨ä¸”æ¸…æ™°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">if</span> 0          <span class="comment">// 0å³ç¦ç”¨ä¸‹é¢çš„ä»£ç ï¼Œ1åˆ™æ˜¯å¯ç”¨</span></span></span><br><span class="line">  ...          <span class="comment">// ä»»æ„çš„ä»£ç </span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span>         <span class="comment">// é¢„å¤„ç†ç»“æŸ</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 1          <span class="comment">// 1å¯ç”¨ä»£ç ï¼Œç”¨æ¥å¼ºè°ƒä¸‹é¢ä»£ç çš„å¿…è¦æ€§</span></span></span><br><span class="line">  ...          <span class="comment">// ä»»æ„çš„ä»£ç </span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span>         <span class="comment">// é¢„å¤„ç†ç»“æŸ</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>å±æ€§ï¼šç¼–è¯‘æœŸæŒ‡ä»¤</strong></p>
<p>å‰é¢çš„#includeã€#defineéƒ½æ˜¯é¢„å¤„ç†æŒ‡ä»¤ï¼Œç”¨äºæ§åˆ¶é¢„å¤„ç†å™¨ã€‚ç±»ä¼¼çš„ï¼Œè¿˜æœ‰â€œ<strong>ç¼–è¯‘æŒ‡ä»¤</strong>â€æ¥æ§åˆ¶ç¼–è¯‘å™¨ã€‚</p>
<p>C++11ä¹‹å‰æ ‡å‡†é‡Œæ²¡æœ‰ç¼–è¯‘æŒ‡ä»¤ï¼Œä½†ç¼–è¯‘å™¨æä¾›äº†ï¼Œæ¯”å¦‚GCCé‡Œçš„<code>__attribute__</code>ï¼ŒVCé‡Œçš„<code>__declspec</code></p>
<p>C++11å¼€å§‹ï¼Œå®˜æ–¹å°†ç¼–è¯‘æŒ‡ä»¤æ­£å¼å‘½åä¸ºâ€œ<strong>å±æ€§</strong>â€ï¼Œç”¨ä¸¤å¯¹æ–¹æ‹¬å·çš„å½¢å¼<code>[[...]]</code>è¡¨ç¤ºï¼Œç›¸å½“äºç»™å˜é‡ã€å‡½æ•°ã€ç±»ç­‰è´´ä¸Šä¸€ä¸ªç¼–è¯‘é˜¶æ®µçš„æ ‡ç­¾ï¼Œè®©ç¼–è¯‘å™¨è¯†åˆ«ã€‚</p>
<p>è™½ç„¶å®˜æ–¹å°†å±æ€§çš„è¯­æ³•åŠ è¿›æ¥äº†ï¼Œä½†æ˜¯æ ‡å‡†é‡Œå®šä¹‰çš„å±æ€§è¿˜æ˜¯ååˆ†æœ‰é™çš„ï¼Œæœ€æœ‰ç”¨çš„å½“å±C++14çš„deprecatedï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">[[<span class="built_in">deprecated</span>(<span class="string">&quot;deadline:2020-12-31&quot;</span>)]]</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">old_func</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨æ­¤å‡½æ•°çš„ç¨‹åºç¼–è¯‘æ—¶ä¼šæŠ¥å‡ºä¸€æ¡è­¦å‘Šï¼š</span></span><br><span class="line"><span class="comment">//warning: â€˜int old_func()â€™ is deprecated: deadline:2020-12-31 [-Wdeprecated-declarations]</span></span><br></pre></td></tr></table></figure>

<p>å±æ€§æ”¯æŒéæ ‡å‡†æ‰©å±•ï¼Œä¹Ÿå°±æ˜¯å…è®¸ä½¿ç”¨ç¼–è¯‘å™¨æä¾›çš„éå®˜æ–¹å±æ€§ï¼Œæ¯”å¦‚GCCçš„å±æ€§åœ¨<code>gnu::</code>ä¸­ï¼š</p>
<ul>
<li><p><code>gnu::deprecated</code>ï¼šä¸C++14çš„deprecatedç›¸åŒï¼Œä½†æ˜¯å¯ä»¥ç”¨åœ¨C++11é‡Œã€‚</p>
</li>
<li><p><code>gnu::unused</code>ï¼šæŠ‘åˆ¶å¯¹å˜é‡ã€ç±»ã€å‡½æ•°çš„æœªä½¿ç”¨è­¦å‘Šï¼Œä¸â€(void) varâ€æ•ˆæœä¸€æ ·ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">[[gnu::unused]] <span class="comment">//å£°æ˜ä¸‹é¢çš„å˜é‡æš‚ä¸ä½¿ç”¨ï¼Œä¸æ˜¯é”™è¯¯ï¼Œä¸éœ€è¦warning</span></span><br><span class="line"><span class="type">int</span> nouse;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>gnu::constructor</code>ï¼šå‡½æ•°ä¼šåœ¨main()å‡½æ•°ä¹‹å‰æ‰§è¡Œï¼Œæ•ˆæœç±»ä¼¼å¯¹å…¨å±€å¯¹è±¡çš„æ„é€ å‡½æ•°</p>
</li>
<li><p><code>gnu::destructor</code>ï¼šå‡½æ•°ä¼šåœ¨main()å‡½æ•°ç»“æŸä¹‹åæ‰§è¡Œï¼Œæ•ˆæœç±»ä¼¼å¯¹å…¨å±€å¯¹è±¡çš„ææ„å‡½æ•°</p>
</li>
<li><p><code>gnu::always_inline</code>ï¼šè¦æ±‚ç¼–è¯‘å™¨å¼ºåˆ¶å†…è”å‡½æ•°ï¼Œä½œç”¨æ¯”inlineå…³é”®å­—å¼º</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">[[gnu::always_inline]] <span class="function"><span class="keyword">inline</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">get_num</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>gnu::hot</code>ï¼šæ ‡è®°çƒ­ç‚¹å‡½æ•°ï¼Œè¦æ±‚ç¼–è¯‘å™¨å¯¹å…¶è¿›è¡Œæ›´ç§¯æçš„ä¼˜åŒ–</p>
</li>
</ul>
<blockquote>
<p>ğŸ“Œconstructorå’Œdestructorå¿…é¡»ä½¿ç”¨Cè¯­è¨€çš„è¯­æ³•ï¼Œæ¯”å¦‚åªèƒ½ç”¨printf()è€Œä¸èƒ½ç”¨coutã€‚</p>
</blockquote>
<p>ä¸‹é¢ä¸¤ç§å†™æ³•æ˜¯ç­‰ä»·çš„ï¼š</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">__attribute__((constructor)) <span class="function"><span class="type">void</span> <span class="title">load_file</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Constructor is called.\n&quot;</span>);</span><br><span class="line">    g_count = (<span class="type">int</span> *)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    <span class="keyword">if</span> (g_count == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;Failed to malloc memory.\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">__attribute__((destructor)) <span class="function"><span class="type">void</span> <span class="title">unload_file</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;destructor is called.\n&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (g_count)</span><br><span class="line">    <span class="built_in">free</span>(g_count);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">[[gnu::constructor]] </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">load_file</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Constructor is called.\n&quot;</span>);</span><br><span class="line">    g_count = (<span class="type">int</span> *)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    <span class="keyword">if</span> (g_count == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;Failed to malloc memory.\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">[[gnu::destructor]] </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">unload_file</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;destructor is called.\n&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (g_count)</span><br><span class="line">    <span class="built_in">free</span>(g_count);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>å‡½æ•°ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¿”å›å€¼ç±»å‹ å‡½æ•°åå­—ï¼ˆå‡½æ•°å‚æ•°ï¼‰</span></span><br><span class="line"><span class="function"><span class="type">double</span>     <span class="title">sqrt</span>    <span class="params">(<span class="type">double</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="type">double</span>     <span class="title">sqrt</span>    <span class="params">(<span class="type">double</span> d)</span></span>;</span><br></pre></td></tr></table></figure>

<p>1.å¯¹äºç±»æˆå‘˜å‡½æ•°æ¥è¯´ï¼Œç±»åå­—ä¹Ÿæ˜¯å‡½æ•°åå­—çš„ä¸€éƒ¨åˆ†<code>char&amp; String::operator[](int index);</code></p>
<p>2.ç¼–è¯‘å™¨ä¼šæ£€æŸ¥å®å‚çš„ç±»å‹ï¼Œå¹¶ä¸”ä¼šåœ¨å¿…è¦çš„æ—¶å€™æ‰§è¡Œéšå¼å®å‚ç±»å‹è½¬æ¢ <code>sqrt(2);</code></p>
<p>3.å‡½æ•°é‡è½½å¯èƒ½ä¼šå› ä¸ºäºŒä¹‰æ€§æŠ¥é”™ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">int</span>, <span class="type">double</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">double</span>, <span class="type">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">user</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="number">0</span>,<span class="number">0</span>); <span class="comment">//æ­¤æ—¶ä¼šæŠ¥é”™ï¼Œå› ä¸ºä¸¤ä¸ªprintéƒ½å¯ä»¥ç”¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ“ŒC++å’ŒCç¼–è¯‘æ–‡ä»¶çš„åŒºåˆ«ï¼š<br>Cè¯­è¨€ä¸æ”¯æŒé‡è½½ï¼Œè€ŒC++æ”¯æŒã€‚å¦‚ä¸€ä¸ªå‡½æ•°å£°æ˜ä¸º<code>void function(float x,float y)</code>ï¼Œåœ¨Cè¯­è¨€ä¸­ï¼Œç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘ä¹‹åï¼Œåœ¨åº“ä¸­çš„åå­—ä¸º<code>_function</code>ï¼›åœ¨C++ä¸­ï¼Œç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘åï¼Œåœ¨åº“ä¸­çš„åå­—ä¸º<code>_function_float_float</code>ã€‚<br>ç¼–è¯‘å™¨åœ¨é“¾æ¥çš„é˜¶æ®µï¼Œéƒ½æ˜¯æ‰¾åˆ°ç›¸åº”çš„å‡½æ•°åï¼Œè¿›è¡Œé“¾æ¥ã€‚<br>åœ¨Cè¯­è¨€ä¸­ï¼Œä¸¤ä¸ªå‡½æ•°çš„åå­—ä¸€æ ·ï¼Œå°±ä¼šåœ¨é“¾æ¥æ—¶æŠ¥é”™ï¼›<br>åœ¨C++ä¸­ ï¼Œä¸¤ä¸ªå‡½æ•°åå­—ä¸ç›¸åŒï¼Œå°±ä¸ä¼šæŠ¥é”™ã€‚</p>
</blockquote>
</li>
<li><p><strong>å˜é‡ç±»å‹ä¸ç®—æœ¯ï¼š</strong></p>
<p>åŸºæœ¬ç±»å‹ï¼š<code>bool</code>ï¼Œ<code>int</code>ï¼Œ<code>double</code>ï¼Œ<code>char</code>ï¼Œ<code>unsigned</code>ï¼Œç­‰</p>
</li>
</ul>
<p>ç®—æœ¯è¿ç®—ç¬¦</p>
<p>æ¯”è¾ƒè¿ç®—ç¬¦</p>
<p>é€»è¾‘è¿ç®—ç¬¦</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">x+y  <span class="comment">//äºŒå…ƒåŠ æ³•</span></span><br><span class="line">+x   <span class="comment">//ä¸€å…ƒæ­£ï¼ˆç»“æœæ²¡åŒºåˆ«ï¼‰</span></span><br><span class="line">x-y  <span class="comment">//äºŒå…ƒå‡æ³•</span></span><br><span class="line">-y   <span class="comment">//ä¸€å…ƒè´Ÿï¼ˆç»“æœå–è´Ÿï¼‰</span></span><br><span class="line">x*y  <span class="comment">//ä¹˜æ³•</span></span><br><span class="line">x/y  <span class="comment">//é™¤æ³•</span></span><br><span class="line">x%y  <span class="comment">//å–æ¨¡</span></span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">x==y</span><br><span class="line">x!=y</span><br><span class="line">x&lt;y</span><br><span class="line">x&gt;y</span><br><span class="line">x&lt;=y</span><br><span class="line">x&gt;=y</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">x&amp;y  <span class="comment">//æŒ‰ä½ä¸</span></span><br><span class="line">x|y  <span class="comment">//æŒ‰ä½æˆ–</span></span><br><span class="line">x^y  <span class="comment">//æŒ‰ä½å¼‚æˆ–</span></span><br><span class="line">~x   <span class="comment">//æŒ‰ä½æ±‚è¡¥</span></span><br><span class="line">x&amp;&amp;y <span class="comment">//é€»è¾‘ä¸</span></span><br><span class="line">x||y <span class="comment">//é€»è¾‘æˆ–</span></span><br></pre></td></tr></table></figure>

<p><strong>åˆå§‹åŒ–</strong>çš„ä¸¤ç§æ–¹å¼ï¼š&#x3D;èµ‹å€¼è¿ç®—ç¬¦ å’Œ {}åˆå§‹å€¼åˆ—è¡¨ï¼ŒäºŒè€…åŒºåˆ«åœ¨äºå‰è€…å…è®¸éšå¼ç±»å‹è½¬æ¢ï¼Œè€Œåè€…ä¸å…è®¸</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">double</span> x = <span class="number">2.4</span></span><br><span class="line">complex &lt;<span class="type">double</span>&gt; test = &#123;<span class="number">2.4</span>,<span class="number">2</span>&#125;;<span class="comment">//æ­£ç¡®ï¼Œä¼šè½¬æ¢</span></span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">double</span> x &#123;<span class="number">2.4</span>&#125;;<span class="comment">//æ­£ç¡®</span></span><br><span class="line">complex &lt;<span class="type">double</span>&gt; test &#123;<span class="number">2.4</span>, <span class="number">2</span>&#125;<span class="comment">//é”™è¯¯ï¼Œ2æ˜¯int</span></span><br></pre></td></tr></table></figure>

<p>ç”±äºä¸å…è®¸éšå¼ç±»å‹è½¬æ¢ï¼Œæ‰€ä»¥ä¸€èˆ¬å»ºè®®åˆå§‹å€¼åˆ—è¡¨çš„æ–¹å¼åˆå§‹åŒ–å˜é‡ï¼Œå¯ä»¥é¿å…ä¸€äº›å¯¼è‡´éƒ¨åˆ†ä¿¡æ¯ä¸¢å¤±çš„ç±»å‹è½¬æ¢</p>
<ul>
<li><p>è¿˜å¯ä»¥ä½¿ç”¨autoå…³é”®å­—æ ¹æ®åˆå§‹å€¼è‡ªåŠ¨æ¨æ–­ç±»å‹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> b = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">auto</span> ch = <span class="string">&#x27;x&#x27;</span>;</span><br><span class="line"><span class="keyword">auto</span> i = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">auto</span> d = <span class="number">1.2</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
<!---->

<ul>
<li><p><strong>å¸¸é‡ï¼š</strong></p>
<ul>
<li><p>constï¼šä¿è¯å˜é‡ä¸å˜ <code>const int dmv = 17;</code></p>
</li>
<li><p>constexprï¼šç¼–è¯‘æ—¶æ±‚å€¼ <code>constexpr double max1=square(dmv);</code></p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>ğŸ“Œconstexprè‹¥è¦ç”¨åœ¨ç¼–è¯‘æ—¶æ±‚å€¼åœºæ™¯ï¼Œå³å¼å¿…é¡»æ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¸¸é‡è¡¨è¾¾å¼å‡½æ•°å¿…é¡»æœ‰constexprå£°æ˜</span></span><br><span class="line"><span class="function"><span class="keyword">constexpr</span> <span class="type">double</span> <span class="title">square</span><span class="params">(<span class="type">double</span> x)</span></span>&#123;<span class="keyword">return</span> x*x;&#125;</span><br></pre></td></tr></table></figure>

<p>ç”±constexprå£°æ˜çš„å‡½æ•°å¯ä»¥æ¥å—éå¸¸é‡å®å‚ï¼Œä½†æ­¤æ—¶å°†ä¸å†æ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼›è‹¥æ¥å—çš„æ˜¯å¸¸é‡å®å‚ï¼Œæ­¤æ—¶æ˜¯å¸¸é‡è¡¨è¾¾å¼ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> var = <span class="number">17</span>;</span><br><span class="line"><span class="keyword">constexpr</span> result1 = <span class="built_in">square</span>(var);</span><br><span class="line"><span class="comment">//æŠ¥é”™ï¼å› ä¸ºsquare(var)éå¸¸é‡è¡¨è¾¾å¼ï¼Œä¸å¯ç¼–è¯‘æ—¶æ±‚å€¼</span></span><br></pre></td></tr></table></figure>

<p>â†‘é”™è¯¯  â†’æ­£ç¡®</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> dmv = <span class="number">17</span>;</span><br><span class="line"><span class="keyword">constexpr</span> result2 = <span class="built_in">square</span>(dmv);</span><br><span class="line"><span class="comment">//æ­£ç¡®ï¼square(dmv)æ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼Œæ­¤æ—¶ç¼–è¯‘æ—¶æ±‚å€¼</span></span><br><span class="line"><span class="type">const</span> result3 = <span class="built_in">square</span>(var);</span><br><span class="line"><span class="comment">//æ­£ç¡®ï¼result3ä»æ˜¯å¸¸é‡ï¼Œæ­¤ä¸ºè¿è¡Œæ—¶æ±‚å€¼</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>ä½œç”¨åŸŸä¸ç”Ÿå‘½å‘¨æœŸï¼š</strong></p>
<ul>
<li><p>å±€éƒ¨ä½œç”¨åŸŸï¼š</p>
</li>
<li><p>ç±»ä½œç”¨åŸŸï¼š</p>
</li>
<li><p>å‘½åç©ºé—´ä½œç”¨åŸŸï¼š</p>
</li>
</ul>
</li>
<li><p><strong>å¾ªç¯ä¸æ¡ä»¶ï¼š</strong></p>
</li>
</ul>
<!---->

<ul>
<li><input disabled="" type="checkbox"> æ™®é€šfor</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span> i = <span class="number">0</span>; i != <span class="number">10</span>; ++i)&#123;</span><br><span class="line">  <span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><input disabled="" type="checkbox"> æ™®é€šwhile</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span>(i++ != <span class="number">10</span>)&#123;</span><br><span class="line">  <span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>forå¾ªç¯çš„æ‰§è¡Œé¡ºåºï¼šå…ˆauto i&#x3D;0ï¼Œå†åˆ¤æ–­iâ‰ 10ï¼Œè‹¥æ»¡è¶³ï¼Œæ‰§è¡Œ{ }ä¸­çš„å†…å®¹ï¼Œå†è¿›è¡Œ++iï¼Œç„¶ååˆ¤æ–­iâ‰ 10ï¼Œæ»¡è¶³åˆ™æ‰§è¡Œ{ }ï¼Œå†++iï¼Œå¾ªç¯å¾€å¤ã€‚</p>
<ul>
<li><input disabled="" type="checkbox"> forâ€¦rangeï¼ˆç±»ä¼¼äºPythoné‡Œçš„forï¼‰</li>
</ul>
<p>æ‹·è´å½¢å¼çš„forâ€¦rangeï¼ˆxæ˜¯vä¸­å…ƒç´ çš„æ‹·è´å€¼ï¼‰</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> v[] &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>&#125;;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span> x:v)</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;%d&quot;</span>, x);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span> x:&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;)</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;%d&quot;</span>, x);</span><br></pre></td></tr></table></figure>

<p><strong>å¼•ç”¨å½¢å¼çš„forâ€¦range</strong>ï¼ˆxæ˜¯vä¸­å…ƒç´ çš„å¼•ç”¨ï¼‰</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span>&amp; x:v)</span><br><span class="line">  ++x;</span><br></pre></td></tr></table></figure>

<ul>
<li><input disabled="" type="checkbox"> switch</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">switch</span>(ch)&#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&#x27;u&#x27;</span>:</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>switchçš„é™åˆ¶ï¼š</p>
<p>chå¿…é¡»æ˜¯ä¸€ä¸ªæ•´å½¢æˆ–æšä¸¾ç±»å‹ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªclassï¼ˆclassä¸­æœ‰è½¬æ¢å‡½æ•°å°†å…¶è½¬æ¢ä¸ºæ•´å‹æˆ–æšä¸¾ç±»å‹ï¼‰</p>
</li>
</ul>
<!---->

<ul>
<li><p><strong>å†…è”å‡½æ•°ï¼š</strong></p>
<ul>
<li><p>å†…è”å‡½æ•°ä»¥ç©ºé—´æ¢æ—¶é—´ï¼Œçœå»è°ƒç”¨å‡½æ•°çš„é¢å¤–å¼€é”€ã€‚æ‰€ä»¥ä»£ç å¾ˆé•¿æˆ–æœ‰å¾ªç¯çš„æ—¶å€™ä¸é€‚åˆä½¿ç”¨å†…è”ï¼›</p>
</li>
<li><p>inlineå¯¹ç¼–è¯‘å™¨è€Œè¨€åªæ˜¯ä¸€ä¸ªå»ºè®®ï¼Œå¦‚æœå®šä¹‰çš„å‡½æ•°ä½“å†…æœ‰é€’å½’&#x2F;å¾ªç¯ç­‰ï¼Œç¼–è¯‘å™¨ä¼˜åŒ–æ—¶è‡ªåŠ¨å¿½è§†å†…è”ï¼›</p>
</li>
<li><p>inlineå¿…é¡»ä¸å‡½æ•°å®šä¹‰æ”¾åœ¨ä¸€èµ·ï¼Œä»…å°†å†…è”æ”¾åœ¨å£°æ˜å‰æ˜¯ä¸èµ·ä½œç”¨çš„ï¼›</p>
</li>
<li><p>å®šä¹‰åœ¨ç±»å†…çš„æˆå‘˜å‡½æ•°é»˜è®¤ä¸ºå†…è”å‡½æ•°ï¼›</p>
</li>
<li><p>å†…è”ä¸å®å‡½æ•°çš„åŒºåˆ«ï¼š</p>
<ul>
<li><p>å®ï¼š</p>
<ul>
<li><p>æ²¡æœ‰ç±»å‹æ£€æµ‹ï¼Œä¸å®‰å…¨</p>
</li>
<li><p>ä¸èƒ½è¿›è¡Œè°ƒè¯•</p>
</li>
<li><p>ä¸å¯ä»¥è®¿é—®ç±»çš„æˆå‘˜å˜é‡</p>
</li>
</ul>
</li>
<li><p>å†…è”å‡½æ•°ï¼š</p>
<ul>
<li><p>æœ‰ç±»å‹æ£€æµ‹ï¼Œè¾ƒå®‰å…¨</p>
</li>
<li><p>è¿›è¡Œå‚æ•°ä¼ é€’ï¼Œå¯åœ¨è¿è¡Œæ—¶è°ƒè¯•</p>
</li>
<li><p>å¯ä»¥è®¿é—®ç±»çš„æˆå‘˜å˜é‡</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>æŒ‡é’ˆä¸å¼•ç”¨ï¼š</strong></p>
<p>ç©ºæŒ‡é’ˆå°½é‡ç”¨<code>nullptr</code>ï¼Œä½¿ç”¨<code>NULL</code>å¯èƒ½ä¼šå¯¼è‡´ä¸æ•´æ•°0çš„æ··æ·†ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">char</span>* p = &amp;v[<span class="number">3</span>];   <span class="comment">//pæŒ‡å‘væ•°ç»„ä¸­çš„ç¬¬å››ä¸ªå…ƒç´ çš„åœ°å€</span></span><br><span class="line"><span class="type">char</span> x = *p;       <span class="comment">//væ˜¯pæŒ‡å‘åœ°å€çš„å˜é‡çš„å€¼</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ“Œå‰ç½®&amp;è¡¨ç¤ºä¸€ä¸ªå˜é‡çš„åœ°å€ï¼›<br>åç½®&amp;è¡¨ç¤ºå£°æ˜ä¸€ä¸ªå¼•ç”¨</p>
</blockquote>
<ul>
<li><p>å°†å¼•ç”¨ä¼ å…¥ä½œä¸ºå‡½æ•°å®å‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œå‡½æ•°å®å‚çš„ä¼ é€’æ˜¯ä¸€ä¸ªæ‹·è´çš„è¿‡ç¨‹ï¼Œå°†å˜é‡çš„å€¼æ‹·è´åˆ°å‡½æ•°çš„æ ˆä¸­ï¼Œä¸ä¼šå¸¦æ¥å¯¹åŸå˜é‡çš„å½±å“ã€‚</p>
<p>è€Œè‹¥å°†å¼•ç”¨ä½œä¸ºå‚æ•°ä¼ é€’<code>void sort(vector&lt;double&gt;&amp; vec);</code>ï¼Œsortå‡½æ•°å°†ç›´æ¥æ“çºµvecå‘é‡ï¼Œæ²¡æœ‰æ‹·è´çš„è¿‡ç¨‹ã€‚è¿™æ ·å¯ä»¥åŠ å¿«é€Ÿåº¦ï¼ŒèŠ‚çœç©ºé—´ï¼Œä½†å¸¦æ¥äº†æ“ä½œåŸå˜é‡ï¼Œè¯¯æ”¹åŠ¨å€¼çš„é£é™©ã€‚</p>
<p>è‹¥æƒ³åŠ å¿«ä¼ å…¥å¤§æ•°ç»„å‚æ•°çš„é€Ÿåº¦ï¼Œåˆä¸æ”¹å˜å€¼ï¼Œå¯ä»¥åŠ å…¥consté™å®šï¼</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">sum</span><span class="params">(<span class="type">const</span> vector&lt;<span class="type">double</span>&gt;&amp; vec)</span></span>;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>äºŒçº§æŒ‡é’ˆä¸æŒ‡é’ˆçš„å¼•ç”¨</p>
<ul>
<li><p>äºŒçº§æŒ‡é’ˆ</p>
<p>æŒ‡é’ˆçš„æŒ‡é’ˆï¼Œä½œç”¨æ˜¯æ”¹å˜æŒ‡é’ˆæœ¬èº«çš„å†…å®¹ã€‚</p>
</li>
<li><p>æŒ‡é’ˆçš„å¼•ç”¨</p>
<p>æŒ‡é’ˆçš„å¼•ç”¨ï¼Œå¯ä»¥å†™ä¸º<code>int *&amp;i;</code>å½¢å¼ï¼Œæœ¬è´¨æ˜¯<code>((int*)&amp;) i;</code>ï¼Œè¡¨ç¤ºiæ˜¯ä¸€ä¸ªintå‹æŒ‡é’ˆçš„å¼•ç”¨ï¼Œä¹Ÿå¯ä»¥åƒäºŒçº§æŒ‡é’ˆä¸€æ ·ä¿®æ”¹æŒ‡é’ˆæœ¬èº«çš„å†…å®¹ã€‚</p>
</li>
</ul>
<p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œæ²¡æœ‰æŒ‡å‘å¼•ç”¨çš„æŒ‡é’ˆï¼Œå› ä¸ºå¼•ç”¨ä¸æ˜¯å˜é‡ï¼Œå› æ­¤ä¸å­˜åœ¨æŒ‡é’ˆã€‚</p>
</li>
</ul>
<h3 id="2-ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹"><a href="#2-ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹" class="headerlink" title="2 ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹"></a>2 ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹</h3><blockquote>
<p>è¿™æ˜¯C++æä¾›çš„ä¸€ç§æŠ½è±¡æœºåˆ¶ï¼Œç”¨æˆ·å¯ä»¥æ­¤æœºåˆ¶å®šä¹‰è‡ªå·±æƒ³è¦å®ç°æŸäº›åŠŸèƒ½çš„æ–°ç±»å‹</p>
</blockquote>
<ul>
<li><p><strong>ç»“æ„ä½“ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Vector</span>&#123;</span><br><span class="line">  <span class="type">int</span> sz;       <span class="comment">//å…ƒç´ çš„æ•°é‡</span></span><br><span class="line">  <span class="type">double</span> * elem;<span class="comment">//æŒ‡å‘å…ƒç´ çš„æŒ‡é’ˆ</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Vector_init</span><span class="params">(Vector&amp; v, <span class="type">int</span> s)</span></span>&#123;</span><br><span class="line">  v.elem = <span class="keyword">new</span> <span class="type">double</span>[s];</span><br><span class="line">  v.sz = s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è®¿é—®ç»“æ„ä½“çš„å…ƒç´ æœ‰ä¸¤ç§æ–¹å¼ï¼Œç‚¹è¿ç®—ç¬¦å’Œâ†’è¿ç®—ç¬¦ï¼ˆæŒ‡é’ˆï¼‰</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">Vector v &#123;<span class="number">0</span>, <span class="literal">nullptr</span>&#125;;</span><br><span class="line"><span class="built_in">Vector_init</span>(v, <span class="number">3</span>);</span><br><span class="line">v.elem[<span class="number">0</span>] = <span class="number">1</span>,v.elem[<span class="number">1</span>] = <span class="number">2</span>,v.elem[<span class="number">2</span>] = <span class="number">3</span>;</span><br><span class="line">Vector&amp; rv = v;</span><br><span class="line">Vector* pv = &amp;v; </span><br><span class="line"></span><br><span class="line">cout &lt;&lt; v.sz &lt;&lt; rv.sz &lt;&lt; pv-&gt;sz &lt;&lt; endl;</span><br></pre></td></tr></table></figure>

<ul>
<li>ç»“æ„ä½“çš„å¤šç§åˆå§‹åŒ–æ–¹æ³•ï¼š</li>
</ul>
<blockquote>
<p>ğŸ“Œç»“æ„ä½“åˆå§‹åŒ–ï¼š<br>- {}åˆå§‹åŒ–ï¼š<br><code>Node b = &#123;2, nullptr&#125;</code>æˆ– <code>Node b &#123;2, nullptr&#125;;</code><br>- æ„é€ å‡½æ•°åˆå§‹åŒ–ï¼š<br>&#96;struct Node{                                                                     </p>
<pre><code> int var;                                                                             
 Node* `\*\*`next;                                                                   
 Node(int value, Node next_ty)&#123;
      thisâ†’var = value;
      thisâ†’next = next_ty;
 &#125;
 //æˆ–è€…ï¼š Node(int value, Node* next_ty):var(value), next(next_ty)&#123;&#125;;
</code></pre>
<p>};&#96;&#96;Node c(3, nullptr)<code>  æˆ– </code>Node* d &#x3D; new Node(4,nullptr)&#96;</p>
</blockquote>
</li>
<li><p><strong>ç±»ï¼š</strong></p>
<p>ç±»æœ‰ä¸€ç³»åˆ—æˆå‘˜ï¼Œå¯èƒ½æ˜¯æ•°æ®ã€å‡½æ•°æˆ–ç±»å‹ã€‚publicæˆå‘˜å®šä¹‰äº†è¯¥ç±»çš„æ¥å£ï¼Œprivateæˆå‘˜åˆ™åªèƒ½ä»æ¥å£è®¿é—®</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vector</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Vector</span>(<span class="type">int</span> s): elem&#123;<span class="keyword">new</span> <span class="type">double</span>[s]&#125;, sz&#123;&#125; &#123;&#125; <span class="comment">//æ„é€ å‡½æ•°çš„åˆå§‹å€¼åˆ—è¡¨</span></span><br><span class="line">  <span class="type">double</span>&amp; <span class="keyword">operator</span>[](<span class="type">int</span> i)&#123; <span class="keyword">return</span> elem[i]; &#125;</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> sz; &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">double</span>* elem; <span class="comment">// æŒ‡å‘å…ƒç´ çš„æŒ‡é’ˆ</span></span><br><span class="line">  <span class="type">int</span> sz; <span class="comment">//å…ƒç´ çš„æ•°é‡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œè™½ç„¶Vectorç±»ä¸­elemçš„å…ƒç´ ä¸ªæ•°å¯èƒ½ä¼šå˜ï¼Œä½†æ˜¯Vectorå£°æ˜çš„å¯¹è±¡å¤§å°æ˜¯ä¸å˜çš„ã€‚è¿™ä¸€ç‚¹ä¹Ÿé€‚ç”¨äºæ‰€æœ‰ç±»å£°æ˜çš„å¯¹è±¡ã€‚</p>
<blockquote>
<p>ğŸ“Œstructå’Œclasså¹¶æ²¡æœ‰å¤ªå¤§åŒºåˆ«ï¼Œstructä¸­ä¹Ÿå¯ä»¥å®šä¹‰ä¸€äº›æˆå‘˜å‡½æ•°ã€‚å”¯ä¸€çš„åŒºåˆ«ä½“ç°åœ¨structä¸­çš„æ‰€æœ‰æˆå‘˜éƒ½æ˜¯publicçš„ã€‚</p>
</blockquote>
</li>
<li><p><strong>æšä¸¾ï¼š</strong></p>
<ul>
<li><p>æ™®é€šæšä¸¾ï¼š<code>enum</code></p>
<p>æ™®é€šæšä¸¾çš„æšä¸¾å€¼éƒ½æ˜¯æ•´å½¢ï¼Œé»˜è®¤æƒ…å†µä¸‹æšä¸¾å€¼å¯¹åº”çš„æ•´æ•°ä»0å¼€å§‹ï¼Œä¾æ¬¡åŠ 1</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Color</span> &#123;red, green, blue&#125;;</span><br><span class="line"><span class="type">int</span> col = green; <span class="comment">//colçš„å€¼å˜ä¸º1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¼ºç±»å‹æšä¸¾ï¼šï¼ˆscoped enumerationï¼ŒC++11å¼•å…¥çš„ç‰¹æ€§ï¼‰</p>
<p>å¼ºç±»å‹ä¸­ï¼Œæ¯ä¸ª<code>enum class</code>æ˜¯ä¸åŒçš„ç±»å‹ï¼Œå…¶æšä¸¾å€¼ä½äºæŒ‡å®šçš„ä½œç”¨åŸŸä¸­ï¼Œä¸å¾—æ··ç”¨ï¼Œå¯é¿å…å¯¹å¸¸é‡çš„æ„å¤–è¯¯ç”¨</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum class</span> <span class="title class_">Color</span> &#123;red, blue, green&#125;;</span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">Traffic_light</span> &#123;green, yellow, red&#125;;</span><br><span class="line"></span><br><span class="line">Color x = red;                <span class="comment">//æŠ¥é”™ï¼Œå“ªä¸ªredï¼Ÿ</span></span><br><span class="line">Color y = Traffic_light::red; <span class="comment">//æŠ¥é”™ï¼Œè¿™ä¸ªRedä¸æ˜¯ä¸€ä¸ªColorå¯¹è±¡</span></span><br><span class="line">Color z = Color::red;         <span class="comment">//æ­£ç¡® </span></span><br><span class="line"><span class="type">int</span> col = Color::red;         <span class="comment">//æŠ¥é”™ï¼ŒColor::Redä¸æ˜¯ä¸€ä¸ªint</span></span><br></pre></td></tr></table></figure>

<p>å¼ºç±»å‹æšä¸¾å¹¶ä¸å’Œæ™®é€šæšä¸¾ä¸€æ ·ï¼Œæšä¸¾å€¼å¹¶ä¸æ˜¯intã€‚ä½†å…¶ä½œä¸ºä¸€ç§ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹ï¼Œä¹Ÿå¯è¿›è¡Œè¿ç®—ç¬¦é‡è½½</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">Traffic_light&amp; <span class="keyword">operator</span>++(Traffic_light&amp; t)&#123;<span class="comment">//å‰ç½®++è¿ç®—ç¬¦</span></span><br><span class="line">  <span class="keyword">switch</span>(t)&#123;</span><br><span class="line">    <span class="keyword">case</span> Traffic_light::green: <span class="keyword">return</span> t = Traffic_light::yellow;</span><br><span class="line">    <span class="keyword">case</span> Traffic_light::green: <span class="keyword">return</span> t = Traffic_light::yellow;</span><br><span class="line">    <span class="keyword">case</span> Traffic_light::green: <span class="keyword">return</span> t = Traffic_light::yellow;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>è”åˆï¼š</strong></p>
<p>unionçš„æ‰€æœ‰æˆå‘˜è¢«åˆ†é…åœ¨åŒä¸€ç‰‡å†…å­˜åŒºåŸŸä¸­ï¼Œå…¶å®é™…å ç”¨çš„ç©ºé—´å°±æ˜¯å®ƒæœ€å¤§çš„æˆå‘˜æ‰€å çš„ç©ºé—´ã€‚åŒä¸€æ—¶åˆ»ï¼Œunionä¸­åªèƒ½ä¿å­˜ä¸€ä¸ªæˆå‘˜çš„å€¼ã€‚</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Type</span> &#123;str, num&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Entry</span>&#123;</span><br><span class="line">  <span class="type">char</span>* name;</span><br><span class="line">  Type t;</span><br><span class="line">  <span class="type">char</span>* s;  <span class="comment">//å¦‚æœt==str,åˆ™ä½¿ç”¨s</span></span><br><span class="line">  <span class="type">int</span> i;    <span class="comment">//å¦‚æœt==num,åˆ™ä½¿ç”¨i</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">(Entry* p)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(p-&gt;t==str)</span><br><span class="line">    cout &lt;&lt; p-&gt;s;</span><br><span class="line">  <span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚å·¦è¾¹ç¨‹åºæ‰€ç¤ºï¼Œså’Œiæ°¸è¿œä¸ä¼šåŒæ—¶ç”¨åˆ°ï¼Œä½†åˆåŒæ—¶å®šä¹‰äº†äºŒè€…ï¼Œæ‰€ä»¥æ— å½¢ä¸­æµªè´¹äº†å†…å­˜ç©ºé—´ï¼Œä½¿ç”¨è”åˆå¯è§£å†³è¯¥é—®é¢˜ã€‚</p>
<p>å‘½åè”åˆå’ŒåŒ¿åè”åˆå‡å¯ï¼</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å‘½åè”åˆä½“</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Type</span> &#123;str,num&#125;;</span><br><span class="line"><span class="keyword">union</span> <span class="title class_">Value</span>&#123;</span><br><span class="line">  <span class="type">char</span>* s;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Entry</span>&#123;</span><br><span class="line">  <span class="type">char</span>* name;</span><br><span class="line">  Type t;</span><br><span class="line">  Value v;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">(Entry* p)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(p-&gt;t==str)</span><br><span class="line">    cout&lt;&lt;p-&gt;v.s;</span><br><span class="line">  <span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åŒ¿åè”åˆä½“</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Type</span> &#123;str,num&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Entry</span>&#123;</span><br><span class="line">  <span class="type">char</span>* name;</span><br><span class="line">  Type t;</span><br><span class="line">  <span class="keyword">union</span> &#123;</span><br><span class="line">    <span class="type">char</span>* s;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">(Entry* p)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(p-&gt;t==str)</span><br><span class="line">    cout&lt;&lt;p-&gt;s;<span class="comment">//åŒ¿åçš„ä¼˜åŠ¿åœ¨äºï¼Œå¯ä»¥ç›´æ¥ç”¨</span></span><br><span class="line">  <span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šåˆå§‹åŒ–æ­¤ç»“æ„ä½“ä¸èƒ½å†<code>Entry test&#123;&quot;abc&quot;, num, 123&#125;</code>ï¼Œ{}ä¼šæŒ‰{char <em>, Type, char</em>}åˆå§‹åŒ–ï¼Œå‘æŒ¥ä¸äº†unionä¼˜åŠ¿</p>
<p>è¦é€ä¸ªèµ‹åˆå€¼ï¼Œä»¥åŒ¿åè”åˆä½“ä¸ºä¾‹ï¼Œè¦<code>Entry test;test.name=&quot;abc&quot;; test.t=str;test.s=&quot;abc&quot;;//test.t=num;test.i=123;</code></p>
<h4 id="auto-x2F-decltype"><a href="#auto-x2F-decltype" class="headerlink" title="auto&#x2F;decltype"></a>auto&#x2F;decltype</h4><blockquote>
<p>autoè‡ªåŠ¨ç±»å‹æ¨åˆ°ï¼Œåœ¨ä»£ç é‡Œçš„ä½œç”¨åƒä¸€ä¸ªå ä½ç¬¦ï¼Œå†™ä¸Šå®ƒï¼Œè®©ç¼–è¯‘å™¨è‡ªåŠ¨å¡«ä¸Šå˜é‡çš„ç±»å‹ã€‚å…¶å±äºç¼–è¯‘é˜¶æ®µçš„ç‰¹æ®ŠæŒ‡ä»¤ï¼Œå› æ­¤åœ¨æ³›å‹ç¼–ç¨‹å’Œæ¨¡æ¿å…ƒç¼–ç¨‹é‡Œæœ‰æ¯”è¾ƒå¤šçš„ä½¿ç”¨ã€‚<br>decltypeæ¯”è¾ƒåƒå‡½æ•°ï¼Œæ¥è®¡ç®—ç±»å‹ï¼Œè·Ÿautoå¾ˆåƒã€‚ï¼ˆä¹Ÿæ˜¯ç¼–è¯‘é˜¶æ®µçš„ç±»å‹æ¨å¯¼ï¼‰</p>
</blockquote>
<ul>
<li><p><strong>autoæ³¨æ„äº‹é¡¹</strong>ï¼š</p>
<ul>
<li><p>autoçš„è‡ªåŠ¨æ¨å¯¼èƒ½åŠ›åªèƒ½ç”¨åœ¨â€œåˆå§‹åŒ–â€åœºåˆ</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> x = <span class="number">0L</span>;    <span class="comment">// è‡ªåŠ¨æ¨å¯¼ä¸ºlong</span></span><br><span class="line"><span class="keyword">auto</span> y = &amp;x;    <span class="comment">// è‡ªåŠ¨æ¨å¯¼ä¸ºlong*</span></span><br><span class="line"><span class="keyword">auto</span> z &#123;&amp;x&#125;;    <span class="comment">// è‡ªåŠ¨æ¨å¯¼ä¸ºlong* </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> err;       <span class="comment">// é”™è¯¯ï¼Œæ²¡æœ‰èµ‹å€¼è¡¨è¾¾å¼ï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆç±»å‹</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ç±»æˆå‘˜å˜é‡åˆå§‹åŒ–æ—¶ï¼Œä¸å…è®¸ä½¿ç”¨autoæ¨å¯¼ç±»å‹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">X</span> <span class="keyword">final</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">auto</span> a = <span class="number">10</span>;  <span class="comment">// é”™è¯¯ï¼Œç±»é‡Œä¸èƒ½ä½¿ç”¨autoæ¨å¯¼ç±»å‹</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>autoæ€»æ˜¯æ¨å¯¼å‡ºâ€œå€¼ç±»å‹â€ï¼Œç»ä¸ä¼šæ˜¯â€œå¼•ç”¨â€ï¼›ä½†æ˜¯autoå¯ä»¥é™„åŠ ä¸Šconstã€ *ã€&amp;ç­‰ï¼Œå¾—åˆ°æ–°çš„ç±»å‹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span>        x = <span class="number">10L</span>;    <span class="comment">// autoæ¨å¯¼ä¸ºlongï¼Œxæ˜¯long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span>&amp;       x1 = x;     <span class="comment">// autoæ¨å¯¼ä¸ºlongï¼Œx1æ˜¯long&amp;</span></span><br><span class="line"><span class="keyword">auto</span>*       x2 = &amp;x;    <span class="comment">// autoæ¨å¯¼ä¸ºlongï¼Œx2æ˜¯long*</span></span><br><span class="line"><span class="type">const</span> <span class="keyword">auto</span>&amp; x3 = x;     <span class="comment">// autoæ¨å¯¼ä¸ºlongï¼Œx3æ˜¯const long&amp;</span></span><br><span class="line"><span class="keyword">auto</span>        x4 = &amp;x3;   <span class="comment">// autoæ¨å¯¼ä¸ºconst long*ï¼Œx4æ˜¯const long*</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>decltypeæ³¨æ„äº‹é¡¹</strong>ï¼šdecltypeæ²¡æœ‰autoè¿™ä¹ˆå¤šå±€é™ï¼Œ<strong>å‰è¿°autoçš„ä¸‰ä¸ªäº‹é¡¹åœ¨decltypeè¿™é‡Œå‡ä¸éœ€è¦æ³¨æ„</strong>ã€‚</p>
<ul>
<li><p>ç±»å‹æ¨å¯¼æ—¶ä¸éœ€è¦åˆå§‹åŒ–ï¼ˆåé¢æ— éœ€æœ‰è¡¨è¾¾å¼ï¼‰ï¼Œå¯ä»¥ç›´æ¥å£°æ˜å˜é‡ï¼›</p>
</li>
<li><p>decltypeä¸ä»…èƒ½å¤Ÿæ¨å¯¼å‡ºå€¼ç±»å‹ï¼Œè¿˜èƒ½æ¨å¯¼å‡ºå¼•ç”¨ç±»å‹ï¼Œå³â€œåŸå§‹ç±»å‹â€</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> x = <span class="number">0</span>;          <span class="comment">// æ•´å‹å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">decltype</span>(x)     x1;      <span class="comment">// æ¨å¯¼ä¸ºintï¼Œx1æ˜¯int</span></span><br><span class="line"><span class="keyword">decltype</span>(x)&amp;    x2 = x;    <span class="comment">// æ¨å¯¼ä¸ºintï¼Œx2æ˜¯int&amp;ï¼Œå¼•ç”¨å¿…é¡»èµ‹å€¼</span></span><br><span class="line"><span class="keyword">decltype</span>(x)*    x3;      <span class="comment">// æ¨å¯¼ä¸ºintï¼Œx3æ˜¯int*</span></span><br><span class="line"><span class="keyword">decltype</span>(&amp;x)    x4;      <span class="comment">// æ¨å¯¼ä¸ºint*ï¼Œx4æ˜¯int*</span></span><br><span class="line"><span class="keyword">decltype</span>(&amp;x)*   x5;      <span class="comment">// æ¨å¯¼ä¸ºint*ï¼Œx5æ˜¯int**</span></span><br><span class="line"><span class="keyword">decltype</span>(x2)    x6 = x2;  <span class="comment">// æ¨å¯¼ä¸ºint&amp;ï¼Œx6æ˜¯int&amp;ï¼Œå¼•ç”¨å¿…é¡»èµ‹å€¼</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>C++14å¼•å…¥äº†<code>decltype(auto)</code>ï¼Œæ—¢èƒ½å¤Ÿç²¾ç¡®æ¨å¯¼ç±»å‹ï¼Œåˆå¯ä»¥åƒautoä¸€æ ·æ–¹ä¾¿ï¼ˆdecltypeé‡Œä¸å†æ¯æ¬¡éƒ½è¾“å…¥ç‰¹å®šçš„è¡¨è¾¾å¼äº†ï¼‰</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> x = <span class="number">0</span>;            <span class="comment">// æ•´å‹å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">decltype</span>(<span class="keyword">auto</span>)     x1 = (x);  <span class="comment">// æ¨å¯¼ä¸ºint&amp;ï¼Œå› ä¸º(expr)æ˜¯å¼•ç”¨ç±»å‹</span></span><br><span class="line"><span class="keyword">decltype</span>(<span class="keyword">auto</span>)     x2 = &amp;x;   <span class="comment">// æ¨å¯¼ä¸ºint*</span></span><br><span class="line"><span class="keyword">decltype</span>(<span class="keyword">auto</span>)     x3 = x1;   <span class="comment">// æ¨å¯¼ä¸ºint&amp;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>autoå’Œdecltypeçš„ä½¿ç”¨</strong>ï¼š</p>
<ul>
<li><p>autoä½¿ç”¨åœºæ™¯ï¼šå˜é‡å£°æ˜ã€range-based forï¼š<code>for(auto&amp; i : vec)</code>ã€å‡½æ•°è¿”å›å€¼<code>auto test()&#123;&#125;</code>ï¼ˆC++14ï¼‰</p>
</li>
<li><p>decltypeçš„ä½¿ç”¨åœºæ™¯ï¼š</p>
<ul>
<li><p>å½“ç±»å‹éå¸¸å¥‡æ€ªæ—¶ï¼Œç»™å¥‡æ€ªç±»å‹ä¸€ä¸ªåˆ«å</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// UNIXä¿¡å·å‡½æ•°çš„åŸå‹ï¼Œçœ‹ç€å°±è®©äººæ™•ï¼Œä½ èƒ½æ‰‹å†™å‡ºå‡½æ•°æŒ‡é’ˆå—ï¼Ÿ</span></span><br><span class="line"><span class="built_in">void</span> (*<span class="built_in">signal</span>(<span class="type">int</span> signo, <span class="built_in">void</span> (*func)(<span class="type">int</span>)))(<span class="type">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨decltypeå¯ä»¥è½»æ¾å¾—åˆ°å‡½æ•°æŒ‡é’ˆç±»å‹</span></span><br><span class="line"><span class="keyword">using</span> <span class="type">sig_func_ptr_t</span> = <span class="keyword">decltype</span>(&amp;signal) ;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç±»å†…æˆå‘˜ï¼Œautoè¢«ç¦ï¼Œdecltypeå¯ä»¥æ›¿æ¢</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DemoClass</span> <span class="keyword">final</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> set_type      = std::set;  <span class="comment">// é›†åˆç±»å‹åˆ«å</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    set_type      m_set;                   <span class="comment">// ä½¿ç”¨åˆ«åå®šä¹‰æˆå‘˜å˜é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨decltypeè®¡ç®—è¡¨è¾¾å¼çš„ç±»å‹ï¼Œå®šä¹‰åˆ«å</span></span><br><span class="line">    <span class="keyword">using</span> iter_type = <span class="keyword">decltype</span>(m_set.<span class="built_in">begin</span>());</span><br><span class="line"></span><br><span class="line">    iter_type     m_pos;                   <span class="comment">// ç±»å‹åˆ«åå®šä¹‰æˆå‘˜å˜é‡</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="ä½åŸŸ"><a href="#ä½åŸŸ" class="headerlink" title="ä½åŸŸ"></a>ä½åŸŸ</h4><p>C++ä¸­çš„ç±»å’Œç»“æ„ä½“å¯ä»¥åŒ…å«æ¯”å†…ç½®æ•´å½¢ç±»å‹å ç”¨æ›´å°‘å­˜å‚¨ç©ºé—´çš„æˆå‘˜ã€‚è¿™äº›æˆå‘˜å¯ä»¥æŒ‡å®šä½æ•°å¤§å°ï¼Œå«åšâ€œä½åŸŸâ€ã€‚</p>
<p>ä½åŸŸå¯ä»¥çœ‹åšå†…ç½®æ•´å½¢ç±»å‹çš„å­é›†ï¼Œä½åŸŸæˆå‘˜å¯ä»¥æŒ‡å®šå…¶åœ¨ç»“æ„ä½“ä¸­å ç”¨çš„ä½æ•°ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Date</span>&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> nWeekDay  : <span class="number">3</span>;  <span class="comment">//3 bits</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> nMonthDay : <span class="number">6</span>;  <span class="comment">//6 bits</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> nMonth    : <span class="number">5</span>;  <span class="comment">//5 bits</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> nYear     : <span class="number">8</span>;  <span class="comment">//8 bits</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><img src="/image/image_MHylNzhysP.png"></p>
<p>å£°æ˜ä¸ºä½åŸŸçš„æ•°æ®ä»ä½ä½åˆ°é«˜ä½è¿›è¡Œæ’åº</p>
<p>å‡å®šç³»ç»Ÿä¸­unsigned shortæ˜¯16ä½çš„ï¼ŒnYear8ä½ï¼Œä¼šæº¢å‡ºunsigned shortç±»å‹çš„å•å…ƒè¾¹ç•Œï¼Œå› æ­¤å®ƒä¼šä»æ–°çš„unsigned shortå¼€å§‹ã€‚åŒæ—¶ï¼Œè¿˜å¯ä»¥æœ‰åŒ¿åä½åŸŸï¼ˆå®½åº¦ä¸º0ï¼‰ï¼ŒåŒ¿åä½åŸŸä¼šå¼ºåˆ¶ä¸‹ä¸€å­—æ®µä¸ä¸‹ä¸€ä¸ªç±»å‹è¾¹ç•Œå¯¹é½</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Date</span>&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> nWeekDay  : <span class="number">3</span>;  <span class="comment">//3 bits</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> nMonthDay : <span class="number">6</span>;  <span class="comment">//6 bits</span></span><br><span class="line">  <span class="type">unsigned</span>                 : <span class="number">0</span>;  <span class="comment">//å¼ºåˆ¶å¯¹é½åˆ°ä¸‹ä¸€è¾¹ç•Œ</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> nMonth    : <span class="number">5</span>;  <span class="comment">//5 bits</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> nYear     : <span class="number">8</span>;  <span class="comment">//8 bits</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><img src="/image/image_nuXGWwKUxa.png"></p>
<p>å¸¦æœ‰é›¶é•¿åº¦ä½åŸŸçš„å¯¹è±¡å¸ƒå±€</p>
<blockquote>
<p>ğŸ“Œä½åŸŸå­—æ®µçš„åŸºç¡€ç±»å‹å¿…é¡»æ˜¯æ•´å½¢ç±»å‹ï¼ˆå†…ç½®çš„é‚£äº›ï¼‰</p>
</blockquote>
<h3 id="3-æ¨¡å—åŒ–"><a href="#3-æ¨¡å—åŒ–" class="headerlink" title="3 æ¨¡å—åŒ–"></a>3 æ¨¡å—åŒ–</h3><ul>
<li><p><strong>å‘½åç©ºé—´ï¼š</strong></p>
<p>ä¸€æ®µå®Œæ•´çš„ç¨‹åºå¯èƒ½æ˜¯ç”±ä¸åŒéƒ¨åˆ†æ„æˆçš„ï¼Œåº”å¯¹è¿™ç§æƒ…å†µï¼Œä¸ºä½¿ç»“æ„æ¸…æ™°ä¸”ç¼–è¯‘åŠ å¿«ï¼Œåº”è¯¥ä½¿ç”¨<strong>åˆ†ç¦»ç¼–è¯‘</strong>ï¼Œå³åœ¨å¤´æ–‡ä»¶ä¸­å£°æ˜ï¼Œåˆ©ç”¨å¤´æ–‡ä»¶æä¾›æ¥å£ï¼Œå…·ä½“å®ç°åœ¨ä¸åŒæºæ–‡ä»¶ä¸­ã€‚</p>
<p>ä½†æ˜¯è‹¥æœ‰å¤šä¸ªå¼€å‘è€…å…±åŒå¼€å‘ï¼ŒæŠŠæ¨¡å—ç»„è£…åœ¨ä¸€èµ·æ„æˆç¨‹åºå¹¶ä¸ä¸€å®šæ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ï¼Œç‰¹åˆ«æ˜¯å½“ä¸åŒå¼€å‘è€…å‘½åäº†åŒä¸€ä¸ªå‡½æ•°åæ—¶ã€‚å‘½åç©ºé—´ä¸ºè§£å†³æ­¤æƒ…å†µé—®é¢˜è€Œç”Ÿã€‚</p>
<p>å¦‚è¦å£°æ˜ä¸€ä¸ªè‡ªå·±çš„complexç±»å‹ï¼Œä½†åˆä¸æƒ³ä¸stdåº“ä¸­çš„complexç±»å‹å†²çªï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">namespace</span> My_Code&#123;</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">complex</span>&#123;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="function">complex <span class="title">sort</span><span class="params">(complex)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">My_Code::complex <span class="title">My_Code::sort</span><span class="params">(My_Code::complex)</span></span>&#123;</span><br><span class="line">  <span class="comment">//......</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  My_Code::complex a &#123;<span class="number">1</span>,<span class="number">2</span>&#125;;</span><br><span class="line">  My_Code::complex result = My_Code::<span class="built_in">sort</span>(a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼Œå¦‚æœä¸æƒ³å†™çš„åƒä¸Šé¢é‚£æ ·ç¹çï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨usingå…³é”®å­—<code>using namespace My_Code</code>ï¼Œä½¿å¾—ä¸€ä¸ªæŒ‡å®šå‘½åç©ºé—´çš„åå­—åœ¨å½“å‰åœ¨å½“å‰ä½œç”¨åŸŸä¸­å¯è§ã€‚</p>
</li>
</ul>
<h3 id="4-é”™è¯¯å¤„ç†"><a href="#4-é”™è¯¯å¤„ç†" class="headerlink" title="4 é”™è¯¯å¤„ç†"></a>4 é”™è¯¯å¤„ç†</h3><ul>
<li><p><strong>å¼‚å¸¸&amp;ä¸å˜å¼ï¼š</strong></p>
<p>å¼‚å¸¸è´Ÿè´£æŠ¥å‘Š<strong>è¿è¡Œæ—¶</strong>ç¨‹åºå‘å°„æ—¶èƒ½å¤Ÿçš„é”™è¯¯ã€‚ç”±<code>throw</code>è¯­å¥æŒ‡å®šã€‚ä¾‹å¦‚åœ¨è‡ªå®šä¹‰Vectoræ—¶ï¼Œéœ€è¦ç¡®ä¿ç´¢å¼•Vectorå¯¹è±¡æ—¶ï¼Œä¸ä¼šæœ‰è¶Šç•Œçš„æƒ…å†µå‘ç”Ÿã€‚å› æ­¤ï¼Œå¯ä»¥åœ¨<code>operator[]()</code>ä¸­æŠ›å‡ºå¼‚å¸¸ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">double</span>&amp; Vector::<span class="keyword">operator</span>[](<span class="type">int</span> i)&#123;</span><br><span class="line">  <span class="keyword">if</span>(i&lt;<span class="number">0</span> || <span class="built_in">size</span>()&lt;=i)</span><br><span class="line">    <span class="keyword">throw</span> out_of_range&#123;<span class="string">&quot;Vector::operator[]&quot;</span>&#125;;</span><br><span class="line">  <span class="keyword">return</span> elem[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>throw</code>å°†ç¨‹åºçš„æ§åˆ¶æƒä»è°ƒç”¨äº†Vector::operator[]()çš„å‡½æ•°è½¬ç§»åˆ°äº†out_of_rangeå¼‚å¸¸çš„å¼‚å¸¸å¤„ç†ä»£ç ã€‚æ¯”å¦‚ä¸‹é¢å½“tryä¸­çš„ç´¢å¼•è¶Šç•Œï¼ŒæŠ›å‡ºout_of_rangeå¼‚å¸¸åï¼Œä¼šè¿›å…¥catchå—ä¸­çš„ä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">(Vector&amp; v)</span></span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="keyword">try</span> &#123; <span class="comment">//å¯èƒ½å‘ç”Ÿè¶Šç•Œé”™è¯¯çš„ä»£ç è¢«æ”¾åœ¨äº†tryå—ä¸­</span></span><br><span class="line">    v[v.<span class="built_in">size</span>()] = <span class="number">7</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">catch</span> (out_of_range) &#123; <span class="comment">//æ•æ‰åˆ°è¶Šç•Œå¼‚å¸¸</span></span><br><span class="line">    <span class="comment">//å¤„ç†è¶Šç•Œé”™è¯¯</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨è°ƒç”¨æ„é€ å‡½æ•°æ„é€ Vectoræ—¶ï¼Œä¼ å…¥çš„å‚æ•°ä¹Ÿéœ€è¦æ»¡è¶³ä¸€äº›æ¡ä»¶ã€‚å°†ä»è°ƒç”¨æ„é€ å‡½æ•°ï¼Œç›´åˆ°è°ƒç”¨ææ„å‡½æ•°è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œå¯¹è±¡å§‹ç»ˆæ‰€æ»¡è¶³çš„è¦æ±‚ç§°ä¸º<strong>ä¸å˜å¼</strong>(Invariant)ã€‚æ¯”å¦‚è°ƒç”¨Vectoræ„é€ å‡½æ•°æŒ‡å®šåŒ…å«å¤šå°‘ä¸ªå…ƒç´ ï¼Œå´ä¼ è¿›äº†ä¸€ä¸ªè´Ÿå€¼ï¼Œè¿™æ—¶éœ€è¦ä¸å˜å¼æ¥çº¦æŸã€‚è¿™ç§æƒ…å†µä¸‹çš„ä¸å˜å¼å¯ä»¥é€šè¿‡å¼‚å¸¸å®ç°ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">Vector::<span class="built_in">Vector</span>(<span class="type">int</span> s)&#123;</span><br><span class="line">  <span class="keyword">if</span> (s &lt; <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">throw</span> length_error&#123;&#125;;</span><br><span class="line">  elem = <span class="keyword">new</span> <span class="type">double</span>[s];</span><br><span class="line">  sz = s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="function">Vector <span class="title">v</span><span class="params">(<span class="number">-27</span>)</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">catch</span> (std::length_error) &#123;</span><br><span class="line">    <span class="comment">//å¤„ç†è´Ÿå€¼é—®é¢˜</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">catch</span> (std::bad_alloc) &#123;</span><br><span class="line">    <span class="comment">//å¤„ç†å†…å­˜è€—å°½é—®é¢˜</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>ğŸ“Œå½“å¸Œæœ›ä¸€ä¸ªå‡½æ•°æ°¸è¿œä¸æŠ›å‡ºå¼‚å¸¸ï¼Œå¯ä»¥å°†å…¶å£°æ˜ä¸ºnoexceptã€‚è¿™æ ·çš„è¯å½“å‡½æ•°æŠ›å‡ºäº†å¼‚å¸¸ï¼Œæ ‡å‡†åº“å‡½æ•°terminate()ä¼šç«‹å³ç»ˆæ­¢å½“å‰ç¨‹åºçš„æ‰§è¡Œï¼Œé¿å…å¼‚å¸¸çš„ä¼ æ’­å’Œæ‰©æ•£ã€‚<br>noexcept ç­‰æ•ˆäº noexcept(true)<br>C++11åï¼Œç±»çš„ææ„å‡½æ•°é»˜è®¤æ˜¯noexceptï¼Œä¹Ÿå°±æ˜¯ææ„å‡½æ•°ä¸å…è®¸æŠ›å‡ºå¼‚å¸¸ã€‚ä½†å¦‚æœäººä¸ºå°†å£°æ˜æ”¹ä¸ºnoexcept(false)ï¼Œæˆ–è€…å…¶åŸºç±»çš„ææ„å‡½æ•°æ˜¯noexcept(false)ï¼Œé‚£ä¹ˆæ­¤æ—¶çš„ææ„å‡½æ•°å¯ä»¥æŠ›å‡ºå¼‚å¸¸ã€‚<br>æ­¤å¤–ï¼Œnoexceptè‡ªèº«ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè¿ç®—ç¬¦ï¼Œæ ‡å¿—ä¸€ä¸ªå‡½æ•°æ˜¯å¦è¢«å£°æ˜æˆäº†noexceptï¼Œæ˜¯å¦èƒ½æŠ›å‡ºå¼‚å¸¸ã€‚&amp;#x20;</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">()</span> <span class="keyword">noexcept</span></span>; </span><br><span class="line"><span class="comment">//å‡½æ•°f()ä¸æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="built_in">void</span> (*fp) <span class="built_in">noexcept</span>(<span class="literal">false</span>); </span><br><span class="line"><span class="comment">//fpæŒ‡å‘å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">g</span><span class="params">(<span class="type">void</span> pfa() <span class="keyword">noexcept</span>)</span></span>; </span><br><span class="line"><span class="comment">//gæ¥æ”¶ä¸æŠ›å‡ºå¼‚å¸¸çš„å‡½æ•°çš„æŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">noexcept</span>(f); <span class="comment">//è¿”å›å€¼ä¸ºtrue</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸¤ç§noexceptå¯é…åˆäºå‡½æ•°æ¨¡æ¿</span></span><br><span class="line"><span class="comment">//ä»¥å£°æ˜å‡½æ•°å¯¹æŸäº›ç±»å‹æŠ›å¼‚å¸¸ï¼Œä½†ä¸å¯¹å…¶ä»–ç±»å‹æŠ›å‡º</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">()</span> <span class="title">noexcpet</span><span class="params">(<span class="keyword">noexcept</span>(T()))</span></span>&#123;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>é™æ€æ–­è¨€ï¼š</strong></p>
<p>ä¸Šè¿°ä¸¤ç§æ–¹å¼å‡ä¸ºè¿è¡Œæ—¶æŠ¥é”™ï¼Œè€Œé™æ€æ–­è¨€å¯ä»¥åœ¨ç¼–è¯‘æ—¶æŠ¥é”™ï¼Œä»è€Œè®©å¼€å‘è€…æ”¹è¿›ä»£ç ä»¥è§„é¿è¿è¡Œæ—¶çš„é”™è¯¯ã€‚<code>static_assert(A,S)</code>æœºåˆ¶çš„ä½œç”¨æ˜¯ï¼Œå½“Aä¸ä¸ºtrueæ—¶ï¼ŒæŠŠSä½œä¸ºä¸€æ¡ç¼–è¯‘å™¨é”™è¯¯ä¿¡æ¯è¾“å‡ºã€‚</p>
<blockquote>
<p>ğŸ“Œéœ€æ³¨æ„ï¼ŒAå¿…é¡»æ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">constexpr</span> <span class="type">double</span> C = <span class="number">299792.458</span>;</span><br><span class="line"><span class="type">double</span> speed = <span class="number">100000</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> local_max = <span class="number">160.0</span>/(<span class="number">60</span>*<span class="number">60</span>);</span><br><span class="line"><span class="built_in">static_assert</span>(speed&lt;C,<span class="string">&quot;can&#x27;t go that fast&quot;</span>);     <span class="comment">// æŠ¥é”™ï¼Œspeedä¸æ˜¯å¸¸é‡ï¼Œéå¸¸é‡è¡¨è¾¾å¼</span></span><br><span class="line"><span class="built_in">static_assert</span>(local_max&lt;C,<span class="string">&quot;can&#x27;t go that fast&quot;</span>); <span class="comment">// æ­£ç¡®ï¼Œå¸¸é‡è¡¨è¾¾å¼</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="5-const"><a href="#5-const" class="headerlink" title="5 const"></a>5 const</h3><h4 id="constå¸¸é‡ä¸å®çš„åŒºåˆ«"><a href="#constå¸¸é‡ä¸å®çš„åŒºåˆ«" class="headerlink" title="constå¸¸é‡ä¸å®çš„åŒºåˆ«"></a>constå¸¸é‡ä¸å®çš„åŒºåˆ«</h4><p><strong>constå®šä¹‰çš„å¸¸é‡åœ¨é¢„å¤„ç†é˜¶æ®µå¹¶ä¸å­˜åœ¨ï¼Œè€Œæ˜¯ç›´åˆ°è¿è¡Œé˜¶æ®µæ‰å‡ºç°</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œconstå£°æ˜å‡ºæ¥çš„æ˜¯ä¸€ç§â€œåªè¯»å˜é‡â€ï¼Œå¯ä»¥ç”¨æŒ‡é’ˆè·å–åœ°å€ã€‚æ—¢ç„¶å¯ä»¥è·å–æŒ‡é’ˆï¼Œé‚£ä¹ˆä¾¿å¯ä»¥åˆ©ç”¨æŒ‡é’ˆå†å¼ºåˆ¶å†™å…¥ï¼Œä»è€Œâ€œå¸¸é‡ä¸å¸¸â€ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//éœ€è¦åŠ ä¸Švolatileä¿®é¥°ï¼Œè¿è¡Œæ—¶æ‰èƒ½çœ‹åˆ°æ•ˆæœ</span></span><br><span class="line"><span class="type">const</span> <span class="keyword">volatile</span> <span class="type">int</span> MAX_LEN = <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> ptr = (<span class="type">int</span>*)(&amp;MAX_LEN);</span><br><span class="line">*ptr = <span class="number">2048</span>;</span><br><span class="line">cout &lt;&lt; MAX_LEN &lt;&lt; endl;<span class="comment">//è¾“å‡º2048</span></span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹æ—¶éœ€è¦ç”¨volatileç¦ç”¨ä¼˜åŒ–ã€‚ä¸åŠ çš„è¯ç¼–è¯‘å™¨çœ‹åˆ°constä¼šé‡‡å–ä¼˜åŒ–æ‰‹æ®µï¼ŒæŠŠæ‰€æœ‰constå¸¸é‡å‡ºç°çš„åœ°æ–¹æ›¿æ¢æˆåŸå€¼</p>
<h4 id="constä¿®é¥°æˆå‘˜å‡½æ•°"><a href="#constä¿®é¥°æˆå‘˜å‡½æ•°" class="headerlink" title="constä¿®é¥°æˆå‘˜å‡½æ•°"></a>constä¿®é¥°æˆå‘˜å‡½æ•°</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">const</span> <span class="type">int</span>&amp; <span class="title">fun</span><span class="params">(<span class="type">int</span>&amp; a)</span></span>; <span class="comment">//ä¿®é¥°è¿”å›å€¼</span></span><br><span class="line"><span class="function"><span class="type">int</span>&amp; <span class="title">fun</span><span class="params">(<span class="type">const</span> <span class="type">int</span>&amp; a)</span></span>; <span class="comment">//ä¿®é¥°å½¢å‚</span></span><br><span class="line"><span class="function"><span class="type">int</span>&amp; <span class="title">fun</span><span class="params">(<span class="type">int</span>&amp; a)</span> <span class="type">const</span></span>&#123;&#125; <span class="comment">//constæˆå‘˜å‡½æ•°</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>constä¿®é¥°è¿”å›å€¼</p>
<p>constä¿®é¥°è¿”å›å€¼å¤šæ˜¯åœ¨è¿”å›ç±»å‹ä¸ºå¼•ç”¨çš„æƒ…å†µä¸‹ï¼Œé¿å…è¿”å›å€¼è¢«ä¿®æ”¹çš„æƒ…å†µã€‚</p>
<p>å› ä¸ºæ­¤æ—¶è¿™ä¸ªå¼•ç”¨æ¯”ä¸æ˜¯ä¸´æ—¶å¯¹è±¡çš„å¼•ç”¨ï¼Œå¿…ç„¶æ˜¯æˆå‘˜å˜é‡åå‡½æ•°å‚æ•°ã€‚ä¸ç”¨constä¿®é¥°å¯èƒ½ä¼šæˆä¸ºå·¦å€¼è¢«ä¿®æ”¹ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">A</span>(<span class="type">int</span> num):<span class="built_in">data</span>(num)&#123;&#125;</span><br><span class="line">    ~<span class="built_in">A</span>()&#123;&#125;;</span><br><span class="line">    <span class="function"><span class="type">int</span>&amp; <span class="title">get_data</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">A <span class="title">a</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">    a.<span class="built_in">get_data</span>()=<span class="number">3</span>;</span><br><span class="line">    cout&lt;&lt;a.<span class="built_in">get_data</span>()&lt;&lt;endl; <span class="comment">//data=3</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¿”å›å€¼åŠ ä¸Šäº†constï¼Œæ­¤æ—¶è¯•å›¾æ”¹å˜è¿”å›å€¼çš„æ“ä½œæ˜¯ä¸å…è®¸çš„ï¼Œç¼–è¯‘ä¼šæŠ¥é”™ã€‚ä»è€Œè§„é¿ä¸Šè¿°æƒ…å†µã€‚</p>
</li>
<li><p>constä¿®é¥°å½¢å‚</p>
<p>ä¼ å¼•ç”¨çš„æ–¹å¼å¯ä»¥èŠ‚çœå†…å­˜ï¼Œæé«˜æ•ˆç‡ã€‚ä½†å¯¼è‡´äº†å‡½æ•°å…·å¤‡ä¿®æ”¹è¯¥å€¼çš„é£é™©ã€‚å¦‚æœåœ¨å¼•ç”¨ç±»å‹çš„å½¢å‚å‰åŠ constï¼Œå°±å¯ä»¥è§„é¿æ­¤é£é™©ã€‚</p>
</li>
<li><p>constä¿®é¥°æˆå‘˜å‡½æ•°</p>
<p>è€ƒè™‘è¿™æ ·ä¸€ç§åœºæ™¯ï¼šä¸€ä¸ªå¯¹è±¡è¢«å£°æ˜æˆconstï¼Œä½†æ˜¯å…¶æŸä¸ªæˆå‘˜å‡½æ•°éconstï¼Œæ­¤æ—¶é€šè¿‡è¯¥å¯¹è±¡è°ƒç”¨è¯¥æˆå‘˜å‡½æ•°ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">const</span> String <span class="title">str</span><span class="params">(<span class="string">&quot;hello world&quot;</span>)</span></span>;</span><br><span class="line">str.<span class="built_in">print</span>(); <span class="comment">//ç±»å†…çš„printæ²¡æœ‰è¢«constä¿®é¥°</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯å› ä¸ºè°ƒç”¨æˆå‘˜å‡½æ•°æ—¶ï¼Œä¼šä½¿ç”¨thisæŒ‡é’ˆã€‚ä½†æ˜¯æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªconstå¯¹è±¡ï¼Œä½†thisæŒ‡é’ˆä¸æ˜¯constç±»å‹çš„ï¼Œæ‰€ä»¥å‡ºç°å‚æ•°ç±»å‹ä¸åŒ¹é…ï¼Œç¼–è¯‘æ— æ³•é€šè¿‡çš„æƒ…å†µã€‚</p>
<p><strong>ç”¨constä¿®é¥°æˆå‘˜å‡½æ•°ï¼Œå®è´¨ä¸Šæ˜¯ä¿®é¥°thisæ‰€æŒ‡å‘çš„å¯¹è±¡</strong>ã€‚</p>
<p>å½“ç±»å†…æ²¡æœ‰å‡½æ•°é‡è½½ï¼Œå³åªæœ‰ä¸€ä¸ªç‰ˆæœ¬çš„æˆå‘˜å‡½æ•°æ—¶ï¼Œconstå¯¹è±¡åªèƒ½è°ƒç”¨constæˆå‘˜å‡½æ•°ï¼Œnon-constå¯¹è±¡æ—¢å¯ä»¥è°ƒç”¨constæˆå‘˜å‡½æ•°ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨non-constæˆå‘˜å‡½æ•°ã€‚</p>
<p>è€Œå¦‚æœä¸€ä¸ªæˆå‘˜å‡½æ•°åŒæ—¶æœ‰constå’Œnon-constä¸¤ä¸ªç‰ˆæœ¬çš„è¯ï¼Œconstå¯¹è±¡åªèƒ½è°ƒç”¨constæˆå‘˜å‡½æ•°ï¼Œnon-constå¯¹è±¡åªèƒ½è°ƒç”¨non-constæˆå‘˜å‡½æ•°ã€‚</p>
</li>
</ul>
<h4 id="constä¿®é¥°æŒ‡é’ˆ"><a href="#constä¿®é¥°æŒ‡é’ˆ" class="headerlink" title="constä¿®é¥°æŒ‡é’ˆ"></a>constä¿®é¥°æŒ‡é’ˆ</h4><ul>
<li><p>const char* ptrï¼š* ptræ˜¯constçš„ï¼Œå³ä¸èƒ½é€šè¿‡*pträ¿®æ”¹å€¼ï¼Œä½†æ˜¯ptrå¯ä»¥ä¿®æ”¹ï¼Œå€¼ä¹Ÿå¯æ”¹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">char</span> str[] = <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line"><span class="type">char</span> ss[] = <span class="string">&quot;good game||&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ptr = str;</span><br><span class="line"></span><br><span class="line">ptr[<span class="number">0</span>] = <span class="string">&#x27;s&#x27;</span>; <span class="comment">//æŠ¥é”™ï¼</span></span><br><span class="line">str[<span class="number">0</span>] = <span class="string">&#x27;s&#x27;</span>; <span class="comment">//ä¸æŠ¥é”™ï¼Œæ­£å¸¸ï¼Œè¾“å‡ºä¼šå¾—åˆ°&quot;sello world&quot;</span></span><br><span class="line">ptr = ss;     <span class="comment">//ä¸æŠ¥é”™ï¼Œè¾“å‡º*pträ¼šå¾—åˆ°&quot;good game||&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>char const* ptrï¼šä¸<code>const char*</code>ä¸€è‡´ã€‚</p>
</li>
<li><p>char* const ptrï¼šptræ˜¯constçš„ï¼Œå³ä¸èƒ½ä¿®æ”¹ptrï¼Œä½†å¯ä»¥é€šè¿‡*ptræ”¹å€¼</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">char</span> str[] = <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line"><span class="type">char</span> ss[] = <span class="string">&quot;good game||&quot;</span>;</span><br><span class="line"><span class="type">char</span>* <span class="type">const</span> ptr = str;</span><br><span class="line"></span><br><span class="line">ptr[<span class="number">0</span>] = <span class="string">&#x27;s&#x27;</span>; <span class="comment">//æ­£å¸¸</span></span><br><span class="line">ptr = ss;     <span class="comment">//æŠ¥é”™</span></span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>ğŸ“Œconståœ¨*å‰å€¼ä¸å˜ï¼Œconståœ¨*ååœ°å€ä¸å˜<br>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæœ‰ä¸€ç§è¯´æ³•ä¸ºconståœ¨å‰çš„å±äº<strong>åº•å±‚const</strong>ï¼Œè€Œconståœ¨åçš„å±äº<strong>é¡¶å±‚const</strong><code>const int*</code>ï¼Œ<code>const int&amp;</code>è¿™ç§å±äºåº•å±‚constï¼Œä½¿å¾—å€¼ä¸å¯æ”¹ï¼›<code>int* const</code>å±äºé¡¶å±‚constï¼Œå€¼å¯æ”¹</p>
</blockquote>
<h3 id="6-åŒ¿åå‡½æ•°ï¼ˆlambdaè¡¨è¾¾å¼ï¼‰"><a href="#6-åŒ¿åå‡½æ•°ï¼ˆlambdaè¡¨è¾¾å¼ï¼‰" class="headerlink" title="6 åŒ¿åå‡½æ•°ï¼ˆlambdaè¡¨è¾¾å¼ï¼‰"></a>6 åŒ¿åå‡½æ•°ï¼ˆlambdaè¡¨è¾¾å¼ï¼‰</h3><p>å…·ä½“å½¢å¼ï¼š<code>[capture](parameters)â†’return-type&#123;body&#125;</code></p>
<p>å¦‚æœ€ç®€å•çš„å½¢å¼ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">[](<span class="type">int</span> x, <span class="type">int</span> y)-&gt;<span class="type">int</span> &#123;<span class="type">int</span> z=x+y; <span class="keyword">return</span> z;&#125;</span><br></pre></td></tr></table></figure>

<p>è‹¥æƒ³æ•è·å¤–éƒ¨å˜é‡ï¼Œå¯åœ¨[ ]å†…è¾“å…¥å¤–éƒ¨å‚æ•°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">[]        <span class="comment">//æœªå®šä¹‰å˜é‡.è¯•å›¾åœ¨Lambdaå†…ä½¿ç”¨ä»»ä½•å¤–éƒ¨å˜é‡éƒ½æ˜¯é”™è¯¯çš„.</span></span><br><span class="line">[x, &amp;y]   <span class="comment">//x æŒ‰å€¼æ•è·, y æŒ‰å¼•ç”¨æ•è·.</span></span><br><span class="line">[&amp;]       <span class="comment">//ç”¨åˆ°çš„ä»»ä½•å¤–éƒ¨å˜é‡éƒ½éšå¼æŒ‰å¼•ç”¨æ•è·</span></span><br><span class="line">[=]       <span class="comment">//ç”¨åˆ°çš„ä»»ä½•å¤–éƒ¨å˜é‡éƒ½éšå¼æŒ‰å€¼æ•è·</span></span><br><span class="line">[&amp;, x]    <span class="comment">//xæ˜¾å¼åœ°æŒ‰å€¼æ•è·. å…¶å®ƒå˜é‡æŒ‰å¼•ç”¨æ•è·</span></span><br><span class="line">[=, &amp;z]   <span class="comment">//zæŒ‰å¼•ç”¨æ•è·. å…¶å®ƒå˜é‡æŒ‰å€¼æ•è·</span></span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; some_list;</span><br><span class="line"><span class="type">int</span> total = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;++i) some_list.<span class="built_in">push_back</span>(i);</span><br><span class="line">std::for_each(<span class="built_in">begin</span>(some_list), <span class="built_in">end</span>(some_list), [&amp;total](<span class="type">int</span> x) </span><br><span class="line">&#123;</span><br><span class="line">    total += x;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ“Œ[ ]ä¸­æƒ³æ•è·thisæ—¶ï¼Œthisåªèƒ½æŒ‰å€¼æ•è·<code>[this]</code>ã€‚</p>
</blockquote>
<p>å¦‚æœç”¨æˆ·æƒ³æŠŠlambdaè¡¨è¾¾å¼å½“ä½œä¸€ä¸ªå‚æ•°æ¥ä¼ é€’ï¼Œå¯ä»¥ç”¨autoå…³é”®å­—ï¼ˆè½¬æ¢æˆ<code>std::function</code>å¯¹è±¡ï¼‰å¸®åŠ©å­˜å‚¨ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">eval</span><span class="params">(std::function&lt;<span class="type">double</span>(<span class="type">double</span>)&gt; f, <span class="type">double</span> x = <span class="number">2.0</span>)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">f</span>(x);&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     std::function&lt;<span class="type">double</span>(<span class="type">double</span>)&gt; f0    = [](<span class="type">double</span> x)&#123;<span class="keyword">return</span> <span class="number">1</span>;&#125;;</span><br><span class="line">     <span class="keyword">auto</span>                          f1    = [](<span class="type">double</span> x)&#123;<span class="keyword">return</span> x;&#125;;</span><br><span class="line">     <span class="keyword">decltype</span>(f0)                  fa[<span class="number">3</span>] = &#123;f0,f1,[](<span class="type">double</span> x)&#123;<span class="keyword">return</span> x*x;&#125;&#125;;</span><br><span class="line">     std::vector&lt;<span class="keyword">decltype</span>(f0)&gt;     fv    = &#123;f0,f1&#125;;</span><br><span class="line">     fv.<span class="built_in">push_back</span>                  ([](<span class="type">double</span> x)&#123;<span class="keyword">return</span> x*x;&#125;);</span><br><span class="line">     <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;fv.<span class="built_in">size</span>();i++)  std::cout &lt;&lt; fv[i](<span class="number">2.0</span>) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">     <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)          std::cout &lt;&lt; fa[i](<span class="number">2.0</span>) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;f : fv)             std::cout &lt;&lt; <span class="built_in">f</span>(<span class="number">2.0</span>) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;f : fa)             std::cout &lt;&lt; <span class="built_in">f</span>(<span class="number">2.0</span>) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">     std::cout &lt;&lt; <span class="built_in">eval</span>(f0) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">     std::cout &lt;&lt; <span class="built_in">eval</span>(f1) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">     <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ“Œ- std::function&lt;double(double)&gt;é‡Œï¼Œæ‹¬å·å¤–çš„doubleæ˜¯è¿”å›ç±»å‹ï¼Œæ‹¬å·é‡Œçš„doubleæ˜¯å‚æ•°ç±»å‹<br>- decltype()ï¼ŒC++11ä¸­çš„ç±»å‹è¯´æ˜ç¬¦ï¼Œè¿”å›æ“ä½œæ•°çš„æ•°æ®ç±»å‹ã€‚</p>
</blockquote>
<blockquote>
<p>lambdaè¡¨è¾¾å¼å…¶å®æ˜¯ä¸€ç§é—­åŒ…ã€‚</p>
</blockquote>
<h4 id="mutable"><a href="#mutable" class="headerlink" title="mutable"></a>mutable</h4><ul>
<li><p>ä¿®é¥°ç±»å†…æˆå‘˜</p>
<p>å‰é¢è¯´åˆ°ï¼Œè¢«constä¿®é¥°çš„å¸¸æˆå‘˜å‡½æ•°ï¼Œä¸ä¼šä¿®æ”¹å¯¹è±¡çš„ä»»ä½•å±æ€§ã€‚ä½†æ˜¯æ²¡æœ‰æåˆ°ä¸€ç§æƒ…å†µï¼Œé‚£å°±æ˜¯è¯¥å±æ€§ç”±mutableä¿®é¥°ã€‚mutableçš„ä½œç”¨æ˜¯ï¼šå¯ä»¥åœ¨å¸¸æˆå‘˜å‡½æ•°ä¸­è¢«ä¿®æ”¹å…¶å€¼ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">void</span>)</span> <span class="type">const</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; m_data++ &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">mutable</span> <span class="type">int</span> m_data;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¿®é¥°åŒ¿åå‡½æ•°</p>
<p>å½“[]ä¸­é‡‡ç”¨å€¼æ•è·æ—¶ï¼Œæ˜¯ä¸å…è®¸åœ¨åŒ¿åå‡½æ•°å†…éƒ¨ä¿®æ”¹æ•è·çš„å˜é‡çš„å€¼çš„ã€‚ä½†æ˜¯å¦‚æœæœ‰mutableä¿®é¥°åŒ¿åå‡½æ•°ï¼Œåˆ™åœ¨æ•è·æ—¶ä¼šåˆ›å»ºè¯¥å˜é‡åœ¨åŒ¿åå‡½æ•°ä¸­çš„<strong>åŒåæ‹·è´</strong>ï¼Œè€Œä¸”è¯¥æ‹·è´ä¼šä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°åŒ¿åå‡½æ•°ä½œç”¨åŸŸå®Œç»“ã€‚æ­¤æ—¶ï¼ŒåŒ¿åå‡½æ•°å†…éƒ¨å¯ä»¥å¯¹è¯¥â€œå˜é‡â€ï¼ˆå®è´¨ä¸Šæ˜¯æ‹·è´ï¼‰è¿›è¡Œä¿®æ”¹ï¼ŒåŒæ—¶ä¸å¿…æ‹…å¿ƒåŸå˜é‡è¢«ä¿®æ”¹ã€‚è€Œä¸”æ¯æ¬¡è¿›å…¥ç›¸åŒçš„åŒ¿åå‡½æ•°æ—¶ï¼Œè¯¥æ‹·è´éƒ½ä¼šç»´æŒä¸Šä¸€æ¬¡è°ƒç”¨è¯¥å‡½æ•°æ—¶çš„å€¼ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="type">int</span> t = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//æŒ‰å€¼æ•è·</span></span><br><span class="line">  <span class="keyword">auto</span> f = [t]() <span class="keyword">mutable</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ++t;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">auto</span> f2 = [t]() <span class="keyword">mutable</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ++t;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  cout &lt;&lt; <span class="built_in">f</span>() &lt;&lt; endl;   <span class="comment">//11</span></span><br><span class="line">  cout &lt;&lt; <span class="built_in">f2</span>() &lt;&lt; endl;  <span class="comment">//11</span></span><br><span class="line">  cout &lt;&lt; <span class="built_in">f</span>() &lt;&lt; endl;   <span class="comment">//12</span></span><br><span class="line">  cout &lt;&lt; <span class="built_in">f2</span>() &lt;&lt; endl;  <span class="comment">//12</span></span><br><span class="line">  cout &lt;&lt; t &lt;&lt;endl;      <span class="comment">//10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="7-å‡½æ•°æŒ‡é’ˆ"><a href="#7-å‡½æ•°æŒ‡é’ˆ" class="headerlink" title="7 å‡½æ•°æŒ‡é’ˆ"></a>7 å‡½æ•°æŒ‡é’ˆ</h3><p>å‡½æ•°æŒ‡é’ˆæŒ‡å‘çš„æ˜¯å‡½æ•°è€Œéå¯¹è±¡ï¼Œå…¶æŒ‡å‘çš„å‡½æ•°çš„ç±»å‹ï¼Œä»…ç”±å…¶è¿”å›å€¼ç±»å‹å’Œå½¢å‚ç±»å‹å†³å®šï¼Œä¸å‡½æ•°åæ— å…³ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">lengthCompare</span><span class="params">(<span class="type">const</span> string &amp;, <span class="type">const</span> string &amp;)</span></span>;</span><br></pre></td></tr></table></figure>

<p>å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°<code>lengthCompare</code>ï¼Œå…¶ç±»å‹ä¸º<code>bool(const string&amp;, const string&amp;)</code>ã€‚å¯ä»¥å£°æ˜ä¸€ä¸ªæŒ‡é’ˆpfï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">bool</span> (*pf)(<span class="type">const</span> string &amp;, <span class="type">const</span> string &amp;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ“Œ*pfä¸¤ç«¯çš„æ‹¬å·<strong>å¿…ä¸å¯å°‘</strong>ã€‚å¦‚æœä¸å†™è¿™å¯¹æ‹¬å·ï¼Œè¡¨ç¤ºä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›bool*ç±»å‹çš„è¿”å›å€¼</p>
</blockquote>
<p>è¿™æ˜¯ä¸€ä¸ªæŒ‡å‘<code>bool(const string&amp;, const string&amp;)</code>ç±»å‹å‡½æ•°çš„<strong>å‡½æ•°æŒ‡é’ˆ</strong>ï¼Œå› æ­¤å¯ä»¥æœ‰</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">pf = lengthCompare;                          <span class="comment">//pfæŒ‡å‘lengthCompareå‡½æ•°</span></span><br><span class="line">pf = &amp;lengthCompare;                         <span class="comment">//ç­‰ä»·çš„èµ‹å€¼è¯­å¥ï¼šå–åœ°å€ç¬¦æ˜¯å¯é€‰çš„</span></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> b1 = <span class="built_in">pf</span>(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;goodbye&quot;</span>);            <span class="comment">//è°ƒç”¨lengthCompareå‡½æ•°</span></span><br><span class="line"><span class="type">bool</span> b2 = (*pf)(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;goodbye&quot;</span>);         <span class="comment">//ä¸€ä¸ªç­‰ä»·çš„è°ƒç”¨</span></span><br><span class="line"><span class="type">bool</span> b3 = <span class="built_in">lengthCompare</span>(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;goodbye&quot;</span>); <span class="comment">//å¦ä¸€ä¸ªç­‰ä»·çš„è°ƒç”¨</span></span><br></pre></td></tr></table></figure>

<h4 id="é‡è½½å‡½æ•°çš„æŒ‡é’ˆ"><a href="#é‡è½½å‡½æ•°çš„æŒ‡é’ˆ" class="headerlink" title="é‡è½½å‡½æ•°çš„æŒ‡é’ˆ"></a>é‡è½½å‡½æ•°çš„æŒ‡é’ˆ</h4><p>å¦‚æœæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„å‡½æ•°åè¢«å¾ˆå¤šå‡½æ•°å…±äº«ï¼Œå³å‡ºç°é‡è½½ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨éœ€è¦é€šè¿‡æŒ‡é’ˆç±»å‹å†³å®šé€‰ç”¨å“ªä¸ªå‡½æ•°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ff</span><span class="params">(<span class="type">int</span>*)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ff</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">void</span> (*pf1)(<span class="type">unsigned</span> <span class="type">int</span>) = ff; <span class="comment">//pf1æŒ‡å‘ff(unsigned)</span></span><br><span class="line"><span class="built_in">void</span> (*pf2)(<span class="type">int</span>) = ff;          <span class="comment">//é”™è¯¯ï¼Œæ²¡æœ‰å¯ä»¥åŒ¹é…çš„é‡è½½ï¼ˆå‚æ•°è§’åº¦ï¼‰</span></span><br><span class="line"><span class="built_in">double</span> (*pf3)(<span class="type">int</span>*) = ff;       <span class="comment">//é”™è¯¯ï¼Œæ²¡æœ‰å¯ä»¥åŒ¹é…çš„é‡è½½ï¼ˆè¿”å›ç±»å‹è§’åº¦ï¼‰</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œç›¸æ¯”äºä¸€èˆ¬çš„é‡è½½ï¼ˆåªçœ‹å½¢å‚ï¼Œä¸çœ‹è¿”å›å€¼ï¼‰ï¼Œå‡½æ•°æŒ‡é’ˆåœ¨é‡è½½çš„é€‰æ‹©ä¸Šè¦è‹›åˆ»ä¸€äº›ï¼Œæ—¢è€ƒè™‘äº†å½¢å‚ï¼Œåˆè¦è€ƒè™‘è¿”å›å€¼ç±»å‹ã€‚</p>
<h4 id="å‡½æ•°æŒ‡é’ˆå½¢å‚"><a href="#å‡½æ•°æŒ‡é’ˆå½¢å‚" class="headerlink" title="å‡½æ•°æŒ‡é’ˆå½¢å‚"></a>å‡½æ•°æŒ‡é’ˆå½¢å‚</h4><p>C++â€œè¡¨é¢ä¸Šâ€æ˜¯å¯ä»¥æŠŠâ€œå‡½æ•°ç±»å‹â€ä½œä¸ºå½¢å‚ä¼ å…¥ä¸€ä¸ªå‡½æ•°çš„ï¼Œå³ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç¬¬ä¸‰ä¸ªå½¢å‚æ˜¯å‡½æ•°ç±»å‹</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">useBigger</span><span class="params">(<span class="type">const</span> string &amp;s1, <span class="type">const</span> string &amp;s2,</span></span></span><br><span class="line"><span class="params"><span class="function">               <span class="type">bool</span> pf(<span class="type">const</span> string &amp;, <span class="type">const</span> string &amp;))</span></span>;</span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šï¼Œç¼–è¯‘å™¨å·å·åœ°åšäº†ä¸€ä¸ªéšå¼è½¬æ¢ï¼Œå°†æ‰€è°“çš„å‡½æ•°ç±»å‹ç»™è§£é‡Šæˆäº†å‡½æ•°æŒ‡é’ˆé—®é¢˜ï¼Œå³è½¬æ¢æˆäº†</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">useBigger</span><span class="params">(<span class="type">const</span> string &amp;s1, <span class="type">const</span> string &amp;s2,</span></span></span><br><span class="line"><span class="params"><span class="function">               <span class="type">bool</span> (*pf)(<span class="type">const</span> string &amp;, <span class="type">const</span> string &amp;))</span></span>;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶å¯ä»¥ç›´æ¥æŠŠå‡½æ•°åä½œä¸ºå®å‚ä¼ å…¥ï¼Œå®ƒä¼šè¢«<strong>è‡ªåŠ¨è½¬æ¢æˆæŒ‡é’ˆ</strong>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">useBigger</span>(s1, s2, lengthCompare);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>åˆ©ç”¨ç±»å‹åˆ«åå’Œdecltypeç®€åŒ–å‡½æ•°æŒ‡é’ˆï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* ---- å‡½æ•°ç±»å‹åˆ«å ---- */</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="type">bool</span> <span class="title">Func</span><span class="params">(<span class="type">const</span> string&amp;, <span class="type">const</span> string&amp;)</span></span>; <span class="comment">//å®šä¹‰Funcä¸ºbool(const string&amp;, const string&amp;)ç±»å‹</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">decltype</span><span class="params">(lengthCompare)</span> Func2</span>;           <span class="comment">//å®šä¹‰Func2ä¸ºä¸lengthCompareç±»å‹ä¸€è‡´çš„å‡½æ•°ç±»å‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* ---- å‡½æ•°æŒ‡é’ˆåˆ«å ---- */</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">bool</span><span class="params">(*FuncP)</span> <span class="params">(<span class="type">const</span> string&amp;, <span class="type">const</span> string&amp;)</span></span>; <span class="comment">//å®šä¹‰FuncPä¸ºå‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">decltype</span><span class="params">(lengthCompare)</span> *FuncP2</span>;             <span class="comment">//decltypeè¿”å›çš„æ˜¯ç±»å‹ï¼Œæ‰€ä»¥è¦åŠ ä¸Š*æ‰èƒ½ä½¿FuncP2æŒ‡é’ˆ</span></span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆåœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™å‡ ç§ç­‰ä»·å†™æ³•</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">useBigger</span><span class="params">(<span class="type">const</span> string&amp;, <span class="type">const</span> string&amp;, Func)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">useBigger</span><span class="params">(<span class="type">const</span> string&amp;, <span class="type">const</span> string&amp;, Func2)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">useBigger</span><span class="params">(<span class="type">const</span> string&amp;, <span class="type">const</span> string&amp;, FuncP)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">useBigger</span><span class="params">(<span class="type">const</span> string&amp;, <span class="type">const</span> string&amp;, FuncP2)</span></span>;</span><br></pre></td></tr></table></figure>

<p>ç¬¬1ã€2æ¡è¯­å¥ä¸­ï¼Œç¼–è¯‘å™¨è‡ªåŠ¨å°†Funcã€Func2ç±»å‹è½¬æ¢æˆå‡½æ•°æŒ‡é’ˆ</p>
</li>
</ul>
<h4 id="è¿”å›æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ"><a href="#è¿”å›æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ" class="headerlink" title="è¿”å›æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ"></a>è¿”å›æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ</h4><p>å‡½æ•°ä¸èƒ½ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼ï¼Œä½†æ˜¯å‡½æ•°å¯ä»¥è¿”å›å‡½æ•°æŒ‡é’ˆï¼Œä»¥è¾¾åˆ°ç±»ä¼¼æ•ˆæœã€‚ç„¶è€Œï¼Œè¿”å›å€¼ä¸å†åƒå½¢å‚ä¸€æ ·ï¼Œç¼–è¯‘å™¨ä¸å†å¯¹è¿”å›å€¼è¿›è¡Œè‡ªåŠ¨çš„éšå¼è½¬æ¢ï¼Œå› æ­¤<strong>è¿”å›å€¼éœ€è¦æ˜¾å¼å£°æ˜ä¸ºå‡½æ•°æŒ‡é’ˆç±»å‹</strong>ã€‚è€Œç®€åŒ–è¿™ç§æ˜¾å¼å£°æ˜çš„æ–¹å¼ä»ç„¶æ˜¯åˆ«åï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> F = <span class="built_in">int</span>(<span class="type">int</span>*, <span class="type">int</span>);      <span class="comment">//Fæ˜¯å‡½æ•°ç±»å‹ï¼Œä¸æ˜¯æŒ‡é’ˆ</span></span><br><span class="line"><span class="keyword">using</span> PF = <span class="built_in">int</span>(*)(<span class="type">int</span>*, <span class="type">int</span>);  <span class="comment">//PFæ˜¯æŒ‡é’ˆç±»å‹</span></span><br><span class="line"></span><br><span class="line"><span class="function">PF <span class="title">f1</span><span class="params">(<span class="type">int</span>)</span></span>;                    <span class="comment">//æ­£ç¡®ï¼šPFæ˜¯æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆï¼Œf1è¿”å›æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ</span></span><br><span class="line"><span class="function">F <span class="title">f1</span><span class="params">(<span class="type">int</span>)</span></span>;                     <span class="comment">//é”™è¯¯ï¼šFæ˜¯å‡½æ•°ç±»å‹ï¼Œf1ä¸èƒ½è¿”å›ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line"><span class="function">F *<span class="title">f1</span><span class="params">(<span class="type">int</span>)</span></span>;                    <span class="comment">//æ­£ç¡®ï¼šæ˜¾å¼åœ°æŒ‡å®šè¿”å›ç±»å‹æ˜¯æŒ‡å‘Fç±»å‹å‡½æ•°çš„æŒ‡é’ˆ</span></span><br></pre></td></tr></table></figure>

<p>æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç§å¥‡æŠ€æ·«å·§ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å½¢å¼å£°æ˜f1ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">int</span> (*<span class="built_in">f1</span>(<span class="type">int</span>)) (<span class="type">int</span>*, <span class="type">int</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">éœ€è¦æŒ‰ç…§ç”±å†…å‘å¤–çš„é¡ºåºè§£è¯»æ­¤ä»£ç ï¼šf1æœ‰å½¢å‚åˆ—è¡¨ï¼Œæ‰€ä»¥å®ƒæ˜¯å‡½æ•°ï¼Œf1å‰é¢æœ‰*ï¼Œæ‰€ä»¥f1è¿”å›ä¸€ä¸ªæŒ‡é’ˆï¼›</span></span><br><span class="line"><span class="comment">è¿›ä¸€æ­¥è§‚å¯Ÿå‘ç°ï¼ŒæŒ‡é’ˆçš„ç±»å‹æœ¬èº«ä¹ŸåŒ…å«å½¢å‚åˆ—è¡¨ï¼Œå› æ­¤æŒ‡é’ˆæŒ‡å‘å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„è¿”å›å€¼ç±»å‹æ˜¯int</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>Modern C++ä¸­ï¼Œä¹Ÿå¯ä»¥ç”¨å°¾ç½®è¿”å›ç±»å‹çš„æ–¹å¼ï¼Œå£°æ˜ä¸€ä¸ªè¿”å›å‡½æ•°æŒ‡é’ˆçš„å‡½æ•°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">f1</span><span class="params">(<span class="type">int</span>)</span> -&gt; <span class="title">int</span><span class="params">(*)</span><span class="params">(<span class="type">int</span>*, <span class="type">int</span>)</span></span>;</span><br></pre></td></tr></table></figure>

<h3 id="8-å¸¸ç”¨å…³é”®å­—"><a href="#8-å¸¸ç”¨å…³é”®å­—" class="headerlink" title="8 å¸¸ç”¨å…³é”®å­—"></a>8 å¸¸ç”¨å…³é”®å­—</h3><h4 id="å››ç§castï¼ˆè½¬æ¢ï¼‰"><a href="#å››ç§castï¼ˆè½¬æ¢ï¼‰" class="headerlink" title="å››ç§castï¼ˆè½¬æ¢ï¼‰"></a>å››ç§castï¼ˆè½¬æ¢ï¼‰</h4><ul>
<li><p>const_cast</p>
<p>ç”¨äºå°†constå˜é‡è½¬åŒ–ä¸ºéconstã€‚</p>
</li>
<li><p>static_cast</p>
<p>ç”¨äºå„ç§<strong>éšå¼è½¬æ¢</strong>ï¼Œæ¯”å¦‚éconstè½¬constï¼Œvoid*è½¬æŒ‡é’ˆç­‰ï¼Œ<code>static_cast</code>èƒ½ç”¨äºå¤šæ€å‘ä¸Šè½¬åŒ–ï¼Œå¦‚æœå‘ä¸‹è½¬ï¼Œä¸ç®¡æ˜¯å¦éæ³•ï¼Œéƒ½ä¼šç›´æ¥è½¬è€Œæ— è§†æ½œåœ¨çš„é—®é¢˜ï¼Œå› æ­¤ä¸å®‰å…¨ã€‚</p>
</li>
<li><p>dynamic_cast</p>
<p>ç”¨äºåŠ¨æ€ç±»å‹è½¬æ¢ã€‚<strong>åªèƒ½ç”¨äºå«æœ‰è™šå‡½æ•°çš„ç±»</strong>ï¼Œç”¨äºç±»å±‚æ¬¡é—´çš„å‘ä¸Šå’Œå‘ä¸‹è½¬åŒ–ã€‚åªèƒ½è½¬æŒ‡é’ˆæˆ–å¼•ç”¨ã€‚å‘ä¸‹è½¬åŒ–æ—¶ï¼Œå¦‚æœè½¬åŒ–çš„æ˜¯æŒ‡é’ˆï¼Œä¸”æ˜¯éæ³•çš„ï¼Œè¿”å›NULLï¼›å¦‚æœè½¬åŒ–çš„æ˜¯å¼•ç”¨ï¼Œä¸”æ˜¯éæ³•çš„ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼ˆç›¸æ¯”äºstatic_castæ›´å®‰å…¨ï¼‰ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æˆ‘æ˜¯çˆ¶ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tfather</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123; cout &lt;&lt; <span class="string">&quot;father&#x27;s f()&quot;</span> &lt;&lt; endl; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ‘æ˜¯å­ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tson</span> : <span class="keyword">public</span> Tfather</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123; cout &lt;&lt; <span class="string">&quot;son&#x27;s f()&quot;</span> &lt;&lt; endl; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> data; <span class="comment">// æˆ‘æ˜¯å­ç±»ç‹¬æœ‰æˆå‘˜</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Tfather father;</span><br><span class="line">Tson son;</span><br><span class="line">son.data = <span class="number">123</span>;</span><br><span class="line">Tfather* pf;</span><br><span class="line">Tson* ps;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ä¸Šè¡Œè½¬æ¢ï¼šæ²¡æœ‰é—®é¢˜ï¼Œå¤šæ€æœ‰æ•ˆ */</span></span><br><span class="line">ps = &amp;son;</span><br><span class="line">pf = <span class="built_in">dynamic_cast</span>&lt;Tfather *&gt;(ps);</span><br></pre></td></tr></table></figure>
</li>
<li><p>reinterpret_cast</p>
<p>å‡ ä¹ä»€ä¹ˆéƒ½å¯ä»¥è½¬ï¼Œæ¯”å¦‚å°†intè½¬ä¸ºæŒ‡é’ˆï¼Œå¯èƒ½ä¼šå‡ºé—®é¢˜ï¼Œå°½é‡å°‘ç”¨ã€‚</p>
</li>
</ul>
<blockquote>
<p>ğŸ“Œä¸ºä»€ä¹ˆä¸ä½¿ç”¨Cçš„å¼ºåˆ¶è½¬æ¢ï¼Ÿ<br>Cçš„å¼ºåˆ¶è½¬æ¢è¡¨é¢ä¸Šçœ‹èµ·æ¥åŠŸèƒ½å¼ºå¤§ä»€ä¹ˆéƒ½èƒ½è½¬ï¼Œä½†æ˜¯è½¬åŒ–ä¸å¤Ÿæ˜ç¡®ï¼Œä¸èƒ½è¿›è¡Œé”™è¯¯æ£€æŸ¥ï¼Œå®¹æ˜“å‡ºé”™ã€‚</p>
</blockquote>
<blockquote>
<p><strong>éšå¼è½¬æ¢</strong>çš„å››ç§æ–¹å¼ï¼š<br>1. <strong>ç®—æœ¯è¡¨è¾¾å¼</strong><br>int m&#x3D;10; double n&#x3D;m;                            &#x2F;&#x2F;n&#x3D;10.0ï¼Œéšå¼æŠŠmè½¬ä¸ºdoubleç±»å‹<br>2. <strong>èµ‹å€¼</strong><br>int* p &#x3D; NULL;                                          &#x2F;&#x2F;NULL(0)éšå¼è½¬æ¢ä¸ºint*ç±»å‹çš„ç©ºæŒ‡é’ˆå€¼<br>3. <strong>å‡½æ•°å…¥å‚</strong><br>float add(float f); add(2);                         &#x2F;&#x2F;2éšå¼è½¬æ¢ä¸ºfloatç±»å‹<br>4. <strong>å‡½æ•°è¿”å›å€¼</strong><br>double minus(int a, int b) { return a-b; } &#x2F;&#x2F;è¿”å›å€¼éšå¼è½¬æ¢ä¸ºdoubleç±»å‹</p>
</blockquote>
<h4 id="staticä½œç”¨"><a href="#staticä½œç”¨" class="headerlink" title="staticä½œç”¨"></a>staticä½œç”¨</h4><ul>
<li><p>staticä½œç”¨åœ¨å…¨å±€å˜é‡</p>
<p>åŠ äº†staticä¹‹åï¼Œå˜é‡åªåœ¨å½“å‰æ–‡ä»¶æœ‰æ•ˆ</p>
</li>
<li><p>staticä½œç”¨åœ¨ç±»æˆå‘˜å˜é‡</p>
<p>staticæˆå‘˜å˜é‡å¯ä»¥å®ç°å¤šä¸ªå¯¹è±¡ä¹‹é—´çš„æ•°æ®å…±äº«ï¼Œ<strong>é™æ€æ•°æ®æˆå‘˜åªå­˜å‚¨ä¸€å¤„</strong>ï¼Œä¾›æ‰€æœ‰å¯¹è±¡å…±ç”¨</p>
</li>
<li><p>staticä½œç”¨åœ¨å…¨å±€å‡½æ•°</p>
<p><strong>åœ¨å®šä¹‰è¯¥å‡½æ•°çš„æ–‡ä»¶å†…æ‰èƒ½ä½¿ç”¨</strong>ã€‚åœ¨å¤šäººå¼€å‘é¡¹ç›®æ—¶ï¼Œä¸ºäº†é˜²æ­¢ä¸ä»–äººå‘½åç©ºé—´é‡Œçš„å‡½æ•°é‡åï¼Œå¯ä»¥å°†å‡½æ•°å®šä½ä¸º static</p>
<p>å¦‚æœæƒ³è¦å…¶ä»–æ–‡ä»¶å¯ä»¥å¼•ç”¨æœ¬åœ°å‡½æ•°ï¼Œåˆ™è¦åœ¨å‡½æ•°å®šä¹‰æ—¶ä½¿ç”¨å…³é”®å­—externï¼Œè¡¨ç¤ºè¯¥å‡½æ•°æ˜¯å¤–éƒ¨å‡½æ•°ï¼Œå¯ä¾›å…¶ä»–æ–‡ä»¶è°ƒç”¨</p>
</li>
<li><p>staticä½œç”¨åœ¨ç±»æˆå‘˜å‡½æ•°</p>
<p><strong>ç”±äºstaticä¿®é¥°çš„ç±»æˆå‘˜å±äºç±»ï¼Œä¸å±äºå¯¹è±¡</strong>ï¼Œ<strong>å› æ­¤staticç±»æˆå‘˜å‡½æ•°æ˜¯æ²¡æœ‰thisæŒ‡é’ˆçš„</strong>ï¼Œæ­£å› ä¸ºæ²¡æœ‰thisæŒ‡é’ˆï¼Œ<strong>æ‰€ä»¥staticç±»æˆå‘˜å‡½æ•°ä¸èƒ½è®¿é—®éstaticçš„ç±»æˆå‘˜ï¼Œåªèƒ½è®¿é—® staticä¿®é¥°çš„ç±»æˆå‘˜</strong></p>
<blockquote>
<p>ğŸ“Œ<strong>phread_createå‚æ•°å¿…é¡»æ˜¯staticçš„ï¼Œå› ä¸ºéstaticä¼šè‡ªåŠ¨åŠ ä¸€ä¸ªthisæŒ‡é’ˆï¼Œå¯¼è‡´ä¼ å…¥å‚æ•°å’Œå‡½æ•°ä¸åŒ¹é…</strong></p>
</blockquote>
</li>
</ul>
<blockquote>
<p>ğŸ“ŒC++æ˜¯å¦å…è®¸åŒæ—¶ç”¨constå’Œstaticä¿®é¥°ä¸€ä¸ªæˆå‘˜å‡½æ•°å‘¢ï¼Ÿ<br>ç­”æ¡ˆæ˜¯ä¸å¯ä»¥ï¼ŒC++ç¼–è¯‘å™¨åœ¨å®ç°constçš„æˆå‘˜å‡½æ•°çš„æ—¶å€™ä¸ºäº†ç¡®ä¿è¯¥å‡½æ•°ä¸èƒ½ä¿®æ”¹ç±»çš„å®ä¾‹çš„çŠ¶æ€ï¼Œä¼šåœ¨å‡½æ•°ä¸­æ·»åŠ ä¸€ä¸ªéšå¼çš„å‚æ•°const this *ã€‚ä½†å½“ä¸€ä¸ªæˆå‘˜ä¸ºstaticçš„æ—¶å€™ï¼Œè¯¥å‡½æ•°æ˜¯æ²¡æœ‰thisæŒ‡é’ˆçš„ã€‚ä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶constçš„ç”¨æ³•å’Œstaticæ˜¯å†²çªçš„ã€‚</p>
<p>åŒç†ï¼Œvirtualå’Œstaticä¹Ÿä¸èƒ½ä¸€èµ·ç”¨ï¼Œvirtualä¹Ÿæœ‰ä¸€ä¸ªéšå«å‚æ•°thisæŒ‡é’ˆã€‚</p>
</blockquote>
<h3 id="9-å†çœ‹å‡½æ•°é‡è½½"><a href="#9-å†çœ‹å‡½æ•°é‡è½½" class="headerlink" title="9 å†çœ‹å‡½æ•°é‡è½½"></a>9 å†çœ‹å‡½æ•°é‡è½½</h3><p>å‡½æ•°é‡è½½<strong>å–å†³äºå‚æ•°çš„ç±»å‹ã€ä¸ªæ•°ï¼Œè€Œè·Ÿè¿”å›ç±»å‹æ— å…³</strong>ã€‚ç¼–è¯‘å™¨é€šè¿‡åœ¨<strong>ç¼–è¯‘æ—¶å¯¹å‡½æ•°é‡æ–°å‘½å</strong>ä»¥è§£å†³åŒåå†²çªã€‚</p>
<p>å¯¹äºæ™®é€šå‡½æ•°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">int</span> i)</span></span>&#123;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;Print an integer: &quot;</span> &lt;&lt; i &lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(String s)</span></span>&#123;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;Print a string: &quot;</span> &lt;&lt; s &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œ<code>objdump -d a.out &gt;log.txt</code>åæ±‡ç¼–ï¼Œå¯ä»¥å°†ç¼–è¯‘ç»“æœæ‰“å°åˆ°log.txtä¸­è¿›è¡Œåˆ†æã€‚åˆ†æå¯çŸ¥ï¼š</p>
<p><code>void print(int i)</code>â†’**_Z5printi**</p>
<p><code>void print(String s)</code>â†’**_Z5printSs**</p>
<p>å…¶ä¸­Z5è¡¨ç¤ºè¿”å›å€¼ç±»å‹ï¼Œiè¡¨ç¤ºintç±»å‹,Ssè¡¨ç¤ºStringç±»å‹ï¼ˆg++ç¼–è¯‘ç»“æœï¼Œvsçš„æ–¹æ¡ˆå¯èƒ½ä¼šæœ‰å‡ºå…¥ï¼‰</p>
<p>å¯¹äºç±»å†…çš„å‡½æ•°é‡è½½ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">test</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">int</span> i)</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;int&quot;</span> &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">char</span> c)</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;char&quot;</span> &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>åæ±‡ç¼–åï¼Œå¯çŸ¥ä¸¤ä¸ªå‡½æ•°è¢«æ˜ å°„ä¸ºï¼š</p>
<p><code>void print(int i)</code>â†’**_ZN4test5printEi**</p>
<p><code>void print(char c)</code>â†’**_ZN4test5printEc**</p>
<p>N4testè¡¨ç¤ºä½œç”¨åŸŸã€‚</p>
<p>ç”±ä»¥ä¸Šå¯çŸ¥ï¼Œg++å¯¹å‡½æ•°é‡è½½çš„æ˜ å°„æœºåˆ¶ä¸ºï¼š<strong>ä½œç”¨åŸŸ + è¿”å›ç±»å‹ + å‡½æ•°å + å‚æ•°åˆ—è¡¨</strong></p>
<p>è™½ç„¶è¿”å›å€¼ç±»å‹ä¹Ÿå‚ä¸äº†å‡½æ•°é‡è½½çš„æ˜ å°„æœºåˆ¶ï¼Œä½†æ˜¯ç¼–è¯‘å™¨å¤„ç†å‡½æ•°é‡è½½æ—¶å¹¶ä¸è€ƒè™‘è¿”å›å€¼ç±»å‹ï¼Œè¿™æ ·å¯ä½¿å‡½æ•°è°ƒç”¨æ—¶ç‹¬ç«‹äºä¸Šä¸‹æ–‡ï¼Œè€Œä¸”å‡å°‘å¾ˆå¤šéº»çƒ¦ï¼Œå¦‚ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">float</span> <span class="title">sqrt</span><span class="params">(<span class="type">float</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">sqrt</span><span class="params">(<span class="type">double</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">(<span class="type">double</span> da, <span class="type">float</span> fla)</span></span>&#123;</span><br><span class="line">  <span class="type">float</span> fl = <span class="built_in">sqrt</span>(da);   <span class="comment">// è°ƒç”¨sqrt(double)</span></span><br><span class="line">  <span class="type">double</span> d = <span class="built_in">sqrt</span>(da);   <span class="comment">// è°ƒç”¨sqrt(double)</span></span><br><span class="line"></span><br><span class="line">  fl = <span class="built_in">sqrt</span>(fla); <span class="comment">//è°ƒç”¨sqrt(float)</span></span><br><span class="line">  d = <span class="built_in">sqrt</span>(fla);  <span class="comment">//è°ƒç”¨sqrt(float)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å‡½æ•°é‡è½½æ—¶çš„åŒ¹é…ä¼˜å…ˆçº§"><a href="#å‡½æ•°é‡è½½æ—¶çš„åŒ¹é…ä¼˜å…ˆçº§" class="headerlink" title="å‡½æ•°é‡è½½æ—¶çš„åŒ¹é…ä¼˜å…ˆçº§"></a>å‡½æ•°é‡è½½æ—¶çš„åŒ¹é…ä¼˜å…ˆçº§</h4><blockquote>
<p>C++ Primer 6.6èŠ‚</p>
</blockquote>
<p>C++ç¼–è¯‘å™¨åŠ›å›¾æ‰¾æœ€ä½³åŒ¹é…ã€‚ä¸ºäº†ç¡®å®šæœ€ä½³åŒ¹é…ï¼Œç¼–è¯‘å™¨å°†å®å‚ç±»å‹å‘å½¢å‚ç±»å‹çš„è½¬æ¢åˆ’åˆ†ä¸ºå‡ ä¸ªç­‰çº§ï¼Œå…·ä½“æ’åºå¦‚ä¸‹ï¼š</p>
<ol>
<li><p>ç²¾ç¡®åŒ¹é…ï¼ŒåŒ…æ‹¬ä»¥ä¸‹æƒ…å†µ</p>
<ul>
<li><p>å®å‚ç±»å‹å’Œå½¢å‚ç±»å‹ç›¸åŒ</p>
</li>
<li><p>å®å‚ä»æ•°ç»„ç±»å‹æˆ–å‡½æ•°ç±»å‹è½¬æ¢ä¸ºå¯¹åº”çš„æŒ‡é’ˆç±»å‹</p>
<ul>
<li><p>æ•°ç»„ç±»å‹è½¬æŒ‡é’ˆï¼šåœ¨å¤§å¤šæ•°ç”¨åˆ°æ•°ç»„çš„è¡¨è¾¾å¼ä¸­ï¼Œæ•°ç»„è‡ªåŠ¨è½¬æ¢æˆæŒ‡å‘æ•°ç»„é¦–å…ƒç´ çš„æŒ‡é’ˆ</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> ia[<span class="number">0</span>];</span><br><span class="line"><span class="type">int</span>* ip = ia;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å‡½æ•°ç±»å‹è½¬æŒ‡é’ˆï¼šå½“æŠŠä¸€ä¸ªå‡½æ•°åä¼ å…¥å‡½æ•°æ—¶ï¼Œç¼–è¯‘å™¨ä¼šéšå¼å°†å…¶è½¬æ¢ä¸ºå‡½æ•°æŒ‡é’ˆç±»å‹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">lengthCompare</span><span class="params">(<span class="type">const</span> string&amp;, <span class="type">const</span> string&amp;)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">useBigger</span><span class="params">(<span class="type">const</span> string&amp; s1, <span class="type">const</span> string&amp; s2,</span></span></span><br><span class="line"><span class="params"><span class="function">               <span class="type">bool</span> (*pf)(<span class="type">const</span> string&amp;, <span class="type">const</span> string&amp;))</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">useBigger</span>(s1, s2, lengthCompare);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>å‘å®å‚æ·»åŠ é¡¶å±‚constæˆ–ä»å®å‚åˆ é™¤é¡¶å±‚const</p>
<p>å¯ä»¥ç†è§£ä¸ºï¼Œé¡¶å±‚constä¸å½±å“å‚æ•°ï¼Œå› æ­¤ä¸‹é¢çš„ä¸¤ä¸ªå‡½æ•°ï¼Œæ˜¯ç›¸åŒçš„å‚æ•°ç±»å‹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">int</span>* <span class="type">const</span> a)</span></span>&#123;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;1&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">int</span>* b)</span></span>&#123;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;2&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç¨‹åºä¸­æœ‰ä¸¤ä¸ªè¿™æ ·çš„å‡½æ•°ï¼Œç¼–è¯‘æ—¶ä¼šæŠ¥é”™ï¼Œå› ä¸ºå‘ç”Ÿäº†æ­§ä¹‰ï¼Œç¼–è¯‘å™¨ä¸çŸ¥é“åº”è¯¥é€‰æ‹©å“ªä¸ªå‡½æ•°ã€‚</p>
</li>
</ul>
</li>
<li><p>é€šè¿‡constè½¬æ¢å®ç°çš„åŒ¹é…</p>
<p>ç‰¹æŒ‡åº•å±‚constè½¬æ¢ï¼Œä¸€èˆ¬æ˜¯éconstè½¬æ¢æˆconstå½¢å‚</p>
</li>
<li><p>é€šè¿‡ç±»å‹æå‡å®ç°çš„åŒ¹é…</p>
<ul>
<li><p>å¯¹äºbool, char, signed char, unsigned char, short, unsigned shortç­‰ç±»å‹ï¼Œåªè¦æ‰€æœ‰å¯èƒ½çš„å€¼éƒ½èƒ½å­˜åœ¨inté‡Œï¼Œå®ƒä»¬å°±ä¼šè¢«æå‡ä¸ºintï¼›å¦åˆ™ï¼Œæå‡ä¸ºunsigned intã€‚</p>
</li>
<li><p>è¾ƒå¤§çš„charç±»å‹ï¼ˆwchar_t, char16_t, char32_tï¼‰æå‡æˆint, unsigned int, long, unsigned long, long long, unsigned long longä¸­æœ€å°çš„ä¸€ç§ç±»å‹ï¼Œå‰ææ˜¯è½¬æ¢åçš„ç±»å‹èƒ½å®¹çº³åŸç±»å‹æ‰€æœ‰å¯èƒ½çš„å€¼ã€‚</p>
</li>
</ul>
</li>
<li><p>é€šè¿‡ç®—æœ¯ç±»å‹è½¬æ¢å’ŒæŒ‡é’ˆè½¬æ¢å®ç°çš„åŒ¹é…</p>
<ul>
<li><p>ç®—æœ¯ç±»å‹è½¬æ¢å°±æ˜¯ä¸åŒæ•°å€¼ç±»å‹é—´çš„ç›¸äº’è½¬æ¢ï¼Œå¦‚int,short,doubleä¹‹ç±»ï¼Œä½†ä¸å†å±€é™äºç±»å‹æå‡ï¼Œdoubleä¹Ÿå¯éšå¼è½¬ä¸ºintï¼Œä¹Ÿèƒ½åŒ¹é…åˆ°ã€‚</p>
</li>
<li><p>æŒ‡é’ˆè½¬æ¢ï¼š</p>
<ol>
<li><p>å¸¸é‡æ•´æ•°å€¼0æˆ–è€…å­—é¢å€¼nullptrèƒ½è½¬æ¢æˆä»»æ„æŒ‡é’ˆç±»å‹</p>
</li>
<li><p>æŒ‡å‘ä»»æ„éå¸¸é‡çš„æŒ‡é’ˆèƒ½è½¬æ¢æˆvoid*</p>
</li>
<li><p>æŒ‡å‘ä»»æ„å¯¹è±¡çš„æŒ‡é’ˆèƒ½è½¬æ¢æˆconst void*</p>
</li>
<li><p>ç»§æ‰¿å…³ç³»ï¼šç¼–è¯‘å™¨ä¼šéšå¼åœ°æ‰§è¡Œæ´¾ç”Ÿç±»åˆ°åŸºç±»çš„è½¬æ¢</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Bulk_quoteç»§æ‰¿è‡ªQuote</span></span><br><span class="line">Quote item;</span><br><span class="line">Bulk_quote bulk;</span><br><span class="line">Quote *p = &amp;item;</span><br><span class="line">p = &amp;bulk;</span><br><span class="line">Quote &amp;r = bulk;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>ç®—æœ¯ç±»å‹&#x2F;æŒ‡é’ˆç±»å‹è‡ªåŠ¨è½¬æ¢æˆboolç±»å‹</p>
<p>å­˜åœ¨ä¸€ç§ä»ç®—æœ¯ç±»å‹æˆ–æŒ‡é’ˆç±»å‹å‘å¸ƒå°”ç±»å‹è‡ªåŠ¨è½¬æ¢çš„æœºåˆ¶ã€‚å¦‚æœæŒ‡é’ˆæˆ–ç®—æœ¯ç±»å‹çš„å€¼ä¸º0ï¼Œè½¬æ¢ç»“æœä¸ºfalseï¼›å¦åˆ™è½¬æ¢ç»“æœæ˜¯trueã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">char</span>* cp = <span class="built_in">get_string</span>();</span><br><span class="line"><span class="keyword">if</span>(cp)    <span class="comment">/*...*/</span>   <span class="comment">//å¦‚æœæŒ‡é’ˆcpä¸æ˜¯0ï¼Œæ¡ä»¶ä¸ºçœŸ</span></span><br><span class="line"><span class="keyword">while</span>(*cp) <span class="comment">/*...*/</span>   <span class="comment">//å¦‚æœ*cpä¸æ˜¯ç©ºå­—ç¬¦ï¼Œæ¡ä»¶ä¸ºçœŸ</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>é€šè¿‡ç±»ç±»å‹è½¬æ¢å®ç°çš„åŒ¹é…ï¼šè§â€œç±»â€ç« ã€‚</p>
<p>ç±»ç±»å‹è½¬æ¢çš„ä¸€ä¸ªä¾‹å­å°±æ˜¯ï¼Œchar*è½¬æ¢æˆstringç±»å‹</p>
</li>
</ol>
<p>è€ƒè™‘è¿™æ ·ä¸€ä¸ªåœºæ™¯</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">Employee* <span class="title">findEmployee</span><span class="params">(<span class="type">const</span> std::string&amp; surname, <span class="type">const</span> std::string&amp; givenName, <span class="type">bool</span> retired=<span class="literal">false</span>)</span></span>;</span><br><span class="line"><span class="function">Employee* <span class="title">findEmployee</span><span class="params">(<span class="type">const</span> std::string&amp; fullName, <span class="type">bool</span> retired = <span class="literal">false</span>)</span></span></span><br><span class="line"><span class="function">Employee* e </span>= <span class="built_in">findEmployee</span>(<span class="string">&quot;Chen&quot;</span>, <span class="string">&quot;Shuo&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>ä¸€èˆ¬å¯èƒ½è®¤ä¸ºï¼Œæ‰§è¡Œç¬¬3è¡Œæ—¶ï¼Œä¼šè°ƒç”¨ç¬¬1è¡Œå¯¹åº”çš„å‡½æ•°ã€‚å®åˆ™ä¸ç„¶ï¼Œå®é™…æƒ…å†µä¸‹ä¼šè°ƒç”¨ç¬¬2è¡Œå¯¹åº”çš„å‡½æ•°ã€‚è¿™å°±æ¶‰åŠä¸Šé¢æ‰€è¯´çš„ä¼˜å…ˆçº§é—®é¢˜ã€‚â€chenâ€è¿™ç§å­—ç¬¦ä¸²å­—é¢é‡ï¼Œä½œä¸ºå‚æ•°æ—¶ï¼Œæ˜¯const char*ç±»å‹ï¼Œä¸¤ç§é‡è½½éƒ½æ²¡æœ‰è€ƒè™‘const char*ï¼Œå› æ­¤éœ€è¦è¿›è¡Œéšå¼è½¬æ¢ã€‚ä»const char*è½¬æ¢ä¸ºstringï¼Œæ˜¯ä¸€ä¸ªç±»ç±»å‹è½¬æ¢ï¼Œè€Œä»const char*è½¬æ¢ä¸ºboolï¼Œæ˜¯ä¸€ä¸ªæŒ‡é’ˆç±»å‹è½¬æ¢ï¼Œåè€…ä¼˜å…ˆçº§é«˜äºå‰è€…ï¼Œå› æ­¤ä¼šè°ƒç”¨ç¬¬2è¡Œå¯¹åº”çš„å‡½æ•°é‡è½½ã€‚</p>
<h4 id="å¼•å…¥æ¨¡æ¿çš„é‡è½½"><a href="#å¼•å…¥æ¨¡æ¿çš„é‡è½½" class="headerlink" title="å¼•å…¥æ¨¡æ¿çš„é‡è½½"></a>å¼•å…¥æ¨¡æ¿çš„é‡è½½</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(T a)</span></span>&#123;</span><br><span class="line">  cout &lt;&lt; <span class="number">3</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">int</span> a)</span></span>&#123;</span><br><span class="line">  cout &lt;&lt; <span class="number">1</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="built_in">foo</span>(<span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åä¼šè¾“å‡º3ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨äº†æœ‰æ¨¡æ¿çš„fooå‡½æ•°é‡è½½ã€‚å› ä¸ºç¼–è¯‘å™¨åŠ›å›¾ç²¾ç¡®åŒ¹é…ï¼Œè€ŒTå¯ä»¥è¢«æ¨æ–­ä¸ºdouble&#x2F;floatç±»å‹ï¼Œæ¯”intæ›´ç²¾ç¡®ï¼Œæ‰€ä»¥ä¼šä½¿ç”¨æœ‰æ¨¡æ¿çš„fooå‡½æ•°é‡è½½ã€‚</p>
<h2 id="é¢å‘å¯¹è±¡"><a href="#é¢å‘å¯¹è±¡" class="headerlink" title="é¢å‘å¯¹è±¡"></a>é¢å‘å¯¹è±¡</h2><h3 id="10-ç±»"><a href="#10-ç±»" class="headerlink" title="10 ç±»"></a>10 ç±»</h3><blockquote>
<p>C++ä¸­çš„ç±»å¯å¤§è‡´åˆ†ä¸ºä¸‰ç§ï¼šå…·ä½“ç±»ã€æŠ½è±¡ç±»å’Œç±»å±‚æ¬¡æ¼«æ¸¸ä¸­çš„ç±»ã€‚å¤§éƒ¨åˆ†ç±»å¯å½’ä¸ºè¿™ä¸‰ç§ä¹‹ä¸€ï¼Œæˆ–æŸç§çš„ç®€å•å˜å½¢ï¼Œæˆ–æŸå‡ ç§çš„ç»„åˆã€‚</p>
</blockquote>
<ul>
<li><p><strong>å…·ä½“ç±»ï¼š</strong></p>
<p>å…·ä½“ç±»å¯ä»¥æœ‰ä¸å†…ç½®ç±»å‹ç›¸ä¼¼çš„è¡Œä¸ºï¼ŒåŒæ—¶ä¸ºäº†æé«˜çµæ´»æ€§ï¼Œè¿˜å¯ä»¥æŠŠæˆå‘˜å˜é‡çš„ä¸»ä½“éƒ¨åˆ†æ”¾åœ¨è‡ªç”±å­˜å‚¨ä¸­ï¼ˆåŠ¨æ€å†…å­˜ã€å †ï¼‰ã€‚ä¸€ä¸ªç»å…¸çš„ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹æ˜¯complexï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">complex</span>&#123;</span><br><span class="line">  <span class="type">double</span> re,im;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">complex</span>(<span class="type">double</span> r, <span class="type">double</span> i): re&#123;r&#125;, im&#123;i&#125;&#123;&#125;</span><br><span class="line">  <span class="built_in">complex</span>(<span class="type">double</span> r): re&#123;r&#125;, im&#123;<span class="number">0</span>&#125;&#123;&#125;</span><br><span class="line">  <span class="built_in">complex</span>(): re&#123;<span class="number">0</span>&#125;, im&#123;<span class="number">0</span>&#125;&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">double</span> <span class="title">real</span><span class="params">()</span> <span class="type">const</span> </span>&#123;<span class="keyword">return</span> re;&#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">real</span><span class="params">(<span class="type">double</span> d)</span> </span>&#123;re = d;&#125;</span><br><span class="line">  <span class="function"><span class="type">double</span> <span class="title">imag</span><span class="params">()</span> <span class="type">const</span> </span>&#123;<span class="keyword">return</span> im;&#125;                     <span class="comment">//const å¸¸é‡å‡½æ•°ï¼Œå‡½æ•°ä¸ä¼šæ”¹å˜æ‰€è°ƒç”¨çš„å¯¹è±¡</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">imag</span><span class="params">(<span class="type">double</span> d)</span> </span>&#123;im = d;&#125;</span><br><span class="line"></span><br><span class="line">  complex&amp; <span class="keyword">operator</span>+=(complex z)&#123;re+=z.re, im+=z.im; <span class="keyword">return</span> *<span class="keyword">this</span>;&#125;</span><br><span class="line">  complex&amp; <span class="keyword">operator</span>-=(complex z)&#123;re-=z.re, im-=z.im; <span class="keyword">return</span> *<span class="keyword">this</span>;&#125;</span><br><span class="line"></span><br><span class="line">  complex&amp; <span class="keyword">operator</span>*=(complex);<span class="comment">//åœ¨ç±»å¤–çš„æŸå¤„è¿›è¡Œå®šä¹‰</span></span><br><span class="line">  complex&amp; <span class="keyword">operator</span>/=(complex);<span class="comment">//åœ¨ç±»å¤–çš„æŸå¤„è¿›è¡Œå®šä¹‰</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¾ˆå¤šå‡½æ•°å¹¶ä¸éœ€è¦è®¿é—®complexçš„æˆå‘˜å˜é‡ï¼Œå› æ­¤å…¶å®šä¹‰å¯ä»¥ä¸ç±»çš„å®šä¹‰åˆ†ç¦»å¼€æ¥</span></span><br><span class="line">complex <span class="keyword">operator</span>+(complex a, complex b)&#123; <span class="keyword">return</span> a += b; &#125;</span><br><span class="line">complex <span class="keyword">operator</span>-(complex a, complex b)&#123; <span class="keyword">return</span> a -= b; &#125;</span><br><span class="line">complex <span class="keyword">operator</span>-(complex a)&#123; <span class="keyword">return</span> &#123;-a.<span class="built_in">real</span>(), -a.<span class="built_in">imag</span>()&#125;; &#125;</span><br><span class="line">complex <span class="keyword">operator</span>*(complex a, complex b)&#123; <span class="keyword">return</span> a *= b; &#125;</span><br><span class="line">complex <span class="keyword">operator</span>/(complex a, complex b)&#123; <span class="keyword">return</span> a /= b; &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span>==()&#123;</span><br><span class="line">  <span class="keyword">return</span> a.<span class="built_in">real</span>() == b.<span class="built_in">real</span>() &amp;&amp; a.<span class="built_in">imag</span>() == b.<span class="built_in">imag</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span>!=()&#123;</span><br><span class="line">  <span class="keyword">return</span> !(a==b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>complexå¿…é¡»è¶³å¤Ÿé«˜æ•ˆï¼Œå¦åˆ™ä¸“é—¨å®šä¹‰ä¸€ä¸ªç±»æ²¡æœ‰æ„ä¹‰ï¼Œå› æ­¤ç®€å•çš„æ“ä½œå¿…é¡»è®¾ç½®æˆå†…è”çš„ã€‚</p>
<blockquote>
<p>ğŸ“Œå®šä¹‰åœ¨ç±»é‡Œé¢çš„å‡½æ•°é»˜è®¤æ˜¯å†…è”çš„ï¼Œä¹Ÿå¯ä»¥åœ¨å£°æ˜å‰åŠ ä¸Šinlineå…³é”®å­—æ˜¾å¼æŒ‡å®šã€‚</p>
</blockquote>
<ul>
<li><p>å½“ç»™è‡ªå®šä¹‰ç±»å‹ä½¿ç”¨è¿ç®—ç¬¦é‡è½½æ—¶ï¼Œåº”è¯¥å°Šé‡å…¶å¸¸è§„ä½¿ç”¨ä¹ æƒ¯ï¼š</p>
<ul>
<li><p>æ¯”å¦‚ä¸èƒ½å®šä¹‰ä¸€å…ƒè¿ç®—ç¬¦&#x2F;ï¼Œå› ä¸ºå…¶è¯­æ³•åœ¨è¯­è¨€ä¸­å·²å›ºå®šï¼›</p>
</li>
<li><p>ä¹Ÿä¸èƒ½æ”¹å˜å†…ç½®ç±»å‹çš„è¿ç®—ç¬¦çš„å«ä¹‰ï¼Œå¦‚ä¸èƒ½é‡æ–°å®šä¹‰+æ‰§è¡Œintçš„å‡æ³•</p>
</li>
</ul>
</li>
<li><p>æ•°æ®å¥æŸ„æ¨¡å‹(handle-to-data model)ï¼š</p>
<blockquote>
<p>æ„é€ å‡½æ•°è´Ÿè´£ä¸ºå…ƒç´ åˆ†é…ç©ºé—´å¹¶æ­£ç¡®åˆå§‹åŒ–æˆå‘˜ï¼Œææ„å‡½æ•°è´Ÿè´£é‡Šæ”¾ç©ºé—´ã€‚</p>
</blockquote>
<p>è¿™ä¹Ÿæ˜¯<strong>èµ„æºè·å–å³åˆå§‹åŒ–(Resource Acquisition Is Initialization, RAII)</strong> æŠ€æœ¯ï¼Œå¯ä»¥é˜²æ­¢åœ¨æ™®é€šä»£ç ä¸­åˆ©ç”¨â€œè£¸newâ€å’Œâ€œè£¸deleteâ€åˆ†é…å†…å­˜ï¼Œè€Œæ˜¯å°†åˆ†é…æ“ä½œéšè—åœ¨è¡Œä¸ºè‰¯å¥½çš„æŠ½è±¡çš„å®ç°å†…éƒ¨ï¼Œè§„é¿èµ„æºæ³„éœ²çš„æ½œåœ¨é£é™©ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vector</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">double</span>* elem; <span class="comment">//elemæŒ‡å‘å«æœ‰szä¸ªdoubleå‹å…ƒç´ çš„æ•°ç»„</span></span><br><span class="line">  <span class="type">int</span> sz;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Vector</span>(<span class="type">int</span> s): elem&#123;<span class="keyword">new</span> <span class="type">double</span>[s]&#125;,sz&#123;s&#125; &#123;   <span class="comment">// æ„é€ å‡½æ•°ï¼Œè·å–èµ„æº</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i!=s;++i)</span><br><span class="line">      elem[i] = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ~<span class="built_in">Vector</span>()&#123;<span class="keyword">delete</span>[] elem;&#125;                    <span class="comment">// ææ„å‡½æ•°ï¼Œé‡Šæ”¾èµ„æº</span></span><br><span class="line"></span><br><span class="line">  <span class="type">double</span>&amp; <span class="keyword">operator</span>[](<span class="type">int</span> i);</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„æ„é€ å‡½æ•°ï¼Œå…ˆå»ºç«‹äº†ä¸€å®šæ•°ç›®çš„å­˜å‚¨ï¼Œç„¶åç»™å­˜å‚¨ä¸­çš„å„ä¸ªå…ƒç´ èµ‹å€¼ï¼Œç”¨æˆ·ä½¿ç”¨æ—¶å†å‘å…¶ä¸­å¡«å€¼ã€‚è¿™ä¸æ˜¯å¾ˆå¥½çš„åˆå§‹åŒ–æ–¹æ³•ã€‚æ›´ç®€æ´çš„é€”å¾„æ˜¯;</p>
<ul>
<li><p>åˆ©ç”¨å…ƒç´ åˆ—è¡¨è¿›è¡Œåˆå§‹åŒ–ï¼š</p>
<p>å…ˆé‡è½½ä¸€ä¸ªæ„é€ å‡½æ•°<code>Vector(std::initializer_list&lt;double&gt;)</code></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">Vector::<span class="built_in">Vector</span>(std::initializer_list&lt;<span class="type">double</span>&gt; lst):</span><br><span class="line">  elem&#123;<span class="keyword">new</span> <span class="type">double</span>[lst.<span class="built_in">size</span>()]&#125;, sz&#123;<span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(lst.<span class="built_in">size</span>())&#125;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">copy</span>(lst.<span class="built_in">begin</span>(), lst.<span class="built_in">end</span>(), elem);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>std::initializer_list</code>æ˜¯ä¸€ç§æ ‡å‡†åº“ç±»å‹ï¼Œä½¿ç”¨{1,2,3,4}åˆ—è¡¨æ—¶ï¼Œç¼–è¯‘å™¨ä¼šåˆ›å»ºä¸€ä¸ªè¯¥ç±»å‹çš„å¯¹è±¡ã€‚</p>
<p><code>static_cast</code>è´Ÿè´£å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œæ—¨åœ¨é¿å…ç‰¹åˆ«ä¸¥é‡çš„é”™è¯¯ã€‚</p>
<p>å› æ­¤æ­¤æ—¶å¯ä»¥é‡‡ç”¨åˆå§‹å€¼åˆ—è¡¨æ¥åšåˆå§‹åŒ–ï¼š<code>Vector v1 = &#123;1,2,3,4,5&#125;;</code></p>
</li>
<li><p>push_back()ï¼šåœ¨åºåˆ—çš„æœ«å°¾æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œå®¹å™¨é•¿åº¦åŠ 1.</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>æŠ½è±¡ç±»ï¼š</strong></p>
<p>æŠ½è±¡ç±»çš„ä½œç”¨æ›´ç±»ä¼¼äºæä¾›ä¸€ä¸ªæ¥å£ï¼Œå°†ä½¿ç”¨è€…ä¸ç±»çš„å®ç°ç»†èŠ‚å®Œå…¨éš”ç¦»å¼€æ¥ã€‚å¦‚è®¾è®¡ä¸€ä¸ªæ¯”Vectoræ›´æŠ½è±¡çš„Containerç±»ï¼š</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Container</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="keyword">virtual</span> <span class="type">double</span>&amp; <span class="keyword">operator</span>[](<span class="type">int</span>) = <span class="number">0</span>;<span class="comment">//çº¯è™šå‡½æ•°</span></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;       <span class="comment">//å¸¸é‡æˆå‘˜å‡½æ•°</span></span><br><span class="line">  <span class="keyword">virtual</span> ~<span class="built_in">Container</span>()[]              <span class="comment">//ææ„å‡½æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">use</span><span class="params">(Container&amp; c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">int</span> sz = c.<span class="built_in">size</span>();</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i!=sz;++i)</span><br><span class="line">    cout&lt;&lt;c[i]&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>virtual</code>å…³é”®å­—å£°æ˜è™šå‡½æ•°ï¼ˆå¯èƒ½åœ¨æ´¾ç”Ÿç±»ä¸­è¢«é‡æ–°å®šä¹‰ï¼‰ï¼Œ<code>=0</code>è¡¨ç¤ºè™šå‡½æ•°æ˜¯çº¯è™šå‡½æ•°ï¼Œå³Containerçš„æ´¾ç”Ÿç±»å¿…é¡»å®šä¹‰è¿™ä¸ªå‡½æ•°ã€‚æŠ½è±¡ç±»ä¸­ä¸éœ€è¦è‡ªè¡Œå®šä¹‰æ„é€ å‡½æ•°ï¼Œå› ä¸ºä¸éœ€è¦åˆå§‹åŒ–æ•°æ®ï¼Œè€Œä¸”ææ„å‡½æ•°ä¹Ÿæ˜¯è™šå‡½æ•°ã€‚</p>
<blockquote>
<p>ğŸ“ŒæŠ½è±¡ç±»åº”æ”¾å¼ƒåŒ…å«å±€éƒ¨æˆå‘˜ã€‚</p>
</blockquote>
<p><strong>å¤šæ€æ¨¡å‹</strong>ï¼š<code>use()</code>å®Œå…¨å¿½è§†Containerçš„å®ç°ç»†èŠ‚ï¼Œè€Œä½¿ç”¨Containeræ¥å£ã€‚è¿™ç§ä¸ºå…¶ä»–ç±»å‹æä¾›æ¥å£çš„ç±»ï¼Œä¸€èˆ¬ç§°ä¸ºå¤šæ€æ¨¡å‹(polymorphic type)ã€‚useå‡½æ•°å¯ä»¥ä½¿ç”¨æ‰€æœ‰æ´¾ç”Ÿè‡ªContainerçš„æœ‰è¿™æ ·æ¥å£çš„æ´¾ç”Ÿç±»ã€‚</p>
<ul>
<li><p>æ´¾ç”Ÿç±»ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vector_container</span>: <span class="keyword">public</span> Container&#123;      <span class="comment">//:publicè¡¨ç¤ºç»§æ‰¿å…³ç³»</span></span><br><span class="line">  Vector v;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Vector_container</span>(<span class="type">int</span> s): <span class="built_in">v</span>(s) &#123;&#125;</span><br><span class="line">  ~<span class="built_in">Vector_container</span>() &#123;&#125;</span><br><span class="line">  <span class="type">double</span>&amp; <span class="keyword">operator</span>[](<span class="type">int</span> i) &#123; <span class="keyword">return</span> v[i]; &#125;</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> v.<span class="built_in">size</span>(); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Vector_container vc &#123;<span class="number">10</span>,<span class="number">9</span>,<span class="number">8</span>&#125;;</span><br><span class="line"><span class="built_in">use</span>(vc);                                      <span class="comment">//ä½¿ç”¨å¤šæ€æ¨¡å‹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æ‰€æœ‰æ´¾ç”Ÿç±»</span></span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„ï¼šä½¿ç”¨å¤šæ€æ¨¡å‹ä¼šå¸¦æ¥çµæ´»æ€§ï¼Œä½†æ˜¯å¿…é¡»é€šè¿‡å¼•ç”¨æˆ–æŒ‡é’ˆæ“ä½œå¯¹è±¡ï¼</p>
<p>è¿™é‡Œçš„<code>~Vector_container()</code>éšå¼è°ƒç”¨äº†<code>~Vector()</code></p>
</li>
<li><p>è™šå‡½æ•°çš„ç¼–è¯‘å™¨å®ç°ï¼š</p>
<p><img src="/image/image_6jwbJcI4f8.png"></p>
<p>å½“ä½¿ç”¨Vector_containerä½œä¸ºContainerå¯¹è±¡æ—¶ï¼Œuseå°†å¿…é¡»ä½¿ç”¨Vector_containerçš„operator[]()ï¼Œè€Œå…¶ä»–æ´¾ç”Ÿç±»åˆ™ä¼šä½¿ç”¨é‚£äº›æ´¾ç”Ÿç±»å®ç°çš„operator[]()ã€‚å› æ­¤Containerçš„å¯¹è±¡å¿…é¡»åŒ…å«ä¸€äº›ä¿¡æ¯ï¼Œä½¿å¾—è¿è¡Œæ—¶èƒ½å¤Ÿé€‰æ‹©æ­£ç¡®çš„è™šå‡½æ•°å®ç°ã€‚</p>
<p>åšæ³•å¦‚ä¸Šå›¾ï¼Œç¼–è¯‘å™¨å°†è™šå‡½æ•°åå­—è½¬æ¢æˆè™šå‡½æ•°è¡¨(virtual function table, vtbl)ï¼Œæ¯ä¸ªå«æœ‰è™šå‡½æ•°çš„ç±»éƒ½æœ‰è‡ªå·±çš„vtblç”¨äºè¾¨è¯†è™šå‡½æ•°ï¼Œä»è€Œç¡®ä¿å¯¹è±¡è¢«æ­£ç¡®ä½¿ç”¨ã€‚è°ƒç”¨Containerå¯¹è±¡æ—¶åªéœ€è¦çŸ¥é“vtblæŒ‡é’ˆä½ç½®å’Œå„è™šå‡½æ•°ç´¢å¼•å³å¯ã€‚</p>
<blockquote>
<p>ğŸ“Œè¿™ç§æ–¹å¼ï¼Œä¼šä½¿è™šå‡½æ•°çš„è°ƒç”¨å¤šä¸€äº›å¼€é”€ï¼Œå¦‚æ¯ä¸ªç±»éƒ½éœ€è¦ä¸€ä¸ªvtblï¼Œå¹¶ä¸”ä¿ç•™å…¶æŒ‡é’ˆã€‚ä½†æ˜¯å‡½æ•°è°ƒç”¨çš„æ•ˆç‡è¿˜æ˜¯éå¸¸æ¥è¿‘â€œæ™®é€šå‡½æ•°è°ƒç”¨â€çš„ï¼ˆç›¸å·®ä¸è¶…è¿‡25%ï¼‰ã€‚</p>
</blockquote>
</li>
<li><p>æ´¾ç”Ÿç±»çš„æ„é€ å‡½æ•°ï¼š</p>
<p>è€ƒè™‘è¿™æ ·çš„åŸºç±»å’Œæ´¾ç”Ÿç±»ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Quote</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Quote</span>() = <span class="keyword">default</span>;</span><br><span class="line">  <span class="built_in">Quote</span>(<span class="type">const</span> std::string &amp;book, <span class="type">double</span> sales_price):</span><br><span class="line">    <span class="built_in">bookNo</span>(book), <span class="built_in">price</span>(sales_price) &#123; &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  std::string bookNo;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">  <span class="type">double</span> price = <span class="number">0.0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bulk_quote</span> : <span class="keyword">public</span> Quote&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Bulk_quote</span>() = <span class="keyword">default</span>;</span><br><span class="line">  <span class="built_in">Bulk_quote</span>(<span class="type">const</span> std::string &amp;book, <span class="type">double</span> p, std::<span class="type">size_t</span> qty, <span class="type">double</span> disc);</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  std::<span class="type">size_t</span> min_qty = <span class="number">0</span>;</span><br><span class="line">  <span class="type">double</span> discount = <span class="number">0.0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æ´¾ç”Ÿç±»å¯¹è±¡ä¸­å«æœ‰ä»åŸºç±»ç»§æ‰¿çš„æˆå‘˜ï¼Œä½†æ˜¯æ´¾ç”Ÿç±»å¹¶ä¸èƒ½ç›´æ¥åˆå§‹åŒ–è¿™äº›æˆå‘˜ã€‚<strong>æ´¾ç”Ÿç±»å¿…é¡»ä½¿ç”¨åŸºç±»çš„æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–å®ƒçš„åŸºç±»éƒ¨åˆ†</strong>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">Bulk_quote::<span class="built_in">Bulk_quote</span>(<span class="type">const</span> std::string&amp; book, <span class="type">double</span> p, std::<span class="type">size_t</span> qty, <span class="type">double</span> disc)</span><br><span class="line">  : <span class="built_in">Quote</span>(book, p), <span class="built_in">min_qty</span>(qty), <span class="built_in">discount</span>(disc) &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ç”±C++å®ä¾‹åŒ–å¯¹è±¡æ—¶çš„å†…å­˜åˆ†é…å¯¼è‡´çš„ï¼Œä¸€ä¸ªæ´¾ç”Ÿç±»å¯¹è±¡åŒ…å«å¤šä¸ªç»„æˆéƒ¨åˆ†ï¼šä¸€ä¸ªå«æœ‰æ´¾ç”Ÿç±»è‡ªå·±å®šä¹‰æˆå‘˜ï¼ˆå¯¹åº”minqtyå’Œdiscountï¼‰çš„å­å¯¹è±¡ï¼Œä»¥åŠä¸€ä¸ªåŸºç±»å¯¹åº”çš„å­å¯¹è±¡ï¼ˆå­å¯¹è±¡ä¸­åŒ…å«ï¼‰ã€‚å¦‚æœæœ‰å¤šä¸ªåŸºç±»ï¼Œé‚£ä¹ˆè¿™æ ·çš„å­å¯¹è±¡ä¹Ÿæœ‰å¤šä¸ªã€‚å› æ­¤åœ¨åˆ©ç”¨æ„é€ å‡½æ•°å®ä¾‹åŒ–æ´¾ç”Ÿç±»çš„å¯¹è±¡æ—¶ï¼Œä¹Ÿå¿…é¡»è°ƒç”¨åŸºç±»çš„æ„é€ å‡½æ•°ï¼Œå®ä¾‹åŒ–å­å¯¹è±¡ã€‚</p>
</li>
</ul>
<!---->

<ul>
<li><strong>ç±»å±‚æ¬¡æ¼«æ¸¸ï¼š</strong></li>
</ul>
<blockquote>
<p>ç±»å±‚æ¬¡å°±æ˜¯ç»“æ„å°±æ˜¯ï¼Œä¸€ä¸ªå­ç±»ç»§æ‰¿ä¸€ä¸ªåŸºç±»ï¼Œå¦ä¸€ä¸ªå­ç±»ç»§æ‰¿ç›¸åŒçš„åŸºç±»ï¼Œä¸€ä¸ªå­å­ç±»ç»§æ‰¿å­ç±»ç­‰ç­‰</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> Point <span class="title">center</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">move</span><span class="params">(Point to)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> angle)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">virtual</span> ~<span class="built_in">shape</span>() &#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span>: <span class="keyword">public</span> Shape&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Circle</span>(Point p, <span class="type">int</span> rr);</span><br><span class="line"></span><br><span class="line">  <span class="function">Point <span class="title">center</span><span class="params">()</span> <span class="type">const</span> </span>&#123;<span class="keyword">return</span> x;&#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">move</span><span class="params">(Point to)</span> </span>&#123; x=to; &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span>)</span> </span>&#123;&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  Point x;</span><br><span class="line">  <span class="type">int</span> r;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Smiley</span>: <span class="keyword">public</span> Circle &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Smiley</span>(Point p, <span class="type">int</span> r) : Circle&#123;p,r&#125;, mouth&#123;<span class="literal">nullptr</span>&#125; &#123;&#125;</span><br><span class="line"></span><br><span class="line">  ~<span class="built_in">Smiley</span>()&#123;</span><br><span class="line">    <span class="keyword">delete</span> mouth;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> p:eyes)</span><br><span class="line">      <span class="keyword">delete</span> p;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">move</span><span class="params">(Point to)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">add_eye</span><span class="params">(Shape* s)</span></span>&#123;eyes.<span class="built_in">push_back</span>(s);&#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">set_mouth</span><span class="params">(Shape* s)</span></span>;</span><br><span class="line">  <span class="comment">//......</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  vector&lt;Shape*&gt; eyes;</span><br><span class="line">  Shape* mouth;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Smiley::draw</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Circle::<span class="built_in">draw</span>();</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">auto</span> p:eyes)</span><br><span class="line">    p-&gt;<span class="built_in">draw</span>();</span><br><span class="line">  mouth-&gt;<span class="built_in">draw</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Smileyç»§æ‰¿äº†Circleï¼ŒCircleç»§æ‰¿äº†Shape</p>
<ul>
<li><p>å¯¹äºæŠ½è±¡ç±»æ¥è¯´ï¼Œå…¶æ´¾ç”Ÿç±»çš„å¯¹è±¡é€šå¸¸æ˜¯é€šè¿‡æŠ½è±¡åŸºç±»çš„æ¥å£æ“çºµçš„ï¼Œæ‰€ä»¥åŸºç±»ä¸­å¿…é¡»æœ‰ä¸€ä¸ªè™šææ„å‡½æ•°ã€‚</p>
</li>
<li><p><code>rotate_all</code>å¯ä»¥è°ƒç”¨ä»»ä½•Shapeçš„æ´¾ç”Ÿç±»ï¼Œå¦‚Smileyï¼Œè¿™ä½“ç°äº†<strong>æ¥å£ç»§æ‰¿</strong>çš„ç›Šå¤„ï¼Œå³ï¼šæ´¾ç”Ÿç±»å¯ä»¥ç”¨åœ¨ä»»ä½•éœ€è¦åŸºç±»å¯¹è±¡çš„åœ°æ–¹ã€‚</p>
</li>
<li><p>Smileyå¯ä»¥ä½¿ç”¨Circleçš„æ„é€ å‡½æ•°å’Œ<code>Circle::draw()</code>ï¼Œè¿™ä½“ç°äº†<strong>å®ç°ç»§æ‰¿</strong>çš„ç›Šå¤„ï¼Œå³ï¼šåŸºç±»å¯ä»¥æä¾›ç®€åŒ–æ´¾ç”Ÿç±»å®ç°çš„å‡½æ•°æˆ–æ•°æ®ã€‚</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">rotate_all</span><span class="params">(vector&lt;Shape*&gt;&amp; v, <span class="type">int</span> angle)</span></span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> p:v)</span><br><span class="line">    p-&gt;<span class="built_in">rotate</span>(angle);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&amp;#x20;    - å½“æŸä¸ªå‡½æ•°éœ€è¦ä½¿ç”¨ç‰¹å®šæ´¾ç”Ÿç±»çš„æˆå‘˜å‡½æ•°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>dynamic_cast</code>è¿ç®—ç¬¦è¯¢é—®ç±»å‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">Shape* <span class="title">ps</span><span class="params">(read_shape(cin))</span></span>; <span class="comment">//æ ¹æ®cinæŒ‡å®šçš„ç±»å‹ç”Ÿæˆç‰¹å®šæ´¾ç”Ÿç±»çš„Shape</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(Smiley* p = <span class="built_in">dynamic_cast</span>&lt;Smiley*&gt;(ps)) &#123; <span class="comment">//æˆ–è€…å¼•ç”¨: if(Smiley&amp; p = dynamic_cast&lt;Smiley&amp;&gt;(*ps))</span></span><br><span class="line">  <span class="comment">//...æŒ‡é’ˆpæ‰€æŒ‡çš„å¯¹è±¡ç±»å‹æ˜¯Smiley</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="comment">//...æŒ‡é’ˆpæ‰€æŒ‡çš„å¯¹è±¡ç±»å‹ä¸æ˜¯Smileyï¼Œæ‰§è¡Œå…¶ä»–æ“ä½œ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>å½“ä¸èƒ½ç›´æ¥ä½¿ç”¨å€™é€‰çš„æ´¾ç”Ÿç±»æ—¶ï¼Œå¯ä»¥ç”¨å¼•ç”¨æ›¿ä»£ï¼Œç”¨äº<code>dynamic_cast</code></p>
</li>
<li><p>è‹¥<code>dynamic_cast</code>çš„å‚æ•°(ps)ä¸æœŸæœ›ç±»å‹(Smiley)ä¸ç¬¦æ—¶ï¼Œåˆ™ä¼šè¿”å›<code>nullptr</code>ã€‚</p>
</li>
</ul>
<blockquote>
<p>ğŸ“Œprivateã€publicã€protectedï¼š<br>- è®¿é—®èŒƒå›´çš„å·®å¼‚ï¼š<br>privateï¼šåªèƒ½ç”±è¯¥ç±»ä¸­çš„å‡½æ•°ã€å…¶å‹å…ƒå‡½æ•°è®¿é—®ï¼Œä¸èƒ½è¢«ä»»ä½•å…¶ä»–è®¿é—®ï¼Œè¯¥ç±»çš„å¯¹è±¡ä¹Ÿä¸èƒ½è®¿é—®ï¼›<br>protectedï¼šå¯ä»¥è¢«è¯¥ç±»ä¸­çš„å‡½æ•°ã€å­ç±»çš„å‡½æ•°ã€ä»¥åŠå…¶å‹å…ƒå‡½æ•°è®¿é—®ï¼Œä½†ä¸èƒ½è¢«è¯¥ç±»çš„å¯¹è±¡è®¿é—®ï¼›<br>publicï¼šå¯ä»¥è¢«è¯¥ç±»ä¸­çš„å‡½æ•°ã€å­ç±»çš„å‡½æ•°ã€å…¶å‹å…ƒå‡½æ•°è®¿é—®ï¼Œä¹Ÿå¯ä»¥ç”±è¯¥ç±»çš„å¯¹è±¡è®¿é—®ã€‚<br>- ç»§æ‰¿åçš„æ–¹æ³•å±æ€§å˜åŒ–ï¼š<br>ä½¿ç”¨privateç»§æ‰¿ï¼Œçˆ¶ç±»çš„æ‰€æœ‰æ–¹æ³•åœ¨å­ç±»ä¸­å˜ä¸ºprivateï¼›<br>ä½¿ç”¨protectedç»§æ‰¿ï¼Œçˆ¶ç±»çš„protectedå’Œpublicæ–¹æ³•åœ¨å­ç±»ä¸­å˜ä¸ºprotectedï¼Œprivateæ–¹æ³•ä¸å˜ï¼›<br>ä½¿ç”¨publicç»§æ‰¿ï¼Œçˆ¶ç±»ä¸­çš„æ–¹æ³•å±æ€§ä¸å‘ç”Ÿæ”¹å˜ã€‚</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å…³äºå­ç±»è®¿é—®çˆ¶ç±»çš„privateæˆå‘˜ï¼š</span></span><br><span class="line"><span class="comment">//Ã—ï¼ç¼–è¯‘å™¨æŠ¥é”™</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">int</span> x;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">set_x</span><span class="params">()</span></span>&#123;x = <span class="number">10</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>&#123;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">set_x</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;x = <span class="number">10</span>;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å…³äºå­ç±»è®¿é—®çˆ¶ç±»çš„protectedæˆå‘˜ï¼š</span></span><br><span class="line"><span class="comment">//âˆšï¼ç¼–è¯‘å™¨ä¸æŠ¥é”™</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">  <span class="type">int</span> x;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">set_x</span><span class="params">()</span></span>&#123;x = <span class="number">10</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>&#123;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">set_x</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;x = <span class="number">10</span>;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ“Œexplicitå…³é”®å­—ï¼š<br>å£°æ˜ä¸ºexplicitçš„æ„é€ å‡½æ•°ä¸èƒ½åœ¨éšå¼è½¬æ¢ä¸­ä½¿ç”¨ã€‚<br>å½“ç±»æ„é€ å‡½æ•°<strong>åªæœ‰ä¸€ä¸ªå‚æ•°æˆ–é™¤äº†ç¬¬ä¸€ä¸ªå‚æ•°å¤–å…¶ä½™å‚æ•°éƒ½æœ‰é»˜è®¤å€¼æ—¶</strong>ï¼Œåˆ™æ­¤ç±»æœ‰éšå«çš„ç±»å‹è½¬æ¢æ“ä½œç¬¦ï¼ˆéšå¼è½¬æ¢ï¼‰ï¼Œä½†æœ‰æ—¶éšå¼è½¬æ¢å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œå¯åœ¨æ„é€ å‡½æ•°å‰åŠ ä¸Šå…³é”®å­—explicitï¼Œæ¥æŒ‡å®šæ˜¾å¼è°ƒç”¨ã€‚<br>class Demo{<br>&amp;#x20;  public:<br>&amp;#x20;      explicit Demo(double a);<br>};<br>ç”±äºæ„é€ å‡½æ•°ä½¿ç”¨äº†explicitå…³é”®å­—ï¼Œå› æ­¤è°ƒç”¨å®ƒæ—¶æ— æ³•è¿›è¡Œéšå¼è½¬æ¢ï¼Œå³Demo test; test&#x3D;12.2; æ˜¯æ— æ•ˆçš„ï¼<br>ç„¶è€Œï¼Œæ­¤æ—¶å¯ä»¥è¿›è¡Œæ˜¾å¼è½¬æ¢<br>Demo test;<br>test &#x3D; Demo(12.2); æˆ–è€…<br>test &#x3D; (Demo)12.2;</p>
</blockquote>
<h4 id="overrideã€finalã€defaultã€delete"><a href="#overrideã€finalã€defaultã€delete" class="headerlink" title="overrideã€finalã€defaultã€delete"></a>overrideã€finalã€defaultã€delete</h4><ul>
<li><p>override</p>
<p>æœ‰virtualå°±å…è®¸å¤šæ€ï¼Œå³å…è®¸ç»§æ‰¿åŸºç±»çš„å­ç±»é‡æ–°virtualçš„æ–¹æ³•ã€‚ç„¶è€Œå­˜åœ¨ä¸¤ç§æƒ…å†µï¼š</p>
<ol>
<li><p>å­ç±»å¹¶ä¸æƒ³é‡å†™åŸºç±»çš„å‡½æ•°ï¼Œåªæ˜¯ç¢°å·§å†™çš„æ–°å‡½æ•°ä¸åŸºç±»ä¸­çš„æŸä¸€ä¸ªæ–¹æ³•é‡åäº†ï¼›</p>
</li>
<li><p>å­ç±»æƒ³é‡å†™åŸºç±»çš„å‡½æ•°ï¼Œä½†æ˜¯æŠŠå‡½æ•°åå†™é”™äº†ï¼Œæ­¤æ—¶ç¼–è¯‘å™¨å°†è¯¥å‡½æ•°åˆ¤å®šä¸ºæ–°å‡½æ•°ï¼Œä¸ä¼šæŠ¥é”™ï¼Œä½†è¿è¡Œæ—¶å¯èƒ½ä¼šå‡ºå¾ˆå¤šé—®é¢˜ã€‚</p>
</li>
</ol>
<p>é’ˆå¯¹ä»¥ä¸Šåœºæ™¯ï¼ŒC++11å¼•å…¥äº†<code>override</code>å…³é”®å­—ï¼Œä»¥èµ·åˆ°æ ‡è®°ä½œç”¨ã€‚overrideè¡¨ç¤ºï¼Œæ­¤æˆå‘˜å‡½æ•°å°±æ˜¯è¦é‡å†™åŸºç±»çš„åŒåå‡½æ•°ï¼Œè€Œä¸”å‡½æ•°ç­¾åä¸€è‡´ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">int</span> k, <span class="type">int</span> d)</span></span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> : A&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">int</span> k, <span class="type">int</span> d)</span></span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è€Œä»¥ä¸‹ä¸¤ç§æƒ…å†µä¼šå¯¼è‡´ç¼–è¯‘å™¨æŠ¥é”™ï¼šåŸå‡½æ•°ä¸å­˜åœ¨ï¼Œä»¥åŠé‡æ–°å‡½æ•°çš„å‡½æ•°ç­¾åä¸ä¸€è‡´ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åŸå‡½æ•°ä¸å­˜åœ¨ï¼ˆå‡½æ•°åå†™é”™äº†ï¼‰                     //å‡½æ•°ç­¾åä¸ä¸€è‡´ï¼ˆè¿”å›å€¼å†™é”™äº†ï¼‰                   </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> : A&#123;                                  <span class="keyword">class</span> <span class="title class_">B</span> : A&#123;</span><br><span class="line"><span class="keyword">protected</span>:                                    <span class="keyword">protected</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">funa</span><span class="params">(<span class="type">int</span> k, <span class="type">int</span> d)</span></span>&#123;                      <span class="function"><span class="type">int</span> <span class="title">func</span><span class="params">(<span class="type">int</span> k, <span class="type">int</span> d)</span></span>&#123;</span><br><span class="line">  &#125;                                             &#125;</span><br><span class="line">&#125;;                                            &#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>final</p>
<p>æœ‰ä¸€ç§æƒ…å†µï¼Œç±»Aç»§æ‰¿äº†ä¸€ä¸ªåŸºç±»ï¼Œä½†æ˜¯ç±»Aä¸å¸Œæœ›è¢«å…¶ä»–ç±»æ‰€ç»§æ‰¿ã€‚æˆ–è€…è¯´ç±»Aé‡å†™äº†åŸºç±»çš„è™šå‡½æ•°ï¼Œä½†å½“ç±»Aè¢«ç»§æ‰¿æ—¶ï¼Œä¸å†å¸Œæœ›è¿™ä¸ªè™šå‡½æ•°è¢«é‡å†™ã€‚</p>
<blockquote>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæ²¡æœ‰finalæ—¶è™šå‡½æ•°ä¼šä¼ é€’ï¼Œåªè¦åŸºç±»æœ‰virtualï¼Œå³ä½¿ç±»Aé‡å†™æ—¶å¯¹è¿™ä¸ªå‡½æ•°ä¸åŠ virtualï¼Œç±»Bç»§æ‰¿ç±»Aæ—¶ä¹Ÿèƒ½é‡å†™è¯¥å‡½æ•°ï¼Œè¯¥å‡½æ•°ä»ç„¶æ˜¯ä¸€ä¸ªè™šå‡½æ•°ã€‚</p>
</blockquote>
<ul>
<li><p>finalä¿®é¥°ç±»ï¼šä¸èƒ½å†è¢«ç»§æ‰¿</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> <span class="keyword">final</span>&#123;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ­¤æ—¶ä¸èƒ½å†ç»§æ‰¿Baseç±»ï¼Œä¸‹è¿°ä»£ç ä¼šç¼–è¯‘æœŸæŠ¥é”™</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derive</span> : Base&#123;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>finalä¿®é¥°è™šå‡½æ•°ï¼Œè™šå‡½æ•°ä¸èƒ½å†è¢«é‡å†™ï¼ˆæ³¨ï¼šfinalåªèƒ½ä¿®é¥°è™šå‡½æ•°ï¼Œä¸èƒ½ä¿®é¥°å…¶ä»–æˆå‘˜å‡½æ•°ï¼‰</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">func</span><span class="params">()</span> <span class="keyword">final</span></span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derive</span> : Base&#123;</span><br><span class="line">  <span class="comment">//æ­¤æ—¶ä¸èƒ½å†é‡å†™funcæ–¹æ³•ï¼Œä¸‹è¿°ä»£ç ä¼šç¼–è¯‘æœŸæŠ¥é”™</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>=default</p>
<p>å½“æ‰‹åŠ¨å†™äº†ä¸€ä¸ª<strong>æœ‰å‚æ•°</strong>çš„æ„é€ &#x2F;ææ„å‡½æ•°æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæŠŠé»˜è®¤çš„æ„é€ &#x2F;ææ„å‡½æ•°ä¼˜åŒ–æ‰ï¼Œå³<strong>ä¸ç”Ÿæˆé‚£äº›é»˜è®¤æ— å‚æ•°</strong>çš„æ„é€ &#x2F;ææ„å‡½æ•°ã€‚å¦‚æœæƒ³è¦ä¿ç•™è¿™äº›é»˜è®¤å‡½æ•°ï¼Œä½¿å¾—ç¼–è¯‘å™¨èƒ½å¤Ÿç”Ÿæˆé»˜è®¤å‡½æ•°ä»è€Œä¿ç•™æ— å‚æ•°æ—¶çš„è¡Œä¸ºï¼Œå¯ä»¥ç”¨<code>=default</code></p>
<ul>
<li><p>æŠ¥é”™åœºæ™¯ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">A</span>(<span class="type">int</span> i)&#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  A a;      <span class="comment">//å¯ä»¥ç¼–è¯‘é€šè¿‡ï¼Œä½†æ˜¯ä¼šè¿è¡Œæ—¶æŠ¥é”™ï¼Œå› ä¸ºå·²ç»æ²¡æœ‰æ— å‚æ•°çš„æ„é€ å‡½æ•°äº†ï¼ŒA aè¿™å¥åˆæ²¡ä¼ å‚æ•°</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸æŠ¥é”™åœºæ™¯ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">A</span>() = <span class="keyword">default</span>;</span><br><span class="line">  <span class="built_in">A</span>(<span class="type">int</span> i)&#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  A a;      <span class="comment">//è¿è¡Œæ—¶ä¸ä¼šå‡ºé”™ï¼Œå› ä¸ºé»˜è®¤æ— å‚æ•°çš„æ„é€ å‡½æ•°å¾—åˆ°äº†ä¿ç•™</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>=delete</p>
<p><code>=delete</code>ä¸<code>=default</code>çš„ä½œç”¨ç›¸åï¼Œå®ƒä¼šç¦ç”¨æ‰ç±»ä¸­çš„æŸä¸ªæˆå‘˜å‡½æ•°ã€‚æ¯”å¦‚ä¸æƒ³è¦é»˜è®¤çš„æ„é€ å‡½æ•°ã€ææ„å‡½æ•°ã€æ‹·è´æ„é€ å‡½æ•°æˆ–operator&#x3D;ï¼Œå¯ä»¥ç”¨<code>=delete</code>ç¦ç”¨æ‰ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">test</span>&#123;</span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">test</span>() = <span class="keyword">default</span>;</span><br><span class="line">    ~<span class="built_in">test</span>() = <span class="keyword">default</span>;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">test</span>(<span class="type">const</span> test&amp; a) = <span class="keyword">delete</span>;</span><br><span class="line">    test&amp; <span class="keyword">operator</span>=(<span class="type">const</span> test&amp; a) = <span class="keyword">delete</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="è±å½¢ç»§æ‰¿ä¸è™šç»§æ‰¿"><a href="#è±å½¢ç»§æ‰¿ä¸è™šç»§æ‰¿" class="headerlink" title="è±å½¢ç»§æ‰¿ä¸è™šç»§æ‰¿"></a>è±å½¢ç»§æ‰¿ä¸è™šç»§æ‰¿</h4><p><img src="/image/image_OQknyX-tPz.png"></p>
<p>è±å½¢ç»§æ‰¿çš„æƒ…å†µå¦‚å›¾æ‰€ç¤ºï¼ŒBå’ŒCéƒ½ç»§æ‰¿äº†Aï¼Œä¹Ÿå°±éƒ½ç»§æ‰¿äº†cntå±æ€§ã€‚è€ŒDåŒæ—¶ç»§æ‰¿äº†Bå’ŒCï¼Œæ­¤æ—¶Dçš„å¯¹è±¡å†…éƒ¨å°†ä¼šæœ‰ä¸¤ä»½cntï¼Œå­˜åœ¨äºŒä¹‰æ€§ã€‚æ­¤æ—¶è‹¥è¦è®©Dçš„å¯¹è±¡è®¿é—®æˆ–ä¿®æ”¹cntå±æ€§ï¼Œä¼šå› äºŒä¹‰æ€§ï¼ˆç¼–è¯‘å™¨ä¸çŸ¥é“åº”è¯¥ä½¿ç”¨å“ªä¸ªcntï¼‰ä½¿å¾—ç¼–è¯‘å™¨æŠ¥é”™ã€‚</p>
<p>D:</p>
<p>&amp;#x20;  - B: cnt</p>
<p>&amp;#x20;  - C: cnt</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;           <span class="comment">//é—´æ¥åŸºç±»A</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">  <span class="type">int</span> cnt;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>: <span class="keyword">public</span> A&#123; <span class="comment">//ç›´æ¥åŸºç±»B</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">  <span class="type">int</span> cnt_b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>: <span class="keyword">public</span> A&#123; <span class="comment">//ç›´æ¥åŸºç±»C</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">  <span class="type">int</span> cnt_c;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">D</span>: <span class="keyword">public</span> B, <span class="keyword">public</span> C&#123; <span class="comment">//æ´¾ç”Ÿç±»D</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">set_a</span><span class="params">(<span class="type">int</span> i)</span></span>&#123; cnt = i; &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">set_b</span><span class="params">(<span class="type">int</span> i)</span></span>&#123; cnt_b = i; &#125; </span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">set_c</span><span class="params">(<span class="type">int</span> i)</span></span>&#123; cnt_c = i; &#125; </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  D d;</span><br><span class="line">  d.<span class="built_in">set_a</span>(<span class="number">3</span>);  <span class="comment">//æŠ¥é”™ï¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è§£å†³è±å½¢ç»§æ‰¿çš„äºŒä¹‰æ€§é—®é¢˜ï¼Œä¸€ç§æ–¹å¼æ˜¯ç›´æ¥ä½¿ç”¨::Bæˆ–::Cï¼Œå¼ºåˆ¶ç¼–è¯‘å™¨ä½¿ç”¨æ¥è‡ªæŸä¸ªåŸºç±»çš„å±æ€§ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;           <span class="comment">//é—´æ¥åŸºç±»A</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="type">int</span> cnt;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>: <span class="keyword">public</span> A&#123; <span class="comment">//ç›´æ¥åŸºç±»B</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="type">int</span> cnt_b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>: <span class="keyword">public</span> A&#123; <span class="comment">//ç›´æ¥åŸºç±»C</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="type">int</span> cnt_c;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">D</span>: <span class="keyword">public</span> B, <span class="keyword">public</span> C&#123; <span class="comment">//æ´¾ç”Ÿç±»D</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  D d;</span><br><span class="line">  d.B::cnt = <span class="number">3</span>; <span class="comment">//å¼ºåˆ¶æŒ‡å®šä½¿ç”¨å“ªä¸ªåŸºç±»çš„cntå±æ€§ï¼Œè§„é¿äºŒä¹‰æ€§</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ä¸Šé¢çš„æ–¹æ¡ˆä¸èƒ½æ ¹æ²»è±å½¢ç»§æ‰¿çš„é—®é¢˜ï¼Œå› ä¸ºå±æ€§åœ¨ç±»Dä¸­æœ¬å°±åº”è¯¥åªæœ‰ä¸€ä¸ªã€‚æ›´æœ‰æ•ˆæ–¹æ¡ˆæ˜¯åˆ©ç”¨<strong>è™šç»§æ‰¿</strong>ã€‚è™šç»§æ‰¿ä¼šä½¿å¾—æ´¾ç”Ÿç±»ä¸­åªä¿ç•™ä¸€ä»½æ¥è‡ªé—´æ¥åŸºç±»çš„å±æ€§ï¼Œæœ‰æ•ˆé˜²æ­¢äºŒä¹‰æ€§é—®é¢˜ã€‚æ­¤æ—¶çš„é—´æ¥åŸºç±»Aï¼Œè¢«ç§°ä¸ºè™šåŸºç±»ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;                     <span class="comment">//é—´æ¥åŸºç±»A</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">  <span class="type">int</span> cnt;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>: <span class="keyword">virtual</span> <span class="keyword">public</span> A&#123;   <span class="comment">//è™šç»§æ‰¿ï¼Œç›´æ¥åŸºç±»B</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">  <span class="type">int</span> cnt_b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>: <span class="keyword">virtual</span> <span class="keyword">public</span> A&#123;   <span class="comment">//è™šç»§æ‰¿ï¼Œç›´æ¥åŸºç±»C</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">  <span class="type">int</span> cnt_c;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">D</span>: <span class="keyword">public</span> B, <span class="keyword">public</span> C&#123; <span class="comment">//æ´¾ç”Ÿç±»D</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">set_a</span><span class="params">(<span class="type">int</span> i)</span></span>&#123; cnt = i; &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">set_b</span><span class="params">(<span class="type">int</span> i)</span></span>&#123; cnt_b = i; &#125; </span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">set_c</span><span class="params">(<span class="type">int</span> i)</span></span>&#123; cnt_c = i; &#125; </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  D d;</span><br><span class="line">  d.<span class="built_in">set_a</span>(<span class="number">3</span>);  <span class="comment">//æ­£ç¡®ï¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ‡å‡†åº“ä¸­ä¹Ÿæœ‰åˆ©ç”¨è™šç»§æ‰¿è§£å†³è±å½¢ç»§æ‰¿é—®é¢˜çš„æ¡ˆä¾‹ã€‚å¦‚iostreamç±»åŒæ—¶ç»§æ‰¿äº†istreamç±»å’Œostreamç±»ï¼Œè€Œistreamå’Œostreaméƒ½ç»§æ‰¿äº†base_iosç±»ã€‚æ­¤æ—¶istreamå’Œostreamå¿…é¡»è™šç»§æ‰¿base_iosï¼Œå¦åˆ™ä¼šå¯¼è‡´iostreamç±»ä¸­åŒ…å«ä¸¤ä»½æ¥è‡ªbase_iosçš„å±æ€§ï¼Œå¯¼è‡´äºŒä¹‰æ€§ã€‚</p>
<h4 id="RAIIï¼šèµ„æºè·å–å³åˆå§‹åŒ–"><a href="#RAIIï¼šèµ„æºè·å–å³åˆå§‹åŒ–" class="headerlink" title="RAIIï¼šèµ„æºè·å–å³åˆå§‹åŒ–"></a>RAIIï¼šèµ„æºè·å–å³åˆå§‹åŒ–</h4><blockquote>
<p>Resource Acquisition is Initialization</p>
</blockquote>
<p>RAIIä¸»è¦åˆ©ç”¨<strong>å¯¹è±¡ç¦»å¼€ä½œç”¨åŸŸä¼šè‡ªåŠ¨è°ƒç”¨ææ„å‡½æ•°</strong>çš„ç‰¹æ€§ï¼Œåœ¨è®¾è®¡ä¸€ä¸ªç±»æ—¶ï¼Œäºæ„é€ å‡½æ•°ç”³è¯·èµ„æºï¼Œåœ¨ææ„å‡½æ•°é‡Šæ”¾èµ„æºï¼Œå³å¯é¿å…å†…å­˜æ³„éœ²é—®é¢˜ï¼Œå¹¶å°†ç¨‹åºå‘˜ä»å†…å­˜ç®¡ç†çš„æ³¥æ½­ä¸­é‡Šæ”¾å‡ºæ¥ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CTest</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">CTest</span>()&#123;</span><br><span class="line">    m_pInt = <span class="keyword">new</span> <span class="type">int</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  ~<span class="built_in">CTest</span>()&#123;</span><br><span class="line">    <span class="keyword">if</span>( m_pInt != <span class="literal">nullptr</span> )</span><br><span class="line">      <span class="keyword">delete</span> m_pInt;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">int</span>* m_pInt;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="å¯¹è±¡éšå¼é”€æ¯"><a href="#å¯¹è±¡éšå¼é”€æ¯" class="headerlink" title="å¯¹è±¡éšå¼é”€æ¯"></a>å¯¹è±¡éšå¼é”€æ¯</h4><p>è€ƒè™‘è¿™æ ·çš„å‡½æ•°ï¼Œ<code>user()</code>å‡½æ•°åœ¨é€€å‡ºå‰ä¼šdeleteæ‰æ‰€æœ‰çš„Shapeï¼Œ<code>delete</code>è¿ç®—ç¬¦ä¾èµ–äºShapeçš„ææ„å‡½æ•°ï¼Œè€Œè¯¥å‡½æ•°æ˜¯è™šå‡½æ•°ï¼Œæ‰€ä»¥<code>delete</code>ä¼šè°ƒç”¨æœ€ç»ˆçš„æ´¾ç”Ÿç±»çš„ææ„å‡½æ•°ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">user</span><span class="params">()</span></span>&#123;</span><br><span class="line">  std::vector&lt;Shape*&gt; v;</span><br><span class="line">  <span class="keyword">while</span>(cin)</span><br><span class="line">    v.<span class="built_in">push_back</span>(<span class="built_in">read_shape</span>(cin));</span><br><span class="line">  <span class="built_in">draw_all</span>(v);</span><br><span class="line">  <span class="built_in">rotate_all</span>(v,<span class="number">45</span>);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">auto</span> p : v)    <span class="comment">//æœ€ååˆ é™¤å…ƒç´ </span></span><br><span class="line">    <span class="keyword">delete</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯â€œæ˜¾å¼â€åœ°é”€æ¯å¯¹è±¡ã€‚ç„¶è€Œè‹¥å¯¹æ‰€æœ‰å‡½æ•°éƒ½æ‰§è¡Œè¿™æ ·çš„æ˜¾å¼æ“ä½œçš„è¯ï¼Œå¯èƒ½æ€»æœ‰æ¼ç½‘ä¹‹é±¼ã€‚è§£å†³æ–¹æ¡ˆä¾¿æ˜¯â€œéšå¼â€å¯¹è±¡é”€æ¯ï¼Œè®©ç¼–è¯‘å™¨è‡ªå·±æ¥åšdeleteæ“ä½œã€‚</p>
<p>å¯¹è±¡è‹¥è¦éšå¼é”€æ¯ï¼Œéœ€è¦é¿å…â€œè£¸æŒ‡é’ˆâ€ï¼Œè€Œæ˜¯å°½é‡ç”¨æ™ºèƒ½æŒ‡é’ˆ<code>unique_ptr</code>ï¼Œæ­¤æ—¶å¯ä»¥ä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum class</span> <span class="title class_">Kind</span> &#123; Circle, triangle, smiley &#125;;</span><br><span class="line"><span class="function">unique_ptr&lt;Shape&gt; <span class="title">read_shape</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="comment">//...ä»isä¸­è¯»å–æè¿°ä¿¡æ¯ï¼Œæ‰¾åˆ°å¯¹åº”å½¢çŠ¶ç§ç±»</span></span><br><span class="line">  <span class="keyword">switch</span>(k)&#123;</span><br><span class="line">    <span class="keyword">case</span> Kind::circle:</span><br><span class="line">      <span class="keyword">return</span> unique_ptr&lt;Shape&gt;&#123;<span class="keyword">new</span> Circle&#123;p,r&#125;&#125;;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">user</span><span class="params">()</span></span>&#123;</span><br><span class="line">  vector&lt;unique_ptr&lt;Shape&gt;&gt; v;</span><br><span class="line">  <span class="keyword">while</span>(cin)</span><br><span class="line">    v.<span class="built_in">push_back</span>(<span class="built_in">read_shape</span>(cin));</span><br><span class="line">  <span class="built_in">draw_all</span>(v);</span><br><span class="line">  <span class="built_in">rotate_all</span>(v,<span class="number">45</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹è±¡ç”±<code>unique_ptr</code>æ‹¥æœ‰ï¼Œå½“å¯¹è±¡ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œ<code>unique_ptr</code>å°†é‡Šæ”¾æ‰æ‰€æŒ‡çš„å¯¹è±¡ã€‚</p>
<h4 id="å‹å…ƒå‡½æ•°-amp-å‹å…ƒç±»"><a href="#å‹å…ƒå‡½æ•°-amp-å‹å…ƒç±»" class="headerlink" title="å‹å…ƒå‡½æ•°&amp;å‹å…ƒç±»"></a>å‹å…ƒå‡½æ•°&amp;å‹å…ƒç±»</h4><ul>
<li><p>æ™®é€šå‹å…ƒå‡½æ•°</p>
<p>çªç ´ç±»å†…æˆå‘˜è®¿é—®æƒé™çš„é™åˆ¶ï¼Œä½¿å¾—å¤–éƒ¨çš„å‡½æ•°ä»èƒ½è®¿é—®åˆ°ç±»å†…çš„ç§æœ‰æˆå‘˜ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">A</span>()&#123;&#125;;</span><br><span class="line">  ~<span class="built_in">A</span>()&#123;&#125;;</span><br><span class="line">  <span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">foo</span><span class="params">()</span></span>; <span class="comment">//å£°æ˜fooå‡½æ•°æ˜¯ç±»Açš„å¥½æœ‹å‹</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">int</span> m_data;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span></span>&#123;</span><br><span class="line">  A aObj;</span><br><span class="line">  aObj.m_data = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å‹å…ƒæˆå‘˜å‡½æ•°</p>
<p>ä»¤ç±»Bçš„æˆå‘˜å‡½æ•°æœ‰æƒé™è®¿é—®ç±»Açš„ç§æœ‰æˆå‘˜ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">B</span>()&#123;&#125;;</span><br><span class="line">  ~<span class="built_in">B</span>()&#123;&#125;;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">A</span>()&#123;&#125;;</span><br><span class="line">  ~<span class="built_in">A</span>()&#123;&#125;;</span><br><span class="line">  <span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">B::foo</span><span class="params">()</span></span>; <span class="comment">//å£°æ˜ç±»Bçš„fooæˆå‘˜å‡½æ•°æ˜¯ç±»Açš„å¥½æœ‹å‹</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">int</span> m_data;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">B::foo</span><span class="params">()</span></span>&#123;</span><br><span class="line">  A aObj;</span><br><span class="line">  aObj.m_data = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å‹å…ƒç±»</p>
<p>è‹¥ç±»Bæ˜¯ç±»Açš„å‹å…ƒç±»ï¼Œé‚£ä¹ˆç±»Bçš„æ‰€æœ‰æˆå‘˜å‡½æ•°å‡èƒ½è®¿é—®åˆ°ç±»Açš„ç§æœ‰æˆå‘˜ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">B</span>()&#123;&#125;;</span><br><span class="line">  ~<span class="built_in">B</span>()&#123;&#125;;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">A</span>()&#123;&#125;;</span><br><span class="line">  ~<span class="built_in">A</span>()&#123;&#125;;</span><br><span class="line">  <span class="keyword">friend</span> B;          <span class="comment">//å£°æ˜ç±»Bæ˜¯ç±»Açš„å¥½æœ‹å‹</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">int</span> m_data;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">B::foo</span><span class="params">()</span></span>&#123;</span><br><span class="line">  A aObj;</span><br><span class="line">  aObj.m_data = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="è¿ç®—ç¬¦é‡è½½"><a href="#è¿ç®—ç¬¦é‡è½½" class="headerlink" title="è¿ç®—ç¬¦é‡è½½"></a>è¿ç®—ç¬¦é‡è½½</h4><blockquote>
<p>å¯ä»¥é‡è½½çš„è¿ç®—ç¬¦ï¼š<br>+   -   *   &#x2F;   %   ^   &amp;   |   ~   !   &#x3D;   &lt;   &gt;  +&#x3D;  -&#x3D;  *&#x3D;  &#x2F;&#x3D;  %&#x3D;  ^&#x3D;  &amp;&#x3D;  |&#x3D;  &lt;&lt;  &gt;&gt;  &lt;&lt;&#x3D;  &gt;&gt;&#x3D;  &#x3D;&#x3D;  !&#x3D;  &lt;&#x3D;  &gt;&#x3D;<br>&amp;&amp;  ||  ++  â€“  []  ()  -&gt;  ,  new  new[]  delete  delete[]&amp;#x20;</p>
</blockquote>
<ul>
<li><p>ä¸€å…ƒè¿ç®—ç¬¦é‡è½½ï¼š++ã€â€“ã€-ï¼ˆè´Ÿå·ï¼‰ã€!</p>
<p>ä¸€å…ƒè¿ç®—ç¬¦å¾€å¾€ä¸éœ€è¦ä¼ å½¢å‚ï¼Œä¼ å½¢å‚è¯´æ˜æ˜¯åç¼€++æˆ–åç¼€â€“</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Complex</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> i;</span><br><span class="line">    <span class="type">double</span> j;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Complex</span>(<span class="type">int</span> = <span class="number">0</span>, <span class="type">int</span> = <span class="number">0</span>);</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span></span>;</span><br><span class="line">    Complex <span class="keyword">operator</span> ++();<span class="comment">//å‰ç¼€è‡ªå¢</span></span><br><span class="line">    Complex <span class="keyword">operator</span> ++(<span class="type">int</span>);<span class="comment">//åç¼€è‡ªå¢ï¼Œå‚æ•°éœ€è¦åŠ int</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Complex::<span class="built_in">Complex</span>(<span class="type">int</span> a, <span class="type">int</span> b) &#123;</span><br><span class="line">    i = a;</span><br><span class="line">    j = b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Complex::display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; i &lt;&lt; <span class="string">&#x27;+&#x27;</span> &lt;&lt; j &lt;&lt; <span class="string">&#x27;i&#x27;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Complex Complex::<span class="keyword">operator</span> ++() &#123;</span><br><span class="line">    ++i;</span><br><span class="line">    ++j;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line">Complex Complex::<span class="keyword">operator</span> ++(<span class="type">int</span>) &#123;</span><br><span class="line">    Complex temp =*<span class="keyword">this</span>;</span><br><span class="line">    ++*<span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>äºŒå…ƒè¿ç®—ç¬¦é‡è½½ï¼š+ã€-ã€ *ã€&#x2F;</p>
<p>thisæ˜¯å·¦å€¼ï¼Œå½¢å‚æ˜¯å³å€¼ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">test_minus</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">int</span> val1, val2;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">test_minus</span>(<span class="type">int</span> a, <span class="type">int</span> b): <span class="built_in">val1</span>(a), <span class="built_in">val2</span>(b) &#123;&#125;</span><br><span class="line">  test_minus <span class="keyword">operator</span>-(<span class="type">const</span> test_minus&amp; right)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">test_minus</span>(right.val1 - val1, right.val2 - val2);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Print</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; val1 &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; val2 &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="function">test_minus <span class="title">a</span><span class="params">(<span class="number">1</span>, <span class="number">3</span>)</span></span>;</span><br><span class="line">  <span class="function">test_minus <span class="title">b</span><span class="params">(<span class="number">2</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">  test_minus c = a - b;</span><br><span class="line">  c.<span class="built_in">Print</span>();            <span class="comment">//è¾“å‡º 1 -3</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>è¿˜å¯ä»¥å‹å…ƒå‡½æ•°çš„æ–¹å¼é‡è½½ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">test_minus</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">int</span> val1, val2;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">test_minus</span>(<span class="type">int</span> a, <span class="type">int</span> b): <span class="built_in">val1</span>(a), <span class="built_in">val2</span>(b) &#123;&#125;</span><br><span class="line">  <span class="keyword">friend</span> test_minus <span class="keyword">operator</span>- (<span class="type">const</span> test_minus&amp;, <span class="type">const</span> test_minus&amp;); <span class="comment">//å‹å…ƒå‡½æ•°</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Print</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; val1 &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; val2 &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">test_minus <span class="keyword">operator</span>-(<span class="type">const</span> test_minus&amp; left, <span class="type">const</span> test_minus&amp; right)&#123;<span class="comment">//å‹å…ƒå‡½æ•°è¿ç®—ç¬¦é‡è½½</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">test_minus</span>(right.val1 - left.val1, right.val2 - left.val2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="function">test_minus <span class="title">a</span><span class="params">(<span class="number">1</span>,<span class="number">3</span>)</span></span>;</span><br><span class="line">  <span class="function">test_minus <span class="title">b</span><span class="params">(<span class="number">2</span>,<span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">  test_minus c = a-b;</span><br><span class="line">  c.<span class="built_in">Print</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>å…³ç³»è¿ç®—ç¬¦é‡è½½ï¼š&lt;ã€&gt;ã€&lt;&#x3D;ã€&gt;&#x3D;ã€&#x3D;&#x3D;ã€!&#x3D;</p>
<p>å’ŒäºŒå…ƒè¿ç®—ç¬¦ä¸€æ ·ï¼Œthisæ˜¯å·¦å€¼ï¼Œå½¢å‚æ˜¯å³å€¼ã€‚å¯ä»¥åœ¨å½¢å‚åŠ ä¸Šconstä»¥è§„é¿ä¿®æ”¹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Distance</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> feet;</span><br><span class="line">    <span class="type">int</span> inches;</span><br><span class="line"><span class="keyword">public</span>:    </span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt;(<span class="type">const</span> Distance&amp; d)</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="keyword">if</span>(feet &lt; d.feet)</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">       <span class="keyword">if</span>(feet == d.feet &amp;&amp; inches &lt; d.inches)</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">       <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æµè¿ç®—ç¬¦é‡è½½ï¼š&lt;&lt;ã€&gt;&gt;</p>
<p>è§â€œI&#x2F;Oæµâ€ç« ï¼Œéœ€è¦æ³¨æ„åŒºåˆ†ä¸€å…ƒè¿ç®—ç¬¦ä¸­çš„å·¦ç§»å³ç§»ã€‚</p>
</li>
<li><p>èµ‹å€¼è¿ç®—ç¬¦é‡è½½ï¼š&#x3D;</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Distance</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">private</span>:</span><br><span class="line">      <span class="type">int</span> feet;             <span class="comment">// 0 åˆ°æ— ç©·</span></span><br><span class="line">      <span class="type">int</span> inches;           <span class="comment">// 0 åˆ° 12</span></span><br><span class="line">   <span class="keyword">public</span>:</span><br><span class="line">      <span class="type">void</span> <span class="keyword">operator</span>=(<span class="type">const</span> Distance &amp;D )</span><br><span class="line">      &#123; </span><br><span class="line">         feet = D.feet;</span><br><span class="line">         inches = D.inches;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦é‡è½½ï¼š()</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Distance</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">private</span>:</span><br><span class="line">      <span class="type">int</span> feet;             <span class="comment">// 0 åˆ°æ— ç©·</span></span><br><span class="line">      <span class="type">int</span> inches;           <span class="comment">// 0 åˆ° 12</span></span><br><span class="line">   <span class="keyword">public</span>:</span><br><span class="line">      <span class="built_in">Distance</span>(<span class="type">int</span> f, <span class="type">int</span> i)&#123;</span><br><span class="line">         feet = f;</span><br><span class="line">         inches = i;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// é‡è½½å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦</span></span><br><span class="line">      <span class="function">Distance <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function">      </span>&#123;</span><br><span class="line">         Distance D;</span><br><span class="line">         <span class="comment">// è¿›è¡Œéšæœºè®¡ç®—</span></span><br><span class="line">         D.feet = a + c + <span class="number">10</span>;</span><br><span class="line">         D.inches = b + c + <span class="number">100</span> ;</span><br><span class="line">         <span class="keyword">return</span> D;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="function">Distance <span class="title">D1</span><span class="params">(<span class="number">11</span>, <span class="number">10</span>)</span>, D2</span>;</span><br><span class="line"></span><br><span class="line">   D2 = <span class="built_in">D1</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>); <span class="comment">// invoke operator()</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸‹æ ‡è¿ç®—ç¬¦é‡è½½ï¼š[]</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> SIZE = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">safearay</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">private</span>:</span><br><span class="line">      <span class="type">int</span> arr[SIZE];</span><br><span class="line">   <span class="keyword">public</span>:</span><br><span class="line">      <span class="built_in">safearay</span>() </span><br><span class="line">      &#123;</span><br><span class="line">         <span class="keyword">register</span> <span class="type">int</span> i;</span><br><span class="line">         <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; SIZE; i++)</span><br><span class="line">         &#123;</span><br><span class="line">           arr[i] = i;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">int</span>&amp; <span class="keyword">operator</span>[](<span class="type">int</span> i)</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">if</span>( i &gt;= SIZE )</span><br><span class="line">          &#123;</span><br><span class="line">              cout &lt;&lt; <span class="string">&quot;ç´¢å¼•è¶…è¿‡æœ€å¤§å€¼&quot;</span> &lt;&lt;endl; </span><br><span class="line">              <span class="comment">// è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">              <span class="keyword">return</span> arr[<span class="number">0</span>];</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> arr[i];</span><br><span class="line">      &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   safearay A;</span><br><span class="line"></span><br><span class="line">   cout &lt;&lt; <span class="string">&quot;A[2] çš„å€¼ä¸º : &quot;</span> &lt;&lt; A[<span class="number">2</span>] &lt;&lt;endl;</span><br><span class="line">   cout &lt;&lt; <span class="string">&quot;A[5] çš„å€¼ä¸º : &quot;</span> &lt;&lt; A[<span class="number">5</span>]&lt;&lt;endl;</span><br><span class="line">   cout &lt;&lt; <span class="string">&quot;A[12] çš„å€¼ä¸º : &quot;</span> &lt;&lt; A[<span class="number">12</span>]&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ“ŒC++çš„registerå…³é”®å­—ä½œç”¨æ˜¯ï¼Œå»ºè®®ç¼–è¯‘å™¨ä½¿ç”¨CPUå¯„å­˜å™¨æ¥å­˜å‚¨å˜é‡ï¼Œæ—¨åœ¨æé«˜è®¿é—®å˜é‡çš„é€Ÿåº¦</p>
</blockquote>
</li>
<li><p>ç±»æˆå‘˜è®¿é—®è¿ç®—ç¬¦é‡è½½ï¼š-&gt; å’Œ è§£å¼•ç”¨è¿ç®—ç¬¦ï¼š*</p>
</li>
</ul>
<p>æˆå‘˜è®¿é—®-&gt;å’Œè§£å¼•ç”¨*çš„é‡è½½éƒ½åªèƒ½ç”±å¯¹è±¡ä½¿ç”¨ï¼Œè€Œä¸èƒ½ç”±æŒ‡é’ˆä½¿ç”¨ï¼Œå› æ­¤ï¼Œå‡ºç°<code>pointer-&gt;mem;</code>æ—¶ï¼Œå¯èƒ½æœ‰ä¸¤ç§æƒ…å†µï¼š</p>
<ol>
<li><p>æŒ‡é’ˆï¼ŒåŸåŸæœ¬æœ¬çš„æˆå‘˜è®¿é—®å’Œè§£å¼•ç”¨åŠŸèƒ½ï¼šmemå°±æ˜¯æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ï¼Œæ‰€å±ç±»å‹çš„æˆå‘˜</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">pointer-&gt;mem;</span><br><span class="line"><span class="comment">//ç­‰ä»·äº   (*pointer).mem;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯¹è±¡ï¼Œè°ƒç”¨çš„é‡è½½çš„è¿ç®—ç¬¦ï¼šmemä¸ä¸€å®šæ˜¯pointeræ‰€å±ç±»å‹çš„æˆå‘˜ï¼Œå¯èƒ½æ˜¯å…¶å®ƒç±»å‹çš„</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">pointer.<span class="built_in">operator</span>()-&gt;mem;</span><br><span class="line"><span class="comment">//ç­‰ä»·äº   (pointer.operator*()).mem;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>é‡è½½æ—¶ï¼Œä¸€èˆ¬è¦æ±‚è§£å¼•ç”¨*é‡è½½ï¼Œè¿”å›å¼•ç”¨ï¼Œè¦æ±‚æˆå‘˜è®¿é—®-&gt;é‡è½½ï¼Œè¿”å›æŒ‡é’ˆã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">test_arrow_1</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="type">int</span> val1, val2;</span><br><span class="line">  <span class="built_in">test_arrow_1</span>(<span class="type">int</span> a, <span class="type">int</span> b) : <span class="built_in">val1</span>(a), <span class="built_in">val2</span>(b) &#123;&#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Print1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; val1 &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; val2 &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">test_arrow_2</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">int</span> val3, val4, val5;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  test_arrow_1* val6;</span><br><span class="line">  <span class="built_in">test_arrow_2</span>(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c, <span class="type">int</span> d, <span class="type">int</span> e) </span><br><span class="line">    : <span class="built_in">val6</span>(<span class="keyword">new</span> <span class="built_in">test_arrow_1</span>(a,b)), <span class="built_in">val3</span>(c), <span class="built_in">val4</span>(d), <span class="built_in">val5</span>(e) &#123;&#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Print2</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; val6-&gt;val1 &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; val6-&gt;val2 &lt;&lt; <span class="string">&#x27; &#x27;</span> </span><br><span class="line">         &lt;&lt; val3 &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; val4 &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; val5 &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  test_arrow_1&amp; <span class="keyword">operator</span>*() <span class="type">const</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (*val6);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  test_arrow_1* <span class="keyword">operator</span>-&gt;() <span class="type">const</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> val6;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="function">test_arrow_2 <span class="title">t1</span><span class="params">(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</span></span>;</span><br><span class="line">  t1-&gt;val1 = <span class="number">6</span>;</span><br><span class="line">  t1-&gt;<span class="built_in">Print1</span>();</span><br><span class="line">  t1.<span class="built_in">Print2</span>();</span><br><span class="line"></span><br><span class="line">  (*t1).val2 = <span class="number">7</span>;</span><br><span class="line">  t1.<span class="built_in">Print2</span>();</span><br><span class="line"></span><br><span class="line">  test_arrow_2* t2 = <span class="keyword">new</span> <span class="built_in">test_arrow_2</span>(<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>);</span><br><span class="line">  t2-&gt;<span class="built_in">Print2</span>();</span><br><span class="line">  (*t2).<span class="built_in">Print2</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>å¯¹è±¡è°ƒç”¨</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="function">test_arrow_2 <span class="title">t1</span><span class="params">(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</span></span>;</span><br><span class="line">  t1-&gt;val1 = <span class="number">6</span>;</span><br><span class="line">  t1-&gt;<span class="built_in">Print1</span>();</span><br><span class="line">  t1.<span class="built_in">Print2</span>();</span><br><span class="line"></span><br><span class="line">  (*t1).val2 = <span class="number">7</span>;</span><br><span class="line">  t1.<span class="built_in">Print2</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>t1æ˜¯é‡è½½äº†*å’Œ-&gt;çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯æŒ‡é’ˆï¼Œå› æ­¤ï¼Œå½“t1è°ƒç”¨*t1å’Œt1-&gt;æ—¶ï¼Œä¼šä½¿ç”¨é‡è½½çš„è¿ç®—ç¬¦å‡½æ•°ã€‚</p>
<p>å› æ­¤t1-&gt;å¯ä»¥ä½¿ç”¨å±äº<code>test_arrow_1</code>ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œ</p>
<p>(*t1)ä¹Ÿå¯ä»¥ä½¿ç”¨å±äºæ”¹ç±»çš„å±æ€§å’Œæ–¹æ³•ã€‚è€Œâ€œç‚¹è¿ç®—ç¬¦â€ä»ç„¶åªèƒ½ä½¿ç”¨<code>test_arrow_2</code>ç±»çš„ã€‚</p>
<ul>
<li>æŒ‡é’ˆè°ƒç”¨</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">test_arrow_2* t2 = &amp;t1;</span><br><span class="line">t2-&gt;<span class="built_in">Print2</span>();</span><br><span class="line">(*t2).<span class="built_in">Print2</span>();</span><br></pre></td></tr></table></figure>

<p>t2æ˜¯æŒ‡é’ˆï¼Œå› æ­¤è°ƒç”¨*å’Œ-&gt;æ—¶ï¼Œä¸èƒ½å†è°ƒç”¨é‡è½½çš„è¿ç®—ç¬¦å‡½æ•°ï¼Œè€Œæ˜¯å’Œå¹³æ—¶çš„æ“ä½œæ— å¼‚ã€‚å› æ­¤t2-&gt;åªèƒ½ä½¿ç”¨<code>test_arrow_2</code>çš„å±æ€§å’Œæ–¹æ³•ï¼Œè€Œä¸”(*t2)ä¹Ÿåªèƒ½ä½¿ç”¨<code>test_arrow_2</code>çš„ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè§£å¼•ç”¨è¿ç®—ç¬¦ *ï¼Œå¯ä»¥è‡ªå®šä¹‰ä»»ä½•é€»è¾‘ï¼Œä¸Šé¢çš„ä»£ç ä¸­ï¼Œä¹Ÿå¯ä»¥è®©è§£å¼•ç”¨çš„é‡è½½è¿”å›ä¸€ä¸ªintå¸¸æ•°ã€‚</p>
<p>ä½†æ˜¯æˆå‘˜è®¿é—®è¿ç®—ç¬¦æ— è®ºæ€ä¹ˆæ”¹ï¼Œéƒ½<strong>å¿…é¡»ä¿ç•™æˆå‘˜è®¿é—®çš„åŠŸèƒ½</strong>ï¼Œè™½ç„¶å¯èƒ½ä¸å†æ˜¯å½“å‰ç±»çš„æˆå‘˜äº†ã€‚</p>
<blockquote>
<p>ğŸ“Œå–åœ°å€ç¬¦&amp;ä¹Ÿå¯ä»¥é‡è½½ï¼Œä½†ä¸€èˆ¬ä¸éœ€è¦æ‰‹åŠ¨é‡è½½ï¼Œç±»ä¼šé»˜è®¤ç”Ÿæˆ&amp;å’Œ&amp; const</p>
</blockquote>
<h4 id="ç±»ç±»å‹è½¬æ¢ï¼ˆç‰¹æ®Šè¿ç®—ç¬¦é‡è½½ï¼‰"><a href="#ç±»ç±»å‹è½¬æ¢ï¼ˆç‰¹æ®Šè¿ç®—ç¬¦é‡è½½ï¼‰" class="headerlink" title="ç±»ç±»å‹è½¬æ¢ï¼ˆç‰¹æ®Šè¿ç®—ç¬¦é‡è½½ï¼‰"></a>ç±»ç±»å‹è½¬æ¢ï¼ˆç‰¹æ®Šè¿ç®—ç¬¦é‡è½½ï¼‰</h4><p><strong>ç±»å‹è½¬æ¢è¿ç®—ç¬¦</strong>ï¼Œè´Ÿè´£å°†ä¸€ä¸ªç±»çš„ç±»å‹è½¬æ¢æˆå…¶ä»–ç±»å‹ï¼š<code>operator type() const;</code>ï¼Œç”±äºå…¶é€šå¸¸ä¸åº”è¯¥æ”¹å˜å¾…è½¬æ¢å¯¹è±¡çš„å†…å®¹ï¼Œå› æ­¤ï¼Œä¸€èˆ¬è¢«å®šä¹‰ä¸ºconstæˆå‘˜ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SmallInt</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">SmallInt</span>(<span class="type">int</span> i = <span class="number">0</span>):<span class="built_in">val</span>(i)&#123;</span><br><span class="line">    <span class="keyword">if</span>(i &lt; <span class="number">0</span> || i &gt; <span class="number">255</span>)</span><br><span class="line">      <span class="keyword">throw</span> std::<span class="built_in">out_of_range</span>(<span class="string">&quot;Bad SmallInt value&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">operator</span> <span class="title">int</span><span class="params">()</span> <span class="type">const</span> </span>&#123;&#125;;          <span class="comment">//ç±»å‹è½¬æ¢è¿ç®—ç¬¦</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  std::<span class="type">size_t</span> val;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡ŒSmallIntç±»ä¸­å®šä¹‰äº†å‘intç±»å‹çš„è½¬æ¢ç¬¦ï¼Œå› æ­¤ï¼Œå¯ä»¥æ˜¾å¼&#x2F;<strong>éšå¼</strong>çš„å°†SmallIntå¯¹è±¡è½¬æ¢æˆintç±»å‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">SmallInt si;</span><br><span class="line">si = <span class="number">4</span>; <span class="comment">// é¦–å…ˆå°†4éšå¼è½¬æ¢æˆSmallIntï¼Œç„¶åè°ƒç”¨SmallInt operator=</span></span><br><span class="line">si + <span class="number">3</span>; <span class="comment">// é¦–å…ˆå°†siéšå¼è½¬æ¢æˆintï¼Œç„¶åæ‰§è¡Œæ•´æ•°çš„åŠ æ³•</span></span><br></pre></td></tr></table></figure>

<p>é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœè½¬æ¢åçš„ç±»å‹åˆæœ‰å…¶å®ƒå†…ç½®è½¬æ¢æ–¹æ¡ˆï¼Œå®é™…æƒ…å†µä¸­ï¼Œä¹Ÿå¯ä»¥å‡ºç°è½¬æ¢ä¼ é€’çš„æƒ…å†µã€‚æ¯”å¦‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">SmallInt si = <span class="number">3.14</span>; <span class="comment">// è°ƒç”¨SmallInt(int)æ„é€ å‡½æ•°</span></span><br><span class="line">si + <span class="number">3.14</span>;          <span class="comment">// SmallIntç±»å‹è½¬æ¢æˆintï¼Œintåˆç»§ç»­éšå¼è½¬æ¢æˆdouble</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ“Œä¸€ä¸ªç±»å‹è½¬æ¢å‡½æ•°å¿…é¡»æ˜¯ç±»çš„æˆå‘˜å‡½æ•°ã€‚<br><strong>ä¸èƒ½å£°æ˜è¿”å›ç±»å‹ï¼</strong>ï¼ˆå…¶åå­—å°±å·²è¯´æ˜è¿”å›ï¼‰<br><strong>å½¢å‚åˆ—è¡¨å¿…é¡»ä¸ºç©ºï¼****é€šå¸¸åº”è¯¥ä¸ºconstï¼</strong></p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SmallInt</span>;</span><br><span class="line"><span class="function"><span class="keyword">operator</span> <span class="title">int</span><span class="params">(SmallInt&amp;)</span></span>;            <span class="comment">//é”™,ä¸æ˜¯æˆå‘˜å‡½æ•°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SmallInt</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="keyword">operator</span> <span class="title">int</span><span class="params">()</span> <span class="type">const</span></span>;         <span class="comment">//é”™,æœ‰è¿”å›ç±»å‹</span></span><br><span class="line">  <span class="function"><span class="keyword">operator</span> <span class="title">int</span><span class="params">(<span class="type">int</span>=<span class="number">0</span>)</span> <span class="type">const</span></span>;        <span class="comment">//é”™,æœ‰å½¢å‚</span></span><br><span class="line">  <span class="keyword">operator</span> <span class="type">int</span>*() <span class="type">const</span> &#123;<span class="keyword">return</span> <span class="number">42</span>;&#125;<span class="comment">//é”™,42ä¸æ˜¯ä¸€ä¸ªæŒ‡é’ˆ</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>è€ç‰ˆæœ¬C++ï¼Œç±»å‹è½¬æ¢è¿ç®—ç¬¦çš„ä¸è¶³ï¼š</p>
<p>æ—©æœŸç‰ˆæœ¬C++ä¸­ï¼Œç±»ä¸­å®šä¹‰ä¸€ä¸ªå‘boolè½¬æ¢çš„ç±»å‹è½¬æ¢è¿ç®—ç¬¦ï¼Œæ˜¯æ¯”è¾ƒæ™®éçš„ã€‚æ¯”å¦‚ç»å¸¸ç”¨çš„<code>while(cin&gt;&gt;i)</code>å°±æ˜¯cinä¸­å†…ç½®äº†ä¸€ä¸ªoperator bool( )ã€‚ç„¶è€Œï¼Œè¿™æ ·ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„æ•ˆæœï¼Œæ¯”å¦‚ä¸‹é¢çš„è¯­å¥ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> i = <span class="number">42</span>;</span><br><span class="line">cin &lt;&lt; i;</span><br></pre></td></tr></table></figure>

<p>æµè¿ç®—ç¬¦&lt;&lt;æ˜¯coutç‰¹æœ‰çš„ï¼Œistreamæœ¬èº«æ²¡æœ‰å®šä¹‰&lt;&lt;ï¼Œæ‰€ä»¥è¿™æ®µä»£ç æœ¬åº”æŠ¥é”™ã€‚ç„¶è€Œï¼Œistreamå†…ç½®äº†boolç±»å‹è½¬æ¢ï¼Œç”±æ­¤å°†cinè½¬æ¢æˆäº†boolï¼Œæ¥ç€boolä¼šè¢«æå‡ä¸ºintï¼Œåé¢çš„&lt;&lt;æˆä¸ºäº†å·¦ç§»è¿ç®—ç¬¦ã€‚å› æ­¤ï¼Œè¿™æ®µä»£ç ä¸ä¼šæŠ¥é”™ï¼Œè¿˜ä¼šå‡ºç°ä¸é¢„æœŸå¤§ç›¸å¾„åº­çš„ç»“æœã€‚</p>
</li>
<li><p>C++11å¸¦æ¥çš„è§£å†³æ–¹æ¡ˆï¼š<strong>æ˜¾å¼çš„ç±»å‹è½¬æ¢è¿ç®—ç¬¦</strong></p>
<p>ä¸ºäº†é˜²æ­¢ä¸Šé¢ç°è±¡çš„å‘ç”Ÿï¼ŒC++å¼•å…¥äº†è§£å†³æ–¹æ¡ˆï¼šexplicit operator type()ï¼Œå³<strong>é€šè¿‡explicitå…³é”®å­—</strong>ï¼Œ<strong>è¦æ±‚æ˜¾å¼è½¬æ¢</strong></p>
<p>æ¯”å¦‚ä¸‹é¢ä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SmallInt</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">SmallInt</span>(<span class="type">int</span> i = <span class="number">0</span>):<span class="built_in">val</span>(i)&#123;</span><br><span class="line">    <span class="keyword">if</span>(i &lt; <span class="number">0</span> || i &gt; <span class="number">255</span>)</span><br><span class="line">      <span class="keyword">throw</span> std::<span class="built_in">out_of_range</span>(<span class="string">&quot;Bad SmallInt value&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">explicit</span> <span class="keyword">operator</span> <span class="title">int</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> val; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">SmallInt si = <span class="number">3</span>;        <span class="comment">//æ­£ç¡®ï¼šSmallIntçš„æ„é€ å‡½æ•°ä¸æ˜¯æ˜¾å¼çš„</span></span><br><span class="line">si + <span class="number">3</span>;                 <span class="comment">//é”™è¯¯ï¼šæ­¤å¤„éœ€è¦éšå¼çš„ç±»å‹è½¬æ¢ï¼Œä½†ç±»çš„è¿ç®—ç¬¦ä¸æ˜¯æ˜¾å¼çš„</span></span><br><span class="line"><span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(si)+<span class="number">3</span>; <span class="comment">//æ­£ç¡®ï¼šæ˜¾å¼åœ°è¯·æ±‚ç±»å‹è½¬æ¢</span></span><br></pre></td></tr></table></figure>

<p>è¿™ç§è§„å®šè¿˜æ˜¯æœ‰ä¾‹å¤–çš„ï¼Œæ ‡å‡†è§„å®šï¼šå¦‚æœè¡¨è¾¾å¼è¢«ç”¨ä½œäº†æ¡ä»¶ï¼Œåˆ™ç¼–è¯‘å™¨ä¼š<strong>è‡ªåŠ¨</strong>ï¼ˆå³â€œéšå¼â€ï¼‰è¿›è¡Œæ˜¾å¼ç±»å‹è½¬æ¢ï¼Œ</p>
<p>å› æ­¤istreamå†…éƒ¨çš„bool()æˆä¸ºexplicitçš„äº†ï¼Œä½†æ˜¯while(cin&gt;&gt;i)ä¾ç„¶èƒ½ç”¨ï¼Œå› ä¸ºæ˜¯æ¡ä»¶ï¼Œä¼šè‡ªåŠ¨è½¬æˆboolç±»å‹ã€‚</p>
<ul>
<li><p>æˆä¸ºæ¡ä»¶çš„å‡ ä¸ªä½ç½®ï¼š</p>
<p>if, while, doâ€¦while, for</p>
<p>é€»è¾‘è¿ç®—ç¬¦<code>!, ||, &amp;&amp;</code></p>
<p>æ¡ä»¶è¿ç®—ç¬¦<code>? :</code>&amp;#x20;</p>
</li>
</ul>
</li>
<li><p>ç±»ç±»å‹è½¬æ¢å¸¦æ¥çš„äºŒä¹‰æ€§ï¼šï¼ˆè¿™é‡Œçš„ç±»å‹è½¬æ¢ä¸å†å±€é™äºç±»å‹è½¬æ¢è¿ç®—ç¬¦ï¼Œè¿˜åŒ…æ‹¬æ„é€ å‡½æ•°ï¼‰</p>
<p>æœ‰å‡ ç§æƒ…å†µå¯èƒ½ä¼šå¸¦æ¥äºŒä¹‰æ€§ï¼Œå‡ºç°äºŒä¹‰æ€§ä¹‹åä¼šç¼–è¯‘æŠ¥é”™ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¸çŸ¥é“è¯¥ä½¿ç”¨å“ªç§å®ç°æ–¹å¼ã€‚</p>
<ol>
<li><p>ä¸¤ä¸ªç±»æä¾›äº†â€œäº’ç›¸æŒ‡å‘â€çš„ç±»å‹è½¬æ¢ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">B</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span> &#123;</span><br><span class="line">  <span class="built_in">A</span>() = <span class="keyword">default</span>;</span><br><span class="line">  <span class="built_in">A</span>(<span class="type">const</span> B&amp;);           <span class="comment">//æŠŠä¸€ä¸ªBè½¬æ¢ä¸ºA</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">B</span> &#123;</span><br><span class="line">  <span class="function"><span class="keyword">operator</span> <span class="title">A</span><span class="params">()</span> <span class="type">const</span></span>;    <span class="comment">//æŠŠä¸€ä¸ªAè½¬æ¢ä¸ºB</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function">A <span class="title">f</span><span class="params">(<span class="type">const</span> A&amp;)</span></span>;           <span class="comment">//å®šä¹‰ä¸€ä¸ªæ¥æ”¶Açš„å‡½æ•°</span></span><br><span class="line">B b;</span><br><span class="line">A a = <span class="built_in">f</span>(b);              <span class="comment">//äºŒä¹‰æ€§é”™è¯¯ï¼šå«ä¹‰æ˜¯ è°ƒç”¨Bä¸­è½¬æ¢ä¸ºAçš„ç±»å‹è½¬æ¢è¿ç®—ç¬¦ f(b.operator A())</span></span><br><span class="line">                         <span class="comment">//             è¿˜æ˜¯è°ƒç”¨Aä¸­å¯ä»¥æŠŠBç±»å‹è½¬æ¢ä¸ºAçš„æ„é€ å‡½æ•° f(A(b))</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæƒ³æ‰§è¡Œä¸Šé¢çš„è°ƒç”¨ï¼Œå¿…é¡»æ˜¾å¼åœ°è°ƒç”¨ç±»å‹è½¬æ¢è¿ç®—ç¬¦æˆ–è½¬æ¢æ„é€ å‡½æ•°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">A a1 = <span class="built_in">f</span>(b.<span class="keyword">operator</span> <span class="built_in">A</span>()); <span class="comment">//æ­£ç¡®ï¼šä½¿ç”¨Bçš„ç±»å‹è½¬æ¢è¿ç®—ç¬¦</span></span><br><span class="line">A a2 = <span class="built_in">f</span>(<span class="built_in">A</span>(b));           <span class="comment">//æ­£ç¡®ï¼šä½¿ç”¨Açš„æ„é€ å‡½æ•°</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ç±»å®šä¹‰äº†å¤šä¸ªè½¬æ¢è§„åˆ™ï¼š</p>
<p>æœ€å›°æ‰°çš„æƒ…å†µæ˜¯ç±»ä¸­å®šä¹‰äº†å¤šä¸ªå‚æ•°éƒ½æ˜¯ç®—æœ¯ç±»å‹çš„æ„é€ å‡½æ•°ï¼Œæˆ–è€…è½¬æ¢ç›®æ ‡éƒ½æ˜¯ç®—æœ¯ç±»å‹çš„ç±»å‹è½¬æ¢è¿ç®—ç¬¦</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span>&#123;</span><br><span class="line">  <span class="built_in">A</span>(<span class="type">int</span> = <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">A</span>(<span class="type">double</span> = <span class="number">0</span>);</span><br><span class="line">  <span class="function"><span class="keyword">operator</span> <span class="title">int</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">operator</span> <span class="title">double</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f2</span><span class="params">(<span class="type">long</span> <span class="type">double</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">A a;</span><br><span class="line"><span class="built_in">f2</span>(a);    <span class="comment">//äºŒä¹‰æ€§é”™è¯¯ï¼Œä¸çŸ¥é“æ˜¯ f(a.operator int()) è¿˜æ˜¯ f(a.operator double())</span></span><br><span class="line"></span><br><span class="line"><span class="type">long</span> lg;</span><br><span class="line"><span class="function">A <span class="title">a2</span><span class="params">(lg)</span></span>; <span class="comment">//äºŒä¹‰æ€§é”™è¯¯ï¼Œä¸çŸ¥é“æ˜¯ A::A(int) è¿˜æ˜¯ A::A(double)</span></span><br></pre></td></tr></table></figure>

<p>f2çš„è°ƒç”¨ä¸­ï¼Œå“ªä¸ªç±»å‹è½¬æ¢éƒ½æ— æ³•ç²¾ç¡®åŒ¹é…long doubleï¼Œç„¶è€Œå´éƒ½å­˜åœ¨å‘long doubleçš„éšå¼è½¬æ¢ï¼ˆè€Œä¸”è½¬æ¢çº§åˆ«è¿˜ä¸€è‡´ï¼‰ã€‚å› æ­¤å‡ºç°äº†äºŒä¹‰æ€§ã€‚</p>
<blockquote>
<p>ğŸ“ŒC++ primerä¸­å»ºè®®ï¼Œ<br>æœ€å¥½ä¸è¦åˆ›å»ºä¸¤ä¸ªè½¬æ¢æºéƒ½æ˜¯ç®—æœ¯ç±»å‹çš„ç±»å‹è½¬æ¢ï¼<br>æœ€å¥½ä¸è¦åˆ›å»ºä¸¤ä¸ªè½¬æ¢å¯¹è±¡éƒ½æ˜¯ç®—æœ¯ç±»å‹çš„ç±»å‹è½¬æ¢ï¼</p>
</blockquote>
<p>å¦‚æœè¿™ç§æƒ…å†µä¸­ï¼Œè½¬æ¢çº§åˆ«ä¸ä¸€è‡´ï¼Œå°±ä¸å­˜åœ¨äºŒä¹‰æ€§é—®é¢˜ã€‚æ¯”å¦‚ä»shortæå‡åˆ°intï¼Œçº§åˆ«é«˜äºlongåˆ°doubleã€‚</p>
</li>
<li><p>å‡½æ•°é‡è½½è¿‡ç¨‹ä¸­ï¼Œä¸åŒé‡è½½çš„å½¢å‚ï¼Œéƒ½å®šä¹‰äº†åŒä¸€ç§ç±»å‹è½¬æ¢è¿ç®—ç¬¦ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">C</span>&#123;</span><br><span class="line">  <span class="built_in">C</span>(<span class="type">int</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">D</span>&#123;</span><br><span class="line">  <span class="built_in">D</span>(<span class="type">int</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">manip</span><span class="params">(<span class="type">const</span> C&amp;)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">manip</span><span class="params">(<span class="type">const</span> D&amp;)</span></span>;</span><br><span class="line"><span class="built_in">manip</span>(<span class="number">10</span>);     <span class="comment">//äºŒä¹‰æ€§é”™è¯¯ï¼šå«ä¹‰æ˜¯ manip(C(10)) è¿˜æ˜¯ manip(D(10))</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥æ˜¾å¼è°ƒç”¨æ„é€ å‡½æ•°ï¼Œä»¥æ¶ˆé™¤äºŒä¹‰æ€§ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">manip</span>(<span class="built_in">C</span>(<span class="number">10</span>));</span><br></pre></td></tr></table></figure>

<p>ä½†è¿™ç§æƒ…å†µå¹¶æ²¡æœ‰ç»“æŸï¼Œ10å¯ä»¥ç²¾ç¡®åŒ¹é…intï¼Œé‚£ä¹ˆä¸‹é¢çš„ä»£ç æ˜¯å¦å°±æ²¡æœ‰äºŒä¹‰æ€§äº†å‘¢ï¼Ÿ</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">C</span>&#123;</span><br><span class="line">  <span class="built_in">C</span>(<span class="type">int</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">E</span>&#123;</span><br><span class="line">  <span class="built_in">E</span>(<span class="type">double</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">manip</span><span class="params">(<span class="type">const</span> C&amp;)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">manip</span><span class="params">(<span class="type">const</span> E&amp;)</span></span>;</span><br><span class="line"><span class="built_in">manip</span>(<span class="number">10</span>);     <span class="comment">//äºŒä¹‰æ€§é”™è¯¯ï¼šå«ä¹‰æ˜¯ manip(C(10)) è¿˜æ˜¯ manip(E(double(10)))</span></span><br></pre></td></tr></table></figure>

<p>è¿˜æ˜¯ä¼šç¼–è¯‘æŠ¥é”™ï¼Œè¿˜æ˜¯ä¼šæœ‰äºŒä¹‰æ€§ï¼Œè¿™æ˜¯å› ä¸ºåœ¨è°ƒç”¨é‡è½½æ—¶ï¼Œç±»ç±»å‹è½¬æ¢éƒ½æ˜¯æœ€ä½çº§åˆ«çš„åŒ¹é…åº¦ã€‚å³ä½¿intæ¯”doubleæ›´èƒ½åŒ¹é…10ï¼Œä½†æ˜¯ç°åœ¨ä¸æ˜¯intå’Œdoubleçš„æ¯”è¾ƒï¼Œè€Œæ˜¯C(10)ï¼šintâ†’Cï¼Œå’ŒE(double(10))ï¼šintâ†’Eçš„æ¯”è¾ƒï¼Œè€ŒäºŒè€…æ˜¯å¹³çº§çš„ã€‚è€Œä¸”äºŒè€…éƒ½æ˜¯å¯è¡ŒåŒ¹é…ã€‚å› æ­¤å¯¼è‡´äº†äºŒä¹‰æ€§ã€‚</p>
</li>
</ol>
</li>
</ul>
<p>è™½ç„¶ï¼Œç±»å‹è½¬æ¢è¿ç®—ç¬¦å¯ä»¥åœ¨æŸäº›ç¨‹åº¦ä¸Šç®€åŒ–æ“ä½œï¼Œä½†è¿˜æ˜¯è¦æ…ç”¨ï¼Œéå¸¸å®¹æ˜“å‡ºç°äºŒä¹‰æ€§é—®é¢˜ï¼</p>
<h4 id="new-x2F-deleteçš„é‡è½½"><a href="#new-x2F-deleteçš„é‡è½½" class="headerlink" title="new&#x2F;deleteçš„é‡è½½"></a>new&#x2F;deleteçš„é‡è½½</h4><p>new operator&#x2F;delete operatorå°±æ˜¯newå’Œdeleteæ“ä½œç¬¦ï¼Œè€Œoperator new&#x2F;operator deleteæ˜¯å‡½æ•°ã€‚ placement newæ˜¯operator newçš„å…¨å±€é‡è½½ã€‚</p>
<p>newè¿ç®—åˆ†ä¸¤é˜¶æ®µï¼šï¼ˆ1ï¼‰è°ƒç”¨::operator newé…ç½®å†…å­˜ï¼›ï¼ˆ2ï¼‰è°ƒç”¨å¯¹è±¡æ„é€ å‡½æ•°æ„é€ å¯¹è±¡å†…å®¹ã€‚</p>
<p>deleteè¿ç®—åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šï¼ˆ1ï¼‰è°ƒç”¨å¯¹è±¡ææ„å‡½æ•°ï¼›ï¼ˆ2ï¼‰è°ƒç”¨::operator deleteé‡Šæ”¾å†…å­˜ã€‚</p>
<ul>
<li><p>operator newå‡½æ•°</p>
<p>é»˜è®¤çš„::operator newä¸mallocæ— æ˜æ˜¾åŒºåˆ«ã€‚åªåˆ†é…æ‰€è¦æ±‚çš„ç©ºé—´ï¼Œä¸è°ƒç”¨ç›¸å…³å¯¹è±¡çš„æ„é€ å‡½æ•°ã€‚å½“æ— æ³•æ»¡è¶³æ‰€è¦æ±‚åˆ†é…çš„ç©ºé—´æ—¶ï¼Œåˆ™ï¼š</p>
<p>â†’å¦‚æœæœ‰<code>new_handler</code>ï¼Œåˆ™è°ƒç”¨å…¶ï¼Œå¦åˆ™</p>
<p>â†’å¦‚æœå…è®¸æŠ›å‡ºå¼‚å¸¸ï¼ˆå³<code>nothrow</code>å‚æ•°æœªè¢«è®¾ç½®ï¼‰ï¼Œåˆ™æ‰§è¡Œ<code>bad_alloc</code>å¼‚å¸¸ï¼Œå¦åˆ™</p>
<p>â†’è¿”å›0</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ::operator newæ˜¯å¯ä»¥è¢«é‡è½½çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥è‡ªå®šä¹‰operator newçš„è¡Œä¸º</p>
<ul>
<li><p>operator newé‡è½½</p>
<p>é‡è½½æ—¶ï¼Œè¿”å›ç±»å‹å¿…é¡»å£°æ˜ä¸ºvoid*</p>
<p>é‡è½½æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ç±»å‹å¿…é¡»ä¸ºè¡¨è¾¾è¦æ±‚åˆ†é…ç©ºé—´çš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰ï¼Œç±»å‹ä¸ºsize_t</p>
<p>é‡è½½æ—¶ï¼Œå¯ä»¥å¸¦å…¶å®ƒå‚æ•°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">X</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">X</span>() &#123; cout&lt;&lt;<span class="string">&quot;constructor of X&quot;</span>&lt;&lt;endl; &#125;</span><br><span class="line">    ~<span class="built_in">X</span>() &#123; cout&lt;&lt;<span class="string">&quot;destructor of X&quot;</span>&lt;&lt;endl;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span>* <span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="type">size_t</span> size,string str)</span>  <span class="comment">//é‡è½½::operator new</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;operator new size &quot;</span>&lt;&lt;size&lt;&lt;<span class="string">&quot; with string &quot;</span>&lt;&lt;str&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">return</span> ::<span class="keyword">operator</span> <span class="built_in">new</span>(size);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="keyword">operator</span> <span class="title">delete</span><span class="params">(<span class="type">void</span>* pointee)</span>         <span class="comment">//é‡è½½::operator delete</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;operator delete&quot;</span>&lt;&lt;endl;</span><br><span class="line">        ::<span class="function"><span class="keyword">operator</span> <span class="title">delete</span><span class="params">(pointee)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> num;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    X *px = <span class="built_in">new</span>(<span class="string">&quot;A new class&quot;</span>) X;</span><br><span class="line">    <span class="keyword">delete</span> px;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>ç¼ºçœçš„operator newå…·æœ‰éå¸¸å¥½çš„é€šç”¨æ€§ï¼Œè¿™ä¹Ÿä½¿å¾—å…¶åœ¨æŸäº›åœºåˆä¸‹ç‰ºç‰²äº†æ€§èƒ½ã€‚é’ˆå¯¹æ€§ä¼˜åŒ–çš„operator newå¯ä»¥æå‡æ•ˆç‡ã€‚</p>
</li>
<li><p>placement newå‡½æ•°</p>
<p>å‰é¢é‡è½½çš„operator newåªèƒ½ä½œä¸ºç±»å†…å‡½æ•°ï¼Œæ— æ³•å…¨å±€ä½¿ç”¨ã€‚è€Œplacement newæ˜¯ä¸€ç§å…¨å±€çš„é‡è½½çš„operator newã€‚</p>
<p>placement newçš„ä½¿ç”¨ï¼š</p>
<p>operator newä¼šåˆ†é…å†…å­˜ï¼Œä½†æ˜¯placement newä¸åˆ†é…ã€‚ç›¸ååœ°ï¼Œplacement newçš„å‚æ•°å°±æ˜¯ä¸€ä¸ªé¢„å…ˆåˆ†é…å¥½çš„å†…å­˜ï¼Œè€Œplacement newä¼šåœ¨å…¶ä¸Šæ„é€ å¯¹è±¡ã€‚ï¼ˆplacement newä¸æ¥æ”¶size_tç±»å‹å‚æ•°ï¼Œå³ä¸æ¥æ”¶å¾…åˆ†é…å†…å­˜å¤§å°å‚æ•°ï¼‰ï¼Œå‡½æ•°è¿”å›å€¼æ˜¯å¯¹è±¡çš„åœ°å€ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">string* sp=<span class="built_in">static_cast</span>&lt;string*&gt;(::<span class="keyword">operator</span> <span class="built_in">new</span>(<span class="built_in">sizeof</span>(string)));</span><br><span class="line">mystr = <span class="built_in">new</span> (sp) <span class="built_in">string</span>(<span class="string">&quot;hello world&quot;</span>); <span class="comment">//ä½¿ç”¨placement newæ„é€ å¯¹è±¡</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>placement newçš„ä½¿ç”¨æ­¥éª¤ï¼š</p>
<ol>
<li><p>å†…å­˜æå‰åˆ†é…</p>
</li>
<li><p>è°ƒç”¨placement newæ„é€ å¯¹è±¡</p>
</li>
<li><p>ä½¿ç”¨å¯¹è±¡<code>mystr</code></p>
</li>
<li><p>ææ„å¯¹è±¡<code>mystrâ†’~string();</code></p>
</li>
<li><p>é‡Šæ”¾å†…å­˜ï¼šå†…å­˜<code>sp</code>å¯ä»¥è¢«åå¤ä½¿ç”¨ï¼Œåå¤é€šè¿‡placement newåˆ†é…ç»™æ–°çš„å¯¹è±¡ï¼Œä½†è‹¥ä¸æƒ³ä½¿ç”¨è¯¥å†…å­˜ï¼Œå¯ä»¥ç”¨<code>delete [] buf;</code>é‡Šæ”¾å®ƒã€‚</p>
</li>
</ol>
</li>
<li><p>ä¸ºä»€ä¹ˆè¦æœ‰placement newï¼š</p>
<ol>
<li><p>ç¡®å®æœ‰è¦åœ¨é¢„åˆ†é…å†…å­˜ä¸Šåˆ›å»ºå¯¹è±¡çš„éœ€æ±‚ã€‚æ¯”å¦‚ç¡¬ä»¶ä¸­æœ‰ä¸€ä¸ªå†…å­˜æ˜ å°„çš„IOè®¡æ—¶å™¨è®¾å¤‡ï¼Œæƒ³å»ºç«‹ä¸€ä¸ªclockå¯¹è±¡åœ¨é‚£ä¸ªå†…å­˜ä½ç½®ï¼Œä½†ç”¨ã€‚</p>
</li>
<li><p>å¢å¤§æ—¶ç©ºæ•ˆç‡ã€‚ä½¿ç”¨newæ“ä½œç¬¦éœ€è¦åœ¨å †ä¸­æŸ¥æ‰¾è¶³å¤Ÿå¤§çš„å‰©ä½™ç©ºé—´ï¼Œè¿™ä¸ªæ“ä½œé€Ÿåº¦è¾ƒæ…¢ï¼Œè€Œä¸”å¯èƒ½å‡ºç°æ— æ³•åˆ†é…å†…å­˜çš„å¼‚å¸¸ï¼ˆç©ºé—´ä¸å¤Ÿï¼‰ã€‚placement newå¯ä»¥è§£å†³ï¼Œé¢„å…ˆåˆ†é…å¥½çš„å†…å­˜ç¡®ä¿ä¸ä¼šå‡ºç°å†…å­˜ä¸è¶³çš„å¼‚å¸¸ï¼ŒåŒæ—¶ä¹Ÿçœä¸‹äº†æŸ¥æ‰¾å¯ç”¨å†…å­˜çš„æ—¶é—´ã€‚</p>
</li>
</ol>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>ğŸ“Œç”³è¯·å†…å­˜å’Œé‡Šæ”¾å†…å­˜çš„æ“ä½œç¬¦éœ€è¦é…å¥—ä½¿ç”¨ï¼Œæ¯”å¦‚newå’Œdeleteä¸€èµ·ç”¨ï¼Œnew[]å’Œdelete[]ä¸€èµ·ç”¨ã€‚<br>int* ptr &#x3D; new int[10];<br>delete [] ptr;</p>
</blockquote>
<h4 id="æ‹·è´å’Œç§»åŠ¨"><a href="#æ‹·è´å’Œç§»åŠ¨" class="headerlink" title="æ‹·è´å’Œç§»åŠ¨"></a>æ‹·è´å’Œç§»åŠ¨</h4><ul>
<li><strong>æ‹·è´æ„é€ </strong>ï¼šå®šä¹‰æ‹·è´æ„é€ å‡½æ•°å’Œæ‹·è´èµ‹å€¼è¿ç®—ç¬¦&amp;#x20;</li>
</ul>
<blockquote>
<p>ğŸ“Œå¯¹äºå¤§å®¹é‡çš„å®¹å™¨æ¥è¯´ï¼Œæ‹·è´è¿‡ç¨‹å¯èƒ½è€—è´¹å·¨å¤§ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œ<br>è€Œäº‹å®ä¸Šï¼Œæˆ‘ä»¬å¹¶ä¸çœŸçš„æƒ³è¦ä¸€ä¸ªå‰¯æœ¬ï¼Œè€Œæ˜¯æƒ³å°†è®¡ç®—ç»“æœä»å‡½æ•°ä¸­å–å‡ºæ¥ï¼Œç›¸æ¯”äº<em>æ‹·è´</em>ï¼Œæ›´å¸Œæœ›çš„æ“ä½œçš„<em>ç§»åŠ¨</em>ã€‚</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/******* å£°æ˜ä¸€ä¸ªVectorç±» *******/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Vector</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">double</span>* elem;</span><br><span class="line">  <span class="type">int</span> sz;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Vector</span>(<span class="type">int</span> s);                          <span class="comment">//æ„é€ å‡½æ•°ï¼šå»ºè®®ä¸å˜å¼ï¼Œè·å–èµ„æº</span></span><br><span class="line">  ~<span class="built_in">Vector</span>() &#123; <span class="keyword">delete</span>[] elem; &#125;            <span class="comment">//ææ„å‡½æ•°ï¼šé‡Šæ”¾èµ„æº</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">Vector</span>(<span class="type">const</span> Vector&amp; a);                <span class="comment">//æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">  Vector&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Vector&amp; a);     <span class="comment">//æ‹·è´èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line"></span><br><span class="line">  <span class="type">double</span>&amp; <span class="keyword">operator</span>[](<span class="type">int</span> i);</span><br><span class="line">  <span class="type">const</span> <span class="type">double</span>&amp; <span class="keyword">operator</span>[](<span class="type">int</span> i) <span class="type">const</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/****æ‹·è´æ„é€ å‡½æ•°****/</span></span><br><span class="line">Vector::<span class="built_in">Vector</span>(<span class="type">const</span> Vector&amp; a)</span><br><span class="line">  :elem&#123;<span class="keyword">new</span> <span class="type">double</span>[a.sz]&#125;,     <span class="comment">//ä¸ºå…ƒç´ åˆ†é…ç©ºé—´</span></span><br><span class="line">   sz&#123;a.sz&#125;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i != sz; ++i) <span class="comment">//å¤åˆ¶å…ƒç´ </span></span><br><span class="line">    elem[i] = a.elem[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ˜¯<strong>æ·±æ‹·è´</strong>ã€‚æ‹·è´æ„é€ å‡½æ•°çš„è¾“å…¥å‚æ•°æ˜¯è¢«æ‹·è´çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯a &#x3D; bä¸­å³é¢çš„bã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/****æ‹·è´èµ‹å€¼è¿ç®—ç¬¦****/</span></span><br><span class="line">Vector&amp; Vector::<span class="keyword">operator</span>=(<span class="type">const</span> Vector&amp; a)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">double</span>* p = <span class="keyword">new</span> <span class="type">double</span>[a.sz];</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i != a.sz; ++i)</span><br><span class="line">    p[i]=a.elem[i];</span><br><span class="line">  <span class="keyword">delete</span>[] elem;       <span class="comment">//åˆ é™¤æ—§å…ƒç´ </span></span><br><span class="line">  elem = p;</span><br><span class="line">  sz = a.sz;</span><br><span class="line">  <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>æ·±æ‹·è´ä¸æµ…æ‹·è´ï¼š</strong></li>
</ul>
<p>å¦‚æœç±»ä¸­çš„å±æ€§å‡ä¸ºåŸºæœ¬ç±»å‹å˜é‡ï¼Œå…¨éƒ¨åœ¨æ ˆä¸Šåˆ†é…ï¼Œä¸æ¶‰åŠæ·±&#x2F;æµ…æ‹·è´é—®é¢˜ã€‚æ·±æ‹·è´ä¸æµ…æ‹·è´ä»…åœ¨ï¼Œç±»ä¸­å­˜åœ¨éœ€è¦åœ¨å †ä¸Šåˆ†é…å†…å­˜çš„å±æ€§æ—¶ï¼Œæ‰éœ€è¦åŠ ä»¥åŒºåˆ†ã€‚è€ƒè™‘ä¸Šé¢çš„Vectorç±»ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ‹·è´æ„é€ å‡½æ•°ï¼šæ·±æ‹·è´</span></span><br><span class="line">Vector::<span class="built_in">Vector</span>(<span class="type">const</span> Vector&amp; a)</span><br><span class="line">  :elem&#123;<span class="keyword">new</span> <span class="type">double</span>[a.sz]&#125;,     <span class="comment">//ä¸ºå…ƒç´ åˆ†é…ç©ºé—´</span></span><br><span class="line">   sz&#123;a.sz&#125;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i != sz; ++i) <span class="comment">//å¤åˆ¶å…ƒç´ </span></span><br><span class="line">    elem[i] = a.elem[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ‹·è´æ„é€ å‡½æ•°ï¼šæµ…æ‹·è´</span></span><br><span class="line">Vector::<span class="built_in">Vector</span>(<span class="type">const</span> Vector&amp; a)</span><br><span class="line">  :elem&#123;a.elem&#125;,     <span class="comment">//ä¸åˆ†é…ç©ºé—´ï¼Œç›´æ¥èµ‹å€¼</span></span><br><span class="line">   sz&#123;a.sz&#125;</span><br><span class="line">&#123; &#125;</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯æ„é€ çš„Vectorå¯¹è±¡çš„elemæŒ‡é’ˆï¼Œç›´æ¥æŒ‡å‘&#x3D;å³è¾¹çš„Vectorå¯¹è±¡çš„elemæ•°ç»„ã€‚</p>
<p>å¯ä»¥çœ‹å‡ºï¼Œæ·±æ‹·è´ä¼šé‡æ–°å¼€è¾Ÿä¸€ç‰‡å†…å­˜ï¼Œå¹¶ä¸”å¯¹å†…å­˜ä¸­çš„å€¼é€ä¸ªæ‹·è´ã€‚è€Œæµ…æ‹·è´çš„è¯ï¼Œä¸ä¼šå¼€è¾Ÿå†…å­˜ï¼Œå¯¹è±¡çš„æŒ‡é’ˆç›´æ¥ç­‰äºå³å€¼å¯¹è±¡å†…çš„æŒ‡é’ˆã€‚æ¢è¨€ä¹‹ï¼Œæ·±æ‹·è´è¿‡ç¨‹ä¸­ï¼Œå·¦å€¼çš„å †å†…å­˜å’Œå³å€¼çš„å †å†…å­˜æ˜¯ä¸¤ç‰‡å†…å­˜ï¼Œè€Œæµ…æ‹·è´çš„è¯å…±åŒä½¿ç”¨ä¸€ç‰‡å†…å­˜ã€‚</p>
<p><img src="/image/image__v58OY9wwk.png"></p>
<p>C++çš„é»˜è®¤æ‹·è´æ„é€ å‡½æ•°<code>=default</code>é‡‡ç”¨çš„æ˜¯<strong>æµ…æ‹·è´</strong>æ–¹å¼ã€‚</p>
<p>ä½†æ˜¯ï¼Œ<strong>ä¸€èˆ¬é‡åˆ°æœ‰å±æ€§éœ€è¦ä»å †å†…å­˜åˆ†é…æ—¶ï¼Œåº”è¯¥è‡ªå·±æ‰‹å†™æ·±æ‹·è´æ–¹å¼çš„æ‹·è´æ„é€ å‡½æ•°</strong>ã€‚æµ…æ‹·è´æ¶‰åŠè¿™æ ·å¤šæ¬¡ææ„çš„é—®é¢˜ï¼Œè€ƒè™‘ä¸Šé¢çš„Vectorç±»ï¼Œå¦‚æœé‡‡ç”¨äº†æµ…æ‹·è´çš„æ‹·è´æ„é€ å‡½æ•°ï¼Œç¦ç”¨operator&#x3D;ï¼Œmainå‡½æ•°è¿›è¡Œæœ€åŸºæœ¬çš„èµ‹å€¼æ“ä½œæ—¶ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">Vector <span class="title">lv</span><span class="params">(<span class="number">3</span>)</span></span>;</span><br><span class="line">    Vector rv = lv;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶ç¨‹åºä¼šåœ¨è¿è¡Œæ—¶å´©æºƒï¼Œå´©æºƒåœ¨ææ„å‡½æ•°ä¸Šã€‚åœ¨æ‰§è¡Œreturn 0ä¹‹å‰ï¼Œä½œç”¨åŸŸå†…æœ‰ä¸¤ä¸ªVectorå˜é‡ï¼šlvå’Œrvï¼ŒäºŒè€…çš„elemæŒ‡å‘äº†åŒä¸€ç‰‡å†…å­˜elemã€‚ç„¶è€Œï¼Œæ‰§è¡Œreturn 0ï¼Œç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œä¼šè°ƒç”¨ä¸¤ä¸ªå˜é‡çš„ææ„å‡½æ•°ã€‚å‡è®¾å…ˆè°ƒç”¨äº†lvçš„ææ„å‡½æ•°ï¼Œé‚£ä¹ˆlvçš„elemä¼šåœ¨ææ„æ—¶é‡Šæ”¾å†…å­˜ï¼Œæ­¤æ—¶çš„elemæˆä¸ºäº†é‡æŒ‡é’ˆã€‚è€Œåœ¨è°ƒç”¨rvçš„ææ„å‡½æ•°æ—¶ï¼Œè¿˜ä¼šdelete [] elemï¼Œæ­¤æ—¶è¦deleteä¸€ä¸ªé‡æŒ‡é’ˆï¼Œå°±ä¼šå¯¼è‡´ç¨‹åºå´©æºƒã€‚</p>
<p>ç”±æ­¤å¯è§ï¼Œå¯¹è±¡ä¸­æ¶‰åŠå †æ—¶ï¼Œåº”è¯¥å°½é‡æ‰‹å†™æ·±æ‹·è´å½¢å¼çš„æ‹·è´æ„é€ å‡½æ•°ã€‚</p>
<blockquote>
<p>ğŸ“Œåœ¨C++æ ‡å‡†ä¸­ï¼ŒNULLå’Œnullptréƒ½è¢«è®¤ä¸ºæ˜¯0ï¼Œå°¤å…¶nullptræŒ‡å‘çš„æ˜¯0x0åœ°å€ï¼Œå¯ä»¥é‡å¤deleteã€‚<br>å› æ­¤ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è¢«deleteäº†ï¼ŒæŒ‡é’ˆæœªå½’ä¸ºnullptrï¼Œå†è°ƒç”¨è¯¥æŒ‡é’ˆæ—¶ä¼šå› é‡æŒ‡é’ˆè€Œä½¿å¾—ç¨‹åºå´©æºƒã€‚ä½†å¦‚æœdeleteåå½’ä¸ºnullptrï¼Œå†deleteå¹¶ä¸ä¼šå‡ºç°é—®é¢˜ã€‚</p>
</blockquote>
<ul>
<li><p><strong>å³å€¼å¼•ç”¨ï¼š</strong></p>
<p>é€šå¸¸å†™çš„å¼•ç”¨<code>int a=0; int &amp;b=a;</code>ï¼Œbæ˜¯ä¸€ä¸ªå·¦å€¼å¼•ç”¨ï¼Œå®ƒå¼•ç”¨äº†ä¸€ä¸ªå·¦å€¼aï¼Œä½†å®ƒä¸èƒ½å¼•ç”¨å³å€¼ï¼Œå³<code>int &amp;b=0;</code>ä¼šæŠ¥é”™ã€‚C++11ä¹‹å‰ï¼Œå¼ºè¡Œé€šè¿‡å·¦å€¼å¼•ç”¨ï¼Œå¼•ç”¨ä¸€ä¸ªå³å€¼çš„æ–¹å¼ï¼Œåªæœ‰ä¸€ä¸ªï¼Œé‚£å°±æ˜¯å¸¸å¼•ç”¨<code>const int&amp;b=0;</code>ï¼Œä½†æ˜¯å¦‚æ­¤å¹¶ä¸èƒ½ä¿®æ”¹å³å€¼çš„å€¼ã€‚</p>
<p>å‰é¢æåˆ°ï¼Œæµ…æ‹·è´æ¯”æ·±æ‹·è´æ•ˆç‡æ›´é«˜ï¼ˆä¸ç”¨å¼€è¾Ÿæ–°ç©ºé—´ï¼‰ï¼Œä½†æ˜¯å­˜åœ¨é‡å¤ææ„çš„é—®é¢˜ï¼Œé‚£ä¹ˆæ˜¯å¦å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç è§£å†³ææ„é‡æŒ‡é’ˆçš„é—®é¢˜å‘¢ï¼Ÿ</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">demo</span>(demo &amp;d):<span class="built_in">num</span>(d.num)&#123;        <span class="comment">//æ‹·è´æ„é€ å‡½æ•°ï¼Œå…¥å‚å»æ‰constï¼Œè®©då¯ä¿®æ”¹</span></span><br><span class="line">    d.num = <span class="literal">nullptr</span>;             <span class="comment">//ä¿®æ”¹åŸå¯¹è±¡å¯¹åº”æŒ‡é’ˆä¸ºç©ºæŒ‡é’ˆ</span></span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;copy construct!&quot;</span>&lt;&lt;endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ˜¯ä¸å¯ä»¥çš„ï¼Œè¿è¡Œä¼šæŠ¥é”™ã€‚å› ä¸º<code>num=d.num</code>è¡¨ç¤º<code>d.num</code>æ˜¯å³å€¼ï¼Œå³å€¼ä¸å¯ä¿®æ”¹ï¼Œä½†<code>d.num=nullptr</code>åˆè®©å…¶æˆä¸ºå¯ä¿®æ”¹çš„å·¦å€¼ï¼Œå‘ç”Ÿäº†å†²çªã€‚</p>
<p>è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•ï¼Œå°±æ˜¯å¸Œæœ›å‡½æ•°å‚æ•°dæ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨ï¼Œå³å€¼å¼•ç”¨çš„ç‰¹å®šåœ¨äºï¼Œæ—¢åæ˜ å³å€¼ï¼Œåˆå¯ä»¥ä¿®æ”¹å³å€¼ã€‚</p>
<p>C++å®šä¹‰äº†<code>T&amp;&amp; param</code>è¿™æ ·è¯­æ³•ï¼Œè¡¨ç¤º<code>param</code>æ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨ï¼Œå…¶å¯ä»¥å¼•ç”¨ä¸€ä¸ªå³å€¼ï¼Œé‚£ä¹ˆ<code>int &amp;&amp;b=0;</code>å°±å¯è¡Œäº†ï¼Œè€Œä¸”å¯ä»¥é€šè¿‡bæ¥ä¿®æ”¹å³å€¼ã€‚ä¸æ­¤åŒæ—¶ï¼ŒC++11å¼•å…¥äº†<code>std::move()</code>å‡½æ•°ï¼Œä½œç”¨åœ¨äºï¼Œä¸ç®¡è¾“å…¥çš„æ˜¯å·¦å€¼è¿˜æ˜¯å³å€¼ï¼Œmoveå‡ºæ¥çš„éƒ½æ˜¯å³å€¼ã€‚</p>
<p>ç„¶è€Œè¿™æ ·çš„è¯­æ³•ï¼Œä¹Ÿä¸ä¸€å®šèƒ½ä¿è¯å¼•ç”¨åˆ°çš„å¿…ç„¶æ˜¯å³å€¼ï¼Œä»¥ä¸€ä¸ªå‡½æ•°ä¼ å‚çš„ä¾‹å­è¿›è¡Œè¯´æ˜ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(<span class="type">int</span>&amp; lvalue)</span>          <span class="comment">// æ¥æ”¶å·¦å€¼</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;lvalue = &quot;</span> &lt;&lt; lvalue &lt;&lt; std::endl; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(<span class="type">int</span>&amp;&amp; rvalue)</span>         <span class="comment">// æ¥æ”¶å³å€¼</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;rvalue = &quot;</span> &lt;&lt; rvalue &lt;&lt; std::endl; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">function</span><span class="params">(T&amp;&amp; param)</span>       <span class="comment">// ä¸èƒ½ç¡®ä¿æ˜¯å³å€¼å¼•ç”¨ï¼Œä½†æ˜¯æ˜¯ä¸‡èƒ½å¼•ç”¨</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">fun</span>(param);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> x = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">function</span>(x);               <span class="comment">// å·¦å€¼</span></span><br><span class="line">    <span class="built_in">function</span>(std::<span class="built_in">move</span>(x));    <span class="comment">// å³å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆçœ‹functionå‡½æ•°ï¼Œå…¶æ˜æ˜æ ‡æ˜å…¥å‚åº”è¯¥æ˜¯å³å€¼å¼•ç”¨ï¼Œä¸ºä½•è¿˜èƒ½é€šè¿‡<code>function(x)</code>ä¼ ä¸€ä¸ªå·¦å€¼å¼•ç”¨è¿›å»å‘¢ï¼Ÿ</p>
<p>è¿™æ˜¯<strong>å¼•ç”¨æŠ˜å </strong>çš„åŸå› å¯¼è‡´çš„ï¼š</p>
<p>è™½ç„¶æ˜¯<code>T&amp;&amp; param</code>ï¼Œä½†è‹¥ä¼ è¿›å»ä¸€ä¸ª<code>int&amp;</code>ï¼Œå®é™…ç›¸å½“äºä¼ å…¥çš„ç±»å‹ä¸º<code>int&amp; &amp;&amp;</code>ï¼Œç­‰ä»·äº<code>int&amp;</code>ï¼Œå³å·¦å€¼å¼•ç”¨ã€‚ã€ŠEffective Modern C++ã€‹çš„ä½œè€…å°†è¿™ç§ï¼Œç”±å¼•ç”¨æŠ˜å å¯¼è‡´çš„ï¼Œ<strong>æ—¢å¯ä»¥è¡¨ç¤ºå³å€¼å¼•ç”¨ï¼Œåˆå¯ä»¥è¡¨ç¤ºå·¦å€¼å¼•ç”¨çš„è¯­æ³•ç§°ä¸ºä¸‡èƒ½å¼•ç”¨</strong>ã€‚</p>
<ul>
<li><p>å¼•ç”¨æŠ˜å çš„è§„åˆ™ï¼š</p>
<table>
<thead>
<tr>
<th>first</th>
<th>second</th>
<th>result</th>
</tr>
</thead>
<tbody><tr>
<td>&amp;</td>
<td>&amp;</td>
<td>å·¦å€¼å¼•ç”¨</td>
</tr>
<tr>
<td>&amp;</td>
<td>&amp;&amp;</td>
<td>å·¦å€¼å¼•ç”¨</td>
</tr>
<tr>
<td>&amp;&amp;</td>
<td>&amp;</td>
<td>å·¦å€¼å¼•ç”¨</td>
</tr>
<tr>
<td>&amp;&amp;</td>
<td>&amp;&amp;</td>
<td>å³å€¼å¼•ç”¨</td>
</tr>
</tbody></table>
<p>å³ï¼Œåªæœ‰ä¸¤ä¸ªå¼•ç”¨å‡ä¸ºå³å€¼å¼•ç”¨æ—¶ï¼Œæ‰ä¼šæŠ˜å æˆå³å€¼å¼•ç”¨ã€‚</p>
</li>
<li><p>ä¸‡èƒ½å¼•ç”¨çš„è§„å¾‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">Widget&amp;&amp; var1 = <span class="built_in">Widget</span>();       <span class="comment">// rvalue reference</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span>&amp;&amp; var2 = var1;             <span class="comment">// universal reference</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">(std::vector&lt;T&gt;&amp;&amp; param)</span></span>; <span class="comment">// rvalue reference</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">(T&amp;&amp; param)</span></span>;              <span class="comment">// universal reference</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">vector</span> &#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push_back</span><span class="params">(T&amp;&amp; x)</span></span>;      <span class="comment">// rvalue reference</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>å¦‚æœ<code>T</code>ä¸æ˜¯æ¨¡æ¿å‚æ•°ï¼Œè€Œæ˜¯å…·ä½“çš„ç±»å‹ï¼Œå¦‚ä¸Šé¢çš„ç¬¬ä¸€ä¸ªä¾‹å­Widgetï¼Œ<code>T&amp;&amp;</code>ä¸€å®šæ˜¯å³å€¼å¼•ç”¨ã€‚</p>
</li>
<li><p>å¦‚æœ<code>T</code>æ˜¯æ¨¡æ¿å‚æ•°ï¼Œ<code>T&amp;&amp;</code>ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯é€šç”¨å¼•ç”¨ã€‚é™¤äº†ä¸‹é¢ä¸¤ç§ä¾‹å¤–æƒ…å†µï¼š</p>
</li>
<li><p>å¦‚æœ<code>T</code>æ˜¯æ¨¡æ¿å‚æ•°ï¼Œä½†<code>param</code>çš„ç±»å‹ä¸ç›´æ¥æ˜¯<code>T</code>ï¼Œæ¯”å¦‚<code>std::vector&lt;T&gt;&amp;&amp;</code>ï¼Œé‚£ä¹ˆ<code>std::vector&lt;T&gt;&amp;&amp;</code>æ˜¯å³å€¼å¼•ç”¨ã€‚</p>
</li>
<li><p>å¦‚æœ<code>T</code>æ˜¯æ¨¡æ¿å‚æ•°ï¼Œä½†ä¸éœ€è¦è‡ªåŠ¨æ¨å¯¼ï¼Œæ¯”å¦‚å·²ç»åœ¨ç±»å®ä¾‹åŒ–çš„æ—¶å€™æ‰‹åŠ¨æŒ‡å®šè¿‡äº†ï¼Œé‚£ä¹ˆ<code>T&amp;&amp;</code>æ˜¯å³å€¼å¼•ç”¨ã€‚</p>
</li>
</ul>
</li>
</ul>
<p>ä½†æ˜¯ï¼Œå¦‚æœæ‰§è¡Œä¸Šé¢çš„ä»£ç ï¼Œä¼šå‘ç°è¾“å‡ºç»“æœä¸ºï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">lvalue = 10</span><br><span class="line">lvalue = 10</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯ï¼Œå·¦å€¼å’Œå³å€¼éƒ½è¢«åˆ¤å®šä¸ºå·¦å€¼ã€‚è¿™æ˜¯å› ä¸ºå³å€¼å¼•ç”¨æ¥æ”¶çš„å€¼æ—¢å¯ä»¥æ˜¯å·¦å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯å³å€¼ï¼Œå­˜åœ¨è¿™æ ·ä¸€ä¸ªå¯¹åº”å…³ç³»ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>å·¦å€¼å¼•ç”¨</th>
<th>å³å€¼å¼•ç”¨</th>
<th>éå¼•ç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>ä»€ä¹ˆæ—¶å€™æ˜¯å·¦å€¼</td>
<td>always</td>
<td>æ˜¾å¼å£°æ˜ä¸ºå˜é‡æ—¶</td>
<td>æ˜¾å¼å£°æ˜ä¸ºå˜é‡æ—¶</td>
</tr>
<tr>
<td>ä»€ä¹ˆæ—¶å€™æ˜¯å³å€¼</td>
<td>never</td>
<td>ä½œä¸ºä¸´æ—¶å˜é‡æ—¶</td>
<td>ä½œä¸ºä¸´æ—¶å˜é‡æ—¶</td>
</tr>
</tbody></table>
<p>è™½ç„¶moveå‡½æ•°å¼ºè¡Œä½¿å¾—ç¬¬äºŒä¸ªfunctionå‡½æ•°ä¼ å…¥å³å€¼ï¼Œä½†æ˜¯ï¼Œfunctionå‡½æ•°å†…éƒ¨è°ƒç”¨funå‡½æ•°æ—¶ï¼Œæ¶‰åŠä¼ å‚ï¼ŒåˆæŠŠparamæ˜¾å¼åŒ–äº†ã€‚è¿™æ ·å°±ä½¿å¾—paramå˜ä¸ºä¸€ä¸ªå·¦å€¼ã€‚</p>
<p>é‚£ä¹ˆå¦‚ä½•ä¿ç•™å³å€¼çš„ç‰¹ç‚¹ï¼Œä½¿å¾—è°ƒç”¨funå‡½æ•°ä¹Ÿä¼ å…¥å³å€¼å‘¢ï¼ŒC++11åŒæ—¶æä¾›äº†<strong>å®Œç¾è½¬å‘</strong><code>std::forward</code>ç‰¹æ€§ã€‚</p>
<p><code>std::forward</code>çš„è¿”å›å€¼æ—¢å¯èƒ½æ˜¯å·¦å€¼ï¼Œä¹Ÿå¯èƒ½æ˜¯å³å€¼ï¼Œå½“ä¼ å…¥å‚æ•°æ˜¯å³å€¼å¼•ç”¨æ—¶ï¼Œè¿”å›å³å€¼ï¼Œå¦åˆ™å°±è¿”å›å·¦å€¼ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥æ”¶å·¦å€¼</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(<span class="type">int</span>&amp; lvalue)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;lvalue = &quot;</span> &lt;&lt; lvalue &lt;&lt; std::endl; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ¥æ”¶å³å€¼</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(<span class="type">int</span>&amp;&amp; rvalue)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;rvalue = &quot;</span> &lt;&lt; rvalue &lt;&lt; std::endl; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¸‡èƒ½å¼•ç”¨</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">function</span><span class="params">(T&amp;&amp; param)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//fun(param);</span></span><br><span class="line">    <span class="built_in">fun</span>(std::forward&lt;T&gt;(param)); <span class="comment">// ä½¿ç”¨std::forwardè¿›è¡Œå®Œç¾è½¬å‘</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> x = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">function</span>(x);     <span class="comment">// å·¦å€¼</span></span><br><span class="line">    <span class="built_in">function</span>(std::<span class="built_in">move</span>(x));    <span class="comment">// å³å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†æ‰§è¡Œé€šè¿‡å®Œç¾è½¬å‘æ”¹è¿›çš„ç¨‹åºï¼Œå¯ä»¥å¾—åˆ°è¿™æ ·çš„è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">lvalue = 10</span><br><span class="line">rvalue = 10</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯ï¼Œå·¦å€¼æ˜¯å·¦å€¼çš„è¡Œä¸ºï¼Œå³å€¼æ˜¯å³å€¼çš„è¡Œä¸ºï¼Œä¸å†æ··ä¹±ï¼Œæ³¾æ¸­åˆ†æ˜ã€‚</p>
<p>äº‹å®ä¸Šï¼Œä½¿ç”¨<code>std::forward</code>å¤„ç†ä¸‡èƒ½å¼•ç”¨ï¼Œä¹Ÿæ˜¯å®˜æ–¹æ¨èçš„å¼€å‘æ–¹å¼ï¼</p>
</li>
</ul>
<p>åˆç†è¿ç”¨å³å€¼å¼•ç”¨ï¼Œè¾¾åˆ°æé€Ÿæ•ˆæœçš„æ¡ˆä¾‹ï¼š</p>
<p>åœ¨åšçŸ©é˜µåŠ æ³•æ—¶ï¼Œå¯ä»¥è¿™æ ·å†™ï¼Œå³å…¥å‚æ˜¯ä¸¤ä¸ªå·¦å€¼å¼•ç”¨ä»¥é¿å…æ‹·è´</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">Matrix <span class="keyword">operator</span>+(<span class="type">const</span> Matrix&amp; lhs, <span class="type">const</span> Matrix&amp; rhs) &#123;</span><br><span class="line">    Matrix sum = ...        <span class="comment">// Sum all elements in lhs and rhs here.</span></span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™ä¹ˆåšç¾ä¸­ä¸è¶³çš„åœ°æ–¹åœ¨äºï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªé¢å¤–çš„Matrixå¯¹è±¡ã€‚å¦‚æœè¯´ï¼Œlhså’Œrhsæœ‰ä¸€ä¸ªæ“ä½œæ•°å¯ä»¥æ˜¯å³å€¼ï¼Œä¹Ÿå°±æ˜¯ç®—å®Œä¹‹åè°ƒç”¨è€…ä¸ä¼šå†ä½¿ç”¨å®ƒï¼Œé‚£ä¾¿å¯ä»¥å¤ç”¨å®ƒçš„å†…å­˜ç©ºé—´ï¼Œä¸å¿…åˆ›å»ºæ–°çš„Matrixå¯¹è±¡ï¼Œè¾¾åˆ°æé«˜æ•ˆç‡çš„ç›®çš„ã€‚å‡è®¾è¿™ä¸ªå³å€¼æ˜¯lhsï¼Œé‚£ä¹ˆä¾¿å¯ä»¥è®¾ç½®å®ƒä¸ºå³å€¼å¼•ç”¨ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">Matrix <span class="keyword">operator</span>+(Matrix&amp;&amp; lhs, <span class="type">const</span> Matrix&amp; rhs) &#123;</span><br><span class="line">    lhs = ...               <span class="comment">// Sum all elements in lhs and rhs and assign to lhs.</span></span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">move</span>(lhs);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¦ç”¨<code>std::move</code>è¿”å›å€¼ï¼Œé¿å…è®©lhsæˆä¸ºæ˜¾å¼å˜é‡ï¼Œæˆä¸ºå·¦å€¼ï¼ˆæˆä¸ºå·¦å€¼çš„è¯ï¼Œä¼šè¿”å›å¯¹è±¡çš„æ‹·è´æ„é€ ï¼‰ã€‚æ­¤æ—¶çš„è¿”å›å€¼å˜æˆäº†å³å€¼å¼•ç”¨ï¼Œç¼–è¯‘å™¨è‡ªåŠ¨ä¸ºå³å€¼è°ƒç”¨ç§»åŠ¨æ„é€ å‡½æ•°ã€‚</p>
<p>é‚£ä¹ˆè¿›è¡ŒçŸ©é˜µåŠ æ³•ä¾¿å¯ä»¥ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">Matrix sum1 = m1 + m2;                  <span class="comment">// è°ƒç”¨ç¬¬ä¸€ç§å®ç°</span></span><br><span class="line">Matrix sum3 = std::<span class="built_in">move</span>(m1) + m2;       <span class="comment">// è°ƒç”¨ç¬¬äºŒç§å®ç°</span></span><br></pre></td></tr></table></figure>

<p><strong>ä¸€èˆ¬ä¸å»ºè®®å‡½æ•°è¿”å›å³å€¼å¼•ç”¨ï¼</strong></p>
<blockquote>
<p>C++ä¸­çš„å·¦å³å€¼ï¼š<br>- lvalueï¼šé€šå¸¸å¯ä»¥æ”¾åœ¨ç­‰å·å·¦è¾¹çš„è¡¨è¾¾å¼ï¼Œå·¦å€¼<br>- rvalueï¼šé€šå¸¸åªèƒ½æ”¾åœ¨ç­‰å·å³è¾¹çš„è¡¨è¾¾å¼ï¼Œå³å€¼<br>- glvalueï¼šgeneralized lvalueï¼Œå¹¿ä¹‰å·¦å€¼<br>- xvalueï¼šexpiring lvalueï¼Œå°†äº¡å€¼ï¼Œä¹Ÿå°±æ˜¯std::move(ptr1)çš„å€¼<br>- prvalueï¼špure rvalueï¼Œçº¯å³å€¼<br>å¯¹äºåŒ…å«å³å€¼çš„å†…å­˜ä½ç½®æ¥è¯´ï¼Œå…¶æœ¬è´¨å°±æ˜¯ï¼šå®ƒè™½ç„¶æ²¡æœ‰åç§°ï¼Œä½†æ˜¯å¯ä»¥ä»ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†è®¿é—®åˆ°å®ƒã€‚<br>è€Œå³å€¼å¼•ç”¨ä¾¿å¯ä»¥ç”¨æ¥è¡¨ç¤ºè¿™ä¸ªæœ¬åº”æ²¡æœ‰åç§°çš„ä¸´æ—¶å¯¹è±¡ã€‚</p>
<p>C++11ä¹‹åç¼–è¯‘å™¨å¼€å§‹æ”¯æŒRVO(Return Value Optimization)æŠ€æœ¯ï¼ŒRVOå¯ä»¥æŠŠå‡½æ•°è¿”å›æ—¶åˆ›å»ºçš„ä¸´æ—¶å¯¹è±¡ä¼˜åŒ–æ‰ï¼Œè¾¾åˆ°å°‘è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°çš„ç›®æ ‡ã€‚å¦‚æœå‡½æ•°è¿”å›ä¸€ä¸ªä»…åœ¨å‡½æ•°å†…çš„å±€éƒ¨å˜é‡ï¼Œè€Œä¸”å˜é‡ç±»å‹æ”¯æŒç§»åŠ¨æ„é€ å‡½æ•°ï¼Œæ¯”å¦‚ï¼š<br>std::vector&lt;int&gt; return_vector(void){<br>&amp;#x20;  std::vector&lt;int&gt; tmp {1,2,3,4,5};<br>&amp;#x20;  return tmp;<br>}<br>std::vector&lt;int&gt; rval_ref &#x3D; return_vector();<br>é‚£ä¹ˆç¼–è¯‘å™¨å‘ç°tmpæ˜¯å±€éƒ¨å˜é‡ï¼Œç¦»å¼€return_vectorå‡½æ•°åå°±ä¼šæ­»äº¡æ—¶ï¼Œä¼šæŠŠtmpå½“åšå°†äº¡å€¼ï¼ˆxvalueï¼‰ï¼Œç¼–è¯‘å™¨ä¼šä¸ºå°†äº¡å€¼è°ƒç”¨ç§»åŠ¨æ„é€ å‡½æ•°ã€‚</p>
</blockquote>
<p><img src="/image/image_M99Hn4BKd-.png"></p>
<ul>
<li><p><strong>ç§»åŠ¨æ„é€ ï¼š</strong></p>
<p>è™½ç„¶æ·±æ‹·è´å¾ˆç¨³å®šï¼Œä½¿å¾—å‡ºé”™çš„é£é™©é™ä½ï¼Œä½†æ˜¯å¸¦æ¥äº†æ•ˆç‡çš„ç‰ºç‰²ã€‚è€ƒè™‘ä¸‹é¢çš„æ·±æ‹·è´æ„é€ å‡½æ•°ä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">demo</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">   <span class="built_in">demo</span>():<span class="built_in">num</span>(<span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">0</span>))&#123;</span><br><span class="line">      cout&lt;&lt;<span class="string">&quot;construct!&quot;</span>&lt;&lt;endl;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="built_in">demo</span>(<span class="type">const</span> demo &amp;d):<span class="built_in">num</span>(<span class="keyword">new</span> <span class="built_in">int</span>(*(d.num)))&#123;  <span class="comment">//æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">      cout&lt;&lt;<span class="string">&quot;copy construct!&quot;</span>&lt;&lt;endl;</span><br><span class="line">   &#125;</span><br><span class="line">   ~<span class="built_in">demo</span>()&#123;</span><br><span class="line">      <span class="keyword">delete</span> num;</span><br><span class="line">      cout&lt;&lt;<span class="string">&quot;class destruct!&quot;</span>&lt;&lt;endl;</span><br><span class="line">   &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">   <span class="type">int</span> *num;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function">demo <span class="title">get_demo</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">demo</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    demo a = <span class="built_in">get_demo</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>g++ demo.cpp -o demo.exe -std=c++0x -fno-elide-constructors</code>å‘½ä»¤ç¦ç”¨ä¼˜åŒ–ï¼Œçœ‹æœ€åŸå§‹æƒ…å†µçš„è¾“å‡ºï¼Œæœ‰ï¼š</p>
<p><img src="/image/image_59GclcE4Cr.png"></p>
<ol>
<li><p>é¦–å…ˆåœ¨get_demoé‡Œè°ƒç”¨äº†æ„é€ å‡½æ•°</p>
</li>
<li><p>ç¦»å¼€get_demoæ—¶ï¼Œreturnè¯­å¥å¯¹å‡½æ•°å†…åˆ›å»ºçš„å¯¹è±¡è¿›è¡Œæ‹·è´ï¼Œä»è€Œæä¾›è¿”å›å€¼</p>
</li>
<li><p>æ‰§è¡Œå®Œreturnåï¼Œç¦»å¼€ä½œç”¨åŸŸï¼Œä¹‹å‰å‡½æ•°å†…åˆ›å»ºçš„å¯¹è±¡é”€æ¯ï¼Œä½†æ˜¯æ‹·è´çš„ä½œä¸ºè¿”å›å€¼æ¥åˆ°äº†main</p>
</li>
<li><p>è¿”å›å€¼è¢«&#x3D;èµ‹ç»™äº†aï¼Œæ‰§è¡Œäº†æ‹·è´æ„é€ ï¼ˆæ·±æ‹·è´ï¼Œæ­¤æ—¶æœ‰ä¸¤ä¸ªdemoå¯¹è±¡ï¼‰</p>
</li>
<li><p>return 0ä¹‹åï¼Œç¦»å¼€ä½œç”¨åŸŸï¼Œè°ƒç”¨ææ„å‡½æ•°é”€æ¯å¯¹è±¡ï¼Œç”±äºä¸¤ä¸ªå¯¹è±¡éƒ½è¦é”€æ¯ï¼Œå› æ­¤è°ƒç”¨äº†ä¸¤æ¬¡ææ„å‡½æ•°</p>
</li>
</ol>
<p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œåœ¨ç¬¬2æ­¥å’Œç¬¬4æ­¥æ—¶æ‰§è¡Œäº†ä¸¤æ¬¡æ·±æ‹·è´ï¼Œå¯¹äºä»…ç”³è¯·å°‘é‡å †ç©ºé—´çš„ä¸´æ—¶å¯¹è±¡æ¥è¯´ï¼Œæ·±æ‹·è´çš„æ‰§è¡Œæ•ˆç‡ä¾æ—§å¯ä»¥æ¥å—ï¼Œä½†å¦‚æœä¸´æ—¶å¯¹è±¡ä¸­çš„æŒ‡é’ˆæˆå‘˜ç”³è¯·äº†å¤§é‡çš„å †ç©ºé—´ï¼Œé‚£ä¹ˆ 2 æ¬¡æ·±æ‹·è´æ“ä½œåŠ¿å¿…ä¼šå½±å“ a å¯¹è±¡åˆå§‹åŒ–çš„æ‰§è¡Œæ•ˆç‡ã€‚é’ˆå¯¹æ­¤ï¼ŒC++11å¼•å…¥äº†ç§»åŠ¨æ„é€ å‡½æ•°æ–¹æ¡ˆä»¥é¿å…æ·±æ‹·è´å¯¼è‡´çš„æ•ˆç‡é—®é¢˜ã€‚</p>
<p>ç§»åŠ¨æ„é€ å‡½æ•°ä¸æµ…æ‹·è´ç±»ä¼¼ï¼Œä½†æ˜¯åŒºåˆ«åœ¨äºï¼š1. å‚æ•°è¦æ±‚æ˜¯å³å€¼å¼•ç”¨ï¼Œè€Œéå·¦å€¼å¼•ç”¨ï¼›2. å‡½æ•°å†…å°†åŸæŒ‡é’ˆç½®ä¸º0</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ·»åŠ ç§»åŠ¨æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="built_in">demo</span>(demo &amp;&amp;d):<span class="built_in">num</span>(d.num)&#123;</span><br><span class="line">    d.num = <span class="literal">NULL</span>;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;move construct!&quot;</span>&lt;&lt;endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸Šé¢çš„mainåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œreturnè¿”å›å’Œ&#x3D;èµ‹å€¼ï¼Œéƒ½æ˜¯å°†å³å€¼èµ‹ç»™å·¦å€¼ï¼Œå› æ­¤å¯¹åº”ä¸Šäº†ç§»åŠ¨æ„é€ å‡½æ•°ä¸­çš„å³å€¼å¼•ç”¨ã€‚æ‰€ä»¥å†æ‰§è¡Œä»£ç æ—¶ï¼Œå°†ä¼šé€šè¿‡ä¸¤æ¬¡ç§»åŠ¨æ›¿ä»£ä¸¤æ¬¡æ‹·è´ï¼š</p>
<p><img src="/image/image_w9TrPipfr5.png"></p>
<p>å®é™…å¼€å‘ä¸­ï¼Œé€šå¸¸åœ¨ç±»ä¸­è‡ªå®šä¹‰ç§»åŠ¨æ„é€ å‡½æ•°çš„åŒæ—¶ï¼Œä¼šå†ä¸ºå…¶è‡ªå®šä¹‰ä¸€ä¸ªé€‚å½“çš„æ‹·è´æ„é€ å‡½æ•°ï¼Œç”±æ­¤å½“ç”¨æˆ·åˆ©ç”¨å³å€¼åˆå§‹åŒ–ç±»å¯¹è±¡æ—¶ï¼Œä¼šè°ƒç”¨ç§»åŠ¨æ„é€ å‡½æ•°ï¼›ä½¿ç”¨å·¦å€¼ï¼ˆéå³å€¼ï¼‰åˆå§‹åŒ–ç±»å¯¹è±¡æ—¶ï¼Œä¼šè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ã€‚</p>
<p><strong>ä½†æ˜¯</strong>ï¼Œä¹Ÿå¯ä»¥å®Œå…¨ç”¨ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å®Œå…¨ç”¨å³å€¼å¼•ç”¨ï¼Œæ–¹æ³•æ˜¯é‡‡ç”¨<code>std::move()</code>å‡½æ•°ï¼Œå¼ºè¡Œå°†å·¦å€¼è½¬ä¸ºå³å€¼ã€‚</p>
</li>
</ul>
<blockquote>
<p>ğŸ“ŒC++å®šä¹‰ç±»class Aï¼Œç±»å†…åŒ…å«çš„é»˜è®¤8ä¸ªæˆå‘˜å‡½æ•°ï¼š<br>- é»˜è®¤æ„é€ å‡½æ•°ï¼š                                   A();<br>- é»˜è®¤æ‹·è´æ„é€ å‡½æ•°ï¼š                            A(const A&amp;);<br>- é»˜è®¤ææ„å‡½æ•°ï¼š                                   ~A();<br>- é»˜è®¤é‡è½½èµ‹å€¼è¿ç®—ç¬¦ï¼š                         A&amp; operator &#x3D; (const A&amp;);<br>- é»˜è®¤é‡è½½å–å€è¿ç®—ç¬¦ï¼š                         A* operator &amp; ();<br>- é»˜è®¤constä¿®é¥°çš„é‡è½½å–å€è¿ç®—ç¬¦ï¼š     const A* operator &amp; () const;<br>- ï¼ˆC++11ï¼‰é»˜è®¤ç§»åŠ¨æ„é€ å‡½æ•°ï¼š          A(A&amp;&amp;);<br>- ï¼ˆC++11ï¼‰é»˜è®¤é‡è½½ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ï¼šA&amp; operator &#x3D; (const A&amp;&amp;);</p>
<p>unique_ptrå°±æ˜¯é€šè¿‡ç§»åŠ¨æ„é€ å‡½æ•°å®ç°çš„æ‰€æœ‰æƒè½¬ç§»ã€‚unique_ptrç±»ä¸­åªæœ‰ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œç¦ç”¨æ‹·è´æ„é€ ã€‚<br>ç§»åŠ¨æ„é€ å‡½æ•°è¿˜æœ‰ä¸€ä¸ªå…¸å‹æ¡ˆä¾‹å°±æ˜¯ï¼Œvectorå®¹å™¨ä¸­çš„emplace_backå‡½æ•°é‡‡ç”¨ç§»åŠ¨æ„é€ ï¼Œpush_backå‡½æ•°é‡‡ç”¨æ‹·è´æ„é€ ï¼Œå‰è€…æ¯”åè€…é«˜æ•ˆå¾ˆå¤šã€‚</p>
</blockquote>
<h4 id="æ™ºèƒ½æŒ‡é’ˆ"><a href="#æ™ºèƒ½æŒ‡é’ˆ" class="headerlink" title="æ™ºèƒ½æŒ‡é’ˆ"></a>æ™ºèƒ½æŒ‡é’ˆ</h4><p>æ™ºèƒ½æŒ‡é’ˆçš„ä½œç”¨æ˜¯ç®¡ç†ä¸€ä¸ªæŒ‡é’ˆï¼Œå› ä¸ºå­˜åœ¨ä»¥ä¸‹è¿™ç§æƒ…å†µï¼šç”³è¯·çš„ç©ºé—´åœ¨å‡½æ•°ç»“æŸæ—¶å¿˜è®°é‡Šæ”¾ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆå¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šçš„é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæ™ºèƒ½æŒ‡é’ˆæ˜¯ä¸€ä¸ªç±»ï¼Œå½“è¶…å‡ºç±»çš„ä½œç”¨åŸŸæ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ææ„å‡½æ•°ï¼Œææ„å‡½æ•°ä¼šè‡ªåŠ¨é‡Šæ”¾èµ„æºã€‚å› æ­¤<strong>æ™ºèƒ½æŒ‡é’ˆåœ¨å‡½æ•°ç»“æŸæ—¶è‡ªåŠ¨é‡Šæ”¾å†…å­˜ç©ºé—´ï¼Œä¸éœ€è¦æ‰‹åŠ¨é‡Šæ”¾</strong>ï¼ˆä¸¥æ ¼è·µè¡ŒRAIIï¼‰ã€‚è€Œä¸”æ™ºèƒ½æŒ‡é’ˆé‡è½½äº†*å’Œâ†’æ“ä½œç¬¦ï¼Œä½¿ç”¨èµ·æ¥å’ŒåŸå§‹æŒ‡é’ˆä¸€æ ·ã€‚ä¸è¦è¯•å›¾deleteæ™ºèƒ½æŒ‡é’ˆã€‚</p>
<ul>
<li><p>auto_ptrï¼ˆå·²è¢«C++11å¼ƒç”¨ï¼‰</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">auto_ptr&lt;string&gt; <span class="title">p1</span> <span class="params">(<span class="keyword">new</span> string(<span class="string">&quot;I reigned lonely as a cloud&quot;</span>))</span></span>;</span><br><span class="line">auto_ptr&lt;string&gt; p2;</span><br><span class="line">p2 = p1; <span class="comment">//auto_pträ¸ä¼šæŠ¥é”™</span></span><br></pre></td></tr></table></figure>

<p>auto_ptré‡‡ç”¨æ‰€ç”¨æƒæ¨¡å¼ã€‚ä¸Šè¿°ä»£ç æ‰§è¡Œæ—¶ä¸ä¼šæŠ¥é”™ï¼Œä½†p2å‰¥å¤ºäº†p1çš„æ‰€æœ‰æƒï¼Œå½“ç¨‹åºè®¿é—®p1æ—¶å°†ä¼šæŠ¥é”™ã€‚æ‰€ä»¥auto_ptrçš„ç¼ºç‚¹æ˜¯ï¼šå­˜åœ¨æ½œåœ¨çš„å†…å­˜å´©æºƒé£é™©ã€‚</p>
</li>
<li><p>unique_ptr</p>
<p>unique_ptrå®ç°ç‹¬å å¼æ‹¥æœ‰ï¼Œä¿è¯åŒä¸€æ—¶é—´å†…åªæœ‰ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆå¯ä»¥æŒ‡å‘è¯¥å¯¹è±¡ã€‚å®ƒå¯¹äºé¿å…èµ„æºæ³„éœ²ï¼ˆå¦‚â€œnewåˆ›å»ºå¯¹è±¡åå› å¼‚å¸¸è€Œå¿˜è®°è°ƒç”¨deleteâ€ï¼‰ç‰¹åˆ«æœ‰ç”¨ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">unique_ptr&lt;string&gt; <span class="title">p3</span><span class="params">(<span class="keyword">new</span> string (<span class="string">&quot;auto&quot;</span>))</span></span>;</span><br><span class="line">unique_ptr&lt;string&gt; p4;</span><br><span class="line">p4 = p3; <span class="comment">//æŠ¥é”™ï¼</span></span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘å™¨è®¤ä¸ºp4&#x3D;p3éæ³•ï¼Œå› æ­¤é¿å…äº†p3ä¸å†æŒ‡å‘æœ‰æ•ˆæ•°æ®ï¼Œæˆä¸ºé‡æŒ‡é’ˆçš„é—®é¢˜ã€‚å› æ­¤unique_ptræ¯”auto_ptræ›´ä¸ºå®‰å…¨ã€‚</p>
<p>æ™ºèƒ½æŒ‡é’ˆæ²¡æœ‰å®šä¹‰åŠ å‡è¿ç®—ï¼Œ<strong>ä¸èƒ½éšæ„ç§»åŠ¨æŒ‡é’ˆåœ°å€</strong>ï¼Œä»è€Œ<strong>é¿å…æŒ‡é’ˆè¶Šç•Œ</strong>ç­‰å±é™©æ“ä½œã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">ptr1++;   <span class="comment">//å¯¼è‡´ç¼–è¯‘é”™è¯¯</span></span><br><span class="line">ptr2+=<span class="number">2</span>;  <span class="comment">//å¯¼è‡´ç¼–è¯‘é”™è¯¯</span></span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„ï¼Œä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆä¹Ÿè¦é¿å…æœªåˆå§‹åŒ–çš„ç©ºæŒ‡é’ˆé—®é¢˜ã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç ä¼šå¯¼è‡´core dumpï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">unique_ptr ptr3;  <span class="comment">//æœªåˆå§‹åŒ–æ™ºèƒ½æŒ‡é’ˆ</span></span><br><span class="line">*ptr3 = <span class="number">42</span>;       <span class="comment">//é”™è¯¯ï¼æ“ä½œäº†ç©ºæŒ‡é’ˆ</span></span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†é¿å…è¿™ç§ä½çº§é”™è¯¯ï¼Œå¯ä»¥è°ƒç”¨å·¥å‚å‡½æ•°**make_unique()**ï¼Œå¼ºåˆ¶è¦æ±‚åˆ›å»ºæŒ‡é’ˆçš„æ—¶å€™å¿…é¡»åˆå§‹åŒ–ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">unique_ptr&lt;string&gt; ptr5;</span><br><span class="line">ptr5 = <span class="built_in">unique_ptr</span>&lt;string&gt;(<span class="keyword">new</span> <span class="built_in">string</span> (<span class="string">&quot;You&quot;</span>)); <span class="comment">//ä¸ç”¨å·¥å‚å‡½æ•°ï¼Œè€Œæ˜¯æ„é€ å‡½æ•°ï¼Œä¸´æ—¶å³å€¼åˆå§‹åŒ–</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> ptr3 = <span class="built_in">make_unique</span>(<span class="number">42</span>);                   <span class="comment">//å·¥å‚å‡½æ•°åˆ›å»ºæ™ºèƒ½æŒ‡é’ˆ</span></span><br><span class="line"><span class="built_in">assert</span>(ptr3 &amp;&amp; *ptr3 == <span class="number">42</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> ptr4 = <span class="built_in">make_unique</span>(<span class="string">&quot;god of war&quot;</span>);         <span class="comment">//å·¥å‚å‡½æ•°åˆ›å»ºæ™ºèƒ½æŒ‡é’ˆ</span></span><br><span class="line"><span class="built_in">assert</span>(!ptr4-&gt;<span class="built_in">empty</span>());</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ“Œmake_unique()è¦æ±‚C++14ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨C++11ï¼Œå¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªç®€åŒ–ç‰ˆçš„make_unqiue()</p>
<p>template&lt;typename T, typenameâ€¦ Ts&gt;                                                &#x2F;&#x2F;å¯å˜å‚æ•°æ¨¡æ¿    &amp;#x20;<br>std::unique_ptr&lt;T&gt; make_unique(Ts&amp;&amp;â€¦ params)                             &#x2F;&#x2F;è¿”å›æ™ºèƒ½æŒ‡é’ˆï¼Œå…¥å£å‚æ•°<br>{<br>&amp;#x20;   return std::unique_ptr&lt;T&gt;(new T(std::foward&lt;Ts&gt;(params)â€¦));   &#x2F;&#x2F;æ„é€ æ™ºèƒ½æŒ‡é’ˆï¼Œå®Œç¾è½¬å‘<br>}</p>
<p>ï¼ˆæ ‡å‡†åº“çš„å·¥å‚å‡½æ•°å†…éƒ¨æ˜¯æœ‰ä¼˜åŒ–çš„ï¼Œä¼šæ¯”æ‰‹å†™ç±»å‹æ„é€ çš„æ•ˆç‡æ›´é«˜ï¼‰</p>
</blockquote>
<p>å‰é¢æåˆ°unique_pträ¸å…è®¸ç›´æ¥è¿›è¡Œâ€œæ‰€æœ‰æƒâ€è½¬ç§»ï¼Œè¿™æ˜¯å› ä¸ºå…¶ç¦ç”¨äº†æ‹·è´èµ‹å€¼ï¼Œä»…ä¿ç•™äº†ç§»åŠ¨æ„é€ å’Œç§»åŠ¨èµ‹å€¼ã€‚å› æ­¤ï¼Œè‹¥æƒ³è¦è¿›è¡Œæ‰€æœ‰æƒè½¬ç§»ï¼Œå¿…é¡»ç”¨<code>std::move</code>å‡½æ•°æ˜¾å¼åœ°å£°æ˜ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> ptr1 = <span class="built_in">make_unique</span>(<span class="number">42</span>);   <span class="comment">//å·¥å‚å‡½æ•°åˆ›å»ºæ™ºèƒ½æŒ‡é’ˆ</span></span><br><span class="line"><span class="built_in">assert</span>(ptr1 &amp;&amp; *ptr1 ==<span class="number">42</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> ptr2 = std::<span class="built_in">move</span>(ptr1);   <span class="comment">//ä½¿ç”¨move()è½¬ç§»æ‰€æœ‰æƒ</span></span><br><span class="line"><span class="built_in">assert</span>(!ptr1 &amp;&amp; ptr2);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>get()å’Œrelease()ï¼š</p>
<p>baræ˜¯ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆï¼Œpæ˜¯ä¸€ä¸ªæ™®é€šæŒ‡é’ˆï¼Œ<code>p=bar.get()</code>ï¼Œbarå¹¶æœªè¢«é‡Šæ”¾ï¼Œæ­¤æ—¶ç›¸å½“äºæŒ‡é’ˆpå’Œæ™ºèƒ½æŒ‡é’ˆbarå…±åŒç®¡ç†ä¸€ä¸ªå¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ*p&#x3D;åšçš„äº‹æƒ…ï¼Œä¼šåæ˜ åˆ°baræŒ‡å‘çš„å¯¹è±¡ã€‚</p>
<p>release()ä¼šé‡Šæ”¾å½“å‰æŒ‡é’ˆå¯¹å¯¹è±¡çš„æ‰€æœ‰æƒï¼Œå…¶è¿”å›å€¼ç”¨äºæ–°çš„æŒ‡é’ˆï¼ˆæ™®é€šæŒ‡é’ˆæˆ–æ™ºèƒ½æŒ‡é’ˆï¼‰æ¥ç®¡å¯¹è±¡ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">                                           <span class="comment">// foo   bar    p</span></span><br><span class="line">                                           <span class="comment">// ---   ---   ---</span></span><br><span class="line">std::unique_ptr&lt;<span class="type">int</span>&gt; foo;                  <span class="comment">// null</span></span><br><span class="line">std::unique_ptr&lt;<span class="type">int</span>&gt; bar;                  <span class="comment">// null  null</span></span><br><span class="line"><span class="type">int</span>* p = <span class="literal">nullptr</span>;                          <span class="comment">// null  null  null</span></span><br><span class="line"></span><br><span class="line">foo = std::<span class="built_in">unique_ptr</span>&lt;<span class="type">int</span>&gt;(<span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">10</span>));   <span class="comment">//  10   null  null</span></span><br><span class="line">bar = std::<span class="built_in">move</span>(foo);                      <span class="comment">// null   10   null</span></span><br><span class="line">p = bar.<span class="built_in">get</span>();                             <span class="comment">// null   10    10</span></span><br><span class="line">*p = <span class="number">20</span>;                                   <span class="comment">// null   20    20</span></span><br><span class="line">p = <span class="literal">nullptr</span>;                               <span class="comment">// null   20   null</span></span><br><span class="line"></span><br><span class="line">foo = std::<span class="built_in">unique_ptr</span>&lt;<span class="type">int</span>&gt;(<span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">30</span>));   <span class="comment">//  30    20   null</span></span><br><span class="line">p = foo.<span class="built_in">release</span>();                         <span class="comment">// null   20    30</span></span><br><span class="line">*p = <span class="number">40</span>;                                   <span class="comment">// null   20    40</span></span><br></pre></td></tr></table></figure>

<p>æ­¤å¤–è¿˜æœ‰reset()æ–¹æ³•ï¼Œä¸ä»…ä¼šé‡Šæ”¾æ‰€æœ‰æƒï¼Œè¿˜ä¼šé‡Šæ”¾å¯¹è±¡ï¼Œå³é‡Šæ”¾å†…å­˜ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">std::unique_ptr&lt;string&gt; <span class="title">p1</span><span class="params">(<span class="keyword">new</span> std::string(<span class="string">&quot;1&quot;</span>))</span></span>;</span><br><span class="line"><span class="function">std::unique_ptr&lt;string&gt; <span class="title">p2</span><span class="params">(p1.release())</span></span>;    <span class="comment">//p1ç½®ç©º,p2æ¥ç®¡</span></span><br><span class="line"></span><br><span class="line"><span class="function">std::unique_ptr&lt;string&gt; <span class="title">p3</span><span class="params">(<span class="keyword">new</span> std::string(<span class="string">&quot;3&quot;</span>))</span></span>;</span><br><span class="line">p2.<span class="built_in">reset</span>(p3.<span class="built_in">release</span>());                      <span class="comment">//p2ä¼šé‡Šæ”¾åŸæ¥æŒ‡å‘çš„å¯¹è±¡ï¼Œæ¥ç®¡p3åŸæ¥çš„å¯¹è±¡</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>shared_ptr</p>
<p>shared_ptrå®ç°å…±äº«å¼æ‹¥æœ‰æ¦‚å¿µã€‚å¤šä¸ªæ™ºèƒ½æŒ‡é’ˆæŒ‡å‘ç›¸åŒå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å’Œå…¶ç›¸å…³èµ„æºä¼šåœ¨â€œæœ€åä¸€ä¸ªå¼•ç”¨è¢«é”€æ¯â€æ—¶é‡Šæ”¾ã€‚é‡‡ç”¨è®¡æ•°æœºåˆ¶è¡¨æ˜èµ„æºè¢«å‡ ä¸ªæŒ‡é’ˆå…±äº«ï¼Œå¯é€šè¿‡æˆå‘˜å‡½æ•°<code>use_count()</code>æŸ¥çœ‹èµ„æºæ‰€å¾—è€…ä¸ªæ•°ã€‚</p>
<ul>
<li><p>æ„é€ æ–¹å¼ï¼š</p>
<p>å¯é€šè¿‡newæ¥æ„é€ ï¼Œä¹Ÿå¯é€šè¿‡ä¼ å…¥<code>auto_ptr</code>ï¼Œ<code>unique_ptr</code>ï¼Œ<code>weak_ptr</code>æ¥æ„é€ ï¼Œè¿˜å¯é€šè¿‡<code>std::make_shared</code>å‡½æ•°æ„é€ ï¼Œå¦‚ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">std::shared_ptr&lt;<span class="type">int</span>&gt; <span class="title">sptr3</span><span class="params">(<span class="keyword">new</span> <span class="type">int</span>(<span class="number">10</span>))</span></span>;</span><br><span class="line">std::shared_ptr&lt;<span class="type">int</span>&gt; sptr4 = std::<span class="built_in">make_shared</span>&lt;<span class="type">int</span>&gt;(<span class="number">5</span>);</span><br></pre></td></tr></table></figure>

<p>ç”±äºæ‰€æœ‰æƒæ˜¯å¯ä»¥è¢«å®‰å…¨å…±äº«çš„ï¼Œæ‰€ä»¥å…è®¸æ‹·è´èµ‹å€¼ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> ptr1 = std::<span class="built_in">make_shared</span>&lt;<span class="type">int</span>&gt;(<span class="number">42</span>);</span><br><span class="line"><span class="keyword">auto</span> ptr2 = ptr1;</span><br></pre></td></tr></table></figure>
</li>
<li><p>é”€æ¯æ–¹å¼ï¼š</p>
<p>å¯¹æŸä¸ªæŒ‡é’ˆè°ƒç”¨release()æ—¶ï¼Œå½“å‰æŒ‡é’ˆä¼šé‡Šæ”¾èµ„æºæ‰€æœ‰æƒï¼Œè®¡æ•°å‡1ã€‚å½“è®¡æ•°ç­‰äº0ï¼Œèµ„æºè¢«é‡Šæ”¾</p>
</li>
<li><p>å…³é”®æˆå‘˜å‡½æ•°ï¼š</p>
<p>use_countï¼šè¿”å›å¼•ç”¨è®¡æ•°çš„ä¸ªæ•°</p>
<p>uniqueï¼šè¿”å›æ˜¯å¦æ˜¯ç‹¬å æ‰€æœ‰æƒï¼ˆuse_countä¸º1ï¼‰</p>
<p>swapï¼šäº¤æ¢ä¸¤ä¸ªshared_ptrå¯¹è±¡</p>
<p>resetï¼šæ”¾å¼ƒå†…éƒ¨å¯¹è±¡çš„æ‰€æœ‰æƒæˆ–æ‹¥æœ‰å¯¹è±¡çš„å˜æ›´ï¼Œä¼šå¼•èµ·åŸæœ‰å¯¹è±¡çš„å¼•ç”¨è®¡æ•°çš„å‡å°‘</p>
<p>getï¼šè¿”å›å†…éƒ¨å¯¹è±¡ï¼ˆæŒ‡é’ˆï¼‰ï¼Œå¦‚<code>shared_ptr&lt;int&gt;sp (new int(1))</code>åï¼Œ<code>sp</code>ä¸<code>sp.get()</code>æ˜¯ç­‰ä»·çš„</p>
</li>
</ul>
</li>
<li><p>weak_ptr</p>
<p>weak_ptræŒ‡å‘ç”±shared_ptrç®¡ç†çš„å¯¹è±¡ï¼Œä½†ä¸æ§åˆ¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚è€ƒè™‘è¿™æ ·ä¸€ç§æƒ…å†µï¼Œä¸¤ä¸ªshared_ptrç›¸äº’å¼•ç”¨ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  shared_ptr&lt;B&gt; pb_;</span><br><span class="line">  ~<span class="built_in">A</span>()&#123; cout&lt;&lt;<span class="string">&quot;A delete\n&quot;</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  shared_ptr&lt;A&gt; pa_;</span><br><span class="line">  ~<span class="built_in">B</span>()&#123; cout&lt;&lt;<span class="string">&quot;B delete\n&quot;</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">shared_ptr&lt;B&gt; <span class="title">pb</span> <span class="params">(<span class="keyword">new</span> B())</span></span>;</span><br><span class="line"><span class="function">shared_ptr&lt;A&gt; <span class="title">pa</span> <span class="params">(<span class="keyword">new</span> A())</span></span>;</span><br><span class="line">pb-&gt;pa_ = pa;</span><br><span class="line">pa-&gt;pb_ = pb;</span><br><span class="line">cout &lt;&lt; pb.<span class="built_in">use_count</span>() &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; pa.<span class="built_in">use_count</span>() &lt;&lt; endl;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶ä¸¤ä¸ªæŒ‡é’ˆäº’ç›¸å¼•ç”¨ï¼Œå½¢æˆäº†æ­»é”ï¼Œè®¡æ•°ä¸å¯èƒ½ä¸‹é™ä¸º0ï¼ˆä¸¤ä¸ªçš„è®¡æ•°éƒ½ä¸º2ï¼‰ï¼Œèµ„æºæ°¸è¿œä¸ä¼šé‡Šæ”¾ã€‚è€Œweak_ptræ—¨åœ¨è§£å†³è¿™ä¸€é—®é¢˜ï¼Œweak_pträ¸ä¼šå¼•èµ·è®¡æ•°çš„å¢åŠ æˆ–å‡å°‘ï¼Œä½†å¯æŒ‡å‘shared_ptrç®¡ç†çš„å¯¹è±¡ï¼Œå› æ­¤åœ¨ä¾‹å­ä¸­ï¼Œä¸¤shared_pträ¸­çš„ä¸€ä¸ªé™çº§ä¸ºweak_ptrå³å¯è§£å†³æ­»é”é—®é¢˜ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  weak_ptr&lt;B&gt; pb_;</span><br><span class="line">  ~<span class="built_in">A</span>()&#123; cout&lt;&lt;<span class="string">&quot;A delete\n&quot;</span>; &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>weak_ptråŸºæœ¬ç”¨æ³•ï¼š</p>
<p>&amp;#x20;å¦‚æœè¦ä½¿ç”¨weak_ptræŒ‡å‘çš„å¯¹è±¡ï¼Œé¦–å…ˆè¦ç”¨expiredæˆå‘˜å‡½æ•°æ£€æŸ¥å¯¹è±¡æ˜¯å¦å­˜åœ¨ä¸”æ˜¯å¦èƒ½å¼•ç”¨ï¼Œä¹‹åå†ç”¨lockæˆå‘˜å‡½æ•°å‡æ ¼ä¸ºshared_ptrï¼Œæ‰èƒ½ä½¿ç”¨ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="function">std::shared_ptr&lt;<span class="type">int</span>&gt; <span class="title">sptr</span><span class="params">(<span class="keyword">new</span> <span class="type">int</span>(<span class="number">3</span>))</span></span>;  <span class="comment">//strong ref = 1</span></span><br><span class="line">  std::shared_ptr&lt;<span class="type">int</span>&gt; sptr2 = sptr;      <span class="comment">//strong ref = 2</span></span><br><span class="line"></span><br><span class="line">  std::weak_ptr&lt;<span class="type">int</span>&gt; wptr = sptr;         <span class="comment">//strong ref = 2, weak ref = 1</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!wptr.<span class="built_in">expired</span>())&#123;</span><br><span class="line">    std::shared_ptr&lt;<span class="type">int</span>&gt; sptr3 = wptr.<span class="built_in">lock</span>();<span class="comment">//strong ref = 3, weak ref = 1</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨weak_ptræ˜¯æœ‰å¼ºå¼±å¼•ç”¨è®¡æ•°çš„</p>
</li>
</ul>
</li>
<li><p>æ™ºèƒ½æŒ‡é’ˆæ˜¯å¦ä¼šæœ‰å†…å­˜æ³„æ¼</p>
<p>å½“ä¸¤ä¸ªå¯¹è±¡ç›¸äº’ä½¿ç”¨ä¸€ä¸ªshared_ptræˆå‘˜å˜é‡æŒ‡å‘å¯¹æ–¹ï¼Œä¼šé€ æˆå¾ªç¯å¼•ç”¨ï¼Œä½¿å¼•ç”¨è®¡æ•°å¤±æ•ˆï¼Œé€€å‡ºä½œç”¨åŸŸæ—¶æœªèƒ½é‡Šæ”¾å†…å­˜ï¼Œä»è€Œå¯¼è‡´å†…å­˜æ³„éœ²ã€‚</p>
</li>
<li><p>æ™ºèƒ½æŒ‡é’ˆçš„å†…å­˜æ³„éœ²å¦‚ä½•å¤„ç†</p>
<p>ä¸ºäº†è§£å†³å¾ªç¯å¼•ç”¨å¯¼è‡´çš„å†…å­˜æ³„æ¼ï¼Œå¼•å…¥äº†weak_ptrå¼±æŒ‡é’ˆï¼Œweak_ptrçš„æ„é€ å‡½æ•°ä¸ä¼šä¿®æ”¹å¼•ç”¨è®¡æ•°çš„å€¼ï¼Œä»è€Œä¸ä¼šå¯¹å¯¹è±¡çš„å†…å­˜è¿›è¡Œç®¡ç†ï¼Œå…¶ç±»ä¼¼ä¸€ä¸ªæ™®é€šæŒ‡é’ˆï¼Œä½†ä¸æŒ‡å‘å¼•ç”¨è®¡æ•°çš„å…±äº«å†…å­˜ï¼Œä½†æ˜¯å…¶å¯ä»¥æ£€æµ‹åˆ°æ‰€ç®¡ç†çš„å¯¹è±¡æ˜¯å¦å·²ç»è¢«é‡Šæ”¾ï¼Œä»è€Œé¿å…éæ³•è®¿é—®ã€‚</p>
</li>
</ul>
<h4 id="å†™æ—¶æ‹·è´ï¼ˆCOW-Copy-On-Writeï¼‰"><a href="#å†™æ—¶æ‹·è´ï¼ˆCOW-Copy-On-Writeï¼‰" class="headerlink" title="å†™æ—¶æ‹·è´ï¼ˆCOW, Copy On Writeï¼‰"></a>å†™æ—¶æ‹·è´ï¼ˆCOW, Copy On Writeï¼‰</h4><p>&amp;#x20;æ·±æ‹·è´å’Œæµ…æ‹·è´å„æœ‰ä¼˜åŠ£ï¼Œå‰è€…å¯ä»¥é¿å…é‡å¤ææ„çš„é—®é¢˜ï¼Œåè€…å¯ä»¥æé«˜ä»£ç æ•ˆç‡ã€‚å†™æ—¶æ‹·è´å³æ˜¯èåˆäº†äºŒè€…ä¼˜ç‚¹çš„æ”¹è‰¯æ–¹æ¡ˆï¼Œç±»ä¼¼äºshared_ptrã€‚</p>
<p>å…¶ç‰¹ç‚¹ä¸ºï¼š<strong>å†™ä¹‹å‰â†’æµ…æ‹·è´</strong>ï¼Œå¤šä¸ªå¯¹è±¡å¯ä»¥æŒ‡å‘ä¸€ç‰‡å†…å­˜ï¼›<strong>ä¿®æ”¹æ—¶â†’æ·±æ‹·è´</strong>ï¼Œå“ªä¸ªå¯¹è±¡è¦ä¿®æ”¹å†…å­˜çš„å€¼ï¼Œå°±ä¸ºå…¶æ–°å¼€è¾Ÿä¸€å—ç©ºé—´ã€‚å½“è¦é‡Šæ”¾æ‰æŸç‰‡å†…å­˜æ—¶ï¼Œåªåœ¨<strong>æœ€åä¸€ä¸ªå¯¹è±¡é”€æ¯æ—¶</strong>é‡Šæ”¾è¯¥å†…å­˜ã€‚</p>
<ul>
<li><p>å¦‚ä½•çŸ¥é“å½“å‰ææ„çš„æ˜¯å¦æ˜¯æœ€åä¸€ä¸ªå¯¹è±¡ï¼Ÿ</p>
<p>åˆ©ç”¨è®¡æ•°å™¨ï¼ˆ<strong>å¼•ç”¨è®¡æ•°</strong>ï¼‰ï¼Œå½“æ–°å¢äº†ä¸€ä¸ªæŒ‡å‘è¿™ç‰‡å†…å­˜çš„å¯¹è±¡æ—¶ï¼Œè¯¥è®¡æ•°å™¨åŠ 1ï¼Œå½“é”€æ¯äº†ä¸€ä¸ªæŒ‡å‘è¿™ç‰‡å†…å­˜çš„å¯¹è±¡æ—¶ï¼Œè®¡æ•°å™¨å‡1ã€‚å‡åˆ°0æ—¶ï¼Œè¯´æ˜åœ¨é”€æ¯æœ€å³ä¸€ä¸ªå¯¹è±¡ï¼Œæ­¤æ—¶å¯ä»¥é‡Šæ”¾å†…å­˜ã€‚</p>
<p>è®¡æ•°å™¨ä½ç½®çš„é€‰å–æ˜¯æ­¤æ–¹æ¡ˆæœ€é‡è¦çš„é—®é¢˜ã€‚</p>
<ul>
<li><p>å¼•ç”¨è®¡æ•°ä½œä¸ºæˆå‘˜å˜é‡ï¼Ÿ</p>
<p>éš¾ä»¥åšåˆ°å¤šä¸ªå¯¹è±¡ä¹‹é—´çš„åŒæ­¥ã€‚</p>
</li>
<li><p>å¼•ç”¨è®¡æ•°ä½œä¸ºé™æ€å˜é‡ï¼Ÿ</p>
<p>æ‰€æœ‰å¯¹è±¡å…±äº«è¯¥å¼•ç”¨è®¡æ•°ï¼Œå¦‚æœéƒ½æŒ‡å‘äº†ç›¸åŒå†…å­˜ï¼Œå¯ä»¥è¾¾åˆ°è®¡æ•°ç›®çš„ã€‚ç„¶è€Œï¼Œå¦‚æœå‡ºç°äº†å†™æ“ä½œï¼Œä¼šå¯¼è‡´é—®é¢˜ã€‚ä¸¾ä¾‹è¯´æ˜ï¼Œç±»ä¸­æœ‰ä¸€ä¸ªstringæŒ‡é’ˆå±æ€§ï¼Œå®ä¾‹åŒ–å¯¹è±¡æ—¶éœ€è¦å¼€è¾Ÿå†…å­˜ã€‚å½“å‰ä¸‰ä¸ªå¯¹è±¡éƒ½æŒ‡å‘â€helloâ€å­—ç¬¦ä¸²æ—¶ï¼Œè®¡æ•°å™¨ä¼šåŠ åˆ°3ï¼Œä½†æ˜¯å¦‚æœç¬¬å››ä¸ªå¯¹è±¡æŒ‡å‘äº†â€worldâ€å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆç¬¬å››ä¸ªå¯¹è±¡ä¼šå°†è®¡æ•°å™¨ç½®1ã€‚é‚£ä¹ˆå‰ä¸‰ä¸ªå¯¹è±¡çš„è®¡æ•°å™¨ä¹Ÿä¼šè¢«ä¿®æ”¹ä¸º1ï¼Œä»è€Œæ— æ³•é‡Šæ”¾æ‰â€helloâ€å­—ç¬¦ä¸²ã€‚</p>
</li>
<li><p><strong>å¼•ç”¨è®¡æ•°æ”¾åœ¨å †å†…å­˜ä¸­</strong>ï¼š</p>
<p>å°†å¼•ç”¨è®¡æ•°å˜é‡æ”¾åœ¨å †å†…å­˜ä¸­ï¼Œæ˜¯å†™æ—¶æ‹·è´çš„æƒ¯ç”¨æ–¹æ¡ˆã€‚å½“å¼€è¾Ÿå†…å­˜æ—¶ï¼Œå¤šç•™4å­—èŠ‚çš„è£•é‡ï¼Œå°†å¼•ç”¨è®¡æ•°æ”¾åœ¨å †å†…å­˜èµ·å§‹ä½ç½®ã€‚ä¹‹åå†å°†ç±»çš„å±æ€§ï¼ˆæŒ‡é’ˆï¼‰æŒ‡å‘å †å†…å­˜èµ·å§‹ä½ç½®+4ã€‚</p>
<p><img src="/image/image_pNRhIJgYeq.png"></p>
</li>
</ul>
</li>
</ul>
<p>ä»¥è‡ªå®šä¹‰ä¸€ä¸ªCStringç±»å‹ä¸ºä¾‹ï¼š</p>
<ol>
<li><p>æŸ¥çœ‹å¼•ç”¨è®¡æ•°å‡½æ•°ï¼š</p>
<p>å¼•ç”¨è®¡æ•°åœ¨å †å†…å­˜ä¸­ï¼Œéœ€è¦æŸ¥çœ‹æˆ–ä¿®æ”¹æ—¶ï¼Œè¿”å›è¯¥å†…å­˜çš„å¼•ç”¨ã€‚å› ä¸ºå †å†…å­˜å¼€è¾Ÿæ—¶æ˜¯charç±»å‹ï¼ŒæŒ‡é’ˆéœ€å¼ºåˆ¶è½¬ä¸ºint*</p>
<p>ä¸åº”æš´éœ²å‡ºå¯ä»¥å¤–éƒ¨ä¿®æ”¹å¼•ç”¨è®¡æ•°çš„æ¥å£ï¼Œæ‰€ä»¥å¼•ç”¨è®¡æ•°å’ŒæŸ¥çœ‹å‡½æ•°å‡åº”æ˜¯ç§æœ‰çš„ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//mptræ˜¯ç±»CStringä¸­ï¼ŒæŒ‡å‘å †å†…å­˜çš„æŒ‡é’ˆæˆå‘˜</span></span><br><span class="line"><span class="function"><span class="type">int</span>&amp; <span class="title">getRefCount</span><span class="params">(<span class="type">char</span>* ptr)</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> *(<span class="type">int</span>*)(ptr<span class="number">-4</span>);         <span class="comment">//ptræŒ‡å‘çš„æ˜¯å­—ç¬¦ä¸²ï¼Œæƒ³æŸ¥çœ‹å¼•ç”¨è®¡æ•°éœ€åœ°å€å›é€€å››ä¸ªå­—èŠ‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>é‡Šæ”¾å†…å­˜å‡½æ•°ï¼š</p>
<p>é‡Šæ”¾å†…å­˜æ¶‰åŠçš„é—®é¢˜æ˜¯åˆ¤æ–­æ˜¯å¦é”€æ¯åˆ°äº†æŒ‡å‘è¿™ç‰‡å†…å­˜çš„æœ€åä¸€ä¸ªå¯¹è±¡ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Release</span><span class="params">(<span class="type">char</span>* ptr)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(--<span class="built_in">getRefCount</span>(mptr) == <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">delete</span>[] (mptr<span class="number">-4</span>);                <span class="comment">//é‡Šæ”¾å†…å­˜çš„æ—¶å€™è¿˜è¦é‡Šæ”¾ä¿å­˜å¼•ç”¨è®¡æ•°çš„å››ä¸ªå­—èŠ‚</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ„é€ å‡½æ•°ï¼š</p>
<p>æ„é€ å‡½æ•°éœ€ä»ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡æ„é€ ï¼Œç”±äºäº‹å…ˆå¹¶æ— å¼€è¾Ÿçš„å †å†…å­˜ï¼Œæ‰€ä»¥éœ€è¦å¼€è¾Ÿæ–°å†…å­˜ï¼Œå¹¶å°†å¼•ç”¨è®¡æ•°ç½®1ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">CString</span>(<span class="type">char</span>* ptr=<span class="literal">NULL</span>) : <span class="built_in">mptr</span>(<span class="keyword">new</span> <span class="type">char</span>[<span class="built_in">strlen</span>(ptr) + <span class="number">1</span> + <span class="number">4</span>])&#123;     <span class="comment">//ä»å­—ç¬¦ä¸²å¸¸é‡æ„é€ CStringå¯¹è±¡</span></span><br><span class="line">  mptr += <span class="number">4</span>;</span><br><span class="line">  <span class="built_in">strcpy</span>(mptr, ptr);</span><br><span class="line">  <span class="built_in">getRefCount</span>(mptr) = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ‹·è´æ„é€ å‡½æ•°å’Œé‡è½½èµ‹å€¼è¿ç®—ç¬¦ï¼š</p>
<p>æ‹·è´æ„é€ å‡½æ•°ç”¨æµ…æ‹·è´ï¼ŒåŒæ—¶ç»™å¼•ç”¨è®¡æ•°åŠ 1ã€‚</p>
<p>è€Œèµ‹å€¼è¿ç®—ç¬¦éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå·¦å€¼æ˜¯åŸå†…å­˜çš„æœ€åä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™éœ€è¦é”€æ¯åŸå†…å­˜ï¼ˆæˆ–è€…ä¸æ˜¯æœ€åä¸€ä¸ªå¯¹è±¡ï¼Œè¦å¼•ç”¨è®¡æ•°å‡1ï¼‰ï¼Œå†è¿›è¡Œæµ…æ‹·è´ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">CString</span>(<span class="type">const</span> CString&amp; rhs):<span class="built_in">mptr</span>(rhs.mptr)&#123;</span><br><span class="line">  ++<span class="built_in">getRefCount</span>(mptr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">CString&amp; <span class="keyword">operator</span>=(<span class="type">const</span> CString&amp; rhs)&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span> != &amp;rhs)&#123;</span><br><span class="line">    <span class="built_in">Release</span>(mptr);</span><br><span class="line">    mptr = rhs.mptr;</span><br><span class="line">    ++<span class="built_in">getRefCount</span>(mptr);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>é‡è½½[]è¿ç®—ç¬¦å‡½æ•°ï¼š</p>
<p>[ ]è¿ç®—ç¬¦æ¶‰åŠçš„é—®é¢˜æ˜¯ï¼ŒCStingå®šä¹‰çš„å¯¹è±¡strï¼Œå¾€å¾€æ˜¯é€šè¿‡[ ]æ¥ä¿®æ”¹å€¼çš„ï¼Œæ¯”å¦‚str[1]&#x3D;â€™aâ€™ã€‚æ‰€ä»¥è¿™é‡Œä¸åº”é‡‡ç”¨æµ…æ‹·è´ï¼Œè€Œåº”æ˜¯æ·±æ‹·è´ã€‚è¿™ä¹Ÿå¯¹åº”äº†<strong>å†™æ—¶æ‹·è´</strong>çš„æ¦‚å¿µï¼Œå³åªæœ‰å‘ç”Ÿä¿®æ”¹æ—¶ï¼Œæ‰ç”¨æ·±æ‹·è´ã€‚</p>
<p>ä½†ä¹Ÿä¸æ˜¯æ‰€æœ‰æƒ…å†µä¸‹éƒ½å¿…é¡»ç”¨æ·±æ‹·è´ï¼Œå¦‚æœå¼•ç”¨è®¡æ•°ä¸º1ï¼Œè¯´æ˜åªæœ‰ä¸€ä¸ªå¯¹è±¡ç‹¬å èµ„æºï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥åœ¨åŸå†…å­˜ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œä¸éœ€è¦æ·±æ‹·è´ã€‚å¦‚æœå¼•ç”¨è®¡æ•°å¤§äº1ï¼Œè¯´æ˜å¤šä¸ªå¯¹è±¡å…±äº«å †å†…å­˜ï¼Œé‚£ä¹ˆä¸€ä¸ªå¯¹è±¡åŠ¨äº†å †ï¼Œå…¶ä»–å¯¹è±¡ä¹Ÿä¼šè·Ÿç€æ”¹å˜ï¼Œä½†æ˜¯å…¶ä»–å¯¹è±¡æœ¬æ¥çš„å †å†…å­˜çš„å€¼æœ¬å°±ä¸åº”æ”¹å˜ï¼Œè¿™æ—¶éœ€è¦é‡‡ç”¨æ·±æ‹·è´ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"> <span class="type">char</span>&amp; <span class="keyword">operator</span>[](<span class="type">int</span> index)&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">getRefCount</span>(mptr) &gt; <span class="number">1</span>)&#123;                   <span class="comment">//åˆ¤æ–­å¼•ç”¨è®¡æ•°æ˜¯å¦å¤§äº1</span></span><br><span class="line">    <span class="type">char</span>* ptr = mptr;</span><br><span class="line">    mptr = <span class="keyword">new</span> <span class="built_in">char</span>(<span class="built_in">strlen</span>(mptr) + <span class="number">1</span> + <span class="number">4</span>);     <span class="comment">//æ·±æ‹·è´</span></span><br><span class="line">    --<span class="built_in">getRefCount</span>(ptr);</span><br><span class="line">    mptr += <span class="number">4</span>;</span><br><span class="line">    <span class="built_in">strcpy</span>(mptr, ptr);</span><br><span class="line">    <span class="built_in">getRefCount</span>(mptr) = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> mptr[index];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å†™ä¹Ÿå­˜åœ¨é—®é¢˜ï¼Œå¾ˆå¤šæ—¶å€™è°ƒç”¨[ ]åªå¸Œæœ›è®¿é—®å€¼ï¼Œè€Œéä¿®æ”¹ï¼Œä½†è®¿é—®æ—¶ä¹Ÿé‡‡ç”¨äº†æ·±æ‹·è´ï¼Œå¯¼è‡´äº†æ•ˆç‡çš„æŸå¤±ã€‚<strong>è¿™ä¹Ÿæ˜¯å†™æ—¶æ‹·è´çš„ç¼ºç‚¹æ‰€åœ¨</strong>ã€‚</p>
</li>
</ol>
<ul>
<li><p>æ•´ä½“ä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CString</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">CString</span>(<span class="type">char</span>* ptr=<span class="literal">NULL</span>) : <span class="built_in">mptr</span>(<span class="keyword">new</span> <span class="type">char</span>[<span class="built_in">strlen</span>(ptr) + <span class="number">1</span> + <span class="number">4</span>])&#123;</span><br><span class="line">    mptr += <span class="number">4</span>;</span><br><span class="line">    <span class="built_in">strcpy</span>(mptr, ptr);</span><br><span class="line">    <span class="built_in">getRefCount</span>(mptr) = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">CString</span>(<span class="type">const</span> CString&amp; rhs):<span class="built_in">mptr</span>(rhs.mptr)&#123;</span><br><span class="line">    ++<span class="built_in">getRefCount</span>(mptr);</span><br><span class="line">  &#125;</span><br><span class="line">  CString&amp; <span class="keyword">operator</span>=(<span class="type">const</span> CString&amp; rhs)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span> != &amp;rhs)&#123;</span><br><span class="line">      <span class="built_in">Release</span>(mptr);</span><br><span class="line">      mptr = rhs.mptr;</span><br><span class="line">      ++<span class="built_in">getRefCount</span>(mptr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="type">char</span>&amp; <span class="keyword">operator</span>[](<span class="type">int</span> index)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">getRefCount</span>(mptr) &gt; <span class="number">1</span>)&#123;</span><br><span class="line">      <span class="type">char</span>* ptr = mptr;</span><br><span class="line">      mptr = <span class="keyword">new</span> <span class="built_in">char</span>(<span class="built_in">strlen</span>(mptr) + <span class="number">1</span> + <span class="number">4</span>);</span><br><span class="line">      --<span class="built_in">getRefCount</span>(ptr);</span><br><span class="line">      mptr += <span class="number">4</span>;</span><br><span class="line">      <span class="built_in">strcpy</span>(mptr, ptr);</span><br><span class="line">      <span class="built_in">getRefCount</span>(mptr) = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mptr[index];</span><br><span class="line">  &#125;</span><br><span class="line">  ~<span class="built_in">CString</span>()&#123;</span><br><span class="line">    <span class="built_in">Release</span>(mptr);                      <span class="comment">//ææ„æ—¶è°ƒç”¨é‡Šæ”¾å†…å­˜å‡½æ•°</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Print</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; mptr &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">char</span>* mptr;</span><br><span class="line">  <span class="function"><span class="type">int</span>&amp; <span class="title">getRefCount</span><span class="params">(<span class="type">char</span>* ptr)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> *(<span class="type">int</span>*)(ptr<span class="number">-4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Release</span><span class="params">(<span class="type">char</span>* ptr)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(--<span class="built_in">getRefCount</span>(mptr) == <span class="number">0</span>)&#123;</span><br><span class="line">      <span class="keyword">delete</span>[] (mptr<span class="number">-4</span>);                <span class="comment">//é‡Šæ”¾å†…å­˜çš„æ—¶å€™è¿˜è¦é‡Šæ”¾ä¿å­˜å¼•ç”¨è®¡æ•°çš„å››ä¸ªå­—èŠ‚</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="function">CString <span class="title">str1</span><span class="params">(<span class="string">&quot;hello&quot;</span>)</span></span>;<span class="comment">//æ„é€ </span></span><br><span class="line">  <span class="function">Cstring <span class="title">str2</span><span class="params">(str1)</span></span>;<span class="comment">//æ‹·è´æ„é€ </span></span><br><span class="line">  <span class="function">CString <span class="title">str3</span><span class="params">(<span class="string">&quot;world&quot;</span>)</span></span>;<span class="comment">//æ„é€ </span></span><br><span class="line">  str1 = str3;</span><br><span class="line">  str1[<span class="number">0</span>] = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">  str1.<span class="built_in">Print</span>();</span><br><span class="line">  str2.<span class="built_in">Print</span>();</span><br><span class="line">  str3.<span class="built_in">Print</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<p>aorld</p>
<p>hellow</p>
<p>world</p>
</li>
</ul>
<h3 id="11-æ¨¡æ¿"><a href="#11-æ¨¡æ¿" class="headerlink" title="11 æ¨¡æ¿"></a>11 æ¨¡æ¿</h3><blockquote>
<p>æ›´é«˜æ·±çš„æ¨¡æ¿çŸ¥è¯†ç§»æ­¥ã€Šæ³›å‹ç¼–ç¨‹ã€‹ç¬”è®°ï¼Œæ³›å‹ç¼–ç¨‹æœ¬èº«å°±æ˜¯C++å‡ å¤§ç¼–ç¨‹é£æ ¼ä¹‹ä¸€ï¼Œå¯ä»¥è¯´éå¸¸å¤æ‚</p>
</blockquote>
<ul>
<li><p>ç±»æ¨¡æ¿</p>
<p>ç¼–è¯‘æ—¶çš„æœºåˆ¶ï¼Œå¹¶ä¸ä¼šäº§ç”Ÿé¢å¤–çš„è¿è¡Œæ—¶å¼€é”€</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Vector</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  T* elem;</span><br><span class="line">  <span class="type">int</span> sz;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">explicit</span> <span class="title">Vector</span><span class="params">(<span class="type">int</span> s)</span></span>;</span><br><span class="line">  ~<span class="built_in">Vector</span>() &#123;<span class="keyword">delete</span>[] elem;&#125;</span><br><span class="line"></span><br><span class="line">  T&amp; <span class="keyword">operator</span>[](<span class="type">int</span> i);</span><br><span class="line">  <span class="type">const</span> T&amp; <span class="keyword">operator</span>[](<span class="type">int</span> i) <span class="type">const</span>;</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span> </span>&#123;<span class="keyword">return</span> sz;&#125;</span><br><span class="line">  <span class="function">T* <span class="title">begin</span><span class="params">(Vector&lt;T&gt;&amp; x)</span></span>;</span><br><span class="line">  <span class="function">T* <span class="title">end</span><span class="params">(Vector&lt;T&gt;&amp; x)</span></span></span><br><span class="line"><span class="function">&#125;</span>;</span><br></pre></td></tr></table></figure>

<p>æˆå‘˜å‡½æ•°çš„å®šä¹‰æ–¹å¼ä¸ä¹‹ç±»ä¼¼</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">Vector&lt;T&gt;::<span class="built_in">Vector</span>(<span class="type">int</span> s)&#123;</span><br><span class="line">  <span class="keyword">if</span>(s &lt; <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">throw</span> Negative_size&#123;&#125;;</span><br><span class="line">  elem = <span class="keyword">new</span> T[s];</span><br><span class="line">  sz = s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="type">const</span> T&amp; Vector&lt;T&gt;::<span class="keyword">operator</span>[](<span class="type">int</span> i) <span class="type">const</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(i&lt;<span class="number">0</span> || <span class="built_in">size</span>()&lt;=i)</span><br><span class="line">    <span class="keyword">throw</span> <span class="built_in">out_of_range</span>(<span class="string">&quot;Vector::operator[]&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> elem[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">T* <span class="title">begin</span><span class="params">(Vector&lt;T&gt;&amp; x)</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x.<span class="built_in">size</span>() ? &amp;x[<span class="number">0</span>] : <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">T* <span class="title">end</span><span class="params">(Vector&lt;T&gt;&amp; x)</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">begin</span>(x) + x.<span class="built_in">size</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®šä¹‰äº†begin å’Œendå°±å¯ä»¥ä½¿ç”¨forå¾ªç¯äº†</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">f2</span><span class="params">(Vector&lt;string&gt;&amp; vs)</span></span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; s : vs)</span><br><span class="line">    cout &lt;&lt; s &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤äº†ç±»å‹å‚æ•°å¤–ï¼Œè¿˜æ¥å—æ™®é€šçš„å€¼å‚æ•°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="type">int</span> N&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Buffer</span>&#123;</span><br><span class="line">  <span class="keyword">using</span> value_type = T;</span><br><span class="line">  <span class="function"><span class="keyword">constexpr</span> <span class="type">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> N;&#125;</span><br><span class="line">  T[N];</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å‡½æ•°æ¨¡æ¿</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Container, <span class="keyword">typename</span> Value&gt;</span></span><br><span class="line"><span class="function">Value <span class="title">sum</span><span class="params">(<span class="type">const</span> Container&amp; c, Value v)</span></span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">auto</span> x : c)</span><br><span class="line">    v += x;</span><br><span class="line">  <span class="keyword">return</span> v;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„å‡½æ•°ç›¸å½“äºé’ˆå¯¹ä¸åŒçš„ç±»å‹å®ç°äº†ä¸€ä¸ªç´¯åŠ å™¨</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">user</span><span class="params">(Vector&lt;<span class="type">int</span>&gt;&amp; vi, std::list)</span></span>&#123;</span><br><span class="line">  <span class="type">int</span> x = <span class="built_in">sum</span>(vi, <span class="number">0</span>);</span><br><span class="line">  <span class="type">double</span> d = <span class="built_in">sum</span>(vi, <span class="number">0.0</span>);</span><br><span class="line">  <span class="type">double</span> dd = <span class="built_in">sum</span>(ld, <span class="number">0.0</span>);</span><br><span class="line">  <span class="keyword">auto</span> z = <span class="built_in">sum</span>(vc, complex&lt;<span class="type">double</span>&gt;&#123;&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>ğŸ“Œæ¨¡æ¿ä¹Ÿå¯ä»¥è·Ÿå‡½æ•°å‚æ•°ä¸€æ ·ï¼Œæœ‰é»˜è®¤å€¼ã€‚<br>template &lt;typename ty&#x3D;string&gt;<br>int test(ty x) {<br>&amp;#x20;&#x2F;&#x2F;â€¦â€¦<br>}<br>å¦‚æœæ²¡æœ‰æ˜¾å¼è¯´æ˜tyçš„ç±»å‹ï¼Œä¹Ÿæ²¡æœ‰è‡ªåŠ¨æ¨æ–­ï¼Œé‚£ä¹ˆç¼–è¯‘æ—¶å°±ä¼šè®©tyæˆä¸ºé»˜è®¤ç±»å‹stringã€‚</p>
</blockquote>
<h4 id="é™æ€å¤šæ€ï¼šCRTP"><a href="#é™æ€å¤šæ€ï¼šCRTP" class="headerlink" title="é™æ€å¤šæ€ï¼šCRTP"></a>é™æ€å¤šæ€ï¼šCRTP</h4><blockquote>
<p><strong>C</strong>uriously <strong>R</strong>ecurring <strong>T</strong>emplate <strong>P</strong>attern</p>
</blockquote>
<p>ä¸€èˆ¬æ„ä¹‰ä¸Šçš„ä½¿ç”¨virtualå®ç°çš„å¤šæ€å‡ä¸ºåŠ¨æ€å¤šæ€ï¼Œåœ¨è¿è¡Œæ—¶å®ç°å¤šæ€ã€‚åœ¨C++ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨<strong>é™æ€å¤šæ€</strong>ï¼Œåœ¨ç¼–è¯‘æ—¶å®ç°å¤šæ€ã€‚åŠ¨æ€å¤šæ€ç”±äºå­˜å‚¨è™šè¡¨æŒ‡é’ˆå’Œè™šè¡¨ï¼Œä»¥åŠæœ‰æŸ¥è¯¢è™šå‡½æ•°åœ°å€çš„ä¸€ç³»åˆ—æ“ä½œï¼Œä¼šå¸¦æ¥è¾ƒå¤§çš„å¼€é”€ã€‚é™æ€å¤šæ€å¯ä»¥<strong>æå‡æ•ˆç‡ï¼ˆé™ä½å¼€é”€ï¼‰</strong>ï¼Œå°±åƒå†…è”å‡½æ•°ä¸€æ ·ã€‚</p>
<ul>
<li><p>åŠ¨æ€å¤šæ€ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Print</span><span class="params">()</span> <span class="type">const</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;unset&quot;</span> &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> : <span class="keyword">public</span> Animal&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Print</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Dog&quot;</span> &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> : <span class="keyword">public</span> Animal&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Print</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Cat&quot;</span> &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">My_Print</span><span class="params">(<span class="type">const</span> Animal&amp; animal)</span></span>&#123;</span><br><span class="line">  animal.<span class="built_in">Print</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Dog d;</span><br><span class="line">  <span class="built_in">My_Print</span>(d);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<!---->

<ul>
<li><p>æœ€ç®€å•çš„é™æ€å¤šæ€ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Animal_Type</span>&#123;</span><br><span class="line">  unset, Dog, Cat,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Animal</span>(Animal_Type animal_type) </span><br><span class="line">    : <span class="built_in">animal_type</span>(animal_type) &#123;&#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Print</span><span class="params">()</span> <span class="type">const</span></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(animal_type)&#123;</span><br><span class="line">      <span class="keyword">case</span> unset:</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;unset&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> Dog:</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Dog&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> Cat:</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Cat&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  Animal_Type animal_type;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">My_Print</span><span class="params">(<span class="type">const</span> Animal&amp; animal)</span></span>&#123;</span><br><span class="line">  animal.<span class="built_in">Print</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="function">Animal <span class="title">dog</span><span class="params">(Animal_Type::Dog)</span></span>;</span><br><span class="line">  <span class="built_in">My_Print</span>(dog);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>ç„¶è€Œè¿™ç§æœ€ç®€å•çš„é™æ€å¤šæ€æ–¹æ³•å¯¼è‡´çš„é—®é¢˜æ˜¯æ˜æ˜¾çš„ï¼ŒAnimalç±»éå¸¸éš¾ä»¥ç»´æŠ¤ï¼Œè¦åŠ ä¸€ä¸ªæ–°ç±»åˆ«æˆ–æ–°åŠ¨ä½œï¼Œè¦ç›´æ¥ä¿®æ”¹Animalç±»å’ŒAnimal_Typeç±»çš„æºç ã€‚äºæ˜¯å¯ä»¥é‡‡ç”¨æ¨¡æ¿æ¥è¿›è¡Œæ”¹è¿›ï¼ˆéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œæ—¢ä¸ç”¨virtualï¼Œä¹Ÿä¸ç”¨æ¨¡æ¿ï¼Œè¾¾ä¸åˆ°å¤šæ€çš„ç›®çš„ï¼‰ï¼š</p>
<ul>
<li><p>ä¸ç”¨virtualå’Œæ¨¡æ¿æ— æ³•å®ç°å¤šæ€ï¼š</p>
<p>æ‰“å°çš„ç»“æœæ˜¯unsetï¼Œå› ä¸ºè°ƒç”¨My_Printæ—¶ä¼šæŠŠDogç±»éšå¼è½¬æ¢ä¸ºAnimalç±»ï¼ˆå› ä¸ºMy_Printå‡½æ•°æ¥æ”¶çš„å‚æ•°è¦æ±‚æ˜¯Animalç±»ï¼‰</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Print</span><span class="params">()</span> <span class="type">const</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;unset&quot;</span> &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> : <span class="keyword">public</span> Animal&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Print</span><span class="params">()</span> <span class="type">const</span></span>&#123;<span class="comment">//è¦†ç›–åŸPrint</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Dog&quot;</span> &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> : <span class="keyword">public</span> Animal&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Print</span><span class="params">()</span> <span class="type">const</span></span>&#123;<span class="comment">//è¦†ç›–åŸPrint</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Cat&quot;</span> &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">My_Print</span><span class="params">(<span class="type">const</span> Animal&amp; animal)</span></span>&#123;</span><br><span class="line">  animal.<span class="built_in">Print</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Dog d;</span><br><span class="line">  <span class="built_in">My_Print</span>(d);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<!---->

<ul>
<li><p>åˆ©ç”¨æ¨¡æ¿æ”¹è¿›çš„é™æ€å¤šæ€ï¼š</p>
<p>æ‰“å°Dogï¼ŒMy_Printæ˜¯æ¨¡æ¿å‡½æ•°ï¼Œè‡ªåŠ¨æ¨æ–­ç±»å‹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Print</span><span class="params">()</span> <span class="type">const</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;unset&quot;</span> &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> : <span class="keyword">public</span> Animal&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Print</span><span class="params">()</span> <span class="type">const</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Dog&quot;</span> &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> : <span class="keyword">public</span> Animal&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Print</span><span class="params">()</span> <span class="type">const</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Cat&quot;</span> &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> A_T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">My_Print</span><span class="params">(<span class="type">const</span> A_T&amp; animal)</span></span>&#123;</span><br><span class="line">  animal.<span class="built_in">Print</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Dog d;</span><br><span class="line">  <span class="built_in">My_Print</span>(d);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>å¯ä»¥åœ¨ä¸Šé¢çš„é™æ€å¤šæ€å®ç°æ–¹æ¡ˆçš„åŸºç¡€ä¸Šï¼Œè¿›ä¸€æ­¥æ”¹è‰¯ã€‚ç°åœ¨æ˜¯æœ‰ä¸‰ä¸ªPrintå‡½æ•°ï¼Œå¯ä»¥è¿›ä¸€æ­¥é™åˆ°åªæœ‰ä¸¤ä¸ªå‡½æ•°ä»¥é™ä½å¼€é”€ã€‚æ”¹è‰¯çš„æ–¹æ¡ˆæ˜¯CRTPã€‚</p>
<p>CRTPä¸€èˆ¬çš„å¥—è·¯å¦‚ä¸‹ï¼Œåœ¨åŸºç±»ä¸Šç”¨æ¨¡æ¿ï¼ŒåŸºç±»åªä¿ç•™æ¥å£ï¼Œå­ç±»è´Ÿè´£æ¥å£çš„å…·ä½“å®ç°ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Derived</span>&gt; </span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Base</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Interface</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="built_in">static_cast</span>&lt;Derived*&gt;(<span class="keyword">this</span>)-&gt;<span class="built_in">Implementation</span>();</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Derived</span> : Base&lt;Derived&gt; &#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Implementation</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>é’ˆå¯¹ä¸Šé¢çš„ä¾‹å­ï¼Œåˆ™å¯ä»¥æ”¹å†™ä¸ºCRTPå®ç°çš„é™æ€å¤šæ€ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Derived&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Print</span><span class="params">()</span> <span class="type">const</span></span>&#123;</span><br><span class="line">    <span class="built_in">static_cast</span>&lt;Derived*&gt;(<span class="keyword">this</span>) -&gt; <span class="built_in">Print</span>(); </span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> : <span class="keyword">public</span> Animal&lt;Dog&gt;&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Print</span><span class="params">()</span> <span class="type">const</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Dog&quot;</span> &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> : <span class="keyword">public</span> Animal&lt;Cat&gt;&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Print</span><span class="params">()</span> <span class="type">const</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Cat&quot;</span> &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> A_T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">My_Print</span><span class="params">(<span class="type">const</span> A_T&amp; animal)</span></span>&#123;</span><br><span class="line">  animal.<span class="built_in">Print</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Dog d;</span><br><span class="line">  <span class="built_in">My_Print</span>(d);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¡¨é¢ä¸ŠDogå’ŒCatç±»éƒ½åœ¨ç»§æ‰¿Animalï¼Œä½†äº‹å®ä¸Šå®ƒä»¬ç»§æ‰¿çš„ç±»æ˜¯ä¸åŒçš„ï¼ŒDogç»§æ‰¿çš„æ˜¯Animal&lt;Dog&gt;ç±»ï¼ŒCatç»§æ‰¿çš„æ˜¯Animal&lt;Cat&gt;ç±»ã€‚å› æ­¤å³ä½¿åŸºç±»ä¸­æœ‰staticå˜é‡ï¼Œå®ƒä»¬æ˜¯ä¸å…±äº«çš„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç”±äºç»§æ‰¿çš„ä¸æ˜¯åŒä¸€ä¸ªåŸºç±»ï¼ŒDogå’ŒCatçš„å¯¹è±¡ä¹Ÿæ— æ³•æ”¾åœ¨åŒä¸€ä¸ªSTLå®¹å™¨ä¸­ï¼Œè¿™ä¹Ÿç»™CRTPçš„ä½¿ç”¨å¸¦æ¥äº†å±€é™ã€‚</p>
<h4 id="å‡½æ•°å¯¹è±¡ï¼ˆfunction-object-x2F-functorï¼‰"><a href="#å‡½æ•°å¯¹è±¡ï¼ˆfunction-object-x2F-functorï¼‰" class="headerlink" title="å‡½æ•°å¯¹è±¡ï¼ˆfunction object&#x2F;functorï¼‰"></a>å‡½æ•°å¯¹è±¡ï¼ˆfunction object&#x2F;functorï¼‰</h4><p>å‡½æ•°å¯¹è±¡ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°†å‡½æ•°è§†ä½œä¸€ä¸ªç±»çš„å¯¹è±¡ã€‚è°ƒç”¨å‡½æ•°å¯¹è±¡æ—¶ä¸è°ƒç”¨å‡½æ•°æ— å¼‚ï¼Œè€Œå‡½æ•°å¯¹è±¡çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯æ¯”è¾ƒçµæ´»ï¼Œå¯ä»¥ä½œä¸ºå…¶ä»–å‡½æ•°çš„å‚æ•°è¢«è°ƒç”¨ã€‚</p>
<p>æ¨¡æ¿çš„ä¸€ä¸ªç‰¹æ®Šç”¨é€”å°±æ˜¯æ³›åŒ–å‡½æ•°å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Less_than</span>&#123;</span><br><span class="line">  <span class="type">const</span> T val; <span class="comment">//å¾…æ¯”è¾ƒçš„å€¼</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Less_than</span>(<span class="type">const</span> T&amp; v) : <span class="built_in">val</span>(v) &#123;&#125;</span><br><span class="line">  <span class="function"><span class="type">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> T&amp; x)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> x &lt; val; &#125; <span class="comment">//è°ƒç”¨è¿ç®—ç¬¦</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶ï¼Œå¯ä»¥åƒè°ƒç”¨å‡½æ•°ä¸€æ ·è°ƒç”¨å‡½æ•°å¯¹è±¡</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">Less_than&lt;<span class="type">int</span>&gt; LT_i &#123;<span class="number">42</span>&#125;;</span><br><span class="line">Less_than&lt;string&gt; LT_s &#123;<span class="string">&quot;Backus&quot;</span>&#125;;</span><br><span class="line"><span class="type">bool</span> b1 = <span class="built_in">LT_i</span>(n);  <span class="comment">//å¦‚æœn&lt;42åˆ™ä¸ºçœŸ</span></span><br><span class="line"><span class="type">bool</span> b2 = <span class="built_in">LT_s</span>(s);  <span class="comment">//å¦‚æœs&lt;&quot;Backus&quot;åˆ™ä¸ºçœŸ</span></span><br></pre></td></tr></table></figure>

<p>å‡½æ•°å¯¹è±¡ç»å¸¸ä½œä¸ºç®—æ³•çš„å‚æ•°å‡ºç°ï¼Œä¾‹å¦‚ä¸‹é¢ä¾‹å­ä¸­predå°±æ˜¯å‡½æ•°å¯¹è±¡ä½œä¸ºçš„å‚æ•°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç»Ÿè®¡å®¹å™¨ä¸­æœ‰å¤šå°‘ä¸ªå°äºæŸæ•°çš„å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> C, <span class="keyword">typename</span> P&gt;</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">count</span><span class="params">(<span class="type">const</span> C&amp; c, P pred)</span></span>&#123;    <span class="comment">//Cå‡å®šä¸ºå®¹å™¨ç±»å‹ï¼ŒPä¸ºå‡½æ•°å¯¹è±¡ç±»å‹</span></span><br><span class="line">  <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">const</span> <span class="keyword">auto</span>&amp; x : c)</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">pred</span>(x))</span><br><span class="line">      ++cnt;</span><br><span class="line">  <span class="keyword">return</span> cnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">(<span class="type">const</span> Vector&lt;<span class="type">int</span>&gt;&amp; vec, <span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">  cout &lt;&lt; <span class="built_in">count</span>(vec, Less_than&lt;<span class="type">int</span>&gt;&#123;x&#125;) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤äº†ç”¨ç±»å’Œæ¨¡æ¿å®šä¹‰å‡½æ•°å¯¹è±¡ï¼Œè¿˜<strong>å¯ä»¥ç”¨åŒ¿åå‡½æ•°(lambdaè¡¨è¾¾å¼)å®šä¹‰å‡½æ•°å¯¹è±¡</strong>ã€‚</p>
<h4 id="å¯å˜å‚æ•°"><a href="#å¯å˜å‚æ•°" class="headerlink" title="å¯å˜å‚æ•°"></a>å¯å˜å‚æ•°</h4><ul>
<li><p>çœç•¥ç¬¦å½¢å‚ï¼š</p>
<p>çœç•¥ç¬¦å½¢å‚åº”è¯¥ä»…ä»…ç”¨äºCå’ŒC++é€šç”¨çš„ç±»å‹ã€‚ç‰¹åˆ«åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œå¤§å¤šæ•°ç±»ç±»å‹çš„å¯¹è±¡åœ¨ä¼ é€’ç»™çœç•¥ç¬¦å½¢å‚æ—¶éƒ½æ— æ³•æ­£ç¡®æ‹·è´ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">sum</span><span class="params">(<span class="type">int</span> count, ...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (count &lt;= <span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//ä¸ºäº†å®ç°å¯å˜å‚æ•°åˆ—è¡¨ï¼Œé¦–å…ˆéœ€è¦å£°æ˜ä¸€ä¸ªva_listç±»å‹çš„æŒ‡é’ˆ</span></span><br><span class="line">  <span class="comment">//va_listç±»å‹æ˜¯åœ¨cstdargå¤´æ–‡ä»¶é‡Œé¢å®šä¹‰çš„ï¼Œè¯¥æŒ‡é’ˆç”¨æ¥ä¾æ¬¡æŒ‡å‘å„ä¸ªå‚æ•°</span></span><br><span class="line">  <span class="comment">//va_startæ˜¯ä¸€ä¸ªå®ï¼Œç”¨æ¥åˆå§‹åŒ–arg_ptrï¼Œä½¿å…¶æŒ‡å‘åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå‚æ•°</span></span><br><span class="line">  <span class="comment">//è¿™ä¸ªå®çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯sumå‡½æ•°å‚æ•°åˆ—è¡¨çœç•¥å·å‰å¾—å›ºå®šå‚æ•°çš„åç§°ï¼Œç”¨æ¥ç¡®å®šç¬¬ä¸€ä¸ªå‚æ•°çš„ä½ç½® </span></span><br><span class="line">  va_list arg_ptr;</span><br><span class="line">  <span class="built_in">va_start</span>(arg_ptr, count);</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> CountSum = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//va_argæ˜¯ä¸€ä¸ªå®ï¼Œè¿”å›arg_ptræŒ‡å‘çš„å‚æ•°ä½ç½®ï¼Œå¹¶ä½¿arg_ptré€’å¢æ¥æŒ‡å‘ä¸‹ä¸€ä¸ªå‚æ•°å€¼</span></span><br><span class="line">  <span class="comment">//va_argå®çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯éœ€è¦ç»Ÿè®¡çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ï¼Œ</span></span><br><span class="line">  <span class="comment">//å¦‚æœç±»å‹ä¸æ­£ç¡®ï¼Œç¨‹åºä¹Ÿå¯èƒ½ä¼šæ‰§è¡Œï¼Œä½†å¾—åˆ°çš„æ˜¯æ— ç”¨çš„æ•°æ®ï¼Œarg_ptrå°†è¢«é”™è¯¯åœ°é€’å¢</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; count; ++i)</span><br><span class="line">  &#123;</span><br><span class="line">    CountSum += <span class="built_in">va_arg</span>(arg_ptr, <span class="type">int</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//å°†va_listç±»å‹çš„æŒ‡é’ˆå¤ä½æˆç©ºå€¼</span></span><br><span class="line">  <span class="comment">//å°±æ˜¯æ¸…ç©ºå¯å˜å‚æ•°åˆ—è¡¨</span></span><br><span class="line">  <span class="built_in">va_end</span>(arg_ptr);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> CountSum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">sum</span>(<span class="number">5</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>);<span class="comment">//return 15</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å¯å˜å‚æ•°æ¨¡æ¿</strong>ï¼ˆå®ç”¨ï¼‰ï¼š</p>
<p>å®ç°å¯å˜å‚æ•°æ¨¡æ¿çš„å…³é”®æ˜¯ï¼šå½“ä½ ä¼ ç»™å®ƒå¤šä¸ªå‚æ•°æ—¶ï¼Œè°¨è®°æŠŠç¬¬ä¸€ä¸ªå‚æ•°å’Œå…¶ä»–å‚æ•°<strong>åŒºåˆ†å¯¹å¾…</strong>ã€‚æ­¤å¤„ï¼Œé¦–å…ˆå¤„ç†ç¬¬ä¸€ä¸ªå‚æ•°headï¼Œç„¶åä½¿ç”¨å‰©ä½™å‚æ•°<strong>é€’å½’</strong>åœ°è°ƒç”¨f()ã€‚çœç•¥å·â€¦è¡¨ç¤ºåˆ—è¡¨åœ°â€œå‰©ä½™éƒ¨åˆ†â€ã€‚æœ€ç»ˆï¼Œtailå°†ä¸ºç©ºã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;&#125; <span class="comment">//ä¸æ‰§è¡Œä»»ä½•æ“ä½œ</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">g</span><span class="params">(T x)</span></span>&#123;</span><br><span class="line">  cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>... Tail&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">(T head, Tail... tail)</span></span>&#123;          <span class="comment">//f()ç±»ä¼¼äºprintf()çš„ç®€å•å˜å½¢</span></span><br><span class="line">  <span class="built_in">g</span>(head);                             <span class="comment">//å¯¹headåšæŸäº›æ“ä½œ</span></span><br><span class="line">  <span class="built_in">f</span>(tail...);                          <span class="comment">//å†æ¬¡å¤„ç†tail</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;first: &quot;</span>;</span><br><span class="line">  <span class="built_in">f</span>(<span class="number">1</span>,<span class="number">2.2</span>,<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;\n second: &quot;</span>;</span><br><span class="line">  <span class="built_in">f</span>(<span class="number">0.2</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&quot;yuck!&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment">//first: 1 2.2 hello</span></span><br><span class="line"><span class="comment">//second: 0.2 c yuck! 0 1 2</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯å˜å‚æ•°initializer_listï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//initializer_listç›¸å¯¹vectoræ›´è½»é‡åŒ– è€Œä¸”å…ƒç´ æ˜¯å¸¸é‡</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">error_msg</span><span class="params">(initializer_list&lt;string&gt; il)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> beg = il.<span class="built_in">begin</span>(); beg != il.<span class="built_in">end</span>(); ++beg)</span><br><span class="line">    cout &lt;&lt; *beg &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">  cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">error_msg</span>(&#123;<span class="string">&quot;im&quot;</span>,<span class="string">&quot;da&quot;</span>,<span class="string">&quot;gong&quot;</span>&#125;);<span class="comment">//&quot;im da gong&quot;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ç§æ–¹å¼å±€é™æ€§å¾ˆå¤§ï¼Œåˆ—è¡¨é‡Œåªèƒ½åŒç±»å‹ï¼Œè€Œä¸”å…ƒç´ æ˜¯å¸¸é‡ã€‚</p>
<p>è¿™ç§æ–¹å¼çš„ä¸€ä¸ªå…¸å‹ä¾‹å­å°±æ˜¯vectoråˆå§‹åŒ–èµ‹å€¼ï¼Œå¯ç”¨ä¸‹é¢ä»£ç æ¨¡æ‹Ÿï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyNumber</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">MyNumber</span>(<span class="type">const</span> std::initializer_list&lt;<span class="type">int</span>&gt;&amp; v)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> itm : v)</span><br><span class="line">      mVec.<span class="built_in">push_back</span>(itm);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> itm : mVec)</span><br><span class="line">      std::cout &lt;&lt; itm &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  std::vector&lt;<span class="type">int</span>&gt; mVec;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  MyNumber m = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line">  m.<span class="built_in">print</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> debug(...) print(cout,__VA_ARGS__)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug2(os, ...) print(os, __VA_ARGS__)</span></span><br><span class="line"><span class="comment">//#define debug2(format, args...) print(format, ##args)//win32ä¸æ”¯æŒ</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">debug2</span>(cout,<span class="string">&quot;this &quot;</span>, <span class="string">&quot; year&quot;</span>);<span class="comment">//&quot;this  year&quot;</span></span><br></pre></td></tr></table></figure>

<p><code>__VA_ARGS__</code>è¡¨ç¤ºå¯å˜å‚æ•°åˆ—è¡¨ã€‚</p>
</li>
</ul>
<h4 id="åˆ«å"><a href="#åˆ«å" class="headerlink" title="åˆ«å"></a>åˆ«å</h4><p>æ³›å‹ç¼–ç¨‹ä¸­çš„åˆ«åå¯ä»¥æœ‰å¾ˆå¤šç”¨é€”ï¼Œ</p>
<ul>
<li><p>å†™å‡ºé€šç”¨ä»£ç ï¼š</p>
<p>æ¯”å¦‚ï¼Œæ¯ä¸ªæ ‡å‡†åº“å®¹å™¨éƒ½æä¾›äº†value_typeä½œä¸ºå…¶å€¼ç±»å‹çš„åå­—ï¼ˆå¦‚vector&lt;int&gt;::value_typeä¸ºintï¼‰ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨è¿™ç‚¹å†™å‡ºä»£ç ï¼Œä½¿ä»£ç èƒ½å¤Ÿåœ¨ä»»ä½•ä¸€ä¸ªæœä»è¿™ç§è§„èŒƒçš„å®¹å™¨ä¸Šå·¥ä½œï¼Œå¦‚ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> C&gt;</span><br><span class="line"><span class="keyword">using</span> Element_type = <span class="keyword">typename</span> C::value_type; <span class="comment">//Cçš„å…ƒç´ ç±»å‹</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Container&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">algo</span><span class="params">(Container&amp; c)</span></span>&#123;</span><br><span class="line">  Vector&lt;Element_type&lt;Container&gt;&gt; vec; <span class="comment">//ä¿å­˜ç»“æœ</span></span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®ç°algoå‡½æ•°ï¼Œå°±å¯ä»¥å°†å¦‚stack&lt;int&gt;çš„å˜é‡è½¬æ¢æˆvector&lt;int&gt;ï¼ŒElement_type&lt;Container&gt;ä¼šç­‰äºintã€‚</p>
</li>
<li><p>ç»‘å®šæŸäº›æ¨¡æ¿å®å‚ï¼Œå®šä¹‰æ–°çš„æ¨¡æ¿ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Key, <span class="keyword">typename</span> Value&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Map</span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Value&gt;</span><br><span class="line"><span class="keyword">using</span> String_map = Map&lt;string, Value&gt;;</span><br><span class="line"></span><br><span class="line">String_map&lt;<span class="type">int</span>&gt; m; <span class="comment">//mæ˜¯ä¸€ä¸ªMap&lt;string, int&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>ğŸ“Œtypedef å’Œusing çš„åŒºåˆ«ï¼štypedef åªèƒ½é’ˆå¯¹ç‰¹å®šçš„ç±»å‹ï¼Œè€Œusing å¯ä»¥ç”Ÿæˆåˆ«åæ¨¡æ¿ã€‚<br>æ¯”å¦‚å¯ä»¥<code>template&lt;class T&gt; using remove_const_t = typename remove_const&lt;T&gt;::type</code>ï¼Œè€Œtypedefåˆ™ä¸è¡Œã€‚</p>
</blockquote>
<h4 id="æ¨¡æ¿ç‰¹åŒ–"><a href="#æ¨¡æ¿ç‰¹åŒ–" class="headerlink" title="æ¨¡æ¿ç‰¹åŒ–"></a>æ¨¡æ¿ç‰¹åŒ–</h4><p>å½“å®šä¹‰ä¸€ä¸ªç±»æ¨¡æ¿æˆ–å‡½æ•°æ¨¡æ¿æ—¶ï¼Œå¾€å¾€å¸Œæœ›æ‰€æœ‰ä¼šç”¨åˆ°çš„æ¨¡æ¿å‚æ•°ç±»å‹ï¼Œéƒ½èƒ½å¤Ÿæ»¡è¶³ç±»æ¨¡æ¿æˆ–å‡½æ•°æ¨¡æ¿å¯¹å…¶åŠŸèƒ½çš„è¦æ±‚ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œå‡½æ•°æ¨¡æ¿template&lt;typename T&gt; â€¦å¸Œæœ›æ‰€æœ‰å¯èƒ½å®ä¾‹åŒ–çš„Tï¼Œéƒ½èƒ½å¤Ÿå®ç°å–æ¨¡è¿ç®—<code>%</code>ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> E&gt;</span><br><span class="line"><span class="function">E <span class="title">my_gcd</span><span class="params">(E a, E b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">while</span>(b != <span class="built_in">E</span>(<span class="number">0</span>))&#123;</span><br><span class="line">    E r = a % b;</span><br><span class="line">    a = b;</span><br><span class="line">    b = r;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶è€Œï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç±»å‹éƒ½æœ‰å–æ¨¡å‡½æ•°ï¼Œæ¯”å¦‚ä¸€äº›ç¬¬ä¸‰æ–¹åº“çš„é«˜ç²¾åº¦æ•°å­—åº“ï¼ˆå¦‚CLNçš„<code>cl_I</code>é«˜ç²¾åº¦æ•´æ•°ç±»å‹å°±ä¸æ”¯æŒï¼‰ï¼Œé‚£ä¹ˆå®ä¾‹åŒ–ä¼šå¤±è´¥ï¼Œç¼–è¯‘å‡ºé”™ã€‚</p>
<p>é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæœ‰ä¸‰ç§è§£å†³æ–¹æ¡ˆï¼Œå…¶ä¸­åé¢ä¸¤ç§æœ€å¸¸ç”¨ï¼Œå³<strong>é‡è½½</strong>å’Œ<strong>ç‰¹åŒ–</strong>ã€‚1</p>
<ol>
<li><p>æ–¹æ¡ˆ1ï¼šæ·»åŠ ä»£ç ï¼Œè®©ç±»å‹æ”¯æŒæ‰€éœ€è¦çš„æ“ä½œ</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">cln::cl_I</span><br><span class="line"><span class="keyword">operator</span>%(<span class="type">const</span> cln::cl_I&amp; lhs,</span><br><span class="line">          <span class="type">const</span> cln::cl_I&amp; rhs)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">mod</span>(lhs, rhs);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ–¹æ¡ˆ2ï¼š<strong>å‡½æ•°é‡è½½</strong>ï¼Œä¸ç›´æ¥ä½¿ç”¨%è¿ç®—ç¬¦ï¼Œæ›¿æ¢æˆmy_modå‡½æ•°ï¼Œå†é‡è½½cl_Iç±»å‹çš„my_modå‡½æ•°</p>
</li>
</ol>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//%æ›¿æ¢æˆmy_mod</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> E&gt;</span><br><span class="line"><span class="function">E <span class="title">my_gcd</span><span class="params">(E a, E b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (b != <span class="built_in">E</span>(<span class="number">0</span>)) &#123;</span><br><span class="line">    E r = <span class="built_in">my_mod</span>(a, b);</span><br><span class="line">    a = b;</span><br><span class="line">    b = r;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸€èˆ¬æƒ…å†µä¸‹çš„my_modå‡½æ•°</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> E&gt;</span><br><span class="line"><span class="function">E <span class="title">my_mod</span><span class="params">(<span class="type">const</span> E&amp; lhs,</span></span></span><br><span class="line"><span class="params"><span class="function">         <span class="type">const</span> E&amp; rhs)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> lhs % rhs;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//é’ˆå¯¹cl_Iç±»é‡è½½çš„my_modå‡½æ•°</span></span><br><span class="line"><span class="function">cln::cl_I</span></span><br><span class="line"><span class="function"><span class="title">my_mod</span><span class="params">(<span class="type">const</span> cln::cl_I&amp; lhs,</span></span></span><br><span class="line"><span class="params"><span class="function">       <span class="type">const</span> cln::cl_I&amp; rhs)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">mod</span>(lhs, rhs);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&amp;#x20;  3. æ–¹æ¡ˆ3ï¼š<strong>æ¨¡æ¿ç‰¹åŒ–</strong>ï¼ŒåŒæ–¹æ¡ˆ2ç±»ä¼¼ï¼Œä½†æ˜¯my_modä¸é’ˆå¯¹cl_Iç±»å‹é‡è½½ï¼Œè€Œæ˜¯ç‰¹åŒ–</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;&gt;</span><br><span class="line">cln::cl_I <span class="built_in">my_mod</span>&lt;cln::cl_I&gt;(<span class="type">const</span> cln::cl_I&amp; lhs, <span class="type">const</span> cln::cl_I&amp; rhs)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">mod</span>(lhs, rhs);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ“Œç‰¹åŒ–æ˜¯ä¸€ç§æ›´åŠ é€šç”¨çš„æŠ€å·§ï¼Œå› ä¸ºç‰¹åŒ–æ—¢å¯ä»¥ç”¨åœ¨ç±»æ¨¡æ¿ä¹Ÿå¯ä»¥ç”¨åœ¨å‡½æ•°æ¨¡æ¿ï¼Œè€Œé‡è½½åªèƒ½ç”¨äºå‡½æ•°ã€‚<br>ç„¶è€Œï¼Œä¸€èˆ¬çš„å»ºè®®æ˜¯ï¼šå¯¹å‡½æ•°æ¨¡æ¿ä½¿ç”¨é‡è½½ï¼Œå¯¹ç±»æ¨¡æ¿è¿›è¡Œç‰¹åŒ–ã€‚</p>
</blockquote>
<ul>
<li><p>ç‰¹åŒ–çš„ç»å…¸ä¾‹å­ï¼šstatic_assert</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="type">bool</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">compile_time_error</span>;</span><br><span class="line"><span class="keyword">template</span> &lt;&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">compile_time_error</span>&lt;<span class="literal">true</span>&gt; &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STATIC_ASSERT(Expr, Msg)   \</span></span><br><span class="line"><span class="meta">  &#123;                                \</span></span><br><span class="line"><span class="meta">    compile_time_error<span class="string">&lt;bool(Expr)&gt;</span> \</span></span><br><span class="line"><span class="meta">      ERROR_##_Msg;                \</span></span><br><span class="line"><span class="meta">    (void)ERROR_##_Msg;            \</span></span><br><span class="line"><span class="meta">  &#125;</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç å£°æ˜äº†ä¸€ä¸ªstructæ¨¡æ¿ï¼Œä½†ä»…å¯¹trueçš„æƒ…å†µè¿›è¡Œäº†ç‰¹åŒ–ï¼Œäº§ç”Ÿäº†compile_tme_error&lt;true&gt;çš„å®šä¹‰ã€‚è¿™æ ·ï¼Œå¦‚æœExpræ˜¯é”™çš„ï¼ˆæ¯”å¦‚3&gt;5ï¼‰ï¼Œæ­¤æ—¶å°±é‡åˆ°äº†compile_time_error&lt;false&gt;çš„æƒ…å†µï¼Œç¼ºå°‘å®šä¹‰ç¼–è¯‘ä¸å‡ºæ¥ï¼Œæ‰€ä»¥å°±ä¼šç¼–è¯‘æŠ¥é”™ï¼Œèµ·åˆ°ç¼–è¯‘æœŸæ£€æŸ¥çš„ä½œç”¨ã€‚<code>(void)ERROR_##_Msg</code>æ˜¯åœ¨æŠ‘åˆ¶ç¼–è¯‘å™¨unusedè­¦å‘Šï¼ˆå½“æˆåŠŸç¼–è¯‘æ—¶ï¼‰ã€‚</p>
</li>
<li><p><strong>ä¸ºä»€ä¹ˆé‡åˆ°ç±»å‹ä¸æ»¡è¶³æ¡ä»¶æ—¶ï¼Œå¯¹å‡½æ•°æ¨¡æ¿æ›´å€¾å‘äºé‡è½½</strong>ï¼Ÿ</p>
<blockquote>
<p>èµ„æ–™ï¼š<a href="http://www.gotw.ca/publications/mill17.htm" title="Why not specialize Function Templates?">Why not specialize Function Templates?</a></p>
</blockquote>
<blockquote>
<p>åç‰¹åŒ–ï¼šå¤šä¸ªæ¨¡æ¿å‚æ•°ï¼Œä»…ç‰¹åŒ–å…¶ä¸­çš„ä¸€éƒ¨åˆ†</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">  </span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="ç¼–è¯‘æ—¶è®¡ç®—ï¼ˆæµ…è¿°æ¨¡æ¿å…ƒç¼–ç¨‹ï¼‰"><a href="#ç¼–è¯‘æ—¶è®¡ç®—ï¼ˆæµ…è¿°æ¨¡æ¿å…ƒç¼–ç¨‹ï¼‰" class="headerlink" title="ç¼–è¯‘æ—¶è®¡ç®—ï¼ˆæµ…è¿°æ¨¡æ¿å…ƒç¼–ç¨‹ï¼‰"></a>ç¼–è¯‘æ—¶è®¡ç®—ï¼ˆæµ…è¿°æ¨¡æ¿å…ƒç¼–ç¨‹ï¼‰</h4><ul>
<li>æœ€å¤§å…¬çº¦æ•°ï¼ˆè¾—è½¬ç›¸é™¤gcdï¼‰</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="type">int</span> n&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">factorial</span>&#123;</span><br><span class="line">  <span class="built_in">static_assert</span>( n &gt;= <span class="number">0</span>, <span class="string">&quot;Arg must be non-negative&quot;</span>);</span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> value = n * factorial&lt;n<span class="number">-1</span>&gt;::value;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">factorial</span>&lt;<span class="number">0</span>&gt;&#123;</span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> value = <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; factorial&lt;<span class="number">10</span>&gt;::value &lt;&lt; std::endl; </span><br><span class="line">    <span class="comment">//3628800</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çš„ä»£ç è¿›è¡Œåæ±‡ç¼–ï¼Œå¯ä»¥çœ‹åˆ°3628800ç›´æ¥å‡ºç°äº†ï¼Œä¸­é—´çš„é€’å½’ã€è®¡ç®—è¿‡ç¨‹å®Œå…¨æ²¡æœ‰ã€‚è¿™ä¾¿ä½“ç°äº†ç¼–è¯‘æœŸè®¡ç®—ï¼Œå³è®¡ç®—æ­¥éª¤å®Œå…¨ç”±ç¼–è¯‘å™¨å®Œæˆäº†ï¼Œè€Œä¸åœ¨è¿è¡Œæ—¶è¿›è¡Œã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">.LC0:</span><br><span class="line">        .string <span class="string">&quot;%d\n&quot;</span></span><br><span class="line">main:</span><br><span class="line">        push    rbp</span><br><span class="line">        mov     rbp, rsp</span><br><span class="line">        mov     esi, <span class="number">3628800</span></span><br><span class="line">        mov     edi, OFFSET FLAT:.LC0</span><br><span class="line">        mov     eax, <span class="number">0</span></span><br><span class="line">        call    printf</span><br><span class="line">        mov     eax, <span class="number">0</span></span><br><span class="line">        pop     rbp</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure>

<p>ä»ä¸­å¯ä»¥ä¸€çª¥ç¼–è¯‘æœŸè®¡ç®—çš„æ ¸å¿ƒï¼š<strong>å°†è®¡ç®—è½¬å˜æˆç±»å‹æ¨å¯¼</strong>ã€‚</p>
<ul>
<li>æ¡ä»¶è¯­å¥ï¼ˆC++98ï¼‰ï¼šå³è¾¹ä¸¤ç§å†™æ³•æ˜¯ç­‰ä»·çš„</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="type">bool</span> cond, <span class="keyword">typename</span> Then, <span class="keyword">typename</span> Else&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">If</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Then, <span class="keyword">typename</span> Else&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">If</span>&lt;<span class="literal">true</span>, Then, Else&gt;&#123;</span><br><span class="line">  <span class="keyword">typedef</span> Then type;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Then, <span class="keyword">typename</span> Else&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">If</span>&lt;<span class="literal">false</span>, Then, Else&gt;&#123;</span><br><span class="line">  <span class="keyword">typedef</span> Else type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, T v&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">integral_constant</span>&#123;</span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> T value = v;</span><br><span class="line">  <span class="keyword">typedef</span> T value_type;</span><br><span class="line">  <span class="keyword">typedef</span> integral_constant type;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">foo</span><span class="params">(<span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>( n==<span class="number">2</span> || n==<span class="number">3</span> || n==<span class="number">5</span> ) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="type">int</span> n&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Foo</span>&#123;</span><br><span class="line">  <span class="keyword">typedef</span> <span class="keyword">typename</span> If&lt;</span><br><span class="line">    ( n==<span class="number">2</span> || n==<span class="number">3</span> || n==<span class="number">5</span>),</span><br><span class="line">    integral_constant&lt;<span class="type">int</span>, <span class="number">1</span>&gt;,</span><br><span class="line">    integral_constant&lt;<span class="type">int</span>, <span class="number">2</span>&gt;&gt;::type</span><br><span class="line">  type;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ç”¨<code>::</code>å–ä¸€ä¸ªæˆå‘˜ç±»å‹ï¼Œä¸”<code>::</code>å·¦è¾¹æœ‰æ¨¡æ¿å‚æ•°çš„è¯ï¼Œå¾—é¢å¤–åŠ ä¸Štypenameå…³é”®å­—æ¥æ ‡æ˜ç»“æœæ˜¯ä¸€ä¸ªç±»å‹ã€‚ä½¿ç”¨å¦‚ä¸‹ï¼š</p>
<p><code>std::cout&lt;&lt;Foo&lt;1&gt;::type::value&lt;&lt;std::endl</code></p>
<p>å®šä¹‰ä¸¤é¡¹åˆ†æ”¯Thenå’ŒElseï¼Œç”¨ç±»å‹æ¥ä»£è¡¨æ‰§è¡ŒçŠ¶æ€ã€‚</p>
<p>condï¼šæ¡ä»¶ï¼ˆçœŸæˆ–å‡ï¼‰</p>
<p>Thenï¼šæ¡ä»¶ä¸ºçœŸæ—¶çš„çŠ¶æ€</p>
<p>Elseï¼šæ¡ä»¶ä¸ºå‡æ—¶çš„çŠ¶æ€</p>
<ul>
<li>å¾ªç¯è¯­å¥ï¼ˆC++98ï¼‰ï¼š</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="type">bool</span> condition, <span class="keyword">typename</span> body&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WhileLoop</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Body&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WhileLoop</span>&lt;<span class="literal">true</span>, Body&gt;&#123;</span><br><span class="line">  <span class="keyword">typedef</span> <span class="keyword">typename</span> WhileLoop&lt;</span><br><span class="line">    Body::cond_value,</span><br><span class="line">    <span class="keyword">typename</span> Body::next_type&gt;::type</span><br><span class="line">  type;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Body&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WhileLoop</span>&lt;<span class="literal">false</span>, Body&gt;&#123;</span><br><span class="line">  <span class="keyword">typedef</span> <span class="keyword">typename</span> Body::res_type type;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Body&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">While</span> &#123;</span><br><span class="line">  <span class="keyword">typedef</span> <span class="keyword">typename</span> WhileLoop&lt;</span><br><span class="line">    Body::cond_value, Body&gt;::type</span><br><span class="line">  type;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, T v&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">integral_constant</span>&#123;</span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> T value = v;</span><br><span class="line">  <span class="keyword">typedef</span> T value_type;</span><br><span class="line">  <span class="keyword">typedef</span> integral_constant type;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(n != <span class="number">0</span>)&#123;</span><br><span class="line">  result = result + n;</span><br><span class="line">  n = n<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="type">int</span> result, <span class="type">int</span> n&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SumLoop</span>&#123;</span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> <span class="type">bool</span> cond_value = n!=<span class="number">0</span>;</span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> res_value = result;</span><br><span class="line">  <span class="keyword">typedef</span> integral_constant&lt;<span class="type">int</span>, res_value&gt; res_type;</span><br><span class="line">  <span class="keyword">typedef</span> SumLoop&lt;result + n, n <span class="number">-1</span>&gt; next_type;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="type">int</span> n&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Sum</span>&#123;</span><br><span class="line">  <span class="keyword">typedef</span> SumLoop&lt;<span class="number">0</span>,n&gt; type;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>â†‘ä¸Šé¢ä¸¤ç§å†™æ³•çš„æ•ˆæœæ˜¯ç­‰ä»·çš„ã€‚ä½¿ç”¨æ—¶æ‰§è¡Œï¼š</p>
<p><code>While&lt;Sum&lt;10&gt;::type&gt;::type::value</code></p>
<p>å¯å¾—åˆ°1~10ç´¯åŠ ç»“æœ</p>
<p>å‰é¢è¯´åˆ°ï¼Œç¼–è¯‘æœŸè®¡ç®—ç”¨ç±»å‹æ¨å¯¼è¡¨ç¤ºåˆ†æ”¯çŠ¶æ€ã€‚å› æ­¤éœ€è¦ä¸‰ä¸ªæˆå‘˜ï¼šcond_valueè¡¨ç¤ºå¾ªç¯åˆ¤æ–­çš„æ¡ä»¶ï¼ˆçœŸå‡ï¼‰ã€res_typeè¡¨ç¤ºé€€å‡ºå¾ªç¯æ—¶çš„çŠ¶æ€ã€next_typeè¡¨ç¤ºä¸‹é¢å¾ªç¯æ‰§è¡Œä¸€æ¬¡çš„çŠ¶æ€ã€‚</p>
<p>è¿™æ ·çš„å¾ªç¯è¿‡ç¨‹å¯ä»¥é€šè¿‡å±•å¼€æ¥ç†è§£ï¼Œä»¥ç´¯åŠ åˆ°2ä¸ºä¾‹ï¼š</p>
<p>While&lt; Sum&lt;2&gt;::type &gt;::type::value å®ä¾‹åŒ–(instantiation)è¿‡ç¨‹<br>--&gt; While&lt; SumLoop&lt;0, 2&gt; &gt;::type::value<br>--&gt; WhileLoop&lt;SumLoop&lt;0, 2&gt;::cond_value, SumLoop&lt;0, 2&gt;&gt;::type::value<br>--&gt; WhileLoop&lt;true, SumLoop&lt;0, 2&gt;&gt;::type::value</p>
<p>--&gt; WhileLoop&lt;SumLoop&lt;0, 2&gt;::cond_value, SumLoop&lt;0, 2&gt;::next_type&gt;::type::value<br>--&gt; WhileLoop&lt;true, SumLoop&lt;2, 1&gt;&gt;::type::value</p>
<p>--&gt; WhileLoop&lt;SumLoop&lt;2, 1&gt;::cond_value, SumLoop&lt;2, 1&gt;::next_type&gt;::type::value<br>--&gt; WhileLoop&lt;true, SumLoop&lt;3, 0&gt;&gt;::type::value</p>
<p>--&gt; WhileLoop&lt;SumLoop&lt;3, 0&gt;::cond_value, SumLoop&lt;3, 0&gt;::next_type&gt;::type::value<br>--&gt; WhileLoop&lt;false, SumLoop&lt;3, -1&gt;&gt;::type::value</p>
<p>--&gt; SumLoop&lt;3, -1&gt;::res_type::value</p>
<p>--&gt;integral_constant&lt;int, 3&gt;::value<br>--&gt;3</p>
<h4 id="type-traits"><a href="#type-traits" class="headerlink" title="type_traits"></a>type_traits</h4><p><a href="https://en.cppreference.com/w/cpp/header/type_traits">https://en.cppreference.com/w/cpp/header/type_traits</a></p>
<p>é¡¾åæ€ä¹‰ï¼Œ&lt;type_traits&gt;å¤´æ–‡ä»¶å®šä¹‰äº†ä¸€äº›å·¥å…·ç±»æ¨¡æ¿ï¼Œç”¨æ¥æå–æŸä¸ªç±»å‹ï¼ˆtypeï¼‰åœ¨æŸæ–¹é¢çš„ç‰¹ç‚¹ï¼ˆtraitï¼‰ã€‚å®ƒå¯ä»¥å®ç°åœ¨ç¼–è¯‘æœŸçš„åˆ¤æ–­ã€è½¬æ¢ã€æŸ¥è¯¢ç­‰åŠŸèƒ½ï¼Œå¹¶ä¸”æä¾›äº†ç¼–è¯‘æœŸçš„trueå’Œfalseã€‚æ¯”å¦‚ä¸Šé¢æåˆ°çš„integral_constantç±»ï¼Œå°±è¢«å®šä¹‰åœ¨äº†type_traitsä¸­ï¼Œå®ƒå¯ä»¥ç§°ä½œtype_traitsçš„åŸºçŸ³ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// integral_constant</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> _Tp, _Tp __v&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">integral_constant</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">static</span> <span class="keyword">constexpr</span> _Tp                  value = __v;</span><br><span class="line">    <span class="keyword">typedef</span> _Tp                           value_type;</span><br><span class="line">    <span class="keyword">typedef</span> integral_constant&lt;_Tp, __v&gt;   type;</span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="keyword">operator</span> <span class="title">value_type</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> __cplusplus &gt; 201103L</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __cpp_lib_integral_constant_callable 201304</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> value_type <span class="title">operator</span><span class="params">()</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> _Tp, _Tp __v&gt;</span><br><span class="line"><span class="keyword">constexpr</span> _Tp integral_constant&lt;_Tp, __v&gt;::value;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> std::integral_constant&lt;</span><br><span class="line">  <span class="type">bool</span>, <span class="literal">true</span>&gt; true_type;</span><br><span class="line"><span class="keyword">typedef</span> std::integral_constant&lt;</span><br><span class="line">  <span class="type">bool</span>, <span class="literal">false</span>&gt; false_type;</span><br></pre></td></tr></table></figure>

<p>ä¸ºæ–¹ä¾¿ä½¿ç”¨ï¼Œtype_traitsè¿˜é’ˆå¯¹å¸ƒå°”å€¼æœ‰ä¸¤ä¸ªé¢å¤–çš„ç±»å‹å®šä¹‰ã€‚äºæ˜¯è°ƒç”¨<code>std::true_type::value</code>å¯ä»¥å¾—åˆ°<code>true</code></p>
<p>type_traitså¤´æ–‡ä»¶ä¸­å‡¡æ˜¯å¸¦å‰ç¼€<code>is_*</code>ç±»çš„åç‰¹åŒ–æˆ–ç‰¹åŒ–å‡ç»§æ‰¿è‡ª<code>true_type</code>å’Œ<code>false_type</code>ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">__is_pointer_helper</span> : \</span><br><span class="line">  <span class="keyword">public</span> false_type &#123; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">__is_pointer_helper</span> &lt;_Tp*&gt; : \</span><br><span class="line">  <span class="keyword">public</span> true_type &#123; &#125;;</span><br></pre></td></tr></table></figure>

<p>è€Œè¿™äº›<code>is_*</code>å‰ç¼€çš„ä¾¿æ˜¯<strong>ç”¨æ¥æ ‡æ³¨æŸç±»å‹æ˜¯å¦æœ‰æŸç‰¹ç‚¹</strong>çš„æ¨¡æ¿å…ƒã€‚æ¯”å¦‚<code>is_trivially_destructible</code>æ¨¡æ¿å¯ç”¨äºåˆ¤æ–­ç±»æ˜¯å¦å¯å¹³å‡¡ææ„ï¼ˆå³ï¼Œä¸è°ƒç”¨ææ„å‡½æ•°ï¼Œä¸ä¼šé€ æˆä»»ä½•èµ„æºæ³„éœ²é—®é¢˜ï¼‰ã€‚æ¨¡æ¿è¿”å›çš„è¦ä¹ˆæ˜¯<code>true_type</code>è¦ä¹ˆæ˜¯<code>false_type</code>ã€‚ä½¿ç”¨operator()é‡è½½æˆ–::valueéƒ½å¯ä»¥å¾—åˆ°èƒŒåçš„trueæˆ–falseã€‚å› æ­¤ï¼Œå¯ä»¥åœ¨åˆ é™¤æŸå¯¹è±¡å‰ï¼Œç”¨å®ƒæ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ææ„å‡½æ•°ï¼Œè¿™æ ·åœ¨ä¼˜åŒ–ç¼–è¯‘æ—¶ï¼Œç¼–è¯‘å™¨å¯ä»¥æŠŠä¸éœ€è¦çš„ææ„æ“ä½œå…¨éƒ¨åˆ é™¤ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SomeContainer</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  ...</span><br><span class="line">  <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">destroy</span><span class="params">(T* ptr)</span></span>&#123;</span><br><span class="line">    _destroy(ptr, <span class="built_in">is_trivially_destructible</span>&lt;T&gt;());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">static</span> <span class="type">void</span> _destroy(T* ptr, true_type) &#123;&#125;</span><br><span class="line">  <span class="type">static</span> <span class="type">void</span> _destroy(T* ptr, false_type) &#123;</span><br><span class="line">    ptr-&gt;~<span class="built_in">T</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç ä¾¿æ˜¯å¾ˆå¤šå®¹å™¨ç±»éƒ½ä¼šæœ‰çš„destroyå‡½æ•°ï¼Œé€šè¿‡<code>is_trivially_destructible</code>æ¥æœ€å¤§ç¨‹åº¦ä¼˜åŒ–ã€‚ç±»ä¼¼çš„<code>is_*</code>è¿˜æœ‰ï¼šï¼ˆå…·ä½“å¯æŸ¥çœ‹cppreferenceå®˜ç½‘ï¼‰</p>
<p><code>is_void, is_null_pointer, is_integral, is_class, is_function, is_pointer, is_lvalue_reference, is_rvalue_reference, is_const, is_move_constructble, is_copy_constructible, has_virtual_destructor</code>ç­‰ç­‰</p>
<hr>
<p>åŒæ—¶ï¼Œtype_traitsè¿˜å¯ä»¥åšç±»å‹è½¬æ¢ï¼Œä»¥<code>std::remove_const</code>ä¸ºä¾‹ï¼Œæ¥å»é™¤ç±»å‹é‡Œçš„constä¿®é¥°ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">remove_const</span> &#123;</span><br><span class="line">  <span class="keyword">typedef</span> T type;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">remove_const</span>&lt;<span class="type">const</span> T&gt;&#123;</span><br><span class="line">  <span class="keyword">typedef</span> T type;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">remove_const&lt;<span class="type">const</span> string&gt;::type str;<span class="comment">//stringç±»å‹</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ“Œå¦‚æœå¯¹const char* åº”ç”¨remove_constçš„è¯ï¼Œç»“æœè¿˜æ˜¯const char <em>ã€‚å› ä¸ºconst char</em> æ˜¯æŒ‡å‘const chatçš„æŒ‡é’ˆï¼Œè€Œä¸æ˜¯æŒ‡å‘charçš„constæŒ‡é’ˆã€‚å¦‚æœå¯¹char * conståº”ç”¨remove_constçš„è¯ï¼Œå¯å¾—åˆ°char*</p>
</blockquote>
<p>&lt;type_traits&gt;ä¸­ç±»ä¼¼çš„ç±»å‹è½¬æ¢å…ƒè¿˜æœ‰ï¼šï¼ˆå…·ä½“å¯æŸ¥çœ‹cppreferenceå®˜ç½‘ï¼‰</p>
<p><code>remove_cv</code>ï¼ˆåŒæ—¶å»é™¤constå’Œvolatileï¼‰ã€<code>remove_volatile</code>ã€<code>remove_pointer</code>ã€<code>add_const</code>ã€<code>remove_extent</code>ã€<code>make_signed</code>ç­‰ç­‰ã€‚</p>
<p>C++14å’ŒC++17è¿˜é’ˆå¯¹&lt;type_traits&gt;æä¾›äº†ä¸€äº›ç®€æ˜“å†™æ³•ï¼Œæ¯”å¦‚å†™<code>is_trivially_destructible&lt;T&gt;::value</code>å’Œ<code>is_trivially_destructible&lt;T&gt;::type</code>ä¼šæ¯”è¾ƒå•°å—¦ï¼Œé‚£ä¹ˆå¯ä»¥ç®€åŒ–å†™æˆ_vï¼ˆC++17ï¼‰å’Œ_tï¼ˆC++14ï¼‰ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">constexpr</span> <span class="type">bool</span></span><br><span class="line">  is_trivially_destructible_v =</span><br><span class="line">    is_trivially_destructible&lt;</span><br><span class="line">      T&gt;::value;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">using</span> <span class="type">remove_const_t</span> =</span><br><span class="line">  <span class="keyword">typename</span> remove_const&lt;T&gt;::type;</span><br></pre></td></tr></table></figure>

<p>ç±»å‹è½¬æ¢æ¨¡æ¿å…ƒä¸­ï¼Œæœ€é‡è¦çš„æ¨¡æ¿å…ƒæ˜¯<code>std::decay</code>ï¼Œdecayå¯ä»¥å¯¹äºæ™®é€šç±»å‹ç§»é™¤å¼•ç”¨å’Œcvç¬¦ï¼ˆconstå’Œvolatileï¼‰</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> std::decay&lt;<span class="type">int</span>&gt;::type Normal;      <span class="comment">//int</span></span><br><span class="line"><span class="keyword">typedef</span> std::decay&lt;<span class="type">int</span>&amp;&gt;::type Ref;        <span class="comment">//int</span></span><br><span class="line"><span class="keyword">typedef</span> std::decay&lt;<span class="type">int</span>&amp;&amp;&gt;::type RefRef;    <span class="comment">//int</span></span><br><span class="line"><span class="keyword">typedef</span> std::decay&lt;<span class="type">const</span> <span class="type">int</span>&amp;&gt;::type cnst; <span class="comment">//int</span></span><br><span class="line"><span class="keyword">typedef</span> std::decay&lt;<span class="type">int</span>[<span class="number">2</span>]&gt;::type Array;    <span class="comment">//int*ï¼Œæ•°ç»„ç±»å‹å˜æˆæŒ‡é’ˆç±»å‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----decayä¸€èˆ¬ä¼šå’Œdecltypeæ­é…-----*/</span></span><br><span class="line"><span class="type">int</span> arr[<span class="number">2</span>] = &#123;<span class="number">1</span>,<span class="number">2</span>&#125;;</span><br><span class="line"><span class="keyword">typedef</span> std::decay&lt;<span class="keyword">decltype</span>(arr)&gt;::type myArray;</span><br></pre></td></tr></table></figure>

<p>decayæ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç‚¹åœ¨äºå…¶å¯ä»¥æ–¹ä¾¿åœ°è·å¾—å‡½æ•°æŒ‡é’ˆï¼Œå³å…¶å¯ä»¥å®ç°ä»å‡½æ•°å¯¹è±¡æå–å‡ºå‡½æ•°æŒ‡é’ˆç±»å‹ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">add_2</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x+<span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add_3</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x+<span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">std::<span class="type">decay_t</span>&lt;<span class="keyword">decltype</span>(add_2)&gt; add_ptr = add_3;   <span class="comment">//add_ptræ˜¯å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line"><span class="keyword">decltype</span>&lt;add_2&gt; * add_func = add2_3;             <span class="comment">//ç›´æ¥ä½¿ç”¨decltypeæ¨æ–­ä¸å‡ºå‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">cout &lt;&lt; <span class="built_in">add_ptr</span>(<span class="number">7</span>) &lt;&lt; endl;                      <span class="comment">//10</span></span><br><span class="line">cout &lt;&lt; <span class="built_in">add_func</span>(<span class="number">7</span>) &lt;&lt; endl;                     <span class="comment">//10</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>decayæœ¬æ„å°±æ˜¯é€€åŒ–ï¼Œç§»é™¤å¼•ç”¨å’Œcvï¼Œä»å‡½æ•°å¯¹è±¡åˆ°å‡½æ•°æŒ‡é’ˆï¼Œéƒ½å¯ä»¥çœ‹åšæ˜¯ä¸€ç§é€€åŒ–è¡Œä¸ºã€‚</p>
</blockquote>
<p>ä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œdecay_t&lt;decltype&lt;func&gt;&gt;å’Œdecay_t&lt;decltype&lt;func()&gt;&gt;æ˜¯ä¸åŒçš„ï¼Œçœ‹ä¸Šå»åè€…åªæ˜¯åŠ äº†ä¸€ä¸ªæ‹¬å·ã€‚ä½†æ˜¯åè€…æ˜¯å°†funcçš„è¿”å›ç±»å‹é€€åŒ–ï¼Œè€Œå‰è€…æ˜¯ä¸funcä¸€è‡´å…¥å‚è¿”å›å€¼çš„å‡½æ•°æŒ‡é’ˆã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼Œè¿›è¡Œmap-reduceä¸­çš„mapæ“ä½œï¼Œå°±æ˜¯è¿›è¡Œè¿”å›ç±»å‹é€€åŒ–decay_t&lt;decltype&lt;func()&gt;&gt;ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">template</span>&lt;<span class="keyword">typename</span>, <span class="keyword">typename</span>&gt;<span class="keyword">class</span> <span class="title class_">OutContainer</span> = vector, <span class="keyword">typename</span> F, <span class="keyword">class</span> R&gt;</span><br><span class="line">        <span class="keyword">auto</span> <span class="built_in">fmap</span>(F&amp;&amp; f, R&amp;&amp; inputs)&#123;</span><br><span class="line">            <span class="keyword">typedef</span> <span class="type">decay_t</span>&lt;<span class="keyword">decltype</span>(<span class="built_in">f</span>(*inputs.<span class="built_in">begin</span>()))&gt; result_type;</span><br><span class="line">            OutContainer&lt;result_type, allocator&lt;result_type&gt;&gt; result;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span>&amp;&amp; item : inputs)&#123;</span><br><span class="line">                result.<span class="built_in">push_back</span>(<span class="built_in">f</span>(item));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; v = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">    <span class="keyword">auto</span> add_1 = [](<span class="type">int</span> x)&#123;</span><br><span class="line">        <span class="keyword">return</span> x + <span class="number">1</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">auto</span> result = <span class="built_in">fmap</span>(add_1, v);   <span class="comment">//vå˜æˆï¼š2,3,4,5,6</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>å…¶ä»–çš„&lt;type_traits&gt;ä¸­å¸¸ç”¨æ¨¡æ¿å…ƒæœ‰ï¼š<code>std::conditional, std::enable_if, std::void_t</code>ç­‰ã€‚</p>
<ul>
<li><p><code>std::conditional</code>ï¼šåœ¨ç¼–è¯‘æœŸæ ¹æ®ä¸€ä¸ªåˆ¤æ–­å¼é€‰æ‹©ä¸¤ä¸ªç±»å‹ä¸­çš„ä¸€ä¸ªï¼Œç±»ä¼¼ä¸‰å…ƒè¡¨è¾¾å¼</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åŸå‹</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="type">bool</span> B, <span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">F</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">conditional</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">typedef</span> std::conditional&lt;<span class="literal">true</span>, <span class="type">int</span>, <span class="type">char</span>&gt;::type A;</span><br><span class="line">  <span class="keyword">typedef</span> std::conditional&lt;<span class="literal">false</span>, <span class="type">int</span>, <span class="type">char</span>&gt;::type B;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>type_traitsæœ€å¸¸ç”¨çš„<code>std::enable_if</code>ä¼šåœ¨ä¸‹ä¸€å°èŠ‚é˜è¿°ã€‚</p>
</li>
</ul>
<hr>
<h4 id="é‡è½½æ­§ä¹‰æ¶ˆé™¤ï¼ˆtraitsï¼‰"><a href="#é‡è½½æ­§ä¹‰æ¶ˆé™¤ï¼ˆtraitsï¼‰" class="headerlink" title="é‡è½½æ­§ä¹‰æ¶ˆé™¤ï¼ˆtraitsï¼‰"></a>é‡è½½æ­§ä¹‰æ¶ˆé™¤ï¼ˆtraitsï¼‰</h4><p>å¤šä¸ªåŒåå‡½æ•°åšé‡è½½æ—¶ï¼Œå¶å°”ä¼šå‘ç”Ÿæ­§ä¹‰çš„æƒ…å†µã€‚å³è°ƒç”¨å‡½æ•°æ—¶çš„å‚æ•°ï¼ŒåŒæ—¶æ»¡è¶³ä¸¤ä¸ªåŠä»¥ä¸Šçš„é‡è½½å‡½æ•°ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨æ— ä»é€‰æ‹©ï¼Œå°±ä¼šå‡ºç°ç¼–è¯‘æŠ¥é”™ã€‚å› æ­¤éœ€è¦æ­§ä¹‰æ¶ˆé™¤æœºåˆ¶ï¼Œæœ‰ä¸¤ç§å¸¸ç”¨æ–¹æ¡ˆï¼ŒSFINAEå’Œtype_traitsã€‚</p>
<blockquote>
<p>SFINAEå…¶å®æ˜¯C++ä¸­çš„ä¸€ç§æœºåˆ¶ï¼Œå³â€œå¦‚æœæ¨¡æ¿å®ä¾‹åŒ–å‘ç”Ÿäº†å¤±è´¥ï¼Œæ²¡æœ‰ç†ç”±è®©ç¼–è¯‘å°±æ­¤å‡ºé”™ç»ˆæ­¢ï¼Œå› ä¸ºè¿˜å¯èƒ½æœ‰å…¶ä»–å¯ç”¨çš„å‡½æ•°é‡è½½â€ï¼Œæ ‡å‡†åº“é€šè¿‡è¿™ç§æœºåˆ¶æå‡ºäº†æ­§ä¹‰æ¶ˆé™¤çš„è§£å†³æ–¹æ¡ˆã€‚</p>
</blockquote>
<ul>
<li><p>SFINAEï¼ˆSubstitution Failure Is Not An Errorï¼‰</p>
<p>è€ƒè™‘è¦å®ç°ä¸€ä¸ªBufferç±»ï¼Œå¸Œæœ›åœ¨Bufferä¸­æ·»åŠ å…ƒç´ ï¼Œå¯ä»¥æœ‰ä¸‰ç§å½¢å¼ï¼š</p>
<ul>
<li><p>ç¬¬ä¸€ç§é‡è½½ï¼šä¼ å…¥ä¸€ä¸ªå­—ç¬¦ï¼Œå’Œä¸€ä¸ªsize_tï¼Œå‘Bufferä¸­æ·»åŠ nä¸ªç›¸åŒçš„c</p>
</li>
<li><p>ç¬¬äºŒç§é‡è½½ï¼šç›´æ¥ä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶ä¼ å…¥å­—ç¬¦ä¸²å¤§å°</p>
</li>
<li><p>ç¬¬ä¸‰ç§é‡è½½ï¼šSTLé£æ ¼æ·»åŠ ï¼Œå³å¯ä»¥<code>buf.append(str.begin(), str.end());</code>å’Œ<code>buf.append(str.rbegin(),str.rend());</code>ï¼Œéœ€è¦æ³¨æ„å‰è€…çš„å‚æ•°ç±»å‹æ˜¯string::iteratorï¼Œåè€…çš„å‚æ•°ç±»å‹æ˜¯string::reverse_iteratorã€‚æƒ³ç”¨ä¸€ä¸ªå‡½æ•°æ¥å—ä¸¤ç±»è¿­ä»£å™¨ï¼Œéœ€è¦ç”¨åˆ°æ¨¡æ¿ã€‚</p>
</li>
</ul>
<p>å› æ­¤ï¼ŒBufferç±»å¯ä»¥è®¾è®¡æˆä¸‹é¢çš„å½¢å¼ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Buffer</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">append</span><span class="params">(<span class="type">char</span> c, <span class="type">size_t</span> n = <span class="number">1</span>)</span></span>;    <span class="comment">//ç¬¬ä¸€ç§é‡è½½</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">append</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* s, <span class="type">size_t</span> n)</span></span>; <span class="comment">//ç¬¬äºŒç§é‡è½½</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Iter&gt;</span></span><br><span class="line"><span class="function">  <span class="type">void</span> <span class="title">append</span><span class="params">(Iter bp, Iter ep)</span></span>;        <span class="comment">//ç¬¬ä¸‰ç§é‡è½½</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Buffer buf;</span><br><span class="line"></span><br><span class="line">  buf.<span class="built_in">append</span>(<span class="string">&#x27;a&#x27;</span>);                     <span class="comment">//[1]</span></span><br><span class="line">  buf.<span class="built_in">append</span>(<span class="string">&#x27;b&#x27;</span>,<span class="number">10</span>);                  <span class="comment">//[1]</span></span><br><span class="line"></span><br><span class="line">  <span class="function">string <span class="title">str</span><span class="params">(<span class="string">&quot;hello&quot;</span>)</span></span>;</span><br><span class="line">  buf.<span class="built_in">append</span>(str.<span class="built_in">data</span>(), str.<span class="built_in">size</span>());  <span class="comment">//[2]</span></span><br><span class="line"></span><br><span class="line">  buf.<span class="built_in">append</span>(str.<span class="built_in">rbegin</span>(), str.<span class="built_in">rend</span>());<span class="comment">//[3]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™æ ·çš„å†™æ³•æ˜¯æœ‰é”™è¯¯çš„ï¼Œè€ƒè™‘ä¸‹é¢çš„æƒ…å†µ</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="type">int</span> ch = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">  Buffer buf;</span><br><span class="line">  buf.<span class="built_in">append</span>(ch, <span class="number">10</span>);  <span class="comment">//int,int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ç§å†™æ³•ä¸‹ï¼ŒæŒ‰ç†è¯´æ˜¯æƒ³ç”¨ç¬¬ä¸€ç§é‡è½½æ–¹å¼ï¼Œç„¶è€Œç”±äºä¸¤ä¸ªç±»å‹éƒ½æ˜¯intï¼Œæ‰€ä»¥ä¼šè°ƒç”¨åŸæœ¬ä¸ºè¿­ä»£å™¨è®¾è®¡çš„æ¨¡æ¿é‡è½½ï¼Œå³è°ƒç”¨äº†ç¬¬ä¸‰ç§æ–¹å¼çš„é‡è½½ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´è¿è¡Œæ—¶çš„é”™è¯¯ã€‚</p>
<p>SFINAEå¯ç”¨äºè§£å†³è¿™ç§é—®é¢˜ï¼Œå®ƒçš„æ€è·¯æ˜¯<strong>å¯¹æ¨¡æ¿å‚æ•°Tçš„ç±»å‹åŠ ä»¥é™åˆ¶</strong>ï¼Œä»è€Œé¿å…æ‰€æœ‰æƒ…å†µä¸‹æ¨¡æ¿éƒ½èƒ½ç²¾å‡†åŒ¹é…ã€‚</p>
<p>SFINAEçš„å…³é”®åœ¨äºstd::enable_ifã€‚<code>std::enable_if&lt;BOOL,??&gt;::type</code>çš„ä½¿ç”¨æ–¹å¼ï¼šç¬¬ä¸€ä¸ªæ¨¡æ¿å‚æ•°æ¥æ”¶ä¸€ä¸ªboolç±»å‹ï¼Œç¬¬äºŒä¸ªæ¨¡æ¿å‚æ•°æ¥æ”¶ä¸€ä¸ªä»»æ„ç±»å‹ï¼Œå½“å‰é¢çš„boolæ¡ä»¶ä¸ºtrueæ—¶ï¼Œenable_ifçš„æˆå‘˜å˜é‡typeå°±ä¼šæ˜¯ç¬¬äºŒä¸ªæ¨¡æ¿å‚æ•°??çš„ç±»å‹ã€‚è€Œenable_if&lt;BOOL,void&gt;é»˜è®¤ç¬¬äºŒä¸ªæ¨¡æ¿å‚æ•°æ˜¯voidã€‚boolæ¡ä»¶ä¸ºfalseæ—¶ï¼Œè¡¨è¾¾å¼è§£æå¤±è´¥ï¼Œå³ä¸ä¼šç¼–è¯‘falseå¯¹åº”çš„å†…å®¹ã€‚</p>
<p>ç”¨SFINAEï¼Œè§„é¿Iterä¸ºintç±»å‹ï¼š</p>
<ul>
<li><p>å†™æ³•ï¼š(å¯ä»¥å†™çš„å½¢å¼æœ‰å¾ˆå¤šï¼Œè·Ÿè¿™ç§å†™æ³•éƒ½æ˜¯ä¸€ä¸ªæ€æƒ³)</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Buffer</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">append</span><span class="params">(<span class="type">char</span> c, <span class="type">size_t</span> n = <span class="number">1</span>)</span></span>;    <span class="comment">//ç¬¬ä¸€ç§é‡è½½</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">append</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* s, <span class="type">size_t</span> n)</span></span>; <span class="comment">//ç¬¬äºŒç§é‡è½½</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Iter, <span class="keyword">typename</span> = </span><br><span class="line">      std::enable_if&lt;!std::is_integral&lt;Iter&gt;::value&gt;::type&gt;</span><br><span class="line">  <span class="type">void</span> <span class="built_in">append</span>(Iter bp, Iter ep);        <span class="comment">//ç¬¬ä¸‰ç§é‡è½½</span></span><br><span class="line">  <span class="comment">//å½“éæ•´æ•°æ—¶å°±ç›¸å½“äºtemplate&lt;typename Iter, typename = void&gt; void append(...)</span></span><br><span class="line">  <span class="comment">//æ•´æ•°æ—¶å°±ä¼šè§£æå¤±è´¥ï¼ŒSFINAEæœºåˆ¶æ­¤æ—¶ä¼šé€‰æ‹©å…¶ä»–å‡½æ•°é‡è½½</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p>ä¸Šé¢çš„å†™æ³•æ˜¯é’ˆå¯¹å‡½æ•°é‡è½½æ­§ä¹‰æ¶ˆé™¤æ—¶çš„enable_ifç”¨æ³•ï¼Œäº‹å®ä¸Šenable_ifè¿˜å¯ä»¥æœ‰åˆ«çš„ç”¨æ³•ï¼š</p>
<ol>
<li><p>æ¨¡æ¿åç‰¹åŒ–ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> Enable=<span class="type">void</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> check;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">check</span>&lt;T, <span class="keyword">typename</span> std::enable_if&lt;T::value&gt;::type&gt; &#123;</span><br><span class="line">  <span class="type">static</span> <span class="keyword">constexpr</span> <span class="type">bool</span> value = T::value;</span><br><span class="line">&#125;; </span><br></pre></td></tr></table></figure>

<p>checkåªé€‰æ‹©<code>value==true</code>çš„Tï¼Œå¦åˆ™å°±æŠ¥ç¼–è¯‘é”™è¯¯ï¼ˆå› ä¸ºæ²¡æœ‰å…¶ä»–é‡è½½çš„å®šä¹‰äº†ï¼‰ã€‚</p>
<blockquote>
<p>ğŸ“Œåªæœ‰ç±»æ¨¡æ¿æ˜¯å¯ä»¥åç‰¹åŒ–çš„ï¼Œå‡½æ•°æ¨¡æ¿ä¸å¯ä»¥åç‰¹åŒ–ã€‚</p>
</blockquote>
</li>
<li><p>æ§åˆ¶å‡½æ•°è¿”å›ç±»å‹ï¼šå…¸å‹çš„ä¾‹å­å°±æ˜¯C++çš„tupleä¸­ï¼Œè·å–kä¸ªå…ƒç´ çš„getæ–¹æ³•çš„å®ç°ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;std::<span class="type">size_t</span> k, <span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span>... Ts&gt;</span><br><span class="line"><span class="keyword">typename</span> std::enable_if&lt;k==<span class="number">0</span>, <span class="keyword">typename</span> element_type_holder&lt;<span class="number">0</span>, T, Ts...&gt;::type&amp;&gt;::type</span><br><span class="line"><span class="built_in">get</span>(tuple&lt;T, Ts...&gt; &amp;t) &#123;</span><br><span class="line">  <span class="keyword">return</span> t.tail; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;std::<span class="type">size_t</span> k, <span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span>... Ts&gt;</span><br><span class="line"><span class="keyword">typename</span> std::enable_if&lt;k!=<span class="number">0</span>, <span class="keyword">typename</span> element_type_holder&lt;k, T, Ts...&gt;::type&amp;&gt;::type</span><br><span class="line"><span class="built_in">get</span>(tuple&lt;T, Ts...&gt; &amp;t) &#123;</span><br><span class="line">  tuple&lt;Ts...&gt; &amp;base = t;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">get</span>&lt;k<span class="number">-1</span>&gt;(base); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡enable_ifå¯ä»¥æ ¹æ®ä¸åŒkçš„å€¼é€‰æ‹©è°ƒç”¨å“ªä¸ªgetï¼Œå®ç°å‡½æ•°æ¨¡æ¿çš„å¤šæ€ã€‚è¿™ä¸ªä¾‹å­ä¹Ÿä½“ç°äº†â€œç¼–è¯‘æ—¶è®¡ç®—â€æ€æƒ³ã€‚è¿›è¡Œäº†ä¸€ä¸ªç¼–è¯‘æœŸçš„é€’å½’ã€‚</p>
</li>
<li><p>åœ¨è¿›è¡Œæ­§ä¹‰æ¶ˆé™¤çš„åŒæ—¶ï¼Œæ§åˆ¶è¿”å›ç±»å‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">typename</span> std::enable_if&lt;std::is_integral&lt;T&gt;::value, <span class="type">bool</span>&gt;::<span class="function">type</span></span><br><span class="line"><span class="function"><span class="title">is_odd</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">bool</span>(t % <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>é™¤äº†åˆ©ç”¨enable_ifå…³é”®å­—å’ŒSFINAEæœºåˆ¶ï¼Œè¿˜æœ‰å¦ä¸€ç§æ›´æœ‰æ•ˆçš„æ­§ä¹‰æ¶ˆé™¤æ–¹æ¡ˆã€‚</p>
<ul>
<li><p>æ·»åŠ å‚æ•°ï¼ˆæ ‡ç­¾åˆ†å‘ï¼Œtag dispatchï¼‰</p>
<p>ç°åœ¨å¸Œæœ›å®ç°ä¸€ä¸ªto_stringå‡½æ•°ï¼ŒæŠŠæ•°å€¼ï¼ˆæ•´æ•°ã€æµ®ç‚¹æ•°ï¼‰è½¬æ¢ä¸ºæ ‡å‡†åº“stringç±»å‹å˜é‡ï¼Œå¯ä»¥å…ˆè¿™ä¹ˆå†™ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">std::string <span class="title">to_string</span><span class="params">(<span class="type">long</span> <span class="type">long</span> value)</span></span>&#123;</span><br><span class="line">  <span class="type">char</span> str[<span class="number">64</span>];</span><br><span class="line">  <span class="type">int</span> len = <span class="built_in">sprintf</span>(str, <span class="string">&quot;%lld&quot;</span>, value);</span><br><span class="line">  <span class="keyword">return</span> std::<span class="built_in">string</span>(str, len);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">std::string <span class="title">to_string</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> value)</span></span>&#123;</span><br><span class="line">  <span class="type">char</span> str[<span class="number">64</span>];</span><br><span class="line">  <span class="type">int</span> len = <span class="built_in">sprintf</span>(str, <span class="string">&quot;%llu&quot;</span>, value);</span><br><span class="line">  <span class="keyword">return</span> std::<span class="built_in">string</span>(str, len);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">std::string <span class="title">to_string</span><span class="params">(<span class="type">long</span> <span class="type">double</span> value)</span></span>&#123;</span><br><span class="line">  <span class="type">char</span> str[<span class="number">64</span>];</span><br><span class="line">  <span class="type">int</span> len = <span class="built_in">sprintf</span>(str, <span class="string">&quot;%Lg&quot;</span>, value);</span><br><span class="line">  <span class="keyword">return</span> std::<span class="built_in">string</span>(str, len);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  std::string str;</span><br><span class="line"></span><br><span class="line">  str = <span class="built_in">to_string</span>(<span class="number">1234</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;str = %s\n&quot;</span>, str.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">  str = <span class="built_in">to_string</span>(<span class="number">-1234</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;str = %s\n&quot;</span>, str.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">  str = <span class="built_in">to_string</span>(<span class="number">56.789</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;str = %s\n&quot;</span>, str.<span class="built_in">c_str</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤ä»£ç è€ƒè™‘äº†long long ç±»å‹æ•´æ•°å’Œéè´Ÿæ•´æ•°ï¼Œä»¥åŠdoubleæµ®ç‚¹ç±»å‹ã€‚ç„¶è€Œï¼Œ<strong>ç¼–è¯‘ä¼šæŠ¥é”™</strong>ã€‚å› ä¸ºä¼ 1234è¿™ä¸ªå­—é¢é‡æ—¶ï¼Œ1234ä¼šä½œä¸ºä¸€ä¸ªæ•´æ•°å˜é‡è¿›å…¥å‡½æ•°æ ˆï¼Œç„¶è€Œé‡è½½çš„å‡½æ•°ä¸­æ²¡ä¸€ä¸ªæ˜¯ç²¾ç¡®åŒ¹é…intç±»å‹çš„ï¼Œå› æ­¤ç¼–è¯‘å™¨ä¼šæ‰¾ç±»å‹æå‡ï¼Œå³éšå¼è½¬æ¢ã€‚ç„¶è€Œï¼Œintå¯¹äºlong long , unsigned long long, long doubleéƒ½å­˜åœ¨éšå¼è½¬æ¢ï¼Œç”±æ­¤äº§ç”Ÿæ­§ä¹‰ï¼Œç¼–è¯‘å™¨ä¸çŸ¥é“è¯¥é€‰æ‹©å“ªä¸ªå‡½æ•°é‡è½½ï¼Œæ‰€ä»¥ä¼šæœ‰ç¼–è¯‘æŠ¥é”™ã€‚</p>
<ul>
<li><p>è§£å†³æ–¹æ¡ˆä¸€ï¼šæŠŠæ‰€æœ‰ç±»å‹çš„å‚æ•°ï¼Œéƒ½å†™ä¸€éï¼Œå³åˆ—ä¸¾æ‰€æœ‰å¯èƒ½çš„å‡½æ•°é‡è½½</p>
<p>ç¼ºç‚¹ï¼šå†™å¤ªå¤šäº†ï¼Œè´¹æ—¶è´¹åŠ›</p>
</li>
<li><p>è§£å†³æ–¹æ¡ˆäºŒï¼šç”¨SFINAE</p>
<p>ç¼ºç‚¹ï¼šå½“å‰çš„é‡è½½ä¸»è¦åˆ¤æ–­ä¸¤ä¸ªæ¡ä»¶ï¼Œä¸€ä¸ªæ˜¯â€œå‚æ•°æ˜¯å¦ä¸ºæ•´æ•°â€ï¼Œå¦ä¸€ä¸ªæ˜¯â€œå‚æ•°æ˜¯å¦ä¸ºæœ‰ç¬¦å·æ•°â€ã€‚å½“é‡è½½çš„åˆ¤æ–­æ¡ä»¶å¤§äºç­‰äº2æ—¶ï¼Œä½¿ç”¨SFINAEä¼šå°†ä»£ç å†™å¾—è¾ƒä¹±ï¼Œéš¾ä»¥ç»´æŠ¤å’Œæ‹“å±•ã€‚</p>
</li>
<li><p><strong>è§£å†³æ–¹æ¡ˆä¸‰</strong>ï¼šæ·»åŠ å‚æ•°ï¼Œç¡®ä¿æ‰€æœ‰æƒ…å†µéƒ½æœ‰é‡è½½å¯ä»¥åŒ¹é…ï¼Œè€Œä¸”è‡³å¤šæœ‰ä¸€ä¸ªåŒ¹é…ã€‚</p>
<p>å®ç°æ–¹å¼ç±»ä¼¼äºï¼Œ<strong>é€šè¿‡å‡½æ•°å‚æ•°ï¼Œå®ç°ifè¯­å¥</strong>ã€‚å½“å‰å‡½æ•°é‡è½½ä¸»è¦åˆ¤æ–­ä¸¤ä¸ªæ¡ä»¶ï¼šå‚æ•°æ˜¯å¦ä¸ºæ•´æ•°ï¼Œå‚æ•°æ˜¯å¦ä¸ºæœ‰ç¬¦å·æ•°ã€‚å› ä¸ºæµ®ç‚¹æ•°ä¸å­˜åœ¨æœ‰æ— ç¬¦å·çš„é—®é¢˜ï¼Œæ‰€ä»¥ç±»å‹æ€»å…±å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªåˆ†æ”¯ï¼š</p>
<ol>
<li><p>æ•´æ•°ï¼Œæœ‰ç¬¦å·æ•°</p>
</li>
<li><p>æ•´æ•°ï¼Œæ— ç¬¦å·æ•°</p>
</li>
<li><p>æµ®ç‚¹æ•°</p>
</li>
</ol>
<p>å› æ­¤ï¼Œå¯ä»¥åŠ ä¸Šæ¨¡æ¿ï¼Œåˆ©ç”¨std::is_integral&lt;T&gt;åˆ¤æ–­å‚æ•°ç±»å‹æ˜¯å¦ä¸ºæ•´æ•°ï¼Œåˆ©ç”¨std::is_signed&lt;T&gt;åˆ¤æ–­ç±»å‹æ˜¯å¦ä¸ºæœ‰ç¬¦å·æ•°ã€‚</p>
<p>is_integral&lt;T&gt;äº‹å®ä¸Šæ˜¯C++æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªç±»ï¼Œç»§æ‰¿è‡ªintegral_constant&lt;bool, true&gt;ï¼Œè¯¥åŸºç±»æ˜¯ä¸€ä¸ªboolç±»å‹å¸¸é‡ã€‚è€Œboolç±»å‹åœ¨C++æ ‡å‡†åº“ä¸­å­˜åœ¨ä¸¤ä¸ªåˆ«åï¼Œåˆ†åˆ«å¯¹åº”trueå’Œfalseï¼š<code>std::true_type</code>å’Œ<code>std::false_type</code>ï¼Œå› æ­¤å¯ä»¥å°†å‡½æ•°é‡è½½è°ƒæ•´ä¸ºä»¥ä¸‹ä»£ç ï¼Œå³åˆ©ç”¨é‡è½½å®ç°å¯¹ç±»å‹å’Œç¬¦å·çš„ifåˆ¤æ–­ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span> <span class="comment">//is_integral, is_signedéƒ½å½’å±äºtype_traitså¤´æ–‡ä»¶</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ—¢æ˜¯æ•´æ•°ï¼Œåˆæ˜¯æœ‰ç¬¦å·æ•°çš„æƒ…å†µ</span></span><br><span class="line"><span class="function">std::string <span class="title">do_to_string</span><span class="params">(std::true_type,   <span class="comment">//integral</span></span></span></span><br><span class="line"><span class="params"><span class="function">                         std::true_type,   <span class="comment">//signed</span></span></span></span><br><span class="line"><span class="params"><span class="function">                         <span class="type">long</span> <span class="type">long</span> value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> str[<span class="number">64</span>];</span><br><span class="line">  <span class="type">int</span> len = <span class="built_in">sprintf</span>(str, <span class="string">&quot;%lld&quot;</span>, value);</span><br><span class="line">  <span class="keyword">return</span> std::<span class="built_in">string</span>(str, len);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ˜¯æ•´æ•°ï¼Œä½†ä¸æ˜¯æœ‰ç¬¦å·æ•°çš„æƒ…å†µ</span></span><br><span class="line"><span class="function">std::string <span class="title">do_to_string</span><span class="params">(std::true_type,   <span class="comment">//integral</span></span></span></span><br><span class="line"><span class="params"><span class="function">                         std::false_type,   <span class="comment">//!signed</span></span></span></span><br><span class="line"><span class="params"><span class="function">                         <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> str[<span class="number">64</span>];</span><br><span class="line">  <span class="type">int</span> len = <span class="built_in">sprintf</span>(str, <span class="string">&quot;%llu&quot;</span>, value);</span><br><span class="line">  <span class="keyword">return</span> std::<span class="built_in">string</span>(str, len);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸æ˜¯æ•´æ•°ï¼Œä½†æ˜¯æ˜¯æœ‰ç¬¦å·æ•°</span></span><br><span class="line"><span class="function">std::string <span class="title">do_to_string</span><span class="params">(std::false_type,  <span class="comment">//!integral</span></span></span></span><br><span class="line"><span class="params"><span class="function">                         std::true_type,   <span class="comment">//signed</span></span></span></span><br><span class="line"><span class="params"><span class="function">                         <span class="type">long</span> <span class="type">double</span> value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> str[<span class="number">64</span>];</span><br><span class="line">  <span class="type">int</span> len = <span class="built_in">sprintf</span>(str, <span class="string">&quot;%Lg&quot;</span>, value);</span><br><span class="line">  <span class="keyword">return</span> std::<span class="built_in">string</span>(str, len);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">std::string <span class="title">to_string</span><span class="params">(<span class="type">const</span> T&amp; t)</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">do_to_string</span>(std::<span class="built_in">is_integral</span>&lt;T&gt;(),</span><br><span class="line">                      std::<span class="built_in">is_signed</span>&lt;T&gt;(),</span><br><span class="line">                      t);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="declval"><a href="#declval" class="headerlink" title="declval"></a>declval</h4><p>declvalæ˜¯C++11å¼•å…¥çš„ä¸€ç§<strong>å‡½æ•°æ¨¡æ¿</strong>ï¼Œå…¶ä½œç”¨åœ¨äºä¸ºä¸€äº›ç±»å‹è¿”å›å®ƒçš„å³å€¼å¼•ç”¨ç±»å‹ã€‚å®˜æ–¹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">_Ty</span>,</span><br><span class="line">    <span class="keyword">class</span> = <span class="type">void</span>&gt;</span><br><span class="line">    <span class="keyword">struct</span> _Add_reference</span><br><span class="line">    &#123;   <span class="comment">// add reference</span></span><br><span class="line">    <span class="keyword">using</span> _Lvalue = _Ty;</span><br><span class="line">    <span class="keyword">using</span> _Rvalue = _Ty;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">_Ty</span>&gt;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">add_rvalue_reference</span></span><br><span class="line">    &#123;   <span class="comment">// add rvalue reference</span></span><br><span class="line">    <span class="keyword">using</span> type = <span class="keyword">typename</span> _Add_reference&lt;_Ty&gt;::_Rvalue;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">_Ty</span>&gt;</span><br><span class="line">    <span class="keyword">using</span> <span class="type">add_rvalue_reference_t</span> = <span class="keyword">typename</span> _Add_reference&lt;_Ty&gt;::_Rvalue;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// FUNCTION TEMPLATE declval</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> _Ty&gt;</span></span><br><span class="line"><span class="function">    <span class="type">add_rvalue_reference_t</span>&lt;_Ty&gt; <span class="title">declval</span><span class="params">()</span> <span class="keyword">noexcept</span></span>;</span><br></pre></td></tr></table></figure>

<p>std::declval&lt;T&gt;ï¼Œä¼ å…¥çš„Tä¸ºintæ—¶è¿”å›int&amp;&amp;ï¼ŒTä¸ºint&amp;æ—¶è¿”å›int&amp;ï¼ˆå¼•ç”¨æŠ˜å ï¼‰ï¼ŒTä¸ºint&amp;&amp;æ—¶è¿”å›int&amp;&amp;ã€‚declvalè¿”å›å³å€¼å¼•ç”¨çš„æ“ä½œå‡åœ¨ç¼–è¯‘æœŸå®Œæˆï¼Œä¸ç®¡Tç±»å‹æ˜¯å¦æœ‰publicçš„é»˜è®¤æ„é€ å‡½æ•°ï¼Œéƒ½èƒ½é€ å‡ºå³å€¼å¼•ç”¨ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">//......</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">using</span> YT = <span class="keyword">decltype</span>(std::<span class="built_in">declval</span>&lt;A&gt;());<span class="comment">//ä¸è¦ä¸¢åˆ°declval&lt;A&gt;() åçš„æ‹¬å·ï¼Œå› ä¸ºæ˜¯å‡½æ•°ï¼Œå¦åˆ™ä»£ç å«ä¹‰å‘ç”Ÿå˜åŒ–</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> boost::typeindex::type_id_with_cvr;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;YT = &quot;</span> &lt;&lt; <span class="built_in">type_id_with_cvr</span>&lt;YT&gt;().<span class="built_in">pretty_name</span>() &lt;&lt; endl;<span class="comment">//æ˜¾ç¤ºYTç±»å‹</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¾“å‡ºç»“æœï¼šYT = class A &amp;&amp;</span></span><br></pre></td></tr></table></figure>

<p>declvalå’Œdecltypeç»å¸¸é…åˆåœ¨ä¸€å—ï¼Œç”¨äºè¿›è¡Œå‡½æ•°æŒ‡é’ˆã€æˆå‘˜æ–¹æ³•è¿”å›ç±»å‹çš„æ¨å¯¼ã€‚</p>
<ul>
<li><strong>æˆå‘˜æ–¹æ³•è¿”å›å€¼ç±»å‹æ¨å¯¼</strong>ï¼š</li>
</ul>
<p>ä¼ ç»Ÿæ–¹æ¡ˆï¼šå¿…é¡»æ„é€ å¯¹è±¡ï¼Œæ‰èƒ½ç”¨decltype</p>
<blockquote>
<p>ğŸ“Œdecltype()ä¸­å‡ºç°çš„æ˜¯ å˜é‡ã€å¯¹è±¡ã€è¡¨è¾¾å¼ã€å‡½æ•°åã€å‡½æ•°æŒ‡é’ˆç­‰ï¼Œè€Œä¸å¯ä»¥å‡ºç°ç±»å‹å</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æƒ³è·å¾—æ™®é€šå‡½æ•° myfuncçš„è¿”å›å€¼ç±»å‹</span></span><br><span class="line">    <span class="function">A <span class="title">myobj</span><span class="params">(<span class="number">1</span>)</span></span>;<span class="comment">//åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">using</span> boost::typeindex::type_id_with_cvr;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;è¿”å›å€¼ç±»å‹:= &quot;</span> &lt;&lt;</span><br><span class="line">    <span class="built_in">type_id_with_cvr</span>&lt;</span><br><span class="line">    <span class="keyword">decltype</span>(myobj.<span class="built_in">myfunc</span>())&gt;().<span class="built_in">pretty_name</span>()</span><br><span class="line">     &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°ä»£æ–¹æ³•ï¼šdecltypeé…åˆdeclvalï¼Œæ— éœ€åˆ›å»ºå¯¹è±¡</p>
<blockquote>
<p>ğŸ“Œdeclval()è·å¾—å³å€¼å¼•ç”¨ï¼Œå¯ä»¥â€œéª—è¿‡â€ç¼–è¯‘å™¨ï¼Œç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªå‡çš„å¯¹è±¡ï¼Œä»è€Œç›´æ¥ä½¿ç”¨è¯¥ç±»å‹çš„æˆå‘˜å‡½æ•°</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> boost::typeindex::type_id_with_cvr;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;è¿”å›å€¼ç±»å‹:= &quot;</span> &lt;&lt;</span><br><span class="line">    type_id_with_cvr&lt;</span><br><span class="line">    <span class="keyword">decltype</span>(std::<span class="built_in">declval</span>&lt;A&gt;().<span class="built_in">myfunc</span>())&gt;()</span><br><span class="line">    .<span class="built_in">pretty_name</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>å‡½æ•°æŒ‡é’ˆæ¨å¯¼</strong>ï¼šåˆšåˆšçš„æˆå‘˜æ–¹æ³•è¿”å›ç±»å‹æ¨å¯¼æ¯”è¾ƒç®€å•ï¼Œè€ƒè™‘è¿™æ ·ä¸€ç§æƒ…å†µï¼Œå‡½æ•°æ¨¡æ¿å†…ä½¿ç”¨äº†ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œè¿”å›çš„å°±æ˜¯å‡½æ•°æŒ‡é’ˆçš„è¿”å›å€¼ã€‚ä½†æ˜¯è¿™ä¸ªå‡½æ•°æ¨¡æ¿æ˜¯é€šç”¨çš„ï¼Œä¹Ÿå°±æ˜¯å„ç§å„æ ·çš„å‡½æ•°æŒ‡é’ˆå®ƒéƒ½èƒ½æ¥æ”¶ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™è¿”å›å€¼ç±»å‹æ˜¯ä¸ç¡®å®šçš„ï¼Œæ­¤æ—¶çš„å‡½æ•°æ¨¡æ¿è¯¥å¦‚ä½•å®šä¹‰å‘¢ï¼Ÿ</p>
<p>è§£å†³æ–¹æ¡ˆå°±æ˜¯ï¼Œæ¨å¯¼å‡½æ•°æŒ‡é’ˆçš„è¿”å›å€¼ç±»å‹ï¼Œæ¨å¯¼å‡ºçš„ç±»å‹æ¥ä½œä¸ºå‡½æ•°æ¨¡æ¿çš„è¿”å›ç±»å‹ã€‚</p>
<p>æœ‰ä¸¤ç§æ–¹å¼å®ç°è¿™ä¸€æ€è·¯ï¼Œå…¶ä¸­ä¸€ä¸ªå°±æ˜¯decltypeæ­é…declvalã€‚</p>
</li>
</ul>
<p>æ–¹å¼ä¸€ï¼šdecltype + declval</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">myfunc</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T_F, <span class="keyword">typename</span>... U_Args&gt;</span><br><span class="line"><span class="keyword">decltype</span>(<span class="built_in">declval</span>&lt;T_F&gt;()  (<span class="built_in">declval</span>&lt;U_Args&gt;()...))</span><br><span class="line"><span class="built_in">TestFnRtnTmp1</span>(T_F func, U_Args... args) &#123;</span><br><span class="line">    <span class="keyword">auto</span> rtnvalue = <span class="built_in">func</span>(args...);</span><br><span class="line">    <span class="keyword">return</span> rtnvalue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> result = <span class="built_in">TestFnRtnTmp1</span>(myfunc, <span class="number">5</span>, <span class="number">8</span>);</span><br><span class="line">    cout &lt;&lt; result &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–¹å¼äºŒï¼šå°¾ç½®è¿”å›ç±»å‹ + autoå…³é”®å­—</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">myfunc</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T_F, <span class="keyword">typename</span>... U_Args&gt;</span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">TestFnRtnTmp2</span><span class="params">(T_F func, U_Args... args)</span></span></span><br><span class="line"><span class="function"> -&gt; <span class="title">decltype</span><span class="params">(func(args...))</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> rtnvalue = <span class="built_in">func</span>(args...);</span><br><span class="line">    <span class="keyword">return</span> rtnvalue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> result = <span class="built_in">TestFnRtnTmp2</span>(myfunc, <span class="number">5</span>, <span class="number">8</span>);</span><br><span class="line">    cout &lt;&lt; result &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤å¤„ä¸»è¦è§£é‡Šæ–¹å¼ä¸€ã€‚<code>declval&lt;T_F&gt;()</code>ï¼šT_Fæ˜¯å‡½æ•°æŒ‡é’ˆ<code>int(*)(int, int)</code>ç±»å‹ï¼Œé‚£ä¹ˆåœ¨ç¼–è¯‘æœŸdeclvalå¯ä»¥æ¨æ–­å‡ºå…¶æ˜¯å‡½æ•°æŒ‡é’ˆå¹¶è¿”å›<code>int(*&amp;&amp;)(int,int)</code>ï¼Œå³å‡½æ•°æŒ‡é’ˆçš„å³å€¼ç±»å‹ï¼Œç›¸å½“äºå®ä¾‹åŒ–äº†ä¸€ä¸ªå‡çš„å‡½æ•°æŒ‡é’ˆå¯¹è±¡ï¼Œå¯ä»¥è¾“å…¥å‚æ•°ã€‚æ‰€ä»¥åœ¨<code>decltype(å‡½æ•°æŒ‡é’ˆå³å€¼å¼•ç”¨())</code>ï¼Œå°±å¯ä»¥å¾—åˆ°è¿”å›å€¼ç±»å‹ã€‚ä¹Ÿå°±æ˜¯</p>
<p><code>decltype(declval&lt;T_F&gt;() (declval&lt;U_Args&gt;()...))</code></p>
<p>è€Œç›´æ¥ç”¨<code>decltype(T_F(U_Args)...)</code>æ˜¯ä¸è¡Œçš„ï¼Œä¼šæŠ¥é”™ï¼Œå› ä¸ºdecltype()åªèƒ½æ¥æ”¶å®ä¾‹ï¼Œä¸èƒ½æ¥æ”¶ç±»å‹ã€‚</p>
<h2 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h2><h3 id="stringç±»å‹"><a href="#stringç±»å‹" class="headerlink" title="stringç±»å‹"></a>stringç±»å‹</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨åŠ å·+è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥</span></span><br><span class="line"><span class="function">string <span class="title">compose</span><span class="params">(<span class="type">const</span> string&amp;name, <span class="type">const</span> string&amp; domain)</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> name + <span class="string">&#x27;@&#x27;</span> + domain;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¸¸ç”¨æ“ä½œ</span></span><br><span class="line">string name = <span class="string">&quot;Niels Stroustrup&quot;</span></span><br><span class="line"><span class="type">void</span> <span class="built_in">m3</span>()&#123;</span><br><span class="line">  string s = name.<span class="built_in">substr</span>(<span class="number">6</span>,<span class="number">10</span>);   <span class="comment">//s=&quot;Stroustrup&quot;                   å–å­ä¸²ï¼Œä»ç´¢å¼•6å¼€å§‹çš„10ä¸ªå­—ç¬¦</span></span><br><span class="line">  name.<span class="built_in">replace</span>(<span class="number">0</span>,<span class="number">5</span>,<span class="string">&quot;nicholas&quot;</span>);   <span class="comment">//nameå˜ä¸º&quot;nicholas Stroustrup&quot;     æ›¿æ¢ï¼Œä»ç´¢å¼•0å¼€å§‹çš„5ä¸ªå­—ç¬¦</span></span><br><span class="line">  name[<span class="number">0</span>] = <span class="built_in">toupper</span>(name[<span class="number">0</span>]);     <span class="comment">//nameå˜ä¸º&quot;Nicholas Stroustrup&quot;     å¤§å†™</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//stringä¸å­—ç¬¦ä¸²å­—é¢å€¼çš„æ¯”è¾ƒ</span></span><br><span class="line">string incantation;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">respond</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(answer == incantation)&#123;</span><br><span class="line">    <span class="comment">//æ‰§è¡Œä¸€äº›æ“ä½œ</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (answer == <span class="string">&quot;yes&quot;</span>)&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åªè¯»å½¢å¼çš„Cé£æ ¼å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="type">void</span> <span class="built_in">print</span>(<span class="type">const</span> string&amp; s)&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;For people who like printf: %s\n&quot;</span>, s.<span class="built_in">c_str</span>());</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;For people who like streams: &quot;</span> &lt;&lt; s &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ“Œæ ‡å‡†åº“stringå®šä¹‰äº†ä¸€ä¸ªç§»åŠ¨æ„é€ å‡½æ•°ï¼Œå› æ­¤ï¼Œå³ä½¿æ˜¯ä»¥ä¼ å€¼æ–¹å¼è€Œä¸æ˜¯ä¼ å¼•ç”¨æ–¹å¼è¿”å›ä¸€ä¸ªå¾ˆé•¿çš„stringä¹Ÿä¼šå¾ˆé«˜æ•ˆã€‚</p>
</blockquote>
<p>stringå¯¹è±¡é™¤äº†æœ‰begin()å’Œend()ä¹‹å¤–ï¼Œè¿˜æœ‰rbegin()ï¼Œrend()ã€‚åŒæ—¶è¿˜æœ‰cbegin()ï¼Œcend()ï¼Œè¡¨ç¤ºçš„æ˜¯const iteratorã€‚ç›¸åº”çš„ï¼Œcrbegin()ï¼Œcrend()è¡¨ç¤ºconst reverse iteratorã€‚</p>
<ul>
<li><p>çŸ­å­—ç¬¦ä¸²ä¼˜åŒ–(short-string optimization)æŠ€æœ¯ï¼š</p>
<blockquote>
<p>çŸ­å­—ç¬¦ä¸²ç›´æ¥ä¿å­˜åœ¨stringå¯¹è±¡å†…éƒ¨ï¼Œè€Œé•¿å­—ç¬¦ä¸²åˆ™ä¿å­˜åœ¨è‡ªç”±å­˜å‚¨åŒºä¸­ã€‚</p>
</blockquote>
<p>å› æ­¤å¯¹äºè¿™æ ·çš„ä¸¤ä¸ªå­—ç¬¦ä¸²</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">string s1 &#123;<span class="string">&quot;Annemarie&quot;</span>&#125;;             <span class="comment">//çŸ­å­—ç¬¦ä¸²</span></span><br><span class="line">string s2 &#123;<span class="string">&quot;Annemarie Stroustrup&quot;</span>&#125;;  <span class="comment">//é•¿å­—ç¬¦ä¸²</span></span><br></pre></td></tr></table></figure>

<p>s1å¯¹è±¡å†…éƒ¨ç›´æ¥å­˜åœ¨è¯¥å­—ç¬¦ä¸²ï¼Œè€Œs2å¯¹è±¡å†…éƒ¨ä»…å­˜å‚¨è¯¥å­—ç¬¦ä¸²çš„åœ°å€ï¼Œéœ€è¦ç”¨åˆ°æ—¶åˆ™æ ¹æ®åœ°å€å–å€¼ã€‚</p>
<p>ä¹‹æ‰€ä»¥é‡‡ç”¨è¿™ç§å®ç°æ–¹å¼ï¼Œæ˜¯å› ä¸ºè¿è¡Œæ—¶ç¯å¢ƒä¸­å†…å­˜åˆ†é…ä»£ä»·è¾ƒé«˜ï¼Œè€Œå¤§é‡é•¿åº¦ä¸ä¸€çš„å­—ç¬¦ä¸²ä¼šäº§ç”Ÿå †çš„å†…å­˜ç¢ç‰‡ã€‚</p>
<p>çŸ­å­—ç¬¦ä¸²ä¼˜åŒ–å¯ä»¥è®©æ ˆæ‰¿æ‹…çŸ­å­—ç¬¦ä¸²ï¼ŒåŠ å¿«è¿è¡Œï¼ŒåŒæ—¶è§„é¿é•¿åº¦è¿‡äºåˆ†æ•£çš„çŠ¶å†µã€‚</p>
</li>
<li><p>basic_stringï¼š</p>
<p>C++æ ‡å‡†åº“ä¸­å®šä¹‰äº†é€šç”¨å­—ç¬¦ä¸²æ¨¡æ¿<code>basic_string</code>ï¼Œstringå®é™…ä¸Šæ˜¯æ­¤æ¨¡æ¿ç”¨charç±»å‹å®ä¾‹åŒ–çš„ä¸€ä¸ªåˆ«å</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Char&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">basic_string</span>&#123;</span><br><span class="line">  <span class="comment">//...ç±»çš„åŠŸèƒ½å®ç°</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">using</span> string = basic_string&lt;<span class="type">char</span>&gt;;</span><br></pre></td></tr></table></figure>

<p>ç”¨æˆ·å¯ä»¥ä¸å±€é™äºasciiç ï¼Œåˆ©ç”¨basic_stringå®šä¹‰ä»»æ„å­—ç¬¦ç±»å‹çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ—¥æ–‡å­—ç¬¦ç±»å‹Jcharï¼Œåˆ™å¯ä»¥å®šä¹‰ä¸ºï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> Jstring = basic_string&lt;Jchar&gt;;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œå°±å¯ä»¥åœ¨Jstringâ€”â€”æ—¥æ–‡å­—ç¬¦ä¸²ä¸Šæ‰§è¡Œå¸¸è§çš„å­—ç¬¦ä¸²æ“ä½œã€‚</p>
</li>
<li><p>å­—ç¬¦ä¸²è½¬æ¢å‡½æ•°</p>
<p>Cå‡½æ•°atoi()ã€atol()é¢å‘çš„æ˜¯Cå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯C++çš„stringç±»å‹ã€‚C++11å¢åŠ äº†å‡ ä¸ªæ–°çš„è½¬æ¢å‡½æ•°ï¼š</p>
<ul>
<li><p>stoi()ã€stol()ã€stoll()ç­‰æŠŠstringè½¬æ¢æˆæ•´æ•°ï¼›</p>
</li>
<li><p>stof()ã€stod()ç­‰æŠŠstringè½¬æ¢æˆæµ®ç‚¹æ•°ï¼›</p>
</li>
<li><p>to_string()æŠŠæ•´æ•°ã€æµ®ç‚¹æ•°è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚</p>
</li>
</ul>
</li>
</ul>
<h3 id="æ­£åˆ™è¡¨è¾¾å¼çš„æ¨¡å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼çš„æ¨¡å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼çš„æ¨¡å¼"></a>æ­£åˆ™è¡¨è¾¾å¼çš„æ¨¡å¼</h3><ul>
<li><p>æ­£åˆ™è¡¨è¾¾å¼çš„ç‰¹æ®Šå­—ç¬¦</p>
<table>
<thead>
<tr>
<th>.</th>
<th>ä»»æ„å•ä¸ªå­—ç¬¦ï¼ˆâ€œé€šé…ç¬¦â€ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td>[</td>
<td>å­—ç¬¦é›†å¼€å§‹</td>
</tr>
<tr>
<td>]</td>
<td>å­—ç¬¦é›†ç»“æŸ</td>
</tr>
<tr>
<td>{</td>
<td>æŒ‡å®šé‡å¤æ¬¡æ•°å¼€å§‹</td>
</tr>
<tr>
<td>}</td>
<td>æŒ‡å®šé‡å¤æ¬¡æ•°ç»“æŸ</td>
</tr>
<tr>
<td>(</td>
<td>åˆ†ç»„å¼€å§‹</td>
</tr>
<tr>
<td>)</td>
<td>åˆ†ç»„ç»“æŸ</td>
</tr>
<tr>
<td>\</td>
<td>ä¸‹ä¸€ä¸ªå­—ç¬¦æœ‰ç‰¹æ®Šå«ä¹‰</td>
</tr>
<tr>
<td>*</td>
<td>é›¶æˆ–å¤šæ¬¡é‡å¤ï¼ˆåç¼€æ“ä½œï¼‰</td>
</tr>
<tr>
<td>+</td>
<td>ä¸€æˆ–å¤šæ¬¡é‡å¤ï¼ˆåç¼€æ“ä½œï¼‰</td>
</tr>
<tr>
<td>?</td>
<td>é›¶æˆ–ä¸€æ¬¡ï¼ˆåç¼€æ“ä½œï¼‰</td>
</tr>
<tr>
<td>|</td>
<td>æˆ–</td>
</tr>
<tr>
<td>^</td>
<td>è¡Œå¼€å§‹ï¼›é</td>
</tr>
<tr>
<td>$</td>
<td>è¡Œç»“æŸ</td>
</tr>
</tbody></table>
</li>
<li><p>é‡å¤</p>
<table>
<thead>
<tr>
<th>{n}</th>
<th>ä¸¥æ ¼é‡å¤næ¬¡</th>
</tr>
</thead>
<tbody><tr>
<td>{n,}</td>
<td>é‡å¤næ¬¡æˆ–æ›´å¤šæ¬¡</td>
</tr>
<tr>
<td>{n,m}</td>
<td>è‡³å°‘é‡å¤næ¬¡ï¼Œæœ€å¤šmæ¬¡</td>
</tr>
<tr>
<td>*</td>
<td>é›¶æ¬¡æˆ–å¤šæ¬¡ï¼Œå³{0,}</td>
</tr>
<tr>
<td>+</td>
<td>ä¸€æ¬¡æˆ–å¤šæ¬¡ï¼Œå³{1,}</td>
</tr>
<tr>
<td>?</td>
<td>é›¶æ¬¡æˆ–ä¸€æ¬¡ï¼Œå³{0,1}</td>
</tr>
</tbody></table>
<p>æ¨¡å¼åŒ¹é…åœ¨é‡è§é‡å¤å­—ç¬¦ä¸²æ—¶ï¼Œè¿˜æ¶‰åŠè´ªå¿ƒåŒ¹é…å’Œæ‡’æƒ°åŒ¹é…ã€‚</p>
<ul>
<li><p>è´ªå¿ƒåŒ¹é…ï¼šé»˜è®¤æƒ…å†µä¸‹å°±æ˜¯è´ªå¿ƒåŒ¹é…</p>
<p>åŸå­—ç¬¦ä¸²ï¼šabababï¼Œç°åœ¨ç”¨æ¨¡å¼(ab)*æ¥åŒ¹é…ï¼Œæ¨¡å¼åŒ¹é…å™¨æ€»æ˜¯æŸ¥æ‰¾æœ€é•¿åŒ¹é…ï¼Œä¼šåŒ¹é…åˆ°æ•´ä¸ªå­—ç¬¦ä¸²ababab</p>
</li>
<li><p>æ‡’æƒ°åŒ¹é…ï¼šåœ¨ä»»ä½•é‡å¤ç¬¦å·ï¼ˆ?ã€ *ã€+åŠ{ }ï¼‰ä¹‹åæ”¾ä¸€ä¸ªåç¼€?ï¼Œä¼šä½¿æ¨¡å¼åŒ¹é…å™¨è¿›å…¥æ‡’æƒ°çŠ¶æ€ã€‚</p>
<p>åŸå­—ç¬¦ä¸²ï¼šabababï¼Œç°åœ¨ç”¨æ¨¡å¼(ab) *?æ¥åŒ¹é…ï¼Œæ¨¡å¼åŒ¹é…å™¨ä¼šæŸ¥æ‰¾æœ€çŸ­åŒ¹é…ï¼ŒåŒ¹é…åˆ°å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªab</p>
</li>
</ul>
</li>
<li><p>å­—ç¬¦é›†ä¸å­—ç¬¦é›†ç®€å†™</p>
<p>æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œå­—ç¬¦é›†å¿…é¡»ç”¨[: :]åŒ…å›´èµ·æ¥ã€‚ä¾‹å¦‚[:digit:]åŒ¹é…ä¸€ä¸ªåè¿›åˆ¶æ•°å­—ã€‚åŒæ—¶ï¼Œå¦‚æœæ˜¯å®šä¹‰ä¸€ä¸ªå­—ç¬¦é›†ï¼Œå¤–è¾¹å¿…é¡»å†åŒ…å›´ä¸€å¯¹æ–¹æ‹¬å·[ ]ï¼Œæ¯”å¦‚ï¼Œ[^[:digit:]]åŒ¹é…ä¸€ä¸ªéåè¿›åˆ¶æ•°å­—ã€‚</p>
<table>
<thead>
<tr>
<th>å­—ç¬¦é›†</th>
<th>ç®€å†™</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>alnum</td>
<td></td>
<td>ä»»æ„å­—ç¬¦æ•°å­—å­—ç¬¦</td>
</tr>
<tr>
<td>alpha</td>
<td></td>
<td>ä»»æ„å­—æ¯</td>
</tr>
<tr>
<td>blank</td>
<td></td>
<td>ä»»æ„ç©ºç™½ç¬¦ï¼Œä½†ä¸èƒ½æ˜¯è¡Œåˆ†éš”ç¬¦</td>
</tr>
<tr>
<td>cntrl</td>
<td></td>
<td>ä»»æ„æ§åˆ¶å­—ç¬¦</td>
</tr>
<tr>
<td>d</td>
<td>\d&#x3D;[[:d:]]</td>
<td>ä»»æ„åè¿›åˆ¶æ•°å­—</td>
</tr>
<tr>
<td>digit</td>
<td>\d&#x3D;[[:digit:]], \D&#x3D;[^[:digit:]]éåè¿›åˆ¶æ•°å­—</td>
<td>ä»»æ„åè¿›åˆ¶æ•°å­—</td>
</tr>
<tr>
<td>graph</td>
<td></td>
<td>ä»»æ„å›¾å½¢å­—ç¬¦</td>
</tr>
<tr>
<td>lower</td>
<td>\l&#x3D;[[:lower:]]ï¼Œ\L&#x3D;[^[:lower:]]éå¤§å†™å­—ç¬¦ï¼Œå‡éæ ‡å‡†ä½†å¸¸è§</td>
<td>ä»»æ„å°å†™å­—ç¬¦</td>
</tr>
<tr>
<td>print</td>
<td></td>
<td>ä»»æ„å¯æ‰“å°å­—ç¬¦</td>
</tr>
<tr>
<td>punct</td>
<td></td>
<td>ä»»æ„æ ‡ç‚¹</td>
</tr>
<tr>
<td>s</td>
<td>\s&#x3D;[[:s:]]</td>
<td>ä»»æ„ç©ºç™½ç¬¦ï¼ˆç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ç­‰ç­‰ï¼‰</td>
</tr>
<tr>
<td>space</td>
<td>\s&#x3D;[[:space:]], \S&#x3D;[^[:space:]]éç©ºç™½ç¬¦</td>
<td>ä»»æ„ç©ºç™½ç¬¦</td>
</tr>
<tr>
<td>upper</td>
<td>\u&#x3D;[[:upper:]]ï¼Œ\U&#x3D;[^[:upper:]]éå¤§å†™å­—ç¬¦ï¼Œå‡éæ ‡å‡†ä½†å¸¸è§</td>
<td>ä»»æ„å¤§å†™å­—ç¬¦</td>
</tr>
<tr>
<td>w</td>
<td>\w&#x3D;[[:w:]]ï¼Œ</td>
<td>ä»»æ„å•è¯å­—ç¬¦ï¼ˆå­—æ¯ã€æ•°å­—å­—ç¬¦å†åŠ ä¸‹åˆ’çº¿ï¼‰</td>
</tr>
<tr>
<td>xdigit</td>
<td></td>
<td>ä»»æ„åå…­è¿›åˆ¶æ•°å­—å­—ç¬¦</td>
</tr>
</tbody></table>
</li>
<li><p>æ­£åˆ™è¡¨è¾¾å¼åˆ†ç»„</p>
<p>( )å¼•å‘äº†åˆ†ç»„çš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯æ­£åˆ™è¡¨è¾¾å¼ä¸­è¢«( )åŒ…èµ·æ¥çš„å†…å®¹æ„æˆäº†ä¸€ä¸ªgroupï¼ŒåŒ¹é…æ—¶ä½œä¸ºä¸€ä¸ªå­æ¨¡å¼åŒ¹é…ã€‚</p>
<p>æ¯”å¦‚æƒ³åŒ¹é…XMLè¯­è¨€ï¼Œæ¨¡å¼å¯ä»¥è®¾è®¡ä¸º<code>&lt;(.*?)&gt;(.*?)&lt;/\1&gt;</code>ï¼Œè¿™é‡Œæœ‰ä¸‰ä¸ªåˆ†ç»„ï¼Œå…¶ä¸­\1æ˜¯ç¬¬ä¸‰ä¸ªï¼Œå«ä¹‰ä¸ºâ€œä¸åˆ†ç»„1ä¸€æ ·â€ã€‚è€Œä¸”ä½¿ç”¨äº†æ‡’æƒ°åŒ¹é…<code>.*?</code>ï¼Œè¿™æ ·ï¼Œå½“é¢ä¸´ä¸‹é¢çš„è¾“å…¥ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">Always look for the &lt;b&gt;bright&lt;/b&gt; side of &lt;b&gt;life&lt;/b&gt;.</span><br></pre></td></tr></table></figure>

<p>ä¸ä½¿ç”¨ <em>?ï¼Œè€Œæ˜¯å•ç‹¬</em>çš„è¯ï¼Œè´ªå¿ƒåŒ¹é…ä¼šå°†ç¬¬ä¸€ä¸ª&lt;å’Œæœ€åä¸€ä¸ª&gt;é…å¯¹ã€‚</p>
<p>ä½†æ‡’æƒ°åŒ¹é…çš„ç»“æœå°†æ˜¯&lt;b&gt;bright&lt;&#x2F;b&gt;å’Œ&lt;b&gt;life&lt;&#x2F;b&gt;è¿™ä¸¤ä¸ªç¬¦åˆç¨‹åºå‘˜é¢„æœŸçš„ç»“æœã€‚</p>
<p>ç„¶è€Œï¼Œå¦‚æœ<strong>æƒ³è¦æ‹¬å·ï¼Œä½†æ˜¯ä¸éœ€è¦å®Œå…¨åŒ¹é…åˆ°æ‹¬å·ä¸­çš„å†…å®¹</strong>ï¼Œå¯ä»¥ç”¨<code>(?</code></p>
<ul>
<li><p>(?:pattern)ï¼šåŒ¹é…patternä½†ä¸è·å–ç»“æœï¼Œå³éè·å–åŒ¹é…ã€‚ä¾‹å¦‚â€œindustr(?:y|ies)â€å¯ä»¥ç”¨æ¥æ›¿ä»£â€industry|industriesâ€ã€‚</p>
</li>
<li><p>(?&#x3D;pattern)ï¼šæ­£å‘è‚¯å®šé¢„æŸ¥ï¼Œä¾‹å¦‚â€Windows(?&#x3D;95|98|NT|2000)â€èƒ½åŒ¹é…â€Windows2000â€ä¸­çš„Windowsï¼Œä½†ä¸èƒ½åŒ¹é…â€Windows3.1â€ä¸­çš„Windowsã€‚</p>
</li>
<li><p>(?!pattern)ï¼šæ­£å‘å¦å®šé¢„æŸ¥ï¼Œä¾‹å¦‚â€Windows(?!95|98|NT|2000)â€èƒ½åŒ¹é…â€Windows3.1â€ä¸­çš„Windowsï¼Œä½†ä¸èƒ½åŒ¹é…â€Windows2000â€ä¸­çš„Windowsã€‚</p>
</li>
<li><p>(?&lt;&#x3D;pattern)ï¼šåå‘è‚¯å®šé¢„æŸ¥ï¼Œä¸æ­£å‘è‚¯å®šé¢„æŸ¥ç±»ä¼¼ï¼Œä½†æ–¹å‘ç›¸åï¼Œä¾‹å¦‚â€œ(?&lt;&#x3D;95|98|NT|2000)Windowsâ€èƒ½åŒ¹é…â€œ2000Windowsâ€ä¸­çš„â€œWindowsâ€ï¼Œä½†ä¸èƒ½åŒ¹é…â€œ3.1Windowsâ€ä¸­çš„â€œWindowsâ€</p>
</li>
<li><p>(?&lt;!pattern)ï¼šåå‘å¦å®šé¢„æŸ¥ï¼Œä¸æ­£å‘å¦å®šé¢„æŸ¥ç±»ä¼¼ï¼Œä½†æ–¹å‘ç›¸åï¼Œä¾‹å¦‚â€œ(?&lt;!95|98|NT|2000)Windowsâ€èƒ½åŒ¹é…â€œ3.1Windowsâ€ä¸­çš„â€œWindowsâ€ï¼Œä½†ä¸èƒ½åŒ¹é…â€œ2000Windowsâ€ä¸­çš„â€œWindowsâ€</p>
</li>
</ul>
</li>
</ul>
<h3 id="C-ä¸­çš„æ­£åˆ™API"><a href="#C-ä¸­çš„æ­£åˆ™API" class="headerlink" title="C++ä¸­çš„æ­£åˆ™API"></a>C++ä¸­çš„æ­£åˆ™API</h3><p>æ ‡å‡†åº“æä¾›äº†&lt;regex&gt;ç±»ï¼Œä»è€Œæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ã€‚æ¯”å¦‚å¯ä»¥ç”¨ä¸‹é¢ä»£ç å®šä¹‰ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">regex <span class="title">pat</span> <span class="params">(<span class="string">R&quot;(\w&#123;2&#125;\s*\d&#123;5&#125;(-\d&#123;4&#125;)?)&quot;</span>)</span></span>;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä»£ç å®šä¹‰äº†ä¸€ä¸ªç¾å›½é‚®æ”¿ç¼–ç æ¨¡å¼ï¼šXXddddd-ddddã€‚å…¶ä¸­åé¢çš„-ddddæ˜¯å¯æœ‰å¯æ— çš„ã€‚ä»¥ä¸¤ä¸ªå­—æ¯å¼€å§‹<code>\w&#123;2&#125;</code>ï¼Œåé¢æ˜¯ä»»æ„ä¸ªç©ºç™½ç¬¦<code>\s*</code>ï¼Œå†æ¥ä¸‹æ¥æ˜¯5ä¸ªæ•°å­—<code>\d&#123;5&#125;</code>ï¼Œç„¶åæ˜¯å¯é€‰çš„ç ´æŠ˜å·åŠ å››ä½æ•°å­—<code>-\d&#123;4&#125;</code>ã€‚</p>
<ul>
<li><p>å¸¸ç”¨æ­£åˆ™åŒ¹é…å‡½æ•°</p>
<ul>
<li><p>regex_match( )ï¼šå°†æ­£åˆ™è¡¨è¾¾å¼ä¸ä¸€ä¸ªï¼ˆå·²çŸ¥é•¿åº¦çš„ï¼‰å­—ç¬¦ä¸²è¿›è¡ŒåŒ¹é…ï¼Œåˆ¤æ–­æ˜¯å¦å®Œå…¨åŒ¹é…ã€‚å¦‚æœå®Œå…¨åŒ¹é…åˆ™è¿”å›trueï¼Œå¦åˆ™falseã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">string str = <span class="string">&quot;twinkle1993&quot;</span>;</span><br><span class="line"><span class="function">regex <span class="title">r</span><span class="params">(<span class="string">&quot;[a-z0-9]+&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> is_match = <span class="built_in">regex_match</span>(str, r); <span class="comment">//true</span></span><br><span class="line">is_match = <span class="built_in">regex_match</span>(str.<span class="built_in">begin</span>()+<span class="number">7</span>, str.<span class="built_in">end</span>(), <span class="built_in">regex</span>(<span class="string">&quot;\\d+&quot;</span>)); <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line">smatch sm;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">regex_match</span>(str.<span class="built_in">cbegin</span>()+<span class="number">5</span>, str.<span class="built_in">cend</span>(), sm, <span class="built_in">regex</span>(<span class="string">&quot;([a-z]+)(\\d+)&quot;</span>)))</span><br><span class="line">&#123;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;å­—ç¬¦ä¸²: &quot;</span> &lt;&lt; &amp;str[<span class="number">5</span>] &lt;&lt; <span class="string">&quot; åŒ¹é…æˆåŠŸï¼&quot;</span> &lt;&lt; endl;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;åŒ¹é…å­—ç¬¦ä¸²ä¸ªæ•°: &quot;</span> &lt;&lt; sm.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;åˆ†åˆ«ä¸º: &quot;</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">auto</span> aa : sm)</span><br><span class="line">    cout &lt;&lt; aa.<span class="built_in">str</span>() &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">  cout &lt;&lt; endl; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* è¾“å‡ºç»“æœï¼š</span></span><br><span class="line"><span class="comment">    å­—ç¬¦ä¸²: le1993åŒ¹é…æˆåŠŸ</span></span><br><span class="line"><span class="comment">    åŒ¹é…å­—ç¬¦ä¸²ä¸ªæ•°ï¼š3</span></span><br><span class="line"><span class="comment">    åˆ†åˆ«ä¸ºï¼šle1993 le 1993</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">cmatch cm;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">regex_match</span>(str.<span class="built_in">c_str</span>(), cm, <span class="built_in">regex</span>(<span class="string">&quot;([a-z]+)(\\d+)&quot;</span>))) </span><br><span class="line">&#123;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;å­—ç¬¦ä¸²ï¼š&quot;</span> &lt;&lt; str &lt;&lt; <span class="string">&quot; åŒ¹é…æˆåŠŸï¼&quot;</span> &lt;&lt; endl;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;åŒ¹é…å­—ç¬¦ä¸²ä¸ªæ•°ï¼š&quot;</span> &lt;&lt; cm.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;åˆ†åˆ«ä¸ºï¼š&quot;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> aa : cm)</span><br><span class="line">    cout &lt;&lt; aa.<span class="built_in">str</span>() &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">  cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* è¾“å‡ºç»“æœï¼š</span></span><br><span class="line"><span class="comment">    å­—ç¬¦ä¸²ï¼štwinkle1993 åŒ¹é…æˆåŠŸï¼</span></span><br><span class="line"><span class="comment">    åŒ¹é…å­—ç¬¦ä¸²ä¸ªæ•°ï¼š3</span></span><br><span class="line"><span class="comment">    åˆ†åˆ«ä¸ºï¼štwinkle1993 twinkle 1993</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œsmatchç›¸å½“äºvector&lt;string&gt;ï¼Œå…¶ä¸­å­˜å‚¨æ‰€æœ‰åŒ¹é…çš„ç»“æœã€‚è€Œcmatchåˆ™æ˜¯Cé£æ ¼çš„smatchã€‚</p>
<p>smä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ sm[0]ï¼Œæ˜¯è´ªå¿ƒçš„æœ€é•¿åŒ¹é…ï¼ˆå³è¾“å…¥å­—ç¬¦ä¸²ï¼‰ï¼Œä¹‹åçš„åˆ™æ˜¯å­—ç¬¦ä¸²ä¸­ä¾æ®æ­£åˆ™è¡¨è¾¾å¼groupçš„åˆ†ç»„ã€‚</p>
<p>smatchå¯¹è±¡é™¤äº†æœ‰size()ï¼Œèƒ½ç´¢å¼•ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„æˆå‘˜å‡½æ•°ï¼š</p>
<p><code>::prefix()</code>ï¼šç”¨äºè·å–è¾“å…¥ç›®æ ‡å­—ç¬¦ä¸²ä¸­ï¼ŒåŒ¹é…å­—ç¬¦ä¸²ä¹‹å‰çš„å­—ç¬¦ä¸²</p>
<p><code>::suffix()</code>ï¼šç”¨äºè·å–è¾“å…¥ç›®æ ‡å­—ç¬¦ä¸²ä¸­ï¼ŒåŒ¹é…å­—ç¬¦ä¸²ä¹‹åçš„å­—ç¬¦ä¸²</p>
</li>
<li><p>regex_search( )ï¼šåœ¨ä¸€ä¸ªï¼ˆä»»æ„é•¿ï¼‰æ•°æ®æµä¸­æœç´¢ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å­—ç¬¦ä¸²</p>
<p>åŒ¹é…åˆ°ä¸€ä¸ªå­å­—ç¬¦ä¸²å³è¿”å›ã€‚smä¸­ç¬¬ä¸€ä¸ªå…ƒç´ sm[0]ï¼Œæ˜¯åŒ¹é…åˆ°çš„å­å­—ç¬¦ä¸²ï¼Œä¹‹åçš„å…ƒç´ åˆ™æ˜¯å­å­—ç¬¦ä¸²ä¸­ï¼Œä¾æ®æ­£åˆ™è¡¨è¾¾å¼groupçš„åˆ†ç»„ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  string str = <span class="string">&quot;twinkle1993winkle1993inkle1993&quot;</span>;</span><br><span class="line">  smatch sm;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> it = str.<span class="built_in">cbegin</span>(); <span class="built_in">regex_search</span>(it, str.<span class="built_in">cend</span>(), sm, <span class="built_in">regex</span>(<span class="string">&quot;([a-z]+)1&quot;</span>)); it = sm.<span class="built_in">suffix</span>().first) </span><br><span class="line">  &#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;å­—ç¬¦ä¸²ï¼š&quot;</span> &lt;&lt; &amp;*it &lt;&lt; <span class="string">&quot; åŒ¹é…æˆåŠŸï¼&quot;</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;åŒ¹é…å­—ç¬¦å­ä¸²ä¸ªæ•°ï¼š&quot;</span> &lt;&lt; sm.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;åˆ†åˆ«ä¸ºï¼š&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> aa : sm)</span><br><span class="line">      cout &lt;&lt; aa.<span class="built_in">str</span>() &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;å­—ç¬¦ä¸² &quot;</span> &lt;&lt; sm.<span class="built_in">str</span>() &lt;&lt; <span class="string">&quot; å‰çš„å­—ç¬¦ä¸²ä¸ºï¼š&quot;</span> &lt;&lt; sm.<span class="built_in">prefix</span>().<span class="built_in">str</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;å­—ç¬¦ä¸² &quot;</span> &lt;&lt; sm.<span class="built_in">str</span>() &lt;&lt; <span class="string">&quot; åçš„å­—ç¬¦ä¸²ä¸ºï¼š&quot;</span> &lt;&lt; sm.<span class="built_in">suffix</span>().<span class="built_in">str</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">å­—ç¬¦ä¸²ï¼štwinkle1993winkle1993inkle1993 åŒ¹é…æˆåŠŸï¼</span></span><br><span class="line"><span class="comment">åŒ¹é…å­—ç¬¦å­ä¸²ä¸ªæ•°ï¼š2</span></span><br><span class="line"><span class="comment">åˆ†åˆ«ä¸ºï¼štwinkle1 twinkle</span></span><br><span class="line"><span class="comment">å­—ç¬¦ä¸² twinkle1 å‰çš„å­—ç¬¦ä¸²ä¸ºï¼š</span></span><br><span class="line"><span class="comment">å­—ç¬¦ä¸² twinkle1 åçš„å­—ç¬¦ä¸²ä¸ºï¼š993winkle1993inkle1993</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">å­—ç¬¦ä¸²ï¼š993winkle1993inkle1993 åŒ¹é…æˆåŠŸï¼</span></span><br><span class="line"><span class="comment">åŒ¹é…å­—ç¬¦å­ä¸²ä¸ªæ•°ï¼š2</span></span><br><span class="line"><span class="comment">åˆ†åˆ«ä¸ºï¼šwinkle1 winkle</span></span><br><span class="line"><span class="comment">å­—ç¬¦ä¸² winkle1 å‰çš„å­—ç¬¦ä¸²ä¸ºï¼š993</span></span><br><span class="line"><span class="comment">å­—ç¬¦ä¸² winkle1 åçš„å­—ç¬¦ä¸²ä¸ºï¼š993inkle1993</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">å­—ç¬¦ä¸²ï¼š993inkle1993 åŒ¹é…æˆåŠŸï¼</span></span><br><span class="line"><span class="comment">åŒ¹é…å­—ç¬¦å­ä¸²ä¸ªæ•°ï¼š2</span></span><br><span class="line"><span class="comment">åˆ†åˆ«ä¸ºï¼šinkle1 inkle</span></span><br><span class="line"><span class="comment">å­—ç¬¦ä¸² inkle1 å‰çš„å­—ç¬¦ä¸²ä¸ºï¼š993</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>å½“regex_searchè¿”å›åï¼Œå€ŸåŠ©smä¸­çš„sm[0]].firstå’Œsm[0].secondè¿­ä»£å™¨å¯ä»¥å¾—åˆ°è¿™ä¸ªå­—ç¬¦ä¸²åœ¨æºå­—ç¬¦ä¸²ä¸­å‡ºç°çš„å‡†ç¡®ä½ç½®ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  string str = <span class="string">&quot;twinkle1993winkle1993inkle1993&quot;</span>;</span><br><span class="line">  smatch sm;</span><br><span class="line"></span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;æ­£åˆ™è¡¨è¾¾å¼ï¼š([a-z]+)1&quot;</span> &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> it = str.<span class="built_in">cbegin</span>(); <span class="built_in">regex_search</span>(it, str.<span class="built_in">cend</span>(), sm, <span class="built_in">regex</span>(<span class="string">&quot;([a-z]+)1&quot;</span>)); it = sm.<span class="built_in">suffix</span>().first) </span><br><span class="line">  &#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;åŒ¹é…å­—ç¬¦å­ä¸²ï¼š&quot;</span> &lt;&lt; sm[<span class="number">0</span>].<span class="built_in">str</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;åœ¨æºä¸²å¯¹åº”ç´¢å¼•ï¼š[&quot;</span> &lt;&lt; sm[<span class="number">0</span>].first-str.<span class="built_in">begin</span>() &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; sm[<span class="number">0</span>].second-str.<span class="built_in">begin</span>() &lt;&lt; <span class="string">&#x27;)&#x27;</span> &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">åŒ¹é…å­—ç¬¦å­ä¸²ï¼štwinkle1</span></span><br><span class="line"><span class="comment">åœ¨æºä¸²å¯¹åº”ç´¢å¼•ï¼š[0 8)</span></span><br><span class="line"><span class="comment">åŒ¹é…å­—ç¬¦å­ä¸²ï¼šwinkle1</span></span><br><span class="line"><span class="comment">åœ¨æºä¸²å¯¹åº”ç´¢å¼•ï¼š[11 18)</span></span><br><span class="line"><span class="comment">åŒ¹é…å­—ç¬¦å­ä¸²ï¼šinkle1</span></span><br><span class="line"><span class="comment">åœ¨æºä¸²å¯¹åº”ç´¢å¼•ï¼š[21 27)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>regex_replace( )ï¼šåœ¨ä¸€ä¸ªï¼ˆä»»æ„é•¿ï¼‰æ•°æ®æµä¸­æœç´¢ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å­—ç¬¦ä¸²å¹¶å°†å…¶æ›¿æ¢</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">char</span> data[] = <span class="string">&quot;he...ll..o, worl..d!&quot;</span>;</span><br><span class="line"><span class="function">std::regex <span class="title">reg</span><span class="params">(<span class="string">&quot;\\.&quot;</span>)</span></span>;</span><br><span class="line"><span class="comment">// output: hello, world!</span></span><br><span class="line">std::cout &lt;&lt; std::<span class="built_in">regex_replace</span>(data, reg, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> data[] = <span class="string">&quot;001-Neo,002-Lucia&quot;</span>;</span><br><span class="line"><span class="function">std::regex <span class="title">reg</span><span class="params">(<span class="string">&quot;(\\d+)-(\\w+)&quot;</span>)</span></span>;</span><br><span class="line"><span class="comment">// output: 001 name=Neo,002 name=Lucia</span></span><br><span class="line">std::cout &lt;&lt; std::<span class="built_in">regex_replace</span>(data, reg, <span class="string">&quot;$1 name=$2&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>regex_iteratorï¼šéå†åŒ¹é…ç»“æœå’Œå­åŒ¹é…</p>
<p>ä¸Šé¢çš„regex_search()å‡½æ•°å¯ä»¥è®©æˆ‘ä»¬é€ä¸€è¿­ä»£æ­£åˆ™æŸ¥æ‰¾çš„æ‰€æœ‰åŒ¹é…ç»“æœï¼Œè€Œregex_iteratoræ˜¯è¾¾åˆ°ç›¸åŒç›®çš„çš„å¦ä¸€ç§æ–¹å¼ã€‚</p>
<p>regex_iteratorä¸åŒäºå…¶å®ƒå®¹å™¨çš„è¿­ä»£å™¨ï¼Œä¸éœ€è¦.begin()ï¼Œ.end()æ¥è¿›è¡Œè¿­ä»£ã€‚regex_iteratoråªæœ‰ä¸€ä¸ªendå€¼ï¼Œåªéœ€è¦ç”¨é»˜è®¤çš„æ„é€ å‡½æ•°å£°æ˜ä¸€ä¸ªregex_iteratorï¼Œå°±å¯ä»¥è·å¾—è¿™ä¸ªå°¾è¿­ä»£å™¨ï¼šå°¾è¿­ä»£å™¨ä¼šè¢«éšå¼åœ°åˆå§‹åŒ–ä¸ºendå€¼ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  string str = <span class="string">&quot;twinkle1993twink1993le1993&quot;</span>;</span><br><span class="line">  <span class="function">regex <span class="title">reg</span><span class="params">(<span class="string">&quot;([a-z]+)1&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (sregex_iterator <span class="built_in">it</span>(str.<span class="built_in">begin</span>(), str.<span class="built_in">end</span>(), reg), end; it != end; it++) </span><br><span class="line">  &#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;åŒ¹é…å­—ç¬¦å­ä¸²ï¼š&quot;</span> &lt;&lt; (*it)[<span class="number">0</span>].<span class="built_in">str</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;åœ¨æºä¸²å¯¹åº”ç´¢å¼•ï¼š[&quot;</span> &lt;&lt; (*it)[<span class="number">0</span>].first-str.<span class="built_in">begin</span>() &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; (*it)[<span class="number">0</span>].second-str.<span class="built_in">begin</span>() &lt;&lt; <span class="string">&#x27;)&#x27;</span> &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è¾“å‡ºç»“æœï¼š</span></span><br><span class="line"><span class="comment">    åŒ¹é…å­—ç¬¦å­ä¸²ï¼štwinkle1</span></span><br><span class="line"><span class="comment">    åœ¨æºä¸²å¯¹åº”ç´¢å¼•ï¼š[0 8)</span></span><br><span class="line"><span class="comment">    åŒ¹é…å­—ç¬¦å­ä¸²ï¼štwink1</span></span><br><span class="line"><span class="comment">    åœ¨æºä¸²å¯¹åº”ç´¢å¼•ï¼š[11 17)</span></span><br><span class="line"><span class="comment">    åŒ¹é…å­—ç¬¦å­ä¸²ï¼šle1</span></span><br><span class="line"><span class="comment">    åœ¨æºä¸²å¯¹åº”ç´¢å¼•ï¼š[20 23)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>regex_token_iteratorï¼šéå†æœªéå†éƒ¨åˆ†</p>
<p>ç›¸æ¯”äºregex_iteratorï¼Œregex_token_iteratorè¿˜å¯ç”¨äºè¿­ä»£æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„æ¯ä¸ªgroupã€‚è¿™é‡Œå°†è¿™ç§æ­£åˆ™ä¸­çš„å­åºåˆ—ç§°ä¸ºtokenã€‚regex_token_iteratoråœ¨æœ‰å‚æ•°æ„é€ æ—¶æ¯”regex_iteratorå¤šä¸€ä¸ªå‚æ•°ï¼Œæ­¤å‚æ•°ç”¨äºæŒ‡ç¤ºè¦åŒ¹é…å“ªä¸ªgroupã€‚</p>
<ul>
<li><p>å¦‚æœè¯¥å‚æ•°ä¸º-1ï¼Œè¡¨ç¤ºæ„Ÿå…´è¶£çš„æ˜¯èƒ½å¤ŸåŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„å­å­—ç¬¦ä¸²ä¹‹é—´çš„å­—ç¬¦ä¸²ã€‚</p>
</li>
<li><p>å¦‚æœè¯¥å‚æ•°ä¸º0ï¼Œè¡¨ç¤ºè¿˜æ˜¯è¦å®Œæ•´åŒ¹é…æ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼ˆè¯¥å‚æ•°é»˜è®¤å€¼ä¸º0ï¼Œå› æ­¤å¯ä»¥æ„é€ æ—¶ä¸èµ‹å€¼ï¼‰ã€‚</p>
</li>
<li><p>å¦‚æœè¯¥å‚æ•°ä¸ºå…¶å®ƒæ•°å­—ï¼Œåˆ™è¡¨ç¤ºè¦åŒ¹é…çš„æ˜¯æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ç¬¬å‡ ä¸ªç»„ï¼Œå¦‚1å°±æ˜¯åŒ¹é…ç¬¬ä¸€ä¸ªgroupã€‚</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  string str = <span class="string">&quot;11twinkle1993teink1992le1994&quot;</span>;</span><br><span class="line">  <span class="function">regex <span class="title">reg</span><span class="params">(<span class="string">&quot;([a-z]+)1&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (sregex_token_iterator <span class="built_in">it</span>(str.<span class="built_in">begin</span>(), str.<span class="built_in">end</span>(), reg), end; it != end; it++) <span class="comment">//default=0</span></span><br><span class="line">  &#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ä¸ºï¼š&quot;</span> &lt;&lt; it-&gt;<span class="built_in">str</span>() &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">  cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (sregex_token_iterator <span class="built_in">it</span>(str.<span class="built_in">begin</span>(), str.<span class="built_in">end</span>(), reg, <span class="number">1</span>), end; it != end; it++) </span><br><span class="line">  &#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ä¸ºï¼š&quot;</span> &lt;&lt; it-&gt;<span class="built_in">str</span>() &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">  cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (sregex_token_iterator <span class="built_in">it</span>(str.<span class="built_in">begin</span>(), str.<span class="built_in">end</span>(), reg, <span class="number">-1</span>), end; it != end; it++) </span><br><span class="line">  &#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ä¸ºï¼š&quot;</span> &lt;&lt; it-&gt;<span class="built_in">str</span>() &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">  cout &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è¾“å‡ºç»“æœï¼š</span></span><br><span class="line"><span class="comment">    åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ä¸ºï¼štwinkle1</span></span><br><span class="line"><span class="comment">    åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ä¸ºï¼šteink1</span></span><br><span class="line"><span class="comment">    åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ä¸ºï¼šle1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ä¸ºï¼štwinkle</span></span><br><span class="line"><span class="comment">    åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ä¸ºï¼šteink</span></span><br><span class="line"><span class="comment">    åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ä¸ºï¼šle</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ä¸ºï¼š11</span></span><br><span class="line"><span class="comment">    åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ä¸ºï¼š993</span></span><br><span class="line"><span class="comment">    åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ä¸ºï¼š992</span></span><br><span class="line"><span class="comment">    åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ä¸ºï¼š994</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="I-x2F-Oæµ"><a href="#I-x2F-Oæµ" class="headerlink" title="I&#x2F;Oæµ"></a>I&#x2F;Oæµ</h2><ul>
<li><p>ostreamå¯¹è±¡å°†æœ‰ç±»å‹çš„å¯¹è±¡è½¬æ¢ä¸ºä¸€ä¸ªå­—ç¬¦ï¼ˆå­—èŠ‚ï¼‰æµ</p>
<p>coutæ˜¯ostreamç±»çš„ä¸€ä¸ªå¯¹è±¡ï¼Œofstreamï¼Œostringstreamå‡ç»§æ‰¿è‡ªostreamç±»å‹</p>
</li>
<li><p>istreamå¯¹è±¡å°†ä¸€ä¸ªå­—ç¬¦ï¼ˆå­—èŠ‚ï¼‰æµè½¬æ¢ä¸ºæœ‰ç±»å‹çš„å¯¹è±¡</p>
<p>cinæ˜¯istreamç±»çš„ä¸€ä¸ªå¯¹è±¡ï¼Œifstreamï¼Œistringstreamå‡ç»§æ‰¿è‡ªistreamç±»å‹</p>
</li>
</ul>
<p>æ‰€ä»¥ï¼Œifstream, istringstreamå’Œcinçš„ç”¨æ³•åŒºåˆ«ä¸å¤§ï¼Œofstreamï¼Œostringstreamå’Œcoutçš„ç”¨æ³•ä¹ŸåŒºåˆ«ä¸å¤§ã€‚</p>
<blockquote>
<p>ğŸ“ŒIOå¯¹è±¡æ˜¯ä¸èƒ½è¿›è¡Œæ‹·è´å’Œèµ‹å€¼çš„ã€‚<br>ofstream out1,ou2;<br>out1 &#x3D; out2;                        &#x2F;&#x2F;é”™è¯¯ï¼šä¸èƒ½å¯¹æµå¯¹è±¡èµ‹å€¼<br>ofstream print(ofstream);    &#x2F;&#x2F;é”™è¯¯ï¼šä¸èƒ½åˆå§‹åŒ–ofstreamå‚æ•°<br>out2 &#x3D; print(out2);              &#x2F;&#x2F;é”™è¯¯ï¼šä¸èƒ½æ‹·è´æµå¯¹è±¡<br>ç”±äºä¸èƒ½æ‹·è´IOå¯¹è±¡ï¼Œå› æ­¤<strong>ä¸èƒ½æŠŠå‡½æ•°å‚æ•°å’Œè¿”å›ç±»å‹è®¾ç½®ä¸ºæµç±»å‹</strong>ï¼Œé€šå¸¸ä»¥å¼•ç”¨æ–¹å¼ä¼ é€’å’Œè¿”å›ã€‚åŒæ—¶ï¼Œè¯»å†™ä¸€ä¸ªIOå¯¹è±¡ä¼šæ”¹å˜å…¶çŠ¶æ€ï¼Œå› æ­¤<strong>ä¼ é€’å’Œè¿”å›çš„å¼•ç”¨ä¸èƒ½æ˜¯constçš„</strong>ã€‚</p>
</blockquote>
<h3 id="cin-cout"><a href="#cin-cout" class="headerlink" title="cin cout"></a>cin cout</h3><ul>
<li><p>coutæ ‡å‡†è¾“å‡ºæµ</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> i = <span class="number">7000</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;the value is &quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//coutä¹Ÿå¯ä»¥æ ¼å¼åŒ–è¾“å‡º</span></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">double</span> d = <span class="number">123.456</span>;</span><br><span class="line">cout &lt;&lt; d &lt;&lt; <span class="string">&quot;;&quot;</span>                     <span class="comment">//é»˜è®¤æ ¼å¼</span></span><br><span class="line">     &lt;&lt; scientific &lt;&lt; d &lt;&lt; <span class="string">&quot;;&quot;</span>       <span class="comment">//1.23e2ï¼Œç§‘å­¦è®¡æ•°æ³•é£æ ¼</span></span><br><span class="line">     &lt;&lt; hexfloat &lt;&lt; d &lt;&lt; <span class="string">&quot;;&quot;</span>         <span class="comment">//åå…­è¿›åˆ¶</span></span><br><span class="line">     &lt;&lt; fixed &lt;&lt; d &lt;&lt; <span class="string">&quot;;&quot;</span>            <span class="comment">//å®šç‚¹æ•°</span></span><br><span class="line">     &lt;&lt; defaultfloat &lt;&lt; d &lt;&lt; <span class="string">&quot;\n&quot;</span>;   <span class="comment">//é»˜è®¤floatæ ¼å¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æƒ³è®©æµ®ç‚¹æ•°æˆªæ–­è¾“å‡ºï¼Œå¯ä»¥ç”¨precision()ï¼Œä¼šè‡ªåŠ¨å››èˆäº”å…¥</span></span><br><span class="line">cout.<span class="built_in">precision</span>(<span class="number">8</span>);<span class="comment">//ä¸€ä¸ªæ•°æœ€å¤šæ˜¾ç¤º8ä¸ªæ•°å­—ï¼Œå¦‚æœæ•´æ•°éƒ¨åˆ†è¶…è¿‡8ä¸ªï¼Œå°±ä»…ä¿ç•™æ•´æ•°</span></span><br><span class="line">cout &lt;&lt; <span class="number">1234.56789</span> &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; <span class="number">123456</span> &lt;&lt; endl; <span class="comment">//è¾“å‡ºç»“æœï¼š1234.5679 123456</span></span><br><span class="line"></span><br><span class="line">cout.<span class="built_in">precision</span>(<span class="number">8</span>);<span class="comment">//ä¸€ä¸ªæ•°æœ€å¤šæ˜¾ç¤º8ä¸ªæ•°å­—ï¼Œå¦‚æœæ•´æ•°éƒ¨åˆ†è¶…è¿‡8ä¸ªï¼Œå°±ä»…ä¿ç•™æ•´æ•°</span></span><br><span class="line">cout &lt;&lt; <span class="number">1234.56789</span> &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; <span class="number">123456</span> &lt;&lt; endl; <span class="comment">//è¾“å‡ºç»“æœï¼š1235 123456</span></span><br></pre></td></tr></table></figure>

<p>éœ€è¦å°å¿ƒè¿™æ ·ä¸€ç§å¯èƒ½ä¸ç¬¦åˆé¢„æœŸçš„æƒ…å†µ</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">k</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="type">int</span> b = <span class="string">&#x27;b&#x27;</span>;           <span class="comment">//æ­¤å¤„charè¢«éšå¼è½¬æ¢æˆäº†intï¼Œ&#x27;b&#x27;çš„ASCIIç å€¼ä¸º98</span></span><br><span class="line">  <span class="type">char</span> c = <span class="string">&#x27;c&#x27;</span>;</span><br><span class="line">  cout &lt;&lt; <span class="string">&#x27;a&#x27;</span> &lt;&lt; b &lt;&lt; c; <span class="comment">//è¾“å‡ºç»“æœï¼ša98c</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>cinæ ‡å‡†è¾“å…¥æµ</p>
<p>cinå°†å­—ç¬¦ä¸²è¯»ä¸ºç‰¹å®šç±»å‹çš„å€¼ï¼Œå¹¶ä¼šå¿½ç•¥èµ·å§‹çš„ç©ºç™½ç¬¦ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">hello_line</span><span class="params">()</span></span>&#123;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;Please enter your name\n&quot;</span>;</span><br><span class="line">  string str;</span><br><span class="line">  cin &gt;&gt; str;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;Hello,&quot;</span> &lt;&lt; str &lt;&lt; <span class="string">&quot;!\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¾“å…¥Eric</span></span><br><span class="line"><span class="comment">//è¾“å‡ºHello, Eric!</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç©ºç™½ç¬¦ï¼ˆå¦‚ç©ºæ ¼æˆ–æ¢è¡Œï¼‰ä¼šç»ˆæ­¢è¾“å…¥ã€‚å› æ­¤è¾“å…¥Eric Bloodaxeï¼Œä»ç„¶åªä¼šå›åº”Hello, Ericï¼</p>
<p>è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ç”¨å‡½æ•°getline()æ¥è¯»å–ä¸€æ•´è¡Œï¼ˆåŒ…æ‹¬ç»“æŸçš„æ¢è¡Œç¬¦ï¼‰ï¼Œä¾‹å¦‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">hello_line</span><span class="params">()</span></span>&#123;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;Please enter your name\n&quot;</span>;</span><br><span class="line">  string str;</span><br><span class="line">  <span class="built_in">getline</span>(cin, str);</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;Hello,&quot;</span> &lt;&lt; str &lt;&lt; <span class="string">&quot;!\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¾“å…¥Eric Bloodaxe</span></span><br><span class="line"><span class="comment">//è¾“å‡ºHello, Eric Bloodaxe!</span></span><br></pre></td></tr></table></figure>

<p>è¡Œå°¾çš„æ¢è¡Œç¬¦è¢«ä¸¢æ‰äº†ï¼Œå› æ­¤æ¥ä¸‹æ¥cinä¼šä»ä¸‹ä¸€è¡Œå¼€å§‹ã€‚</p>
</li>
</ul>
<h4 id="å…³è”"><a href="#å…³è”" class="headerlink" title="å…³è”"></a>å…³è”</h4><p>ostreamå¯¹è±¡å¯ä»¥é€šè¿‡tie( )å‡½æ•°å…³è”åœ¨ä¸€ä¸ªistreamå¯¹è±¡ä¸Šã€‚å…³è”çš„ä½œç”¨åœ¨äºç¼“å†²åŒºçš„å®æ—¶åˆ·æ–°ã€‚è€ƒè™‘è¿™æ ·çš„åœºæ™¯ï¼Œé€šè¿‡ä¸€ä¸ªistreamè·å–ä¸€äº›å­—ç¬¦ï¼Œä¹‹åæƒ³å°†å…¶æ”¾å…¥ostreamå¯¹è±¡ä¸­ã€‚è€Œä¸”åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¸Œæœ›åšåˆ°æ¯é€šè¿‡istreamæ¥æ”¶ä¸€ä¸ªå­—ç¬¦ï¼Œå°±ä¼šè®©ostreamå¯¹è±¡è¾“å‡ºä¸€ä¸ªå­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯å®æ—¶åˆ·æ–°ã€‚</p>
<p>å¦‚æœä¸ç”¨å…³è”çš„è¯ï¼Œç”±äºä¸€çº§äºŒçº§ç¼“å­˜çš„å­˜åœ¨ï¼Œistreamæ¥æ”¶çš„å­—ç¬¦ä¸ä¼šå®æ—¶å‡ºç°åœ¨ostreamå¯¹è±¡ä¸­ï¼Œè€Œæ˜¯ç¨‹åºç»“æŸæ—¶ä¸€è‚¡è„‘æ”¾å…¥å…¶ä¸­ã€‚ä½†å¦‚æœç”¨tieå…³è”ï¼Œå¯ä»¥å®æ—¶åˆ·æ–°ç¼“å†²åŒºã€‚ostreamå¯¹è±¡èƒ½å¤Ÿåœ¨istreamå¯¹è±¡æœ‰åŠ¨ä½œä¹‹å‰åˆ·æ–°ç¼“å†²åŒºã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æœ‰å…³è”ç‰ˆæœ¬ä»£ç </span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  std::ofstream ofs;</span><br><span class="line">  ofs.<span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>);</span><br><span class="line">  cin.<span class="built_in">tie</span>(&amp;ofs);</span><br><span class="line">  <span class="type">char</span> c;</span><br><span class="line">  <span class="keyword">while</span>(cin &gt;&gt; c)&#123;</span><br><span class="line">    ofs &lt;&lt; c;</span><br><span class="line">  &#125;</span><br><span class="line">  ofs.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ— å…³è”ç‰ˆæœ¬ä»£ç </span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  std::ofstream ofs;</span><br><span class="line">  ofs.<span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>);</span><br><span class="line">  <span class="type">char</span> c;</span><br><span class="line">  <span class="keyword">while</span>(cin &gt;&gt; c)&#123;</span><br><span class="line">    ofs &lt;&lt; c;</span><br><span class="line">  &#125;</span><br><span class="line">  ofs.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>tie()çš„ä¸¤ä¸ªé‡è½½ï¼š<br>ostream* tie ( ) const;                &#x2F;&#x2F;è¿”å›æŒ‡å‘ç»‘å®šçš„è¾“å‡ºæµçš„æŒ‡é’ˆã€‚<br>ostream* tie ( ostream* tiestr ); &#x2F;&#x2F;å°†tiestræŒ‡å‘çš„è¾“å‡ºæµç»‘å®šåˆ°è¯¥å¯¹è±¡ä¸Šï¼Œå¹¶è¿”å›ä¸€ä¸ªç»‘å®šçš„è¾“å‡ºæµæŒ‡é’ˆã€‚</p>
</blockquote>
<p>æ— å‚å½¢æ€çš„å…³è”ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">*cin.<span class="built_in">tie</span>() &lt;&lt; <span class="string">&quot;There will be some new words&quot;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="I-x2F-OçŠ¶æ€"><a href="#I-x2F-OçŠ¶æ€" class="headerlink" title="I&#x2F;OçŠ¶æ€"></a>I&#x2F;OçŠ¶æ€</h3><p>IOæ“ä½œå¯èƒ½å‘ç”Ÿé”™è¯¯ã€‚è€Œæ¡ä»¶çŠ¶æ€å¯ä»¥å¸®åŠ©æˆ‘ä»¬è®¿é—®å½“å‰æµçš„çŠ¶æ€ï¼Œä»¥åŠå‘ç”Ÿäº†ä½•ç§é”™è¯¯ï¼Œæ˜¯å¦å¯ä¿®æ­£ã€‚</p>
<table>
<thead>
<tr>
<th><code>::iostate</code></th>
<th>iostateæ˜¯è¡¨ç¤ºå½“å‰æµçŠ¶æ€çš„ç±»å‹ï¼Œä¸‹é¢çš„badbit,failbit,eofbit,goodbitéƒ½å±äºiostate</th>
</tr>
</thead>
<tbody><tr>
<td><code>::badbit</code></td>
<td>æŒ‡å‡ºæµå·²å´©æºƒï¼Œæ˜¯å››ç§çŠ¶æ€ä¸­å”¯ä¸€ä¸å¯æ¢å¤çš„é”™è¯¯</td>
</tr>
<tr>
<td><code>::failbit</code></td>
<td>æŒ‡å‡ºIOæ“ä½œå¤±è´¥äº†ï¼Œå¦‚æœŸæœ›è¯»å–æ•°å€¼å´è¯»å‡ºä¸€ä¸ªå­—ç¬¦è¿™æ ·çš„é”™è¯¯</td>
</tr>
<tr>
<td><code>::eofbit</code></td>
<td>æŒ‡å‡ºæµåˆ°è¾¾äº†æ–‡ä»¶ç»“æŸï¼Œå¦‚æœåˆ°è¾¾æ–‡ä»¶ç»“æŸä½ç½®ï¼Œeofbitå’Œfailbitéƒ½ä¼šè¢«ç½®ä½</td>
</tr>
<tr>
<td><code>::goodbit</code></td>
<td>æŒ‡å‡ºæµæœªå¤„äºé”™è¯¯çŠ¶æ€ã€‚å€¼ä¸º0.</td>
</tr>
<tr>
<td><code>s.eof()</code></td>
<td>è‹¥æµsçš„eofbitç½®ä½ï¼Œåˆ™è¿”å›true</td>
</tr>
<tr>
<td><code>s.fail()</code></td>
<td>è‹¥æµsçš„failbitç½®ä½ï¼Œåˆ™è¿”å›true</td>
</tr>
<tr>
<td><code>s.bad()</code></td>
<td>è‹¥æµsçš„badbitç½®ä½ï¼Œåˆ™è¿”å›true</td>
</tr>
<tr>
<td><code>s.good()</code></td>
<td>è‹¥æµså¤„äºæœ‰æ•ˆçŠ¶æ€ï¼Œåˆ™è¿”å›true</td>
</tr>
<tr>
<td><code>s.clear()</code></td>
<td>å°†æµsä¸­æ‰€æœ‰æ¡ä»¶çŠ¶æ€ä½å¤ä½ï¼Œåˆ™æµçš„çŠ¶æ€è®¾ç½®ä¸ºæœ‰æ•ˆï¼Œè¿”å›void</td>
</tr>
<tr>
<td><code>s.clear(flags)</code></td>
<td>æ ¹æ®flagsæ ‡å¿—ä½ï¼Œå°†æµsä¸­å¯¹åº”æ¡ä»¶çŠ¶æ€ä½å¤ä½ã€‚flagsç±»å‹ä¸º<code>::iostate</code>ï¼Œè¿”å›void</td>
</tr>
<tr>
<td><code>s.setstate(flags)</code></td>
<td>æ ¹æ®flagsæ ‡å¿—ä½ï¼Œå°†æµsä¸­å¯¹åº”æ¡ä»¶çŠ¶æ€ä½ç½®ä½ã€‚flagsç±»å‹ä¸º<code>::iostate</code>ï¼Œè¿”å›void</td>
</tr>
<tr>
<td><code>s.rdstate()</code></td>
<td>è¿”å›æµsçš„å½“å‰æ¡ä»¶çŠ¶æ€ï¼Œè¿”å›ç±»å‹ä¸º<code>::iostate</code></td>
</tr>
<tr>
<td><code>cin.sync()</code></td>
<td>æ¸…é™¤è¾“å…¥ç¼“å†²åŒºï¼ŒæˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥æ—¶barbitç½®ä½ï¼Œå‡½æ•°è¿”å›-1</td>
</tr>
<tr>
<td><code>cin.ignore(numeric_limits&lt;std::streamsize&gt;::max(), &#39;\n&#39;)</code></td>
<td>æ¸…é™¤è¾“å…¥ç¼“å†²åŒºçš„å½“å‰è¡Œã€‚å…¶ä¸­<code>cin.ignore()</code>ä¸è¾“å…¥å‚æ•°ï¼Œä¼šæ¸…æ¥šä¸€ä¸ªå­—ç¬¦ï¼Œ<code>numeric_limits&lt;std::streamsize&gt;::max()</code>æ˜¯climitså¤´æ–‡ä»¶å®šä¹‰çš„æµè§„æ ¼æœ€å¤§å€¼ï¼Œä¹Ÿå¯ä»¥ç”¨ä¸€ä¸ªè¶³å¤Ÿå¤§çš„æ•´æ•°ä»£æ›¿å®ƒã€‚</td>
</tr>
</tbody></table>
<ul>
<li><p>åˆ¤æ–­æµæ˜¯å¦å‘ç”Ÿé”™è¯¯</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="type">int</span> a;</span><br><span class="line">  cin &gt;&gt; a;</span><br><span class="line">  <span class="keyword">if</span>(cin.<span class="built_in">rdstate</span>() == ios::goodbit)&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;è¾“å…¥æ•°æ®çš„ç±»å‹æ­£ç¡®&quot;</span> &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(cin.<span class="built_in">rdstate</span>() == ios_base::failbit)&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;è¾“å…¥æ•°æ®çš„ç±»å‹é”™è¯¯ï¼Œéè‡´å‘½é”™è¯¯ï¼Œå¯æ¸…é™¤è¾“å…¥ç¼“å†²åŒºæŒ½å›&quot;</span> &lt;&lt;endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è€Œå¦‚æœä¸åˆ¤æ–­å‡ºé”™ç±»å‹ï¼Œåªæƒ³åˆ¤æ–­è¿™ä¸ªæµæ˜¯å¦å¤„äºè‰¯å¥½çŠ¶æ€ï¼Œå¯ä»¥ç›´æ¥å°†å…¶ç”¨ä½œæ¡ä»¶ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span>(cin &gt;&gt; word)&#123;</span><br><span class="line">  <span class="comment">// ok: è¯»æ“ä½œæˆåŠŸ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç®¡ç†æ¡ä»¶çŠ¶æ€</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> old_state = cin.<span class="built_in">rdstate</span>();  <span class="comment">//è®°ä½cinçš„å½“å‰çŠ¶æ€</span></span><br><span class="line">cin.<span class="built_in">clear</span>();                     <span class="comment">//ä½¿cinæœ‰æ•ˆ</span></span><br><span class="line"><span class="built_in">process_input</span>(cin);              <span class="comment">//ä½¿ç”¨cin</span></span><br><span class="line">cin.<span class="built_in">setstate</span>(old_state);         <span class="comment">//å°†cinç½®ä¸ºåŸæœ‰çŠ¶æ€</span></span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†å¤ä½å•ä¸€çš„æ¡ä»¶çŠ¶æ€ä½ï¼Œé¦–å…ˆç”¨rdstateè¯»å‡ºå½“å‰çŠ¶æ€ï¼Œç„¶åç”¨ä½æ“ä½œå°†æ‰€éœ€ä½å¤ä½ï¼Œæ¥ç”Ÿæˆæ–°çš„çŠ¶æ€ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å°†failbitå’Œbadbitå¤ä½ï¼Œä½†ä¿æŒeofbitä¸å˜</span></span><br><span class="line">cin.<span class="built_in">clear</span>(cin.<span class="built_in">rdstate</span>() &amp; ~cin.failbit &amp; ~cin.badbit);</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="æµè¿ç®—ç¬¦é‡è½½"><a href="#æµè¿ç®—ç¬¦é‡è½½" class="headerlink" title="æµè¿ç®—ç¬¦é‡è½½"></a>æµè¿ç®—ç¬¦é‡è½½</h3><p>ç±»å‹å¯ä»¥è‡ªå®šä¹‰è¾“å…¥æµå’Œè¾“å‡ºæµæ“ä½œã€‚æ¯”å¦‚è‡ªå·±å†™äº†ä¸€ä¸ªEntryç±»</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Entry</span> &#123;</span><br><span class="line">  string name;</span><br><span class="line">  <span class="type">int</span> number;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>&lt;&lt;ä»…å¯¹åº”ostream</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">ostream&amp; <span class="keyword">operator</span>&lt;&lt;(ostream&amp; os, <span class="type">const</span> Entry&amp; e)&#123;</span><br><span class="line">  <span class="keyword">return</span> os &lt;&lt; <span class="string">&quot;&#123;\&quot;&quot;</span> &lt;&lt; e.name &lt;&lt; <span class="string">&quot;\&quot;,&quot;</span> &lt;&lt; e.number &lt;&lt; <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è¾“å‡ºè¿ç®—ç¬¦é‡è½½æ¥å—ä¸€ä¸ªè¾“å‡ºæµï¼ˆå¼•ç”¨ï¼‰ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¾“å‡ºå®Œæ¯•åï¼Œè¿”å›æ­¤æµçš„å¼•ç”¨</strong>ã€‚</p>
</li>
<li><p>&gt;&gt;ä»…å¯¹åº”istream</p>
<p>è¾“å…¥è¿ç®—ç¬¦è¦å¤æ‚çš„å¤šï¼Œå› ä¸ºå¿…é¡»æ£€æŸ¥æ ¼å¼æ˜¯å¦æ­£ç¡®ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¾“å…¥äº†&#123;&quot;name&quot;, number&#125;ï¼Œå¸Œæœ›æŠŠâ€œnameâ€èµ‹å€¼ç»™nameï¼Œnumberèµ‹å€¼ç»™number</span></span><br><span class="line">istream&amp; <span class="keyword">operator</span>&gt;&gt;(istream&amp; is, Entry&amp; e)</span><br><span class="line">  <span class="comment">//è¯»å–&#123;&quot;name&quot;,number&#125;ï¼Œæ³¨æ„ï¼Œæ­£ç¡®æ ¼å¼åŒ…å«&#123;&quot; &quot;, å’Œ&#125;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> c,c2;</span><br><span class="line">  <span class="keyword">if</span>(is&gt;&gt;c &amp;&amp; c==<span class="string">&#x27;&#125;&#x27;</span> &amp;&amp; is&gt;&gt;c2 &amp;&amp; c2==<span class="string">&#x27;&quot;&#x27;</span>)<span class="comment">//ä»¥ä¸€ä¸ª&#123;&quot;å¼€å§‹</span></span><br><span class="line">  &#123;</span><br><span class="line">    string name;</span><br><span class="line">    <span class="keyword">while</span>(is.<span class="built_in">get</span>(c) &amp;&amp; c!=<span class="string">&#x27;&quot;&#x27;</span>)            <span class="comment">//is&gt;&gt;cé»˜è®¤è·³è¿‡ç©ºç™½å­—ç¬¦ï¼Œä½†æ˜¯get()ä¸ä¼š</span></span><br><span class="line">      name+=c;</span><br><span class="line">    <span class="keyword">if</span>(is&gt;&gt;c &amp;&amp; c==<span class="string">&#x27;,&#x27;</span>)&#123;</span><br><span class="line">      <span class="type">int</span> number = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span>(is&gt;&gt;number&gt;&gt;c &amp;&amp; c==<span class="string">&#x27;&#125;&#x27;</span>)         <span class="comment">//è¯»å–æ•°å’Œä¸€ä¸ª&#125;</span></span><br><span class="line">      &#123;</span><br><span class="line">        e = &#123;name, number&#125;;               <span class="comment">//è¯»å…¥çš„å€¼èµ‹äºˆEntryå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> is;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  is.<span class="built_in">setstate</span>(ios_base::failbit);         <span class="comment">//æ ¼å¼ä¸å¯¹ï¼Œå°†æµçŠ¶æ€ç½®ä¸ºfail</span></span><br><span class="line">  <span class="keyword">return</span> is;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è¾“å…¥è¿ç®—ç¬¦é‡è½½æ¥å—ä¸€ä¸ªè¾“å…¥æµï¼ˆå¼•ç”¨ï¼‰ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¾“å…¥å®Œæ¯•åï¼Œè¿”å›æ­¤æµçš„å¼•ç”¨</strong>ã€‚</p>
</li>
</ul>
<h3 id="æ–‡ä»¶æµ"><a href="#æ–‡ä»¶æµ" class="headerlink" title="æ–‡ä»¶æµ"></a>æ–‡ä»¶æµ</h3><p>åœ¨&lt;fstream&gt;ä¸­ï¼Œæ ‡å‡†åº“æä¾›äº†è¯»å†™æ–‡ä»¶æ•°æ®çš„æµï¼š</p>
<ol>
<li><p>ifstreamç”¨äºä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</p>
</li>
<li><p>ofstreamç”¨äºå‘æ–‡ä»¶å†™å…¥æ•°æ®</p>
</li>
<li><p>fstreamç”¨äºè¯»å†™æ–‡ä»¶</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>fstream fstrm;</th>
<th>åˆ›å»ºä¸€ä¸ªæœªç»‘å®šçš„æ–‡ä»¶æµ</th>
</tr>
</thead>
<tbody><tr>
<td>fstream fstrm(s);</td>
<td>åˆ›å»ºä¸€ä¸ªfstreamï¼Œå¹¶æ‰“å¼€åä¸ºsçš„æ–‡ä»¶ã€‚æ„é€ å‡½æ•°æ˜¯explicitçš„ï¼Œså¯ä»¥æ˜¯stringç±»å‹æˆ–æŒ‡å‘Cé£æ ¼å­—ç¬¦ä¸²çš„æŒ‡é’ˆã€‚</td>
</tr>
<tr>
<td>fstream fstrm(s, mode);</td>
<td>ä¸ä¸Šé¢çš„æ„é€ å‡½æ•°ç±»ä¼¼ï¼Œä½†æŒ‰æŒ‡å®šmodeæ‰“å¼€æ–‡ä»¶</td>
</tr>
<tr>
<td>fstrm.open(s)</td>
<td>æ‰“å¼€åä¸ºsçš„æ–‡ä»¶ï¼Œå¹¶å°†æ–‡ä»¶ä¸fstrmç»‘å®šã€‚æ„é€ å‡½æ•°æ˜¯explicitçš„ï¼Œså¯ä»¥æ˜¯stringç±»å‹æˆ–æŒ‡å‘Cé£æ ¼å­—ç¬¦ä¸²çš„æŒ‡é’ˆã€‚å¦‚æœè°ƒç”¨openå¤±è´¥ï¼Œä¼šå¯¼è‡´failbitè¢«ç½®ä½</td>
</tr>
<tr>
<td>fstrm.close( )</td>
<td>å…³é—­fstrmç»‘å®šçš„æ–‡ä»¶ã€‚è¿”å›voidã€‚å…³é—­å®Œï¼Œfstrmå°±å¯ä»¥å»æ‰“å¼€å…¶å®ƒæ–‡ä»¶äº†</td>
</tr>
<tr>
<td>fstrm.is_open( )</td>
<td>è¿”å›boolç±»å‹ï¼ŒæŒ‡å‡ºä¸fstrmå…³è”çš„æ–‡ä»¶æ˜¯å¦æˆåŠŸæ‰“å¼€ï¼Œä¸”æ˜¯å¦å°šæœªå…³é—­</td>
</tr>
</tbody></table>
<ul>
<li><p>è‡ªåŠ¨æ„é€ å’Œææ„</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯¹æ¯ä¸ªä¼ é€’ç»™ç¨‹åºçš„æ–‡ä»¶æ‰§è¡Œå¾ªç¯æ“ä½œ</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span> p = argv+<span class="number">1</span>; p != argv + argc; ++p)&#123;</span><br><span class="line">  <span class="function">ifstream <span class="title">input</span><span class="params">(*p)</span></span>;       <span class="comment">//åˆ›å»ºè¾“å…¥æµå¹¶æ‰“å¼€æ–‡ä»¶</span></span><br><span class="line">  <span class="keyword">if</span>(input) &#123;</span><br><span class="line">    <span class="built_in">process</span>(input);         <span class="comment">//å¦‚æœæ–‡ä»¶æ‰“å¼€æˆåŠŸï¼Œâ€œå¤„ç†â€æ­¤æ–‡ä»¶</span></span><br><span class="line">  &#125; <span class="keyword">else</span></span><br><span class="line">    cerr &lt;&lt; <span class="string">&quot;couldn&#x27;t open: &quot;</span> + <span class="built_in">string</span>(*p);</span><br><span class="line">&#125; <span class="comment">//æ¯ä¸ªå¾ªç¯æ­¥inputéƒ½ä¼šç¦»å¼€ä½œç”¨åŸŸï¼Œå› æ­¤ä¼šè¢«é”€æ¯</span></span><br></pre></td></tr></table></figure>

<p>å› ä¸ºinputæ˜¯whileå¾ªç¯çš„å±€éƒ¨å˜é‡ï¼Œå®ƒåœ¨æ¯ä¸ªå¾ªç¯æ­¥ä¸­éƒ½è¦åˆ›å»ºå’Œé”€æ¯ä¸€æ¬¡ã€‚å½“ä¸€ä¸ªfstreamå¯¹è±¡ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œä¸ä¹‹å…³è”çš„æ–‡ä»¶ä¼šè‡ªåŠ¨å…³é—­ã€‚</p>
</li>
<li><p>æ–‡ä»¶æ¨¡å¼ï¼šæ‰“å¼€æ–‡ä»¶æ—¶æŒ‡å®šçš„mode</p>
<table>
<thead>
<tr>
<th>in</th>
<th>ä»¥è¯»æ–¹å¼æ‰“å¼€ã€‚åªå¯ä»¥å¯¹ifstreamæˆ–fstreamå¯¹è±¡è®¾å®šã€‚</th>
</tr>
</thead>
<tbody><tr>
<td>out</td>
<td>ä»¥å†™æ–¹å¼æ‰“å¼€ã€‚åªå¯ä»¥å¯¹ofstreamæˆ–fstreamå¯¹è±¡è®¾å®šã€‚</td>
</tr>
<tr>
<td>trunc</td>
<td>æˆªæ–­æ–‡ä»¶ã€‚åªæœ‰å½“outè¢«è®¾å®šæ—¶ï¼Œæ‰èƒ½è®¾å®štruncã€‚æ­¤æ¨¡å¼æ‰“å¼€æ–‡ä»¶ï¼Œæ–‡ä»¶çš„åŸå†…å®¹ä¼šè¢«ä¸¢å¼ƒ</td>
</tr>
<tr>
<td>app</td>
<td>æ¯æ¬¡å†™æ“ä½œå‰å‡å®šä½åˆ°æ–‡ä»¶æœ«å°¾ã€‚ä¸truncç›¸æ‚–</td>
</tr>
<tr>
<td>ate</td>
<td>æ‰“å¼€æ–‡ä»¶åç«‹å³å®šä½åˆ°æ–‡ä»¶æœ«å°¾ã€‚å¯ç”¨äºä»»ä½•æ–‡ä»¶æµå¯¹è±¡ã€‚</td>
</tr>
<tr>
<td>binary</td>
<td>ä»¥äºŒè¿›åˆ¶æ–¹å¼è¿›è¡ŒIOã€‚å¯ç”¨äºä»»ä½•æ–‡ä»¶æµå¯¹è±¡ã€‚</td>
</tr>
</tbody></table>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç”¨outæ¨¡å¼æ‰“å¼€ä¼šè‡ªåŠ¨truncï¼ˆå³ä½¿æ²¡æœ‰æ˜¾å¼å†™ï¼‰ï¼Œæ‰€ä»¥ä¼šä¸¢å¼ƒæ–‡ä»¶çš„åŸå§‹å†…å®¹ã€‚é˜»æ­¢ä¸€ä¸ªofstreamæ¸…ç©ºæ–‡ä»¶å†…å®¹çš„æ–¹æ³•æ˜¯outæ¨¡å¼ä¸‹æŒ‡å®šappæ¨¡å¼ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åœ¨è¿™å‡ æ¡è¯­å¥ä¸­ï¼Œfile1éƒ½è¢«æˆªæ–­</span></span><br><span class="line"><span class="function">ofstream <span class="title">out</span> <span class="params">(<span class="string">&quot;file1&quot;</span>)</span></span>; <span class="comment">//éšå«ä»¥è¾“å‡ºæ¨¡å¼æ‰“å¼€æ–‡ä»¶å¹¶æˆªæ–­æ–‡ä»¶</span></span><br><span class="line"><span class="function">ofstream <span class="title">out2</span> <span class="params">(<span class="string">&quot;file1&quot;</span>, ofstream::out)</span></span>; <span class="comment">//éšå«åœ°æˆªæ–­æ–‡ä»¶</span></span><br><span class="line"><span class="function">ofstream <span class="title">out3</span> <span class="params">(<span class="string">&quot;file1&quot;</span>, ofstream::out | ofstream::trunc)</span></span>;</span><br><span class="line"><span class="comment">//ä¸ºäº†ä¿ç•™æ–‡ä»¶å†…å®¹ï¼Œå¿…é¡»æ˜¾å¼æŒ‡å®šappæ¨¡å¼</span></span><br><span class="line"><span class="function">ofstream <span class="title">app</span><span class="params">(<span class="string">&quot;file2&quot;</span>, ofstream::app)</span></span>; <span class="comment">//éšå«ä¸ºè¾“å‡ºæ¨¡å¼</span></span><br><span class="line"><span class="function">ofstream <span class="title">app2</span><span class="params">(<span class="string">&quot;file2&quot;</span>, ofstream::out | ofstream::app)</span></span>;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="å­—ç¬¦ä¸²æµ"><a href="#å­—ç¬¦ä¸²æµ" class="headerlink" title="å­—ç¬¦ä¸²æµ"></a>å­—ç¬¦ä¸²æµ</h3><p>åœ¨sstreamä¸­ï¼Œæ ‡å‡†åº“æä¾›äº†ä»stringè¯»å–æ•°æ®ä»¥åŠå‘stringå†™å…¥æ•°æ®çš„æµï¼š</p>
<ul>
<li><p>istringstreamç”¨äºä»stringä¸­è¯»å–æ•°æ®</p>
</li>
<li><p>ostringstreamç”¨äºå‘stringå†™å…¥æ•°æ®</p>
</li>
<li><p>stringstreamç”¨äºè¯»å†™string</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>sstream strm;</th>
<th>strmæ˜¯ä¸€ä¸ªæœªç»‘å®šçš„stringstreamå¯¹è±¡</th>
</tr>
</thead>
<tbody><tr>
<td>sstream strm(s);</td>
<td>strmæ˜¯ä¸€ä¸ªstringstreamå¯¹è±¡ï¼Œä¿å­˜string sçš„ä¸€ä¸ªæ‹·è´ï¼Œæ­¤æ„é€ å‡½æ•°æ˜¯explicitçš„</td>
</tr>
<tr>
<td>strm.str();</td>
<td>è¿”å›strmæ‰€ä¿å­˜çš„stringçš„æ‹·è´</td>
</tr>
<tr>
<td>strm.str(s);</td>
<td>å°†string sæ‹·è´åˆ°strmä¸­ã€‚è¿”å›void</td>
</tr>
</tbody></table>
<h4 id="istringstream"><a href="#istringstream" class="headerlink" title="istringstream"></a>istringstream</h4><p>è€ƒè™‘æœ‰è¿™æ ·ä¸€ä¸ªæ–‡ä»¶ï¼Œå†…å®¹è®°å½•ç€ä¸€äº›äººå’Œä»–ä»¬çš„è‹¥å¹²ç”µè¯å·ç </p>
<blockquote>
<p>morgan 2015552368 8625550123<br>drew 9735550130<br>lee 6095550132 2015550175 8005550000</p>
</blockquote>
<p>ç°åœ¨å¸Œæœ›æå–è¿™ä¸ªæ–‡ä»¶ï¼Œæå–å‡ºæ¯ä¸ªäººçš„äººåå’Œç›¸åº”çš„ç”µè¯å·ç ã€‚å¯ä»¥å…ˆæ¯æ¬¡ç¬¬ä¸€è¡Œçš„å­—ç¬¦ä¸²ï¼Œä¹‹åå°†å­—ç¬¦ä¸²äº¤ç”±istringstreamï¼Œé€šè¿‡istringstreamé€å…ƒç´ æå–ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PersonInfo</span> &#123;</span><br><span class="line">  string name;</span><br><span class="line">  vector&lt;string&gt; phones;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">string line, word;</span><br><span class="line">vector&lt;PersonInfo&gt; people;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">getline</span>(cin, line))&#123;</span><br><span class="line">  PersonInfo info;</span><br><span class="line">  <span class="function">istringstream <span class="title">record</span><span class="params">(line)</span></span>;</span><br><span class="line">  record &gt;&gt; info.name;</span><br><span class="line">  <span class="keyword">while</span>(record &gt;&gt; word)</span><br><span class="line">    info.phones.<span class="built_in">push_back</span>(word);</span><br><span class="line">  people.<span class="built_in">push_back</span>(info);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ostringstream"><a href="#ostringstream" class="headerlink" title="ostringstream"></a>ostringstream</h4><p>ostringstreamå¯åº”ç”¨äºæƒ³é€æ­¥æ„é€ è¾“å‡ºï¼Œæœ€åä¸€èµ·æ‰“å°çš„åœºæ™¯ã€‚æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œæƒ³è¦éªŒè¯ç”µè¯å·ç å¹¶æ”¹å˜å…¶æ ¼å¼ï¼Œå¹¶è¾“å‡ºåˆ°ä¸€ä¸ªæ–°æ–‡ä»¶ã€‚å…¶ä¸­ï¼Œæ–°æ–‡ä»¶åªåŒ…å«æœ‰æ•ˆç”µè¯ï¼Œæ— æ•ˆçš„ç”µè¯ä¼šè¢«æ‰“å°åˆ°é”™è¯¯ä¿¡æ¯ä¸­ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å‡è®¾äº‹å…ˆå·²ç»æœ‰äº†validå’Œformatå‡½æ•°ï¼ŒvalidéªŒè¯ç”µè¯å·ç ï¼Œformatæ”¹å˜å…¶æ ¼å¼</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">const</span> <span class="keyword">auto</span> &amp;entry : people) &#123;</span><br><span class="line">  ostringstream formatted, badNums;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">const</span> <span class="keyword">auto</span> &amp;nums : entry.phones)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">valid</span>(nums))&#123;</span><br><span class="line">      badNums &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; nums;</span><br><span class="line">    &#125; <span class="keyword">else</span>  </span><br><span class="line">      formatted &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; format(nums);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (badNums.<span class="built_in">str</span>().<span class="built_in">empty</span>())</span><br><span class="line">    os &lt;&lt; entry.name &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; formatted.<span class="built_in">str</span>() &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    cerr &lt;&lt; <span class="string">&quot;input error: &quot;</span> &lt;&lt; entry.name &lt;&lt; <span class="string">&quot; invalid number(s) &quot;</span> &lt;&lt; badNums.<span class="built_in">str</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å®ç”¨å·¥å…·"><a href="#å®ç”¨å·¥å…·" class="headerlink" title="å®ç”¨å·¥å…·"></a>å®ç”¨å·¥å…·</h2><h3 id="12-å¸¸ç”¨å†…ç½®ç®—æ³•"><a href="#12-å¸¸ç”¨å†…ç½®ç®—æ³•" class="headerlink" title="12 å¸¸ç”¨å†…ç½®ç®—æ³•"></a>12 å¸¸ç”¨å†…ç½®ç®—æ³•</h3><h3 id="12-ç‰¹æ®Šå®¹å™¨"><a href="#12-ç‰¹æ®Šå®¹å™¨" class="headerlink" title="12 ç‰¹æ®Šå®¹å™¨"></a>12 ç‰¹æ®Šå®¹å™¨</h3><p>C++æ ‡å‡†åº“ä¸­æä¾›äº†è‹¥å¹²ç§å®¹å™¨ï¼Œå®ƒä»¬ä¸STLæ¡†æ¶å¹¶éå®Œå…¨å¥‘åˆï¼Œæ¯”å¦‚</p>
<table>
<thead>
<tr>
<th>array&lt;T,N&gt;</th>
<th>æ˜¯ä¸€æ®µå›ºå®šå°ºå¯¸ä¸”è¿ç»­åˆ†é…çš„åºåˆ—ï¼ŒåŒ…å«Nä¸ªTç±»å‹çš„å…ƒç´ ï¼›éšå¼åœ°è½¬æ¢æˆT*</th>
</tr>
</thead>
<tbody><tr>
<td>pair&lt;T,U&gt;</td>
<td>ä¸¤ä¸ªå…ƒç´ ï¼Œç±»å‹åˆ†åˆ«æ˜¯Tå’ŒU</td>
</tr>
<tr>
<td>tuple&lt;Tâ€¦&gt;</td>
<td>æ˜¯ä¸€æ®µåºåˆ—ï¼Œå­˜æ”¾ç€ä»»æ„ç±»å‹åœ°ä»»æ„ä¸ªå…ƒç´ </td>
</tr>
<tr>
<td>basic_string&lt;C&gt;</td>
<td>æ˜¯ä¸€æ®µå­—ç¬¦çš„åºåˆ—ï¼Œå­—ç¬¦çš„ç±»å‹æ˜¯Cï¼›æä¾›å­—ç¬¦ä¸²æ“ä½œ</td>
</tr>
<tr>
<td>valarray&lt;T&gt;</td>
<td>æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«Tç±»å‹çš„æ•°å€¼ï¼›æä¾›æ•°å€¼æ“ä½œ</td>
</tr>
</tbody></table>
<h4 id="array"><a href="#array" class="headerlink" title="array"></a>array</h4><p>arrayå¯ä»¥ç†è§£ä¸ºä¸€ä¸ª<strong>å¢å¼ºç‰ˆçš„å†…ç½®æ•°ç»„</strong>ï¼Œå…ƒç´ æ•°é‡åœ¨ç¼–è¯‘æœŸæŒ‡å®šï¼Œä½äºæ ˆä¸­æˆ–è€…å¯¹è±¡å†…ï¼Œä¹Ÿå¯ä»¥ä½äºé™æ€å­˜å‚¨ç©ºé—´ä¸­ã€‚å› æ­¤ï¼Œä½¿ç”¨arrayçš„æ—¶ç©ºä»£ä»·å¹¶ä¸æ¯”ä½¿ç”¨å†…ç½®æ•°ç»„å¤§ã€‚</p>
<p>å¢å¼ºçš„ä½“ç°åœ¨äºï¼š1. ä¸ä¼šéšå¼åœ°è½¬æ¢æˆæŒ‡é’ˆï¼ˆå› ä¸ºå¾ˆå¤šæ—¶å€™å¼€å‘è€…å¹¶ä¸å¸Œæœ›è‡ªåŠ¨è½¬æ¢ï¼‰ï¼›2. æä¾›äº†ä¸€äº›ä¾¿äºæ“ä½œçš„å‡½æ•°ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">array&lt;<span class="type">int</span>,3&gt; a1 = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;; <span class="comment">//åˆå§‹å€¼çš„æ•°é‡ä¸èƒ½å¤šäºarrayæŒ‡å®šçš„å…ƒç´ æ•°é‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼–è¯‘å™¨ä¸å…è®¸çœç•¥arrayçš„å…ƒç´ æ•°é‡</span></span><br><span class="line">array&lt;<span class="type">int</span>&gt; ax = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;   <span class="comment">//é”™è¯¯ï¼æ²¡æœ‰æŒ‡å®šå…ƒç´ çš„æ•°é‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å…ƒç´ çš„æ•°é‡å¿…é¡»æ˜¯ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">(<span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">  array&lt;string, n&gt; aa = &#123;<span class="string">&quot;John&#x27;s&quot;</span>, <span class="string">&quot;Queens&#x27;&quot;</span>&#125;;<span class="comment">//é”™è¯¯ï¼arrayçš„å…ƒç´ æ•°é‡å¿…é¡»æ˜¯å¸¸é‡è¡¨è¾¾å¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>é¿å…éšå¼è½¬æ¢</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">h</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Circle a1[<span class="number">10</span>];</span><br><span class="line">  array&lt;Circle, 10&gt; a2;</span><br><span class="line"></span><br><span class="line">  Shape* p1 = a1; <span class="comment">// è¯­æ³•ä¸Šæ­£ç¡®ï¼Œä½†æ˜¯å­˜åœ¨ä¸¥é‡çš„éšæ‚£</span></span><br><span class="line">  Shape* p2 = a2; <span class="comment">// æŠ¥å‘Šè¯­æ³•é”™è¯¯ï¼›ç¦æ­¢&lt;Circle,10&gt;è‡ªåŠ¨è½¬æ¢æˆShape*ç±»å‹ï¼Œä»è€Œé¿å…äº†é£é™©</span></span><br><span class="line">  p1[<span class="number">3</span>].draw;     <span class="comment">// ç¨‹åºææ˜“å‘ç”Ÿé”™è¯¯ï¼Œå¦‚æœsizeof(Shape)&lt;sizeof(Circle)ï¼Œ</span></span><br><span class="line">                  <span class="comment">// åˆ™é€šè¿‡Shape*æŒ‡é’ˆè°ƒç”¨Circle[]çš„ä¸‹æ ‡è¿ç®—ä¼šå¯¼è‡´è®¿é—®å†…å­˜æ—¶äº§ç”Ÿé”™è¯¯çš„åç§»é‡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¼ é€’ç»™éœ€è¦æŒ‡é’ˆçš„Cé£æ ¼å‡½æ•°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">(<span class="type">int</span>* p, <span class="type">int</span> sz)</span></span>;                    <span class="comment">// Cé£æ ¼çš„æ¥å£</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">g</span><span class="params">()</span></span>&#123;</span><br><span class="line">  array&lt;<span class="type">int</span>,10&gt; a;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">f</span>(a, a.<span class="built_in">size</span>());                          <span class="comment">// é”™è¯¯ï¼šæ­¤å¤„ä¸å­˜åœ¨æœŸæœ›çš„éšå¼ç±»å‹è½¬æ¢</span></span><br><span class="line">  <span class="built_in">f</span>(&amp;a[<span class="number">0</span>], a.<span class="built_in">size</span>());                      <span class="comment">// Cé£æ ¼çš„å†™æ³•</span></span><br><span class="line">  <span class="built_in">f</span>(a.<span class="built_in">data</span>(), a.<span class="built_in">size</span>());                   <span class="comment">// Cé£æ ¼çš„å†™æ³•</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">auto</span> p = <span class="built_in">find</span>(a.<span class="built_in">begin</span>(), a.<span class="built_in">end</span>(), <span class="number">777</span>);  <span class="comment">// C++ STLé£æ ¼å¾·å†™æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="bitset"><a href="#bitset" class="headerlink" title="bitset"></a>bitset</h4><p>äºŒè¿›åˆ¶ä½çš„æ•°ç»„ï¼Œæé«˜å­˜å‚¨æ•ˆç‡ã€‚</p>
<ul>
<li><p>å¯ä»¥ç”¨æ•´æ•°æˆ–è€…å­—ç¬¦ä¸²æ¥åˆå§‹åŒ–bitset</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">bitset&lt;9&gt; bs1 &#123;<span class="string">&quot;110001111&quot;</span>&#125;;</span><br><span class="line">bitset&lt;9&gt; bs2 &#123;<span class="number">399</span>&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å„ç§ä½è¿ç®—å¯ä»¥ç”¨åœ¨bitsetä¸Š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">bitset&lt;9&gt; bs3 = ~bs1;       <span class="comment">//æ±‚åï¼šbs3 == &quot;001110000&quot;</span></span><br><span class="line">bitset&lt;9&gt; bs4 = bs1 &amp; bs3;  <span class="comment">//æ‰€æœ‰ä½éƒ½ä¸º0</span></span><br><span class="line">bitset&lt;9&gt; bs5 = bs3 &lt;&lt; <span class="number">2</span>;   <span class="comment">//å·¦ç§»ï¼šbs5 == &quot;111000000&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>åå…¶é“è€Œè¡Œï¼Œå¯ç”¨æˆå‘˜å‡½æ•°<code>to_ullong()</code>æˆ–<code>to_string()</code>å°†bitsetè½¬ä¸ºæ•´æ•°æˆ–è€…å­—ç¬¦ä¸²</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">binary</span><span class="params">(<span class="type">int</span> i)</span></span>&#123;</span><br><span class="line">  bitset&lt;8*<span class="keyword">sizeof</span>(<span class="type">int</span>)&gt; b = i; <span class="comment">//ä¸€ä¸ªå­—èŠ‚8ä½ï¼Œintå sizeof(int)ä¸ªå­—èŠ‚</span></span><br><span class="line">  cout &lt;&lt; b.<span class="built_in">to_string</span>() &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æˆ–è€…ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨bitsetçš„æµè¿ç®—ç¬¦é‡è½½ï¼š</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">binary2</span><span class="params">(<span class="type">int</span> i)</span></span>&#123;</span><br><span class="line">  bitset&lt;8*<span class="keyword">sizeof</span>(<span class="type">int</span>)&gt; b = i;</span><br><span class="line">  cout &lt;&lt; b &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="tuple"><a href="#tuple" class="headerlink" title="tuple"></a>tuple</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">tuple&lt;string,<span class="type">int</span>,<span class="type">double</span>&gt; t2 &#123;<span class="string">&quot;Sild&quot;</span>, <span class="number">123</span>, <span class="number">3.14</span>&#125;;  <span class="comment">// æ˜¾å¼åœ°æŒ‡å®šäº†ç±»å‹</span></span><br><span class="line"><span class="keyword">auto</span> t = <span class="built_in">make_tuple</span>(string&#123;<span class="string">&quot;Herring&quot;</span>&#125;, <span class="number">10</span>, <span class="number">1.23</span>); <span class="comment">// éšå¼åœ°æ¨æ–­å‡ºç±»å‹æ˜¯ tuple&lt;string, int, double&gt;</span></span><br><span class="line"></span><br><span class="line">string s = <span class="built_in">get</span>&lt;<span class="number">0</span>&gt;(t); <span class="comment">// è·å–tupleçš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼š&quot;Herring&quot;</span></span><br><span class="line"><span class="type">int</span> x = <span class="built_in">get</span>&lt;<span class="number">1</span>&gt;(t);    <span class="comment">// è·å–tupleçš„ç¬¬äºŒä¸ªå…ƒç´ ï¼š10</span></span><br><span class="line"><span class="type">double</span> d = <span class="built_in">get</span>&lt;<span class="number">2</span>&gt;(t); <span class="comment">// è·å–tupleçš„ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼š1.23</span></span><br></pre></td></tr></table></figure>

<p>tupleçš„æ¯ä¸€ä¸ªå…ƒç´ å¯¹åº”ä¸€ä¸ªç¼–å·ï¼Œä»0å¼€å§‹ä¾æ¬¡æ’åˆ—ã€‚è¦æƒ³**åœ¨ç¼–è¯‘æ—¶ä»tupleä¸­é€‰å–å…ƒç´ ï¼Œåªèƒ½ä½¿ç”¨get&lt;1&gt;(t)çš„æ–¹å¼ï¼Œè€Œä¸èƒ½å†™æˆget(t,1)æˆ–t[1]**ã€‚</p>
<h3 id="13-æ—¶é—´"><a href="#13-æ—¶é—´" class="headerlink" title="13 æ—¶é—´"></a>13 æ—¶é—´</h3><p>æ ‡å‡†åº“æä¾›äº†chronoï¼Œè´Ÿè´£å¤„ç†æ—¶é—´ï¼Œå¯ä»¥å®Œæˆä¸€äº›ä¸æ—¶é—´æœ‰å…³çš„ä»»åŠ¡ï¼Œæ¯”å¦‚å¯ä»¥ç”¨ä¸‹é¢çš„ç¨‹åºå®Œæˆæœ€åŸºæœ¬çš„è®¡æ—¶ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::chrono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> t0 = high_resolution_clock::<span class="built_in">now</span>();</span><br><span class="line"><span class="built_in">do_work</span>();</span><br><span class="line"><span class="keyword">auto</span> t1 = high_resolution_clock::<span class="built_in">now</span>();</span><br><span class="line">cout &lt;&lt; <span class="built_in">duration_cast</span>&lt;milliseconds&gt;(t1-t0).<span class="built_in">count</span>() &lt;&lt; <span class="string">&quot;msec\n&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>duration_castå°†C++çš„time_pointç±»å‹è½¬æ¢ä¸ºå…¬è®¤çš„å•ä½ã€‚</p>
<h3 id="14-å‡½æ•°é€‚é…å™¨"><a href="#14-å‡½æ•°é€‚é…å™¨" class="headerlink" title="14 å‡½æ•°é€‚é…å™¨"></a>14 å‡½æ•°é€‚é…å™¨</h3><blockquote>
<p>å‡½æ•°é€‚é…å™¨æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå®ƒçš„å‚æ•°ï¼Œè¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå‡½æ•°å¯¹è±¡è°ƒç”¨åŸæ¥çš„å‡½æ•°</p>
</blockquote>
<ul>
<li><p>bind( )ï¼š</p>
<p>é¡¾åæ€ä¹‰ï¼Œæ­¤å‡½æ•°è¦å°†ä¸€äº›å‚æ•°ï¼Œç»‘å®šåœ¨å‡½æ•°ä¸Šï¼Œä»¥æ„é€ ä¸€ä¸ªå‡½æ•°å¯¹è±¡ã€‚å¯ä»¥é€šè¿‡bindå®ç°åå‡½æ•°ï¼Œå¦‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">cube</span><span class="params">(<span class="type">double</span>)</span></span>;          <span class="comment">//cubeæ˜¯ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line"><span class="keyword">auto</span> cube2 = <span class="built_in">bind</span>(cube, <span class="number">2</span>);   <span class="comment">//é€šè¿‡bindåˆ›å»ºå‡½æ•°å¯¹è±¡cube2</span></span><br><span class="line"><span class="comment">//å› æ­¤ï¼Œè°ƒç”¨cube2()æ—¶ï¼Œç›¸å½“äºè°ƒç”¨äº†cube(2)</span></span><br></pre></td></tr></table></figure>

<p>è€Œä¸”ï¼Œä¸å¿…æ¯æ¬¡éƒ½ç»‘å®šå‡½æ•°çš„å…¨éƒ¨å‚æ•°ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> placeholds;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">(<span class="type">int</span>, <span class="type">const</span> string&amp;)</span></span>;</span><br><span class="line"><span class="keyword">auto</span> g = <span class="built_in">bind</span>(f, <span class="number">2</span>, _1);    <span class="comment">//æŠŠfçš„ç¬¬ä¸€ä¸ªå‚æ•°ç»‘å®šä¸º2</span></span><br><span class="line"><span class="built_in">f</span>(<span class="number">2</span>, <span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="built_in">g</span>(<span class="string">&quot;hello&quot;</span>);                 <span class="comment">//ç­‰åŒäºè°ƒç”¨f(2, &quot;hello&quot;);</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œ<code>_1</code>è¡¨ç¤ºä¸€ä¸ªå ä½ç¬¦ï¼Œå…¶åœ¨<code>std::placeholds</code>å‘½åç©ºé—´ä¸­ã€‚å ä½ç¬¦æŒ‡å®šäº†è°ƒç”¨å‡½æ•°å¯¹è±¡æ—¶çš„å‚æ•°ï¼Œå¯¹åº”äº†åŸå‡½æ•°çš„å“ªå‡ ä¸ªä½ç½®çš„å‚æ•°ã€‚</p>
<ul>
<li><p>ä¸ºé‡è½½å‡½æ•°ç»‘å®šå‚æ•°ï¼Œ<strong>å¿…é¡»æ˜¾å¼</strong>åœ°æŒ‡å®šè¢«ç»‘å®šçš„æ˜¯é‡è½½å‡½æ•°çš„å“ªä¸ªç‰ˆæœ¬ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">pow</span><span class="params">(<span class="type">int</span>, <span class="type">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">pow</span><span class="params">(<span class="type">double</span>, <span class="type">double</span>)</span></span>;    <span class="comment">//é‡è½½äº†å‡½æ•°pow</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> pow2 = <span class="built_in">bind</span>(pow, _1, <span class="number">2</span>);  <span class="comment">//é”™è¯¯ï¼šç»‘å®šçš„æ˜¯å“ªä¸ªpow()?</span></span><br><span class="line"><span class="keyword">auto</span> pow2 = <span class="built_in">bind</span>((<span class="built_in">double</span>(*)(<span class="type">double</span>,<span class="type">double</span>))pow, _1, <span class="number">2</span>);<span class="comment">//æ­£ç¡®ï¼Œç¡®åˆ‡åœ°æŒ‡å®šäº†é€‰ç”¨ç¬¬äºŒä¸ªpow</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>mem_fn( )ï¼š</p>
<p>å°†åå­—æ‹‰é•¿ï¼Œå°±æ˜¯member functionã€‚è¿™ä¸ªå‡½æ•°çš„ç›®çš„åœ¨äºï¼Œå°†ç±»ä¸­çš„æˆå‘˜å‡½æ•°æå–å‡ºæ¥ï¼Œæ„é€ å‡ºä¸€ä¸ªå‡½æ•°å¯¹è±¡ã€‚é€šè¿‡è°ƒç”¨æ™®é€šå‡½æ•°çš„æ–¹å¼ï¼Œè°ƒç”¨æ­¤å‡½æ•°å¯¹è±¡ï¼Œå¯ä»¥è¾¾åˆ°è°ƒç”¨ç±»æˆå‘˜å‡½æ•°çš„æ•ˆæœã€‚æ¢è¨€ä¹‹ï¼Œ<code>mem_fn()</code>å¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ç§ä»é¢å‘å¯¹è±¡çš„è°ƒç”¨åˆ°é¢å‘å‡½æ•°çš„è°ƒç”¨çš„æ˜ å°„ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">user</span><span class="params">(Shape* p)</span></span>&#123;</span><br><span class="line">  p-&gt;<span class="built_in">draw</span>();</span><br><span class="line">  <span class="keyword">auto</span> draw = <span class="built_in">mem_fn</span>(&amp;Shape::draw);</span><br><span class="line">  <span class="built_in">draw</span>(p); <span class="comment">//ç­‰ä»·äºp-&gt;draw()</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŸäº›ç®—æ³•éœ€è¦å®ƒçš„æ“ä½œä»¥éæˆå‘˜å‡½æ•°çš„æ–¹å¼è°ƒç”¨ï¼Œmem_fn()é€šå¸¸ç”¨åœ¨è¿™äº›ç®—æ³•ä¸­ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">draw_all</span><span class="params">(vector&lt;Shape*&gt;&amp; v)</span></span>&#123;</span><br><span class="line">  for_each(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="built_in">mem_fn</span>(&amp;Shape::draw));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶è€Œï¼Œlambdaè¡¨è¾¾å¼å‡ºç°åï¼Œå¯ä»¥æ›¿ä»£è¿™æ ·çš„ç»‘å®šæ–¹å¼ï¼ˆå› ä¸ºåŒ¿åå‡½æ•°æœ¬è´¨æ˜¯å‡½æ•°å¯¹è±¡ï¼‰ï¼Œè€Œä¸”æ›´ä¸ºç®€å•ç›´è§‚ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">draw_all</span><span class="params">(vector&lt;Shape*&gt;&amp; v)</span></span>&#123;</span><br><span class="line">  for_each(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), [](Shape* p)&#123;p-&gt;<span class="built_in">draw</span>();&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>functionï¼š</p>
<p>å‰é¢çš„ä»£ç ä¸­ï¼Œå‡½æ•°å¯¹è±¡éƒ½è¢«ç”¨autoå…³é”®å­—å£°æ˜ï¼Œä¹Ÿå°±æ˜¯è®©ç¼–è¯‘å™¨è‡ªå·±å»æ¨æ–­å‡½æ•°å¯¹è±¡çš„ç±»å‹ã€‚å®é™…ä¸Šï¼Œæ ‡å‡†åº“ä¸­æ˜¯æœ‰åŠæ³•æ‰‹åŠ¨åˆ¶å®šå‡½æ•°å¯¹è±¡çš„å‡†ç¡®ç±»å‹çš„ï¼Œé‚£å°±æ˜¯ä½¿ç”¨<code>function</code>ã€‚è¦é€šè¿‡æŒ‡å®šè¿”å›ç±»å‹å’Œå‚æ•°ç±»å‹ï¼Œæ¥ç¡®å®šä¸€ä¸ªfunctionï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">f1</span><span class="params">(<span class="type">double</span>)</span></span>;</span><br><span class="line">function&lt;<span class="type">int</span>(<span class="type">double</span>)&gt; fct &#123;f1&#125;;<span class="comment">//åˆå§‹åŒ–ä¸ºf1</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">f2</span><span class="params">(<span class="type">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">user</span><span class="params">()</span></span>&#123;</span><br><span class="line">  fct = [](<span class="type">double</span> d)&#123;<span class="keyword">return</span> <span class="built_in">round</span>(d);&#125;;</span><br><span class="line">  fct = f1;</span><br><span class="line">  fct = f2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="å¯¹è±¡æ¨¡å‹"><a href="#å¯¹è±¡æ¨¡å‹" class="headerlink" title="å¯¹è±¡æ¨¡å‹"></a>å¯¹è±¡æ¨¡å‹</h1><h1 id="å¹¶å‘ç¼–ç¨‹"><a href="#å¹¶å‘ç¼–ç¨‹" class="headerlink" title="å¹¶å‘ç¼–ç¨‹"></a>å¹¶å‘ç¼–ç¨‹</h1><h2 id="std-thread"><a href="#std-thread" class="headerlink" title="std::thread"></a>std::thread</h2><p>çº¿ç¨‹åœ¨<code>std::thread</code>å¯¹è±¡åˆ›å»ºæ—¶å¯åŠ¨ï¼Œå¯¹è±¡é‡Œé¢çš„å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œçº¿ç¨‹ä¹Ÿéšä¹‹ç»“æŸã€‚ä½¿ç”¨C++çº¿ç¨‹åº“å¯åŠ¨çº¿ç¨‹ï¼Œå°±æ˜¯æ„é€ <code>std::thread</code>å¯¹è±¡ã€‚åˆ›å»ºthreadå¯¹è±¡æ—¶éœ€è¦ä¼ å…¥æœ‰å‡½æ•°æ“ä½œç¬¦ï¼ˆä¹Ÿå°±æ˜¯æ‹¬å·è¿ç®—ç¬¦ï¼‰çš„ç±»å‹å®ä¾‹ï¼ˆå³å‡½æ•°å¯¹è±¡ï¼‰ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">background_task</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">operator</span><span class="params">()</span> <span class="params">()</span> <span class="type">const</span></span>&#123;</span><br><span class="line">    <span class="built_in">do_something</span>();</span><br><span class="line">    <span class="built_in">do_something_else</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">background_task f;</span><br><span class="line"><span class="function">std::thread <span class="title">my_thread</span><span class="params">(f)</span></span>;</span><br></pre></td></tr></table></figure>

<p>å‡½æ•°å¯¹è±¡ä¼šè¢«å¤åˆ¶åˆ°æ–°çº¿ç¨‹çš„å­˜å‚¨ç©ºé—´ä¸­ï¼Œå‡½æ•°å¯¹è±¡çš„æ‰§è¡Œå’Œè°ƒç”¨éƒ½åœ¨çº¿ç¨‹çš„å†…å­˜ç©ºé—´ä¸­è¿›è¡Œ</p>
<h2 id="å…±äº«æ•°æ®"><a href="#å…±äº«æ•°æ®" class="headerlink" title="å…±äº«æ•°æ®"></a>å…±äº«æ•°æ®</h2><h2 id="å†…å­˜æ¨¡å‹å’ŒåŸå­æ“ä½œ"><a href="#å†…å­˜æ¨¡å‹å’ŒåŸå­æ“ä½œ" class="headerlink" title="å†…å­˜æ¨¡å‹å’ŒåŸå­æ“ä½œ"></a>å†…å­˜æ¨¡å‹å’ŒåŸå­æ“ä½œ</h2><h1 id="ä»£ç æŠ€å·§"><a href="#ä»£ç æŠ€å·§" class="headerlink" title="ä»£ç æŠ€å·§"></a>ä»£ç æŠ€å·§</h1><h2 id="å¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆï¼ˆWebRTCï¼‰"><a href="#å¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆï¼ˆWebRTCï¼‰" class="headerlink" title="å¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆï¼ˆWebRTCï¼‰"></a>å¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆï¼ˆWebRTCï¼‰</h2><blockquote>
<p>WebRTCå†…å®ç°äº†ä¸shared_ptrç›¸ä¼¼çš„ï¼Œæ”¯æŒå¼•ç”¨è®¡æ•°çš„æ™ºèƒ½æŒ‡é’ˆscoped_refptrã€‚ä¸shared_pträ¸åŒä¹‹å¤„åœ¨äºï¼Œå…¶æŠŠå¼•ç”¨è®¡æ•°ç•™ç»™äº†èµ„æºå¯¹è±¡æ¥å®ç°ï¼Œå› æ­¤æ›´åŠ çµæ´»ã€‚</p>
</blockquote>
<p><a href="https://blog.csdn.net/ice_ly000/article/details/105629297">https://blog.csdn.net/ice_ly000/article/details/105629297</a></p>
<h2 id="pybind11"><a href="#pybind11" class="headerlink" title="pybind11"></a>pybind11</h2>]]></content>
      <categories>
        <category>ç¼–ç¨‹è¯­è¨€</category>
      </categories>
      <tags>
        <tag>C++</tag>
      </tags>
  </entry>
</search>
